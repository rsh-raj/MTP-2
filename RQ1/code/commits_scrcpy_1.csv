Hash,Date,Author,Message,IsMerge
7998811fa55a4f1610dd07680a387251ead2dd1f,2025-03-10 01:46:17,Romain Vimont,Mention that no Android app is required,False
7044122fc59cad404722215f375a711667bc4fa0,2025-03-10 01:40:21,Romain Vimont,Simplify wording in README,False
0ba9d3570560cb46b52a0696134442aeb7f634e6,2025-01-15 15:24:57,Romain Vimont,"Mention virtual display destruction

The new virtual display does not persist after scrcpy exits.",False
cac8e9c821b9b8314d57e84ccbf685929af08794,2025-01-01 19:31:18,Romain Vimont,Happy new year 2025!,False
1c7680f689684fe45b8fa8e1525add5dc3cdfdd2,2025-01-01 19:29:11,Jaime J. Denizard,"Fix some grammatical issues in documentation

PR #5722 <https://github.com/Genymobile/scrcpy/pull/5722>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5ae01749bf4fad9fb4d8bf7c879dc60f479c1013,2024-12-19 23:04:20,Markus,"Reintroduce WinGet install note

This semantically reverts c27ab46efbcab0b9558a91e691d799ffef496c97.

WinGet package has been fixed by:
<https://github.com/microsoft/winget-pkgs/pull/196442>

Refs #4027 <https://github.com/Genymobile/scrcpy/issues/4027>
PR #5686 <https://github.com/Genymobile/scrcpy/pull/5686>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1fd57ede1f7caca8d9dad73b0fe778079fad73f1,2024-12-17 17:39:24,Romain Vimont,"Move ""screen off timeout"" section in documentation

Place the ""screen off timeout"" section right after ""stay awake"", as they
serve a similar purpose.",False
48fc18e3806e6eb77772f9f89671884b40c61714,2024-12-17 16:54:50,Romain Vimont,"Add must-know tips

All users should be aware of the main shortcuts and the most important
setting to improve performance.",False
ea6a94d355b92b103da8931d175f2a4a35e8e301,2024-12-17 16:51:57,Romain Vimont,"Fix mouse documentation formatting

Make the format consistent with the shortcuts documentation.",False
0e2d084751b0513f5db1b7e7afc5460766f4b5c7,2024-12-10 03:12:34,Romain Vimont,Update links to 3.1,False
754f4fc6fec42774183a0e821be2a8852366b7bd,2024-12-10 02:59:51,Romain Vimont,Bump version to 3.1,False
aca6d30af5338e27571ed124ff3ef26479b214c5,2024-12-09 23:37:18,Romain Vimont,"Include dav1d in releases

Scrcpy supports AV1, but no decoder was provided in binary releases.

Include dav1d:
 - <https://www.videolan.org/projects/dav1d.html>
 - <https://code.videolan.org/videolan/dav1d>

Fixes #4744 <https://github.com/Genymobile/scrcpy/issues/4744>
PR #5644 <https://github.com/Genymobile/scrcpy/pull/5644>",False
f2018e026c5748db89a31bc2f3535942c081a9ba,2024-12-09 23:37:03,Romain Vimont,"Remove broken macOS flags

Due to a typo (a space was missing before the second '-L'), the
resulting LDFLAGS value was broken:

    ""-L/opt/homebrew/opt/zlib/lib-L/opt/homebrew/opt/libiconv/lib""

This proves that the flag was useless. Remove it.

Refs #5517 comment <https://github.com/Genymobile/scrcpy/pull/5517#issuecomment-2495522201>
PR #5644 <https://github.com/Genymobile/scrcpy/pull/5644>",False
a507b4f5593d960aacb075082fd7b55cb672ee32,2024-12-09 14:59:20,Simon Chan,"Fix DisplayControl classpath

Use the full system server classpath to load DisplayControl, so that
turning the screen off on Android 14+ does not crash on certain devices.

Refs #4544 comment <https://github.com/Genymobile/scrcpy/issues/4544#issuecomment-2526999714>
Fixes #4544 <https://github.com/Genymobile/scrcpy/issues/4544>
Fixes #5274 <https://github.com/Genymobile/scrcpy/issues/5274>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
a9aadc95df6ec51198430a986ac8f56434b25e9d,2024-12-09 14:03:08,Romain Vimont,"Start cleanup process with setsid()

Reimplement c59a3c3169973abb4ce236e06990d58ae6567481 using Os.setsid().

Refs #5613 comment <https://github.com/Genymobile/scrcpy/pull/5613#issuecomment-2527045669>

Suggested-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
28b5bfb90e76f059571a88931b86eb86f6ca8dd7,2024-12-09 13:59:29,Romain Vimont,"Revert ""Start cleanup process with setsid or nohup""

This reverts commit c59a3c3169973abb4ce236e06990d58ae6567481.

The next commit will use Os.setsid() instead.",False
65256d7cc77216424976eb2ca83befde112c0e26,2024-12-08 22:47:07,Romain Vimont,Upgrade SDL (2.30.10),False
328bb74f8002693e4be2703450305e82fc015e88,2024-12-08 22:46:57,Romain Vimont,"Log gamepad added/removed

Add a log when a gamepad is added or removed.

PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
7418fd06626a2ae405f4bfbe9980a9c4ebd744a7,2024-12-08 21:31:03,Withoutruless,"Use Xbox 360 gamepad name

Some games do not work without a known gamepad name.

Fixes #5362 <https://github.com/Genymobile/scrcpy/issues/5362>
Refs #5623 comment <https://github.com/Genymobile/scrcpy/pull/5623#issuecomment-2525685323>
PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0a09518a49cb495ba76573597cf38169f6813209,2024-12-08 15:30:18,Romain Vimont,"Use Xbox 360 gamepad USB ids

Use the vendorId and productId of an Xbox 360 controller for better
support (the HID gamepad protocol used in scrcpy is similar to that of
the Xbox 360 controller).

Fixes #5362 <https://github.com/Genymobile/scrcpy/issues/5362>
PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
27a5934a1d5365332e4338f76508139dbd61d1ef,2024-12-08 15:30:18,Romain Vimont,"Define UHID vendorId and productId from the client

Let the client choose the USB ids, that it transmits in UHID_CREATE
requests.

PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
86a68fac6c631a01e8d0132eee0fc5a831e78417,2024-12-08 15:30:18,Romain Vimont,"Fix gamepad axis initial values

By default, initialize axis to 0, which is represented by 0x8000 as a
16-bit unsigned value.

PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
1786f28e6f9f9c597f4d66de88c206489cb87122,2024-12-08 15:30:18,Romain Vimont,"Fix gamepad HID descriptor

Use Z and Rz for L2/R2, which are more widely supported than
Brake/Accelerator.

The right stick must then be bound to Rx and Ry.

Fixes #5362 <https://github.com/Genymobile/scrcpy/issues/5362>
PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
9cf4d527215a3f21077b4d28466632be26f72917,2024-12-08 15:30:18,Romain Vimont,"Fix HID gamepad comments

PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
4bd1c5981db307155452fa7594945e069542ddb3,2024-12-08 15:30:18,Romain Vimont,"Split gamepad device added/removed events

Use two separate callbacks for gamepad device added and gamepad device
removed.

It looks cleaner.

PR #5623 <https://github.com/Genymobile/scrcpy/pull/5623>",False
c59a3c3169973abb4ce236e06990d58ae6567481,2024-12-08 15:28:22,Romain Vimont,"Start cleanup process with setsid or nohup

If available, start the cleanup process in a new session to reduce the
likelihood of it being terminated along with the scrcpy server process
on some devices.

The binaries setsid and nohup are often available, but it is not
guaranteed.

Refs #5601 <https://github.com/Genymobile/scrcpy/issues/5601>
PR #5613 <https://github.com/Genymobile/scrcpy/pull/5613>",False
2780e0bd7b7c1d4bdbbfc07e7a2b978b48abf3c2,2024-12-08 15:28:07,Romain Vimont,"Do not interrupt cleanup configuration

Some options, such as --show-touches or --stay-awake, modify Android
settings and must be restored upon exit.

If scrcpy terminates (e.g. due to an early error) in the middle of the
clean up configuration, the device may be left in an inconsistent state
(some settings might be changed but not restored).

This issue can be reproduced with high probability by forcing scrcpy to
fail:

    scrcpy --show-touches --video-encoder=fail

To prevent this problem, ensure that the clean up thread is not
interrupted until the clean up process is started.

Refs #5601 <https://github.com/Genymobile/scrcpy/issues/5601>
PR #5613 <https://github.com/Genymobile/scrcpy/pull/5613>",False
6c6607d404b0e8e886852537c382d3732f3454d7,2024-12-08 14:03:03,Romain Vimont,"Add --no-vd-destroy-content

Add an option to disable the following flag for virtual displays:

    DisplayManager.VIRTUAL_DISPLAY_FLAG_DESTROY_CONTENT_ON_REMOVAL

With this option, when the virtual display is closed, the running apps
are moved to the main display rather than being destroyed.

PR #5615 <https://github.com/Genymobile/scrcpy/pull/5615>",False
988174805c1942c3a06caa6f715d896764b1fb00,2024-12-08 13:56:53,Romain Vimont,"Fix boolean assignment

On --no-vd-system-decoration, the boolean option must be set to false.

It was wrongly assigned from optarg (this worked because optarg is NULL
at this point, so it was converted to false).

PR #5615 <https://github.com/Genymobile/scrcpy/pull/5615>",False
f90dc216d10ac062ab1a06e14e574acc5569d2c3,2024-12-08 00:39:14,Romain Vimont,"Refactor virtual display properties initialization

Following the changes from the previous commit, the behavior is now
identical when mirroring the main display or using the SurfaceControl
API.

Factorize the code to perform the initialization in a single location.

Refs #5605 <https://github.com/Genymobile/scrcpy/issues/5605>
PR #5614 <https://github.com/Genymobile/scrcpy/pull/5614>",False
97fa77c76c5502105a3d128a0be2477a04f4fd1b,2024-12-08 00:38:49,Romain Vimont,"Inject main display events to the original display

When mirroring a secondary display, touch and scroll events must be sent
to the mirroring virtual display id (with coordinates relative to the
virtual display size), rather than to the original display (with
coordinates relative to the original display size).

This behavior, introduced by d19396718ee0c0ba7fb578f595a6553c0458da59,
was also applied for the main display for consistency. However, it
causes some UI elements to become unclickable.

To minimize inconveniences, restore the previous behavior when mirroring
the main display: send all events to the original display id (0) with
coordinates relative to the original display size.

Fixes #5545 <https://github.com/Genymobile/scrcpy/issues/5545>
Fixes #5605 <https://github.com/Genymobile/scrcpy/issues/5605>
Fixes #5616 <https://github.com/Genymobile/scrcpy/issues/5616>
Refs #4598 <https://github.com/Genymobile/scrcpy/issues/4598>
Refs #5137 <https://github.com/Genymobile/scrcpy/issues/5137>
Refs #5370 <https://github.com/Genymobile/scrcpy/pull/5370>
PR #5614 <https://github.com/Genymobile/scrcpy/pull/5614>",False
baa10ed0a36ec775712be85f22d3db3f0a6e19f2,2024-12-05 03:18:27,Romain Vimont,Update links to 3.0.2,False
2ed2247e8fe90eefe6070384aa9895a70569e1b6,2024-12-05 03:05:25,Romain Vimont,"Bump version to 3.0.2

The version was not bumped for 3.0.1.",False
5febb1e9fba646d8fe76f891fed001c49ed59b0d,2024-12-05 02:16:06,Romain Vimont,Update links to 3.0.1,False
5c3626ed47b983625481f852073cef859e7fcaf9,2024-12-04 23:08:23,Romain Vimont,"Handle broken pipe errors specifically

Since 9555d3a537a828731ad89ef5258ba537acf8cc11, a capture/encoding error
was sometimes logged on exit.",False
0e473eb0051e7210e10fb9acef92dad3b956ca1f,2024-12-04 17:46:51,Romain Vimont,"Reset TCP/IP connection with a '+' prefix

When running scrcpy with --tcpip=xx.xx.xx.xx, to make sure a new working
connection is established, it was first disconnected by a call to:

    adb disconnect <addr>

However, this caused all running instances connected to that address to
be killed. Running several instances of scrcpy on the same device is now
useful with virtual displays, so change the default behavior to NOT
disconnect.

To force a reconnection, a '+' prefix can be added:

    scrcpy --tcpip=+192.168.0.x

Fixes #5562 <https://github.com/Genymobile/scrcpy/issues/5562>",False
b26b4fb7458b9e6c361b60198d38b28fbf5e329d,2024-12-04 17:40:35,Romain Vimont,"Document launchers in virtual displays

Mention how to start a launcher in a virtual display.

Refs #5592 <https://github.com/Genymobile/scrcpy/issues/5592>",False
9555d3a537a828731ad89ef5258ba537acf8cc11,2024-12-04 03:36:33,Romain Vimont,"Retry capture on IOException

If the capture fails with an IOException, retry with a lower resolution.

Fixes #5539 <https://github.com/Genymobile/scrcpy/issues/5539>",False
aea6a371aa3f5278c8b10cf6bec7bbe215ae1518,2024-12-02 22:53:18,Romain Vimont,"Remove scrcpy wrapper script for static builds

All portable builds now use the files located in the same directory as
the scrcpy executable by default.

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>",False
dc6c279b1e500e4c39fd0adcad425e6eab2f6944,2024-12-02 22:53:18,Romain Vimont,"Log adb executable path

Log the ADB executable path (at the DEBUG level) if it is not the
default one.

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>",False
6d0ac3626dbc8a5ffa6693a00f370f4f93660cd8,2024-12-02 22:53:18,Romain Vimont,"Use local adb in portable builds

For non-Windows portable builds, use the absolute path to the adb
executable located in the same directory as scrcpy.

On Windows, just use ""adb"", which is sufficient to use the local one.

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>",False
beee42fb065a4852082e3f949cb4ee20c184f104,2024-12-02 22:53:18,Romain Vimont,"Load ADB value using sc_get_env()

Contrary to getenv(), the result of sc_get_env() is encoded in UTF-8 on
all platforms. Since it is allocated, it requires an explicit init() and
destroy() functions.

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>",False
131372d2c4b430b01b137e2a0debb21a33963bba,2024-12-02 22:53:18,Romain Vimont,"Expose sc_get_env() to read environment variable

Contrary to getenv(), sc_get_env() returns an allocated string that is
guaranteed to be encoded in UTF-8 on all platforms (it uses _wgetenv()
internally on Windows and converts the strings).

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>",False
0fd7534bd5a5bb3e3556b964f58a4082d941fa81,2024-12-02 22:53:18,Genxster1998,"Add method to get executable path on MacOS

PR #5560 <https://github.com/Genymobile/scrcpy/pull/5560>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
36574d2ee7b5084a64c54951e7c97f5a46ed0388,2024-12-02 13:24:57,Romain Vimont,"Fix .tar.gz compression

The generated .tar.gz releases were in fact non-gzipped tarballs.

Fixes #5581 <https://github.com/Genymobile/scrcpy/issues/5581>",False
3b2b3625e478855392c98367818a360dfba239bf,2024-12-01 21:52:47,Romain Vimont,"Accept positional control events without display

The position of touch and scroll must normally be ""resolved"" with a
""position mapper"" associated to the display.

But to support the injection of such events with scrcpy-server alone
without video, handle the case where there is no display.

Fixes #5542 <https://github.com/Genymobile/scrcpy/issues/5542>",False
b2cdaa4bdce0adc256b87c3271c39a1482817dc6,2024-12-01 21:52:47,Romain Vimont,"Factorize position mapper resolution

The code was duplicated for touch and scroll events. Extract it to a
private function.

Refs #5542 <https://github.com/Genymobile/scrcpy/issues/5542>",False
d01373c03c135c0882c49c8bf95006d32fef041c,2024-11-29 01:32:51,Romain Vimont,"Enable close-on-interrupt for macOS

This behavior is also necessary on macOS.

Fixes #5536 <https://github.com/Genymobile/scrcpy/issues/5536>",False
ff06b6dcc1dde8fb750191e07ba476b2de0c9927,2024-11-29 01:32:31,Romain Vimont,"Split network macro conditions

On Windows, interrupting a socket with shutdown() does not wake up
accept() or read() calls, the socket must be closed.

Introduce a new macro constant SC_SOCKET_CLOSE_ON_INTERRUPT, distinct of
_WIN32, because Windows will not be the only platform exhibiting this
behavior.

Refs #5536 <https://github.com/Genymobile/scrcpy/issues/5536>",False
017a3672a49b55c7943217089f506a55fea8d834,2024-11-29 00:39:21,Romain Vimont,"Check GitHub runner architecture

Make sure that the releases are built for the expected target arch.",False
c1351b250e4824017d876143b39a0d643d7a0f65,2024-11-29 00:39:21,Genxster1998,"Build macOS x86_64 release

Add actions to build a release for macOS x86_64 in addition to the
aarch64 version.

PR #5526 <https://github.com/Genymobile/scrcpy/pull/5526>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
618a978f5b3a37ba08ee7f9832a77fba4e19c667,2024-11-29 00:39:18,Romain Vimont,"Specify architecture for Linux and macOS releases

PR #5526 <https://github.com/Genymobile/scrcpy/pull/5526>

Co-authored-by: Genxster1998 <ck.2229.ck@gmail.com>",False
acddd811bf9192fce2ca3332b6f7f654b3d3a0e6,2024-11-29 00:29:06,Romain Vimont,"Rename TARGET to TARGET_DIRNAME

This avoids confusion with ""$1"", which is also documented as ""<target>"".

If ""$1"" (the target) is ""linux"", then TARGET_DIRNAME is
""scrcpy-linux-v3.0"".",False
ee9f7126ffba412d7a7b3119c55b968d5d6e7502,2024-11-29 00:28:41,Romain Vimont,"Use FORMAT variable name in package_client.sh

The format is used several times, avoid using ""$2"" directly.",False
a18ed1ee7ab10143239e8bf979cfa9bf938a4ea3,2024-11-29 00:28:08,Romain Vimont,"Simplify GitHub actions step descriptions

Each step is executed within the context of an action, so mentioning the
name of the action is unnecessary.",False
678025b31672c230575fe2dbc4a0d487d5010bb1,2024-11-29 00:10:47,Romain Vimont,"Remove apt update on GitHub Actions

Assume the image is up-to-date.",False
3e689020baa1b3ea1b66cba3260a7a33be458a06,2024-11-27 12:15:35,Romain Vimont,"Fix null return value in DisplayManager.toString()

Ensure DisplayListener.toString() returns a non-null value to prevent a
NullPointerException on certain devices.

Fixes #5537 <https://github.com/Genymobile/scrcpy/issues/5537>",False
3d1f036c04412e17a694e6a0b857b7f9e9217ab3,2024-11-26 20:25:16,Romain Vimont,"Rollback to old --turn-screen-off for Android 15

When the screen is turned off with the new display power method
introduced in Android 15, video mirroring freezes.

Use the Android 14 method for Android 15.

Refs 58ba00fa060c9a1f439120f8869ed106e1c935f9
Refs #5418 <https://github.com/Genymobile/scrcpy/pull/5418>
Fixes #5530 <https://github.com/Genymobile/scrcpy/issues/5530>",False
3d5294c1e5819535dfa94bd399e53191283105cd,2024-11-26 20:13:41,Romain Vimont,"Set main display power for virtual display

Change the display power of the main display when mirroring a virtual
display, to make it possible to turn off the screen.

Fixes #5522 <https://github.com/Genymobile/scrcpy/issues/5522>
Refs #5530 <https://github.com/Genymobile/scrcpy/issues/5530>",False
1d2f16dbb53facdb2ea174578437a2a5afb6aede,2024-11-26 18:40:11,Romain Vimont,"Fix documentation about default mouse mode

When video playback is turned off, the default mouse mode has changed
from ""uhid"" to ""disabled"" in 2c25fd7a8082307da19645a690c31403903fbb1e.

Update the documentation accordingly.

Refs #5410 <https://github.com/Genymobile/scrcpy/issues/5410>
Refs #5542 <https://github.com/Genymobile/scrcpy/issues/5542>",False
7fef05197674aa82b7c81541411115704fc9599f,2024-11-26 00:36:32,Romain Vimont,"Add BlueSky link

Scrcpy now has a BlueSky account.",False
da8ade88fd0b1c15c5ae07cd276b3cffa2e5382e,2024-11-25 12:51:06,Wouter Schoot,"Fix link to virtual display doc in README

PR #5525 <https://github.com/Genymobile/scrcpy/pull/5525>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
74aecc00b512969fa3b067ed3cf20e12194206d2,2024-11-24 23:00:01,Romain Vimont,Update links to 3.0,False
5e05f2a25bfdc35840bef81583f02b0ba127b32b,2024-11-24 22:22:54,Romain Vimont,Bump version to 3.0,False
3d478d7d5b19839b10b581b14be0140793fcbeb0,2024-11-24 22:22:53,Romain Vimont,"Build FFmpeg with v4l2 support for Linux

So that --v4l2-sink works with Linux static builds.",False
54e1f8e060ca77f9b5dac1a2f57ea7cdf0de83c3,2024-11-24 21:20:47,Romain Vimont,Include scrcpy manpage in Linux and macOS releases,False
d40224f299b29d614bbdb2ff0e160b6cccd9af03,2024-11-24 21:07:32,Romain Vimont,Fix alphabetic order of cli args,False
0628ffcb0bd09750577955a35a0449bb1025bc74,2024-11-24 20:31:05,Romain Vimont,Merge branch 'master' into release,True
6f9520f3e2f7df6061bfc06053d7d92aba9a24b8,2024-11-24 20:16:37,Romain Vimont,"Test build_without_gradle.sh in GitHub Actions

Build the server without gradle to make sure that the script works.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
a7efb180b9befa576513c31e2db0340d0ee33aeb,2024-11-24 20:16:23,Romain Vimont,"Add script to release macOS static binary

Provide a prebuilt binary for macOS.

Fixes #1733 <https://github.com/Genymobile/scrcpy/issues/1733>
Fixes #3235 <https://github.com/Genymobile/scrcpy/issues/3235>
Fixes #4489 <https://github.com/Genymobile/scrcpy/issues/4489>
Fixes #5327 <https://github.com/Genymobile/scrcpy/issues/5327>
PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>

Co-authored-by: Muvaffak Onus <me@muvaf.com>",False
28c372e8387c3473613e6653f58c934f81d8fb2f,2024-11-24 20:11:13,Muvaffak Onus,"Use generic command for SHA-256

The command sha256sum does not exist on macOS, but `shasum -a256` works
both on Linux and macOS.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
cb19686d7950113039f4f478998df8d9ae7ed985,2024-11-24 20:11:13,Romain Vimont,"Add script to release Linux static binary

Provide a prebuilt binary for Linux.

Fixes #5327 <https://github.com/Genymobile/scrcpy/issues/5327>
PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
93da693e8c15fe2a1065c37636ab9fa945cb1254,2024-11-24 20:11:13,Romain Vimont,"Add support for .tar.gz packaging

Make package_client.sh accept an archive format.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
179c664e2b78f7b1406dc1eed28031591c20934c,2024-11-24 20:11:13,Romain Vimont,"Add static build option

Use static dependencies if the option is set.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
360936248c0fb59bdc211e298d1aaea49af5ee07,2024-11-24 20:11:13,Romain Vimont,"Add support for build and link types for deps

Make dependencies build scripts more flexible, to accept a build type
(native or cross) and a link type (static or shared).

This lays the groundwork for building binaries for Linux and macOS.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
98d2065d6d06d44b3c7af3d199e29cabc6f58b80,2024-11-24 20:11:13,Romain Vimont,"Make the ADB dependency script Windows-specific

This will allow adding similar scripts for other platforms.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
6a81fc438b6457eaab6efe61c41c194791b9439f,2024-11-24 20:11:13,Romain Vimont,"Extract args processing in deps scripts

Extract the code that processes arguments into a function.

This will make it optional, so the script that only downloads the
official ADB binaries will not use arguments.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
cf0098abf0f4198e199f373f7831673f86be44c0,2024-11-24 20:11:13,Romain Vimont,"Store dependencies configure args in bash arrays

This will make it easy to conditionally add items.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
73b595c806db12e78a5f37de2476309b56a0fac9,2024-11-24 20:11:13,Romain Vimont,"Disable VDPAU and VAAPI for FFmpeg build

They are not used, and this prevents Linux builds from working if the
dependencies are unavailable.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
d74f564f563f17a807106b4d2507a6cd4b6cbc3f,2024-11-24 20:11:13,Romain Vimont,"Reorder FFmpeg configure args

All --disable, then all --enable.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
7fc694328483319105408e0bb767c6eb2341632b,2024-11-24 20:11:13,Romain Vimont,"Preserve file permissions in GitHub Actions

The upload-artifact action does not preserve file permissions:
<https://github.com/actions/upload-artifact?#permission-loss>

Even if it is not critical for Windows releases, it will be for other
platforms. Wrap everything in a tarball to keep original permissions.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
a57180047c58b37ad135c6bd322b02d7122f6dd4,2024-11-24 20:11:13,Romain Vimont,"Split packaging for each target on CI

Create separate jobs for packaging win32 and win64 releases.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
5df218d8f9419f555000fb21758bad46350064fb,2024-11-24 20:11:13,Romain Vimont,"Test scrcpy-server in a separate CI job

Use a separate GitHub Action job to build and test the server.

PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
26bf209617d9bf633307eaf9051c03fa0a9f631c,2024-11-24 20:10:34,Romain Vimont,"Replace release.mk by release scripts

Since commit 2687d202809dfaafe8f40f613aec131ad9501433, the Makefile
named release.mk stopped handling dependencies between recipes, because
they have to be executed separately (from different Github Actions
jobs).

Using a Makefile no longer provides any real benefit. Replace it by
several individual release scripts for simplicity and readability.

Refs #5306 <https://github.com/Genymobile/scrcpy/pull/5306>
PR #5515 <https://github.com/Genymobile/scrcpy/pull/5515>",False
dc82425769ab0fce545a5c76658fc7ba774468ad,2024-11-24 16:54:32,Enno Boland,"Add debugging method for Android >= 11

Fixes #5346 <https://github.com/Genymobile/scrcpy/issues/5346>
PR #5466 <https://github.com/Genymobile/scrcpy/pull/5466>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9f39a5f2d6b89b2f57bf003c81163affc3bf0c60,2024-11-22 15:34:32,Romain Vimont,"Determine debugger command at runtime

When server_debugger is enabled, retrieve the device SDK version to
execute the correct command.

PR #5466 <https://github.com/Genymobile/scrcpy/pull/5466>",False
24588cb637496c04330bf12f6350a1369b08a718,2024-11-22 12:18:48,Romain Vimont,"Add missing aidl in build_without_gradle.sh

Refs 39d51ff2cc2f3e201ad433d48372b548e5dd11d3
Fixes #5512 <https://github.com/Genymobile/scrcpy/issues/5512>",False
0e50d1e7dba940bdf3875bfa3855b4227f40a861,2024-11-22 12:17:24,Romain Vimont,"Extract PLATFORM_TOOLS in build_without_gradle.sh

Refs #5512 <https://github.com/Genymobile/scrcpy/issues/5512>",False
264110fd70cbdc1350c08618d158d34bf4c55bbd,2024-11-21 23:06:23,Romain Vimont,"Dissociate virtual display size and capture size

Allow capturing virtual displays at a lower resolution using
-m/--max-size.

In the original implementation in #5370, the virtual display size was
necessarily the same as the capture size. The --max-size value was only
allowed to determine the virtual display size when no explicit size was
provided.

Since the dpi was scaled down accordingly, it is often better to create
a virtual display at the target capture size directly. However, not
everything is rendered according to the virtual display DPI. For
example, a page in Firefox is rendered too big on small virtual
displays. Thus, it makes sense to be able create a virtual display at a
given size, and capture it at a lower resolution with --max-size. This
is now possible using OpenGL filters.

Therefore, change the behavior of --max-size for virtual displays:
 - --max-size does not impact --new-display without size argument
   anymore (the virtual display size is the main display size);
 - it is used to limit the capture size (whether an explicit size is
   provided or not).

This new behavior is consistent with main display capture.

Refs #5370 comment <https://github.com/Genymobile/scrcpy/pull/5370#issuecomment-2438944401>
Refs #5370 <https://github.com/Genymobile/scrcpy/pull/5370>
PR #5506 <https://github.com/Genymobile/scrcpy/pull/5506>",False
4608a19a1313c3c2805ca05a3106798504ecb642,2024-11-20 12:44:04,Romain Vimont,"Upgrade platform-tools (35.0.2) for Windows

Since 35.0.1, the filename has changed on the server from -windows.zip
to -win.zip

The links are referenced from this file:
<https://dl.google.com/android/repository/repository2-2.xml>

Refs <https://www.reddit.com/r/Android/comments/1fhbs7w/download_links_to_platformtoolsadb/>",False
f1f27116269ecbe422fd853ec192e3a80e168f76,2024-11-20 12:34:47,Gutem,"Document missing --cask option for macOS

Installing android-platform-tools via brew install requires the option
--cask.

Refs #2004 <https://github.com/Genymobile/scrcpy/pull/2004>
Refs #2231 <https://github.com/Genymobile/scrcpy/pull/2231>
PR #5398 <https://github.com/Genymobile/scrcpy/pull/5398>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
eeb04292a47f7ef7519b2eb9fd5c06a81bb69352,2024-11-20 12:27:35,Romain Vimont,Upgrade SDL (2.30.9) for Windows,False
2ec30bdf8038899b0b0c0fdb4924725561072c66,2024-11-20 12:25:13,backryun,"Upgrade FFmpeg (7.1) for Windows

PR #5332 <https://github.com/Genymobile/scrcpy/pull/5332>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
145b823b1d029a34f640d5a3f231439e45b0eaf7,2024-11-20 12:20:45,Romain Vimont,"Add --no-vd-system-decorations

Add an option to disable the following flag for virtual displays:

    DisplayManager.VIRTUAL_DISPLAY_FLAG_SHOULD_SHOW_SYSTEM_DECORATIONS

Some devices render a broken UI when this flag is enabled.

Fixes #5494 <https://github.com/Genymobile/scrcpy/issues/5494>",False
28d64ef319337f2313d74be4d16653774ec8185e,2024-11-20 12:19:58,Romain Vimont,"Fix --new-display bash completion

The option --new-display accepts an optional argument, but bash must not
try to auto-complete it with unrelated content.",False
36d61f9ecd853104ba838d8df18102c31320fd0c,2024-11-20 02:01:04,Romain Vimont,"Reference virtual display documentation

Reference the documentation about virtual displays from the ""Display""
section of video.md.",False
f95a5f97b1944b948a45218d349d2acf8e19ac3b,2024-11-20 02:01:04,Romain Vimont,"Document filter order

Matrix multiplication is not commutative, so the order of filters
matters.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
adb674a5c890bf2553149059bfc22ba9df86a04b,2024-11-20 02:01:04,Romain Vimont,"Add --angle

Add an option to rotate the video content by a custom angle.

Fixes #4135 <https://github.com/Genymobile/scrcpy/issues/4135>
Fixes #4345 <https://github.com/Genymobile/scrcpy/issues/4345>
Refs #4658 <https://github.com/Genymobile/scrcpy/pull/4658>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
d19045628e422d8e969a137580bb9e6496ec51fc,2024-11-20 02:01:04,Romain Vimont,"Remove deprecated options

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
443f315f609b2bbd7d7c4f8e9ffc2b41bdc381f7,2024-11-20 02:01:04,Romain Vimont,"Use natural device orientation for --new-display

If no size is provided with --new-display, the main display size is
used. But the actual size depended on the current device orientation.

To make it deterministic, use the size of the natural device orientation
(portrait for phones, landscape for tablets).

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
090488081652593a795ea40697ce703bb5b2a59c,2024-11-20 02:01:04,Romain Vimont,"Log event size mismatch as verbose

On rotation, it is expected that many successive events are ignored due
to size mismatch, when an event was generated from the mirroring window
having the old size, but was received on the device with the new size
(especially since mouse hover events are forwarded).

Do not flood the console with warnings.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
4348f12194b5e44e710e61786b452ebe4b9eb850,2024-11-20 02:01:04,Romain Vimont,"Improve mismatching event size warning

Include both the event size and the current size in the warning message.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
371ff3122590f35996f904d99d02a58986a8c617,2024-11-20 02:01:04,Romain Vimont,"Apply filters to virtual display capture

Apply crop and orientation to virtual display capture.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
456fa510f25039d6cd016eb9293a82be1f7a2653,2024-11-20 02:01:04,Romain Vimont,"Apply filters to camera capture

Apply crop and orientation to camera capture.

Fixes #4426 <https://github.com/Genymobile/scrcpy/issues/4426>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
45382e3f017ea17925243b5cdcdeb3b1a5a44a37,2024-11-20 02:01:04,Romain Vimont,"Add --capture-orientation

Deprecate --lock-video-orientation in favor of a more general option
--capture-orientation, which supports all possible orientations
(0, 90, 180, 270, flip0, flip90, flip180, flip270), and a ""locked"" flag
via a '@' prefix.

All the old ""locked video orientations"" are supported:
 - --lock-video-orientation      ->  --capture-orientation=@
 - --lock-video-orientation=0    ->  --capture-orientation=@0
 - --lock-video-orientation=90   ->  --capture-orientation=@90
 - --lock-video-orientation=180  ->  --capture-orientation=@180
 - --lock-video-orientation=270  ->  --capture-orientation=@270

In addition, --capture-orientation can rotate/flip the display without
locking, so that it follows the physical device rotation.

For example:

    scrcpy --capture-orientation=flip90

always flips and rotates the capture by 90° clockwise.

The arguments are consistent with --display-orientation and
--record-orientation and --orientation (which provide separate
client-side orientation settings).

Refs #4011 <https://github.com/Genymobile/scrcpy/issues/4011>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
9b03bfc3ae881f639f9c4bb381eef7365b785437,2024-11-20 02:01:04,Romain Vimont,"Handle virtual display rotation

Listen to display size changes and rotate the virtual display
accordingly.

Note: use `git show -b` to Show this commit ignoring whitespace changes.

Fixes #5428 <https://github.com/Genymobile/scrcpy/issues/5428>
Refs #5370 <https://github.com/Genymobile/scrcpy/pull/5370>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
39d51ff2cc2f3e201ad433d48372b548e5dd11d3,2024-11-20 02:01:04,Anric,"Use DisplayWindowListener for Android 14

On Android 14, DisplayListener may be broken (it never sends events).
This is fixed in recent Android 14 upgrades, but we can't really detect
it directly.

As a workaround, a RotationWatcher and DisplayFoldListener were
registered as a fallback, until a first ""display changed"" event was
triggered.

To simplify, on Android 14, register a DisplayWindowListener (introduced
in Android 11) to listen to configuration changes instead.

Refs #5455 comment <https://github.com/Genymobile/scrcpy/pull/5455#issuecomment-2481302084>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d72686c867dcde973f4666117128f2fc38888a1b,2024-11-20 02:01:04,Romain Vimont,"Extract display size monitor

Detecting display size changes is not straightforward:
 - from a DisplayListener, ""display changed"" events are received, but
   this does not imply that the size has changed (it must be checked);
 - on Android 14 (see e26bdb07a21493d096ea5c8cfd870fc5a3f015dc),
   ""display changed"" events are not received on some versions, so as a
   fallback, a RotationWatcher and a DisplayFoldListener are registered,
   but unregistered as soon as a ""display changed"" event is actually
   received, which means that the problem is fixed.

Extract a ""display size monitor"" to share the code between screen
capture and virtual display capture.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
06385ce83bcfd57ac82e2f5ca4d9575fe1f1649f,2024-11-20 02:01:04,Romain Vimont,"Reimplement lock orientation using transforms

Reimplement the --lock-video-orientation feature using affine
transforms.

Fixes #4011 <https://github.com/Genymobile/scrcpy/issues/4011>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
9fb0a3dac1770c51758f578bca0b8e349e164e84,2024-11-20 02:01:04,Romain Vimont,"Reimplement crop using transforms

Reimplement the --crop feature using affine transforms.

Fixes #4162 <https://github.com/Genymobile/scrcpy/issues/4162>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
23960ca11ab676dc85f6c0f6e6f447efed92bba9,2024-11-20 02:01:04,Romain Vimont,"Ignore signalEndOfStream() error

This may be called at any time to interrupt the current encoding,
including when MediaCodec is in an expected state.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
904f86152ea7693f481e29cdfd8327ac58eb8c34,2024-11-20 02:01:04,Romain Vimont,"Move mediaCodec.stop() to finally block

This will allow stopping MediaCodec only after the cleanup of other
components which must be performed beforehand.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
e226950cfab9b9e8f2fe8620dc9970bcf13133ee,2024-11-20 02:01:04,Romain Vimont,"Make PositionMapper use affine transforms

This will allow applying transformations performed by video filters.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
019ce5eea4e8d0655ab481ab59ac498c3be51d0f,2024-11-20 02:01:04,Romain Vimont,"Temporarily ignore lock video orientation and crop

Get rid of old code implementing --lock-video-orientation and --crop
features on the device side.

They will be reimplemented differently.

Refs #4011 <https://github.com/Genymobile/scrcpy/issues/4011>
Refs #4162 <https://github.com/Genymobile/scrcpy/issues/4162>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
d6033d28f5a326409218bab15acc432b305cb23f,2024-11-20 02:01:04,Romain Vimont,"Split computeVideoSize() into limit() and round8()

Expose two methods on Size directly:
 - limit() to downscale a size;
 - round8() to round both dimensions to multiples of 8.

This will allow removing ScreenInfo completely.

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
89518f49adb59dfa961f76be3f4414bffdc22cc5,2024-11-20 02:01:04,Romain Vimont,"Revert ""Disable broken options on Android 14""

This reverts commit d62fa8880e03e8823057a5d4d9659d5f19132806.

These options will be reimplemented differently.

Refs #4011 <https://github.com/Genymobile/scrcpy/issues/4011>
Refs #4162 <https://github.com/Genymobile/scrcpy/issues/4162>
PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
2a04858a2271fdb44a0eeaeeadaedfc966eab48d,2024-11-20 02:01:04,Romain Vimont,"Add on-device OpenGL video filter architecture

Introduce several key components to perform OpenGL filters:
 - OpenGLRunner: a tool for running a filter to be rendered to a Surface
   from an OpenGL-dedicated thread
 - OpenGLFilter: a simple OpenGL filter API
 - AffineOpenGLFilter: a generic OpenGL implementation to apply any 2D
   affine transform
 - AffineMatrix: an affine transform matrix, with helpers to build
   matrices from semantic transformations (rotate, scale, translate…)

PR #5455 <https://github.com/Genymobile/scrcpy/pull/5455>",False
e411b74a16a12f95c52f0c7a4c9c4f0ab1a3bc8d,2024-11-18 23:18:26,Matthias Stock,"Use explicit file protocol for AVIO

AVIO expects a `url` to locate a resource.

Use the file protocol to handle filenames containing colons.

Fixes #5487 <https://github.com/Genymobile/scrcpy/issues/5487>
PR #5499 <https://github.com/Genymobile/scrcpy/pull/5499>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5694562a74e068df17193f25c9b1dbdd9342e0c0,2024-11-18 23:17:57,Romain Vimont,"Remove duplicate log

The function prepareRetry() already logs a more detailed message:

    Retrying with -mXXXX...",False
bd9d93194b04970655b22f1eb96d5ad2bd4f2c75,2024-11-16 00:46:04,Romain Vimont,"Pass Options instance directly

Many constructors take a lot of parameters copied from Options. For
simplicity, just pass the Options instance.",False
794595e3f0db8208a2a1df30c1c5e9442deb4112,2024-11-16 00:46:04,Romain Vimont,"Set displayId to NONE in Options on new display

If a new display is set, force options.getDisplayId() to return
Device.DISPLAY_ID_NONE, to avoid any confusion between a local displayId
and options.getDisplayId().",False
5e10c37f02cb41054257dc895a5aae7d9df7dd89,2024-11-16 00:46:04,Romain Vimont,"Define all DisplayManager flags locally

For consistency.",False
0e399b65bd2f32f93a0372ed0d64cdc2ba223d86,2024-11-16 00:46:04,Romain Vimont,"Remove [] around app package names

This simplifies copy-pasting from the result of:

    scrcpy --list-apps",False
2337f524d167e210a2985d691e5695e5b7e3249f,2024-11-16 00:46:04,Romain Vimont,"Improve error message on unknown camera id

If the camera id is explicitly provided (via --camera-id), report a
user-friendly error if no camera with this id is found.",False
df74cceb6fe115bd39e862612a14a1e1483b1529,2024-11-16 00:46:04,Romain Vimont,"Use camera prepare() step

For consistency with screen capture.

Refs b60e1747809cce58793a8c0d54b499df87a6a975",False
91373d906b100349de959f49172d4605f66f64b2,2024-11-14 14:59:03,Simon Chan,"Add FakeContext.getContentResolver()

This avoids the following error on some devices:

    Given calling package android does not match caller's uid 2000

Refs #4639 comment <https://github.com/Genymobile/scrcpy/issues/4639#issuecomment-2466081589>
Fixes #4639 <https://github.com/Genymobile/scrcpy/issues/4639>
PR #5476 <https://github.com/Genymobile/scrcpy/pull/5476>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
04dd72b5944dbe8de2a2fa438f920e88c03e4ff8,2024-11-13 17:26:35,Romain Vimont,"Add ""how to run"" link for Windows

Reference the documentation explaining how to run scrcpy on Windows
directly in the main README.",False
762816cac62b39a58bebf129fb6e00bd24a4594b,2024-11-13 17:24:25,Romain Vimont,"Remove quotes for --video-encoder in documentation

Refs ec602a0334357982d75b374f7ac753c5bef1216a",False
c0e2e27cf9eb38a95b324ba9aeeb34dab6d2e72f,2024-11-11 13:30:40,Simon Chan,"Force javac to use UTF-8

The source files are encoded in UTF-8.

Refs <https://github.com/Genymobile/scrcpy/issues/4639#issuecomment-2467206100>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
eff5b4b219be6043a3baf51149b1d6752569a173,2024-11-09 14:56:59,Romain Vimont,"Add --screen-off-timeout

Change the Android ""screen off timeout"" (the idle delay before the
screen automatically turns off) and restore the initial value on
exit.

PR #5447 <https://github.com/Genymobile/scrcpy/pull/5447>",False
d3db9c40653d4c1eaafda1ece2abe57acad94906,2024-11-09 14:56:43,Romain Vimont,"Refactor clean up configuration to simplify

All options were configured dynamically by sending a single byte to an
output stream. But in practice, only the power mode must be changed
dynamically, the others are configured once on start.

For simplicity, pass the value of static options as command line
arguments, and handle dynamic options in a loop only from a separate
thread once the clean up process is started.

This will allow to easily add cleanup options with values which do not
fit in 1 byte.

Also handle the clean up thread (and the loading of initial settings
values) from the CleanUp class, to expose a simpler clean up API.

Refs 9efa162949c2a3e3e42564862ff390700270394d
PR #5447 <https://github.com/Genymobile/scrcpy/pull/5447>",False
5936167ff77b543a533c7f6a5fa42d78ca5d724f,2024-11-05 03:47:43,Romain Vimont,"Store compensation state as a boolean

We don't need to store the last compensation value anymore, we just need
to know if it's non-zero.",False
e9dd0f68adc59bae67f04bc859a8287785771ace,2024-11-05 03:39:54,Romain Vimont,"Fix audio regulator compensation

A call to swr_set_compensation() configures the resampler to drop or
duplicate ""diff"" samples over an interval of ""distance"" samples.

If the function is not called again, then after ""distance"" samples, no
more compensation will be applied. So it must always be called, even if
the new computed diff value happens to be the same as the previous one.

In practice, it is unlikely that the diff value is exactly the same
every second, except when it is actively clamped (to 2% of the sample
rate).",False
104195fc3bdcd69481ede5ff2808be0a1f1d6e5e,2024-11-04 00:01:02,Romain Vimont,"Add shortcut to reset video capture/encoding

Reset video capture/encoding on MOD+Shift+r.

Like on device rotation, this starts a new encoding session which
produces a video stream starting by a key frame.

PR #5432 <https://github.com/Genymobile/scrcpy/pull/5432>",False
9958302e6f8780c7aa547186c70b493137986701,2024-11-03 23:57:11,Romain Vimont,"Interrupt MediaCodec blocking call on reset

When the MediaCodec input is a Surface, no EOS (end-of-stream) will
never occur automatically: it may only be triggered manually by
MediaCodec.signalEndOfInputStream().

Use this signal to interrupt the blocking call to dequeueOutputBuffer()
immediately on reset, without waiting for the next frame to be dequeued.

PR #5432 <https://github.com/Genymobile/scrcpy/pull/5432>",False
69b836930a1d33d2aeebd17eed67c264c084c37d,2024-11-03 23:56:55,Romain Vimont,"Handle capture reset via listener

When the capture source becomes ""invalid"" (because the display size
changes for example), a reset request is performed to restart the
encoder.

The reset state was stored in SurfaceCapture. The capture implementation
set the flag, and the encoder consumed it.

However, this mechanism did not allow a reset request to _interrupt_ the
encoder, which may be waiting on a blocking call (until a new frame is
produced).

To be able to interrupt the encoder, a reset request must not only set a
flag, but run a callback provided by the encoder. For that purpose,
introduce the CaptureListener interface, which is notified by the
SurfaceCapture implementation whenever the capture is invalidated.

For now, the listener implementation just set a flag as before, so the
behavior is unchanged. It lays the groundwork for the next commits.

PR #5432 <https://github.com/Genymobile/scrcpy/pull/5432>",False
790ea5e58c97a8635ba0326b2b3268ef77bdaae0,2024-11-03 23:40:44,Romain Vimont,"Check screen on for current displayId

Since Android 14, the ""screen on"" state can be checked per-display.

Refs <https://android.googlesource.com/platform/frameworks/base.git/+/956f4084df825f3dcfc5583d6e6d1f593f770811%5E!/#F17>
PR #5442 <https://github.com/Genymobile/scrcpy/pull/5442>",False
1270997f6beb9574dc0ce46e4961f031ca7fb7c5,2024-11-03 23:32:57,Romain Vimont,"Remove useless assignment

The local variable virtualDisplayId was already initialized to the exact
same value.",False
c905fbba8d383af3a128390a95f26f9ab986486e,2024-11-03 23:32:37,Romain Vimont,Fix indentation,False
f08a6d86c5d84aa48c1c197d8f92f322768515cb,2024-11-02 23:21:05,Romain Vimont,"Power on the device only for main display

Power on the device on start only if scrcpy is mirroring the main
display.",False
3ac4b64461716ff472e62ef13b0947dfff98cb2e,2024-11-02 23:19:08,Romain Vimont,"Register rotation watcher for non-main displays

While moving code, commit 874eaec487369f7fcaa9ed8c5f85569659565d4f added
a condition `if (displayId == 0)` to register a rotation watcher,
without good reasons.

This condition was kept when the rotation watcher was moved to a
fallback in e26bdb07a21493d096ea5c8cfd870fc5a3f015dc.

Note: use `git show -b` to show this commit ignoring whitespace changes.

Refs #5428 <https://github.com/Genymobile/scrcpy/issues/5428>",False
c7378f4dc843d24699349812661867c07af3954d,2024-11-01 03:19:03,Romain Vimont,"Extract setting display power to a separate method

For consistency with the other actions.",False
e26bdb07a21493d096ea5c8cfd870fc5a3f015dc,2024-11-01 00:42:23,Romain Vimont,"Listen to display changed events

Replace RotationWatcher and DisplayFoldListener by a single
DisplayListener, which is notified whenever the display size or dpi
changes.

However, the DisplayListener mechanism is broken in the first versions
of Android 14 (it is fixed in android-14.0.0_r29 by commit [1]), so
continue to use the old mechanism specifically for Android 14 (where
DisplayListener may be broken), until we receive the first
""display changed"" event (which proves that it works).

[1]: <https://android.googlesource.com/platform/frameworks/base.git/+/5653c6b5875df599307c3e6bfae32fb2fc17ca1f%5E%21/>

Fixes #161 <https://github.com/Genymobile/scrcpy/issues/161>
Fixes #1918 <https://github.com/Genymobile/scrcpy/issues/1918>
Fixes #4152 <https://github.com/Genymobile/scrcpy/issues/4152>
Fixes #5362 comment <https://github.com/Genymobile/scrcpy/issues/5362#issuecomment-2416219316>
Refs #4469 <https://github.com/Genymobile/scrcpy/pull/4469>
PR #5415 <https://github.com/Genymobile/scrcpy/pull/5415>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
04a3e6fb06377fc75eef805147e55f93877b3e86,2024-11-01 00:42:23,Romain Vimont,"Consume reset request on encoding start

If a reset request is pending when a new encoding starts, then it is
implicitly fulfilled.

PR #5415 <https://github.com/Genymobile/scrcpy/pull/5415>",False
c29ecd0314352661e826d8474b5d275d5ac660f2,2024-11-01 00:27:52,Romain Vimont,"Rename --display-buffer to --video-buffer

For consistency with --audio-buffer, rename --display-buffer to
--video-buffer.

Fixes #5403 <https://github.com/Genymobile/scrcpy/issues/5403>
PR #5420 <https://github.com/Genymobile/scrcpy/pull/5420>",False
d62fa8880e03e8823057a5d4d9659d5f19132806,2024-11-01 00:25:47,Romain Vimont,"Disable broken options on Android 14

The options --lock-video-orientation and --crop are broken since Android
14. Hopefully, they will be reimplemented differently.

Meanwhile, when running Android >= 14, fail with an error to prevent
incorrect behavior.

Refs #4011 <https://github.com/Genymobile/scrcpy/issues/4011>
Refs #4162 <https://github.com/Genymobile/scrcpy/issues/4162>
PR #5417 <https://github.com/Genymobile/scrcpy/pull/5417>",False
1f6634ea87b36c2c6fe08af90b983c69294ee74d,2024-10-31 02:53:53,Romain Vimont,"Document adb shell settings commands

Some scrcpy features change Android settings with `adb shell settings`.
Document the commands to execute manually.",False
58ba00fa060c9a1f439120f8869ed106e1c935f9,2024-10-31 00:08:35,Romain Vimont,"Adapt ""turn screen off"" for Android 15

Android 15 introduced an easy way to set the display power:
<https://android.googlesource.com/platform/frameworks/base.git/+/fd8b5efc7fcd8cec1ea5dc4ccc6bc87d12db3875%5E!/#F17>

Refs #3927 <https://github.com/Genymobile/scrcpy/issues/3927>
Refs <https://issuetracker.google.com/issues/303565669>
PR #5418 <https://github.com/Genymobile/scrcpy/pull/5418>",False
569c37cec159a67593b01c52aaa4cb92d1826bab,2024-10-31 00:08:07,Romain Vimont,"Disable display power for virtual displays

If displayId == Device.DISPLAY_ID_NONE, then the display is virtual: its
power mode cannot be changed.

PR #5418 <https://github.com/Genymobile/scrcpy/pull/5418>",False
58a0fbbf2e0c7912ad487196c2f46ca6c0bd79cd,2024-10-31 00:08:04,Romain Vimont,"Refactor display power mode

Accept a single boolean ""on"" rather than a ""mode"" (which, in practice,
could only take 2 values: NORMAL and OFF).

Also rename ""screen power mode"" to ""display power"".

PR #5418 <https://github.com/Genymobile/scrcpy/pull/5418>",False
acff5b005ce9f2efae80adad09d2e77ba3052460,2024-10-30 23:21:00,Romain Vimont,"Add more details to --list-encoders output

Add more information about each codec (hw/sw, vendor, alias).

Before:

    [server] INFO: List of video encoders:
        --video-codec=h264 --video-encoder=c2.exynos.h264.encoder
        --video-codec=h264 --video-encoder=c2.android.avc.encoder
        --video-codec=h264 --video-encoder=OMX.google.h264.encoder
        --video-codec=h265 --video-encoder=c2.exynos.hevc.encoder
        --video-codec=h265 --video-encoder=c2.android.hevc.encoder
        --video-codec=av1 --video-encoder=c2.google.av1.encoder
        --video-codec=av1 --video-encoder=c2.android.av1.encoder
    // audio encoders omitted

After:

    [server] INFO: List of video encoders:
        --video-codec=h264 --video-encoder=c2.exynos.h264.encoder         (hw) [vendor]
        --video-codec=h264 --video-encoder=c2.android.avc.encoder         (sw)
        --video-codec=h264 --video-encoder=OMX.google.h264.encoder        (sw) (alias for c2.android.avc.encoder)
        --video-codec=h265 --video-encoder=c2.exynos.hevc.encoder         (hw) [vendor]
        --video-codec=h265 --video-encoder=c2.android.hevc.encoder        (sw)
        --video-codec=av1 --video-encoder=c2.google.av1.encoder           (hw) [vendor]
        --video-codec=av1 --video-encoder=c2.android.av1.encoder          (sw)
    // audio encoders omitted

PR #5416 <https://github.com/Genymobile/scrcpy/pull/5416>",False
5474ae6bd62f65e6aa25a8685a7e5db9571390ac,2024-10-30 23:20:47,Romain Vimont,"Factorize codec info listing

Make the listing of video and audio encoders share the same code.

PR #5416 <https://github.com/Genymobile/scrcpy/pull/5416>",False
2c25fd7a8082307da19645a690c31403903fbb1e,2024-10-29 23:29:29,Romain Vimont,"Disable mouse by default if no video playback

If video playback is disabled, then SDK mouse (which uses absolute
positions) could not be used, so the default mouse mode was
automatically switched to UHID.

But UHID does not work on all devices, so it could make the whole scrcpy
session fail.

Instead, disable the mouse by default. It is still possible to pass -M
or --mouse=uhid to enable it explicitly.

Fixes #5410 <https://github.com/Genymobile/scrcpy/issues/5410>",False
ce21f515e318474ca979a38a05814fc748c2bc85,2024-10-29 23:28:54,Romain Vimont,Remove unnecessary '\n' in log,False
381fe95867fb51cfd463f798e2ddbc122e4884b3,2024-10-28 22:48:36,Romain Vimont,"Document virtual display and ""start app"" features

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
566b5be0f69dae6b98f5df849a75d709ef3bd1c2,2024-10-28 22:48:36,Romain Vimont,"Add option to start an app by its name

By adding the '?' prefix, the app is searched by its name instead of its
package name (retrieving app names on the device may take some time):

    scrcpy --start-app=?firefox

An app matches if its label starts with the given name,
case-insensitive.

If '+' is also passed to force-stop the app before starting, then the
prefixes must be in that order:

    scrcpy --start-app=+?firefox

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
dd20efa41cd7d1f2220e38a45e0d7413d19f5c09,2024-10-28 22:48:36,Romain Vimont,"Add option to force-stop app before starting

The previous commit introduced:

    scrcpy --start-app=name

By adding a '+' prefix, the app is stopped beforehand:

    scrcpy --start-app=+name

This may be useful to start a fresh app on a new virtual display:

    scrcpy --new-display --start-app=+org.mozilla.firefox

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
13ce277e1f1eec6312350c5a3a3ac3be7b9be6e1,2024-10-28 22:48:36,Romain Vimont,"Add --start-app

Add a command line option --start-app=name to start an Android app by
its package name. For example:

    scrcpy --start-app=org.mozilla.firefox

The app will be started on the correct target display:

    scrcpy --new-display=1920x1080 --start-app=org.videolan.vlc

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
9c9d92fb1c75dcf7631ef1408dfdce7a01c29db4,2024-10-28 22:48:36,Romain Vimont,"Add --list-apps

Add an option to list all apps installed on the device:

    scrcpy --list-apps

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
408a388fc5115483248c3444062d52565fd1f906,2024-10-28 22:48:36,Romain Vimont,"Reject --new-display for Android <= 10

Fail explicitly if a new virtual display is requested on an Android
version lower than 10.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
98ed5eb643553b6886babfd083931bef4fb4a5b8,2024-10-28 22:48:34,Romain Vimont,"Add virtual display feature

Add a feature to create a new (separate) virtual display instead of
mirroring the device screen:

    scrcpy --new-display=1920x1080
    scrcpy --new-display=1920x1080/420  # force 420 dpi
    scrcpy --new-display         # use the main display size and density
    scrcpy --new-display -m1920  # scaled to fit a max size of 1920
    scrcpy --new-display=/240    # use the main display size and 240 dpi

Fixes #1887 <https://github.com/Genymobile/scrcpy/issues/1887>
PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>
Co-authored-by: anirudhb <anirudhb@users.noreply.github.com>",False
5d0e012a4c198633df8c578e626e2160d148d3d6,2024-10-28 22:43:55,Romain Vimont,"Add DPI to DisplayInfo

It will be useful to automatically set an appropriate DPI for new
virtual displays.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
d19396718ee0c0ba7fb578f595a6553c0458da59,2024-10-28 22:43:55,Romain Vimont,"Inject display-related events to virtual display

Mouse and touch events must be sent to the virtual display id (used for
mirroring), other events (like key events) must be sent to the original
display id.

Fixes #4598 <https://github.com/Genymobile/scrcpy/issues/4598>
Fixes #5137 <https://github.com/Genymobile/scrcpy/issues/5137>
PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>

Co-authored-by: nightmare <mengyanshou@gmail.com>",False
7024d38199206e1a4e7c02e2c9016e856de4a3c0,2024-10-28 22:43:55,Romain Vimont,"Send PositionMapper to Controller directly

When a new capture starts, send a new PositionMapper to the Controller
without using the global Device as an intermediate.

Now all Device methods are static.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
f1368d9a8f936ab47d51de5af30c7e64bf5285bc,2024-10-28 22:43:55,Romain Vimont,"Introduce PositionMapper

Extract the function that converts coordinates from video space to
display space into a separate component.

It only requires the specific data it uses and does not need a full
ScreenInfo object (although it can be created from a ScreenInfo
instance).

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
d9164295666ef9a27b45eecc8608ca1fc0e0fbd8,2024-10-28 22:43:55,Romain Vimont,"Move clipboard management to Controller

Continue to declutter the global Device.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
7cfefae5e110f32940f6ad35dbd45813d066f735,2024-10-28 22:43:55,Romain Vimont,"Move implicit displayId to Controller

Remove from Device the functions using an implicit displayId.

Move them to Controller, which knows best which displayId it must use.

This will allow to properly dispatch events either to the origin display
or to the virtual display created for mirroring.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
b60e1747809cce58793a8c0d54b499df87a6a975,2024-10-28 22:43:55,Romain Vimont,"Add capture prepare() step

Add a function called before each capture starts (before getSize() is
called).

This allows to compute the ScreenInfo instance once exactly when needed.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
5851b6258037d2b2c7d763fac17d33d131eb8922,2024-10-28 22:43:55,Romain Vimont,"Simplify virtual display video size

Do not use an unnecessary intermediate Rect object.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
12d5ca4d5ee870ed6112b5fa396924a090b206b2,2024-10-28 22:43:55,Romain Vimont,"Move local variables in ScreenCapture

Do not initialize variables when they are not used.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
68e54d9b0b393b53539218679b21a105fba4ef8f,2024-10-28 22:43:55,Romain Vimont,"Refactor to call getSize() only once

Avoid to call capture.getSize() (provided by the SurfaceCapture
implementation) twice.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
5f0480c0398bb3370d3a68182a0a4f950c56d824,2024-10-28 22:43:55,Romain Vimont,"Ignore first displayFoldChanged event

An event is posted on registration to signal the initial state.

This had no impact when the listener was registered from Device (before
it was moved to ScreenCapture), because this first initial event was
already triggered when ScreenCapture started listening.

But now, it causes the first encoding to be reset immediately. To avoid
that, ignore the first event.

Refs <https://android.googlesource.com/platform/frameworks/base.git/+/refs/tags/android-15.0.0_r3/services/core/java/com/android/server/policy/DisplayFoldController.java#138>
PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
874eaec487369f7fcaa9ed8c5f85569659565d4f,2024-10-28 22:43:55,Romain Vimont,"Move screen-related features out of Device.java

Move the code related to screen size and rotation/fold to ScreenCapture.

For now, keep the ScreenInfo instance in the Device class to communicate
with the Controller, but it will be removed by further commits.

PR #5370 <https://github.com/Genymobile/scrcpy/pull/5370>",False
14e5439dee5486f870bda95add4102eaba39971c,2024-10-28 19:25:55,Romain Vimont,"Update mouse documentation about capture key

The mouse capture keys are not hardcoded anymore, they use the
configured shortcut modifiers.

Refs ff9fb5994dbe555be8835a5f8d06b03e9f3b1b27",False
a5844e198e9bc53653c8658d53b7b9df4e122cc0,2024-10-28 01:01:24,Romain Vimont,"Add GitHub Actions release workflow

Fixes #4490 <https://github.com/Genymobile/scrcpy/issues/4490>
PR #5306 <https://github.com/Genymobile/scrcpy/pull/5306>",False
2687d202809dfaafe8f40f613aec131ad9501433,2024-10-28 00:59:13,Romain Vimont,"Rework release.mk for CI

Make it possible to build scrcpy-server and Windows binaries in
parallel from different GitHub Actions workflows, and to package
everything as a final step.

PR #5306 <https://github.com/Genymobile/scrcpy/pull/5306>",False
9c0a32849897d98e17bf0f8d7603454e558746cd,2024-10-28 00:56:38,Romain Vimont,"Build server without meson in release.mk

This avoids to install meson/ninja to build scrcpy-server on the CI.

PR #5306 <https://github.com/Genymobile/scrcpy/pull/5306>",False
02ef3d57ce9542493ea7efb4ace66c4300d472fb,2024-10-28 00:56:26,Romain Vimont,"Split client and server tests in release.mk

This will allow to run server tests separately on the CI.

PR #5306 <https://github.com/Genymobile/scrcpy/pull/5306>",False
538a32a53973d5ab1e393a36286de094a97aaf9a,2024-10-28 00:56:13,Romain Vimont,"Fix .PHONY in release.mk

The prepare-deps recipe does not exist anymore. It has been split into
prepare-deps-win32 and prepare-deps-win64.

PR #5306 <https://github.com/Genymobile/scrcpy/pull/5306>",False
67d4dfb5ffcfeaddf3363e73fdf3b2c500fd5842,2024-10-23 23:35:52,Anwar Fuadi,"Add missing client build dependency in Fedora

PR #5147 <https://github.com/Genymobile/scrcpy/pull/5147>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9578aae34eca49f448d0312838c2b4011e977810,2024-10-22 23:17:56,Romain Vimont,Use explicit constant for @TargetApi,False
7b3dd595b493449b4e93281205c375b1472d3b87,2024-10-21 22:21:35,Romain Vimont,"Remove useless version check

Scrcpy requires Android 5.0+, so there is no point testing for older
versions.

Btw, there were two mistakes:
 - the constant name in AndroidVersions should have been
   API_20_ANDROID_4_4W (Android 4.4 without 'W' is API 19)
 - the method isInteractive() was introduced in Android 5.0, not 4.4W:
   <https://android.googlesource.com/platform/frameworks/base.git/+/037c33eae74bee2774897d969d48947f9abe254f%5E%21/>",False
a46150f753c47d0fb180040448629d229ae74581,2024-10-20 18:56:19,Romain Vimont,"Upgrade Android SDK to 35

Also adapt the call to build-tools/35.0.0/aidl, which now requires an
import path (-I. for the current directory).

Otherwise, it fails with:

    ERROR: android/view/IRotationWatcher.aidl:23.1-10: directory ./ is not found in any of the import paths:
     -

Also upgrade AGP (8.7.1) and Gradle (8.9), required for SDK 35.

<https://developer.android.com/build/releases/gradle-plugin#updating-gradle>",False
3acffaae57238ee47e05f97f8e762a04550fdad8,2024-10-20 16:45:22,Romain Vimont,"Use explicit constants for Android versions

Who remembers code names? This avoids to check the mapping every time.",False
e33be3d288fb6ec764a07c56eb4299b44c4793ac,2024-10-12 19:27:24,dillonfrederica,"Fix SDL_events.h include

All SDL includes must be prefixed by ""SDL2/"".

Fixed #5372 <https://github.com/Genymobile/scrcpy/issues/5372>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c15df01171793dca7074a012f4703a185d99169d,2024-10-12 02:21:15,Romain Vimont,"Reject non-positive camera sizes early

Throw an exception on parsing if the camera size dimensions are not both
positive.",False
09741bc8051fc0d131c00690088390b8b36dd672,2024-10-12 02:12:39,Romain Vimont,"Do not duplicate server string params

The server params were passed from the main thread to the server thread,
so a deep copy was performed in case the caller instance was destroyed.

But in practice, it only contains memory that lives until the end of the
program (command line arguments), so simply reference it. Several copies
of string fields were missing anyway.",False
afbaf59abba79a79ab6f4c659ff3d832e02a8e7f,2024-10-08 21:48:05,Romain Vimont,"Cast to sc_tick type in conversion macros

With the old macros definitions, the type of the result depended on the
type of `sec`.

In particular, if sec is a 32-bit type, sec * 1000000 was likely to
overflow (even if the result was assigned to a sc_tick by the caller of
the macro).

This was the case on Windows, where the long type is a 32-bit signed
integer: the --time-limit argument, expressed in seconds, was first
parsed to a long value, then multiplied by 1000000 by the
SC_TICK_FROM_SEC() macro, causing an overflow when the value was greater
than 2147 (2^31 / 1000000).

Fixes #5355 <https://github.com/Genymobile/scrcpy/issues/5355>",False
5b10650f22b218b2fb42415aefe4bd6fec6c7e9e,2024-10-08 21:42:55,Romain Vimont,"Fix time-limit early interruption

If a value for --time-limit was set, then the thread was not interrupted
on stop (the condvar was not signaled).",False
0d8014be5260b64daf3d7b3516d37a0dfafca7e1,2024-10-07 20:24:15,Yan,"Fix build error on macOS

Fix window access typo for macOS.

PR #5348 <https://github.com/Genymobile/scrcpy/pull/5348>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
064670ab4c7d740ba6a02a1242d24edd267d2b76,2024-10-06 21:37:05,Romain Vimont,Add missing include common.h,False
ff9fb5994dbe555be8835a5f8d06b03e9f3b1b27,2024-10-06 21:31:02,Romain Vimont,"Use shortcut mods as mouse capture keys

Instead of using separate hardcoded keys for mouse capture/uncapture,
use the shortcut mods.

By changing the shortcut mods (for example --shortcut-mod=rctrl), it
allows to forward Alt and Super to the device.

Fixes #5318 <https://github.com/Genymobile/scrcpy/issues/5318>
PR #5322 <https://github.com/Genymobile/scrcpy/pull/5322>",False
a36de26969791d054cfd3729e1c29923fec61b32,2024-10-06 21:30:59,Romain Vimont,"Move shortcut mod functions to a separate header

This will allow to reuse it for mouse capture keys, which are handled by
a component separate from the input manager.

PR #5322 <https://github.com/Genymobile/scrcpy/pull/5322>",False
281fcc705254653edc4b418ab68951c6fd069622,2024-10-06 21:30:56,Romain Vimont,"Extract mouse capture

Factorize mouse capture for relative mouse mode to reduce code
duplication between normal and OTG modes.

PR #5322 <https://github.com/Genymobile/scrcpy/pull/5322>",False
65fc53eace19392426631ba2f5bcbd9aec88d796,2024-10-06 21:30:52,Romain Vimont,"Simplify (and inline) is_shortcut_mod()

Masking was unnecessary (im->sdl_shortcut_mods is implicitly masked).

PR #5322 <https://github.com/Genymobile/scrcpy/pull/5322>",False
a6f74d72f52c96fa20ccd49e216383321e4a9efa,2024-10-06 21:30:25,Romain Vimont,"Forward Alt and Super with SDK keyboard

Alt and Super (also named Meta) modifier keys are captured for shortcuts
by default (cf --shortcut-mod).

However, when shortcut modifiers are changed, Alt and Super should be
forwarded to the device. This is the case for AOA and UHID keyboards,
but it was not the case for SDK keyboard.

Fixes #5318 <https://github.com/Genymobile/scrcpy/issues/5318>
PR #5322 <https://github.com/Genymobile/scrcpy/pull/5322>",False
e724ff43490661d9b1c7f92632303a4f08768f03,2024-10-02 02:20:34,Romain Vimont,"Simplify IO.writeFully() for Android >= 6

Do not handle buffer properties manually for Android >= 6 (where it is
already handled by Os.write()).

Refs <https://android.googlesource.com/platform/libcore/+/d9f7e57f5d09b587d8c8d1bd42b895f7de8fbf54%5E%21/>",False
79014143b9cc958ed4b36b8e9a49676243ca68b7,2024-10-02 02:19:55,Romain Vimont,"Fix IO.writeFully() on Android 5

Os.write() did not update the ByteBuffer position before Android 6.

A workaround was added by commit
b882322f7371b16acd53677c4a3adbaaed0aef77, which fixed part of the
problem, but the position was still not updated across calls, causing
the wrong chunk to be written.

Refs <https://android.googlesource.com/platform/libcore/+/d9f7e57f5d09b587d8c8d1bd42b895f7de8fbf54%5E%21/>",False
c0a6432967c54d739cb0f01e87c834c3927f84f2,2024-10-02 02:09:06,Romain Vimont,"Extract EINTR handling for Os.write()

Expose a function which retries automatically on EINTR, and throws an
IOException on other errors.",False
ec602a0334357982d75b374f7ac753c5bef1216a,2024-09-30 11:46:33,Romain Vimont,"Suggest command line arguments without quotes

Replace argument suggestion:

    --video-encoder='c2.android.avc.encoder'

by:

    --video-encoder=c2.android.avc.encoder

On Linux, the quotes are interpreted by the shell, but on Windows they
are passed as is.

This was harmless, because even transmitted as is, they were interpreted
by the shell on the device. However, special characters are now
validated since commit bec3321fff4c6dc3b3dbc61fdc6fd98913988a78, making
the command fail.

Fixes #5329 <https://github.com/Genymobile/scrcpy/issues/5329>",False
7a9ea5c66fedbb5b3b1d02f51695aa4ab259dfe3,2024-09-26 01:08:09,Romain Vimont,"Add shortcut for horizontal tilt

Use Ctrl+Shift for horizontal tilt.

Refs #4529 comment <https://github.com/Genymobile/scrcpy/pull/4529#issuecomment-1855397118>
Fixes #5317 <https://github.com/Genymobile/scrcpy/issues/5317>",False
d92b7a60243f1e08141d8d9bfbc94dadd1b19ac8,2024-09-25 23:29:49,Romain Vimont,"Rename switch_fullscreen() to toggle_fullscreen()

Toggle means to switch between two states.",False
0bb3955b958752e1ec220a1045e5185c027fc56b,2024-09-24 03:29:08,Romain Vimont,"Split audio player

The audio player had 2 roles:
 - handle the SDL audio output device;
 - resample input samples to maintain a target latency.

Extract the latter to a separate component (an ""audio regulator""),
independent of SDL.",False
62776fb2617a3c23190d3549b673c44b65fe12ce,2024-09-24 03:29:08,Romain Vimont,"Make audio buffering independant of output buffer

This will allow to extract the ""audio regulator"" part from the audio
player.",False
10f60054aca70047c128fc801d103dac4d5d7896,2024-09-24 03:29:08,Romain Vimont,Use exact-width integer types,False
42fb947780e1054a72de7b4baf02f1a73beda3c6,2024-09-24 03:29:08,Romain Vimont,"Use local mutex for audio player

Replace SDL_LockAudioDevice() by a local mutex, to minimize the lock
section and to make the code independent of SDL.",False
2e7a15a9987615b10460e7717f3a0dd31774936e,2024-09-24 03:29:08,Romain Vimont,"Remove unused audio player fields

They are only used locally.",False
a7e61fb8712316e0375bf156f3243d7ced333e10,2024-09-24 03:29:08,Romain Vimont,"Remove unused audio player callbacks

The callbacks were never used: the player can report errors directly
from sc_audio_player_frame_sink_push().",False
0cc6f6aa09f0fe5913ec66276e7ea3681fa81cd7,2024-09-20 12:15:46,Romain Vimont,"Detect codec/encoder mismatch

Fail with an explicit error when the requested encoder does not match
the requested codec.

Refs #5066 <https://github.com/Genymobile/scrcpy/issues/5066>",False
f69ac405340efb0b53849b96a32f389cf1c1d54e,2024-09-20 12:13:42,Romain Vimont,"Reorganize server imports

Moving classes into subpackages changed the expected imports order.

Reorganize them all at once automatically to avoid spurious changes in
future commits.",False
665ccb32f5306ebd866dc0d99f4d08ed2aeb91c3,2024-09-16 00:48:15,Romain Vimont,Update links to 2.7,False
292adf294dd654e79b42215fb6bc2c6d2d44165b,2024-09-15 22:29:27,Romain Vimont,Bump version to 2.7,False
f9f3bfabe3904f83d4c5e22b85ccddb5ad8eab0e,2024-09-15 22:29:16,Romain Vimont,Merge branch 'master' into release,True
6d23a389cab2d8678627d6743223506095729ff2,2024-09-15 22:28:53,Romain Vimont,Upgrade FFmpeg (7.0.2) for Windows,False
337901368e7bd143c68052d4a92e809fecdfe5a7,2024-09-15 22:28:53,Romain Vimont,Upgrade SDL (2.30.7) for Windows,False
4cc4abdcc8b3f0d76a362f450db4cefe96edca5d,2024-09-15 22:28:53,Romain Vimont,"Mention issue with AOA and multiple gamepads

Android does not support multiple HID gamepads properly over AOA.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
befc0fac5b0f3c819ba798fc979f1a946a21976c,2024-09-15 22:28:44,Romain Vimont,"Mention UHID permission errors

UHID may not work on old Android versions due to permission errors.

Mention it in UHID mouse and gamepad documentation (it was already
mentioned for UHID keyboard).

Refs #4473 comment <https://github.com/Genymobile/scrcpy/pull/4473#issuecomment-1975133226>
PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
f01a622eadebb66e2fe0da22e24e71679e20bcb5,2024-09-15 14:51:56,Romain Vimont,"Enable joystick events in background

Capture the gamepads even when the window is not focused.

Note: In theory, with this flag set, we could capture gamepad events
even without a window (--no-window). In practice, scrcpy still requires
a window, because --no-window implies --no-control, and the input
manager is owned by the sc_screen instance, which does not exist if
there is no window. Supporting this use case would require a lot of
refactors.

Refs <https://github.com/Genymobile/scrcpy/pull/5270#issuecomment-2339360460>
PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>

Suggested-by: Luiz Henrique Laurini <luizhenriquelaurini@gmail.com>",False
0ba430a462f778d1dc9de1a82b527f1570cc8cf3,2024-09-15 14:51:56,Romain Vimont,"Add gamepad user documentation

Mainly copied and adapted from HID keyboard and mouse documentation.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
91d40c75483592eae78c5702c4e7278370cd06c6,2024-09-15 14:51:56,Romain Vimont,"Fix link in OTG documentation

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
9f3d51106d026e9f234477d7600fcb6162edf4bc,2024-09-15 14:51:56,Romain Vimont,"Remove fragile assert()

The sc_uhid_devices instance is initialized only when there is a UHID
keyboard.

The device message receiver assumed that it could not receive HID output
reports without a sc_uhid_devices instance (i.e. without a UHID
keyboard), but in practice, a UHID driver implementation on the device
may decide to send UHID output reports for mouse or for gamepads (and we
must just ignore them).

So remove the assert().

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
bf2b679e705ed0864e765b1de5f238799a09ece7,2024-09-15 14:51:56,Romain Vimont,"Simplify UHID outputs routing

There was a registration mechanism to listen to HID outputs with a
specific HID id.

However, the UHID gamepad processor handles several ids, so it cannot
work. We could complexify the registration mechanism, but instead,
directly dispatch to the expected processor based on the UHID id.

Concretely, instead of passing a sc_uhid_devices instance to construct a
sc_keyboard_uhid, so that it can register itself, construct the
sc_uhid_devices with all the UHID instances (currently only
sc_keyboard_uhid) so that it can dispatch HID outputs directly.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
7f250dd66923018e145f90789d53c4c7a1e30962,2024-09-15 14:51:56,Romain Vimont,"Mention physical gamepad names for UHID devices

Initialize UHID devices with a custom name:
 - ""scrcpy: $GAMEPAD_NAME"" for gamepads
 - ""scrcpy"" for keyboard and mouse (or if no gamepad name is available)

The name may appear in Android apps.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
68e27c7357fbf0c3a3a5d75fb40611b809c13282,2024-09-15 14:51:56,Romain Vimont,"Reorder function parameters for consistency

Make the local function write_string() accept the output buffer as a
first parameter, like the other similar functions.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
c4febd55ebb75e9033fe7af072cf4af54182ce45,2024-09-15 14:51:56,Romain Vimont,"Make -K -M and -G use AOA in OTG mode

For convenience, short options were added to select UHID input modes:
 - -K for --keyboard=uhid
 - -M for --mouse=uhid
 - -G for --gamepad=uhid

In OTG mode, UHID is not available, so the short options should select
AOA instead.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
f9d1a333a0807bc354a7ba65a9fd2a9dbd12aa4b,2024-09-15 14:51:56,Romain Vimont,"Add UHID gamepad support

Similar to UHID keyboard and mouse, but for gamepads.

Can be enabled with --gamepad=uhid or -G.

It is not enabled by default because not all devices support UHID
(there is a permission error on old Android versions).

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
64a25f6e9dfc12d25fa54126afbbef34b27f56f9,2024-09-15 14:51:56,Romain Vimont,"Add UHID_DESTROY control message

This message will be sent on gamepad disconnection.

Contrary to keyboard and mouse devices, which are registered once and
unregistered when scrcpy exists, each physical gamepad is mapped with
its own HID id, and they can be plugged and unplugged dynamically.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
5fe884276b099f6313db886312fe691cc0bf69a5,2024-09-15 14:51:56,Romain Vimont,"Add gamepad support in OTG mode

Implement gamepad support for OTG.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
3e68244dd3f410da5ff5cce3e6bb1c40743a7c51,2024-09-15 14:51:56,Romain Vimont,"Add connected gamepads on start

Trigger SDL_CONTROLLERDEVICEADDED for all gamepads already connected
when scrcpy starts. We want to handle both the gamepads initially
connected and the gamepads connected while scrcpy is running.

This is not racy, because this event may not be trigged automatically
until SDL events are ""pumped"" (SDL_PumpEvents/SDL_WaitEvent).

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
a34a62ca4b4cc5aa946b2c6c2a53d18815160abd,2024-09-15 14:51:56,Romain Vimont,"Add AOA gamepad support

Similar to AOA keyboard and mouse, but for gamepads.

Can be enabled with --gamepad=aoa.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
a59c6df4b7659adabd5cd98a95f1dbf330a50c14,2024-09-15 14:51:56,Romain Vimont,"Implement HID gamepad

Implement the HID protocol for gamepads, that will be used in further
commits by the AOA and UHID gamepad processor implementations.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
f4d1e49ad91586ea3590eefc992bdfed558f7e06,2024-09-15 14:51:56,Romain Vimont,"Add util functions to write in little-endian

This will be helpful for writing HID values.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
4565f36ee6993eff3b0376ad2da74a71060bc5b0,2024-09-15 14:51:56,Romain Vimont,"Handle SDL gamepad events

Introduce a gamepad processor trait, similar to the keyboard processor
and mouse processor traits.

Handle gamepad events received from SDL, convert them to scrcpy-specific
gamepad events, and forward them to the gamepad processor.

Further commits will provide AOA and UHID implementations of the gamepad
processor trait.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>

Co-authored-by: Luiz Henrique Laurini <luizhenriquelaurini@gmail.com>",False
c8479fe8bf71f6f46bde95f2e7034cca97f7ff1f,2024-09-15 14:51:56,Romain Vimont,"Discard unknown SDL events

Mouse and keyboard events with unknown button/keycode/scancode cannot be
handled properly. Discard them without forwarding them to the
keyboard or mouse processors.

This can happen for example if a more recent version of SDL introduces
new enum values.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
de8455400ce7e5ccef1b78e7a30407a90fcc2872,2024-09-15 14:51:56,Romain Vimont,"Fix HID comments

Fix typo and reference the latest version of ""HID Usage Tables""
specifications.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
1f5be743b474164f1efa691ccbc88435058d9ea7,2024-09-15 14:51:56,Romain Vimont,"Make AOA keyboard/mouse open error fatal

Now that the AOA open/close are asynchronous, an open error did not make
scrcpy exit anymore.

Add a mechanism to exit if the AOA device could not be opened
asynchronously.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
222916eebed01098f3311a1096f4031be2d61197,2024-09-15 14:51:56,Romain Vimont,"Unregister all AOA devices automatically on exit

Pushing a close event from the keyboard_aoa or mouse_aoa implementation
was racy, because the AOA thread might be stopped before these events
were processed.

Instead, keep the list of open AOA devices to close them automatically
from the AOA thread before exiting.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
6c707ad8a359a5acf1c59fd065d50b5e1550c781,2024-09-15 14:51:56,Romain Vimont,"Make HID logs uniform

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
d748ac75e651ff446df74896a39deb6bd427fe67,2024-09-15 14:51:56,Romain Vimont,"Add AOA open/close verbose logs

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
6f0c9eba9bb030cc8e4e6bc4c14ae2c9dd730348,2024-09-15 14:51:56,Romain Vimont,"Introduce hid_open and hid_close events

This allows to handle HID open/close reports at the same place as HID
input reports (in the HID layer).

This will be especially useful to manage HID gamepads, to avoid
implementing one part in the HID layer and another part in the gamepad
processor implementation.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
f6219d26409a1ba25b4df86aa3468aa18b6a11e5,2024-09-15 14:51:56,Romain Vimont,"Rename hid_event to hid_input

The sc_hid_event structure represents HID input data. Rename it so that
we can add other hid event structs without confusion.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
6e9b0d7d4c4d386c84e8a3a40e442a45d1666e24,2024-09-15 14:51:56,Romain Vimont,"Make AOA open and close asynchronous

For AOA keyboard and mouse, only input reports were asynchronous.
Register/unregister were called from the main thread.

This had the benefit to fail immediately if the AOA registration failed,
but we want to open/close AOA devices dynamically in order to add
gamepad support.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
3e9c89c535e0304401da877502de6a892d1bfa10,2024-09-15 14:51:56,Romain Vimont,"Reorder AOA functions

This will allow sc_aoa_setup_hid() to compile even when
sc_aoa_unregister_hid() will be made static.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
9af3bacdd67e2179aea7dc0f56ec487c015181e3,2024-09-15 14:51:56,Romain Vimont,"Refactor AOA handling

Extract event processing to a separate function.

This will make the code more readable when more event types will be
added.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
2dd02ebb80cc8d64f7a3da53ccbb9d78c2506914,2024-09-15 14:51:56,Romain Vimont,"Move HID ids to common HID code

The HID ids (accessory ids or UHID ids) were defined by the keyboard and
mouse implementations.

Instead, define them in the common HID part, and make that id part of
the sc_hid_event.

This prepares the introduction of gamepad support, which will handle
several gamepads (and ids) in the common HID gamepad code.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
dad04bf1389ae5e4432b868c562713b127bbc2d3,2024-09-15 14:51:56,Romain Vimont,"Fix HID mouse header guard

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
1afc8ca36889f668b0fd635d45f63a0113dbb093,2024-09-15 14:51:56,Romain Vimont,"Add missing SC_ prefix for HID mouse event size

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
785099b74d4883ee124a89f15d84e84221434032,2024-09-15 14:51:56,Romain Vimont,"Remove duplicate definition SC_HID_MAX_SIZE

This constant is defined in hid_event.h.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
08da2e068e7f535464b6e801dad2f74e11370b9a,2024-09-15 14:51:56,Romain Vimont,"Fail on AOA keyboard/mouse initialization error

If the AOA keyboard or the AOA mouse fails to be initialized, this is a
fatal error.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
49c8ca34fd96548bd40862fc30a69dd54a68d2b9,2024-09-15 14:51:56,Romain Vimont,"Introduce non-droppable control messages

Control messages are queued from the main thread and sent to the device
from a separate thread.

When the queue is full, messages are just dropped. This avoids to
accumulate too much delay between the client and the device in case of
network issue.

However, some messages should not be dropped: for example, dropping a
UHID_CREATE message would make all further UHID_INPUT messages invalid.
Therefore, mark these messages as non-droppable.

A non-droppable event is queued anyway (resizing the queue if
necessary, unless the allocation fails).

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
a84b0dfd0c3abe7a91e21d8fcd4b3ec33a36964a,2024-09-15 14:51:56,Romain Vimont,"Remove atomics from keyboard_uhid

The UHID output callback is now called from the same (main) thread as
the process_key() function.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
cbf5db85c1931d07e9adad32d788fdf84366b74d,2024-09-15 14:51:56,Romain Vimont,"Process UHID outputs events from the main thread

This will guarantee that the callbacks of UHID devices implementations
will always be called from the same (main) thread.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
72ee195693a030990e9965ac93922c9aae32988d,2024-09-15 14:51:56,Romain Vimont,"Set clipboard from the main thread

The clipboard changes from the device are received from a separate
thread, but they must be handled from the main thread.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
8620d06741ceb05ef2ad34e1a811c452216092a5,2024-09-15 14:51:55,Romain Vimont,"Add mechanism to execute code on the main thread

This allows to schedule a runnable to be executed on the main thread,
until the event loop is explicitly terminated.

It is guaranteed that all accepted runnables will be executed (this
avoids possible memory leaks if a runnable owns resources).

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
e9240f6804764b2b4d7163566cd6d5cc0226f865,2024-09-15 00:54:15,Romain Vimont,"Expose main thread id

This will allow to assert that a function is called from the main
thread.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
e9b32d8a52b418eed8fb00b84de89f6c7ac9e5a0,2024-09-15 00:54:15,Romain Vimont,"Extract sc_push_event()

Expose a convenience function to push an event without args to the main
thread.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
ce4e1fc4204d08b57a3fc63a9d39ad5bd9984812,2024-09-15 00:54:15,Romain Vimont,"Store events numbers in an enum

This avoids to manually set an explicit value for each item.

PR #5270 <https://github.com/Genymobile/scrcpy/pull/5270>",False
e8f02685e94608ea8d352d4fc33f0ad77f94ab61,2024-09-15 00:54:15,Romain Vimont,"Fix deprecated references in scrcpy manpage

The options --hid-keyboard and --hid-mouse do not exist anymore. They
have been replaced by --keyboard=XXX and --mouse=XXX.",False
4a6b335f7df04599cbea488f40848c96dc2e7541,2024-09-15 00:54:15,Romain Vimont,"Do not send uninitialized HID event

If the function returns false, then there is nothing to send.",False
90ee0062cb84b618882f78165f057f58d97b6939,2024-09-15 00:54:15,Romain Vimont,"Fix compilation with -Dusb=false

UHID does not depend on USB support, so the struct sc_uhid_devices must
always be defined.",False
e03888d5877e04cb1f4575099eda54d9c009ca3a,2024-09-15 00:53:44,Romain Vimont,"Reject arguments containing new line characters

Refs bec3321fff4c6dc3b3dbc61fdc6fd98913988a78",False
8453e3ba7d1b4f8ec55825edef2d4357d35ce8c5,2024-09-14 23:16:55,Romain Vimont,"Enable TCP_NODELAY for the control socket

It is better to disable Nagle's algorithm to avoid unnecessary latency
for control messages. (I'm not sure this has any impact for a local TCP
socket though.)",False
145a9468fdf64196dc42f24b5935ce7d40ea2543,2024-09-14 18:12:00,Romain Vimont,"Fix ifdef _WIN32

We use _WIN32 across the code base, not __WIN32.",False
1d713d759850f4b5de8525cfb73c338be8fef94e,2024-09-14 18:07:30,Romain Vimont,"Do not parse --max-fps float in the client

Many parsing and formatting C functions like strtof() and asprintf() are
locale-dependent. Forcing a C locale just for the conversions in a way
that works on all platforms is a mess.

In practice, this is not a problem, scrcpy always uses the C locale,
because it never calls:

    setlocale(LC_ALL, """");

But the max-fps option should not depend on the locale configuration
anyway.

Since the value is parsed by the client in Java anyway, just forward the
string value as is.",False
265a15e0b19f5bfe339ccdae01f30a50457ceecf,2024-09-14 01:32:25,Romain Vimont,"Accept float values for --max-fps

Android accepts a float value, there is no reason to limit the option
to be an integer.

In particular, it allows to capture at a rate lower than 1 fps. For
example, to capture 1 frame every 5 seconds:

    scrcpy --video-source=camera --max-fps=0.2

It was already possible to pass a float manually:

    scrcpy --video-source=camera \
        --video-codec-options=max-fps-to-encoder:float=0.2

But accepting a float directly for --max-fps is more convenient.

Refs <https://developer.android.com/reference/android/media/MediaFormat#KEY_MAX_FPS_TO_ENCODER>",False
6451ad271a0a2a869ceb80836b01e3c35d60cb3d,2024-09-13 23:33:17,Romain Vimont,"Ignore minBufferSize on error

A negative return value from AudioRecord.getMinBufferSize() represents
an error. Only consider positive values (0 would be invalid).

Refs #5228 <https://github.com/Genymobile/scrcpy/issues/5228>",False
bec3321fff4c6dc3b3dbc61fdc6fd98913988a78,2024-09-13 23:23:05,Romain Vimont,"Validate server arguments

Some command line arguments are passed as is to ""adb shell"". Therefore,
they must not contain special shell characters.",False
dea1fe3386b8fdb1b8bb1762ce5c9da4c4590419,2024-09-13 23:18:55,Romain Vimont,"Validate crop and video size

A video width or height of 0 triggered an assert.

Fail explicitly instead: the server may actually send this size in
practice (for example on cropping with small dimensions, even if the
requested crop size is not 0).",False
a7cae595780de4bde22447fb22a25953426a09fb,2024-09-12 14:36:13,Romain Vimont,"Improve delay buffer startup

The delay buffer clock estimates the clock offset between the PTS and
the frame decoded date using an ""Exponentially Weighted Moving Average""
(EWMA).

But for the first frames, the clock have less than SC_CLOCK_RANGE
points to average. Since the timing for the first frames are typically
the worst ones, give more weight to the last point for the estimation.

Once SC_CLOCK_RANGE points are available (i.e. when SC_CLOCK_RANGE ==
clock->range), the new estimation is equivalent to the previous version.",False
f089ea67e17784303f46fe0dc1a4abfccbdd9d26,2024-09-11 19:11:49,Romain Vimont,"Add missing flag initialization

The delay buffer `stopped` field was not initialized.

Since it practice the unique instance of sc_delay_buffer is initialized
in static memory, the flag was initialized to false as a side effect.

But with commit fd0f432e877153d83ed435474fb7b04e41de4269, in debug mode
only, the delay buffer was broken.",False
63ced79842656d0ea6447a53b267c20e3253b538,2024-09-11 19:11:29,Romain Vimont,"Reverse NDEBUG conditions

By default, these specific debug logs are disabled.

Make the ifdef condition less confusing.",False
33a8c39beb970db5efa6449d4e3058134f3be8e5,2024-09-11 14:56:07,Romain Vimont,"Fix local NDEBUG define

The struct definition and the implementation did not use the same NDEBUG
constant.",False
903a5aaaf599bf7c9cb9bba0fefbc04aa5ec50bd,2024-09-09 11:54:52,Romain Vimont,"Replace ""could not"" by ""cannot"" where appropriate

""Could not"" implies that the system tried to disable the option but
encountered an issue or failure.

""Cannot"" indicates a rule or restriction, meaning it's not possible to
perform the action at all.",False
21b412cd9879b850e44fc0cf52012e8f8078bc60,2024-09-07 18:01:54,Romain Vimont,"Simplify messages reader/writer

In Java, control messages were parsed using manual buffering, which was
convoluted and error-prone.

Instead, read the socket directly through a DataInputStream and a
BufferedInputStream. Symmetrically, use a DataOutputStream and a
BufferedOutputStream to write messages.",False
3b241af3f684fed977149e47270dfdb5c2d63d39,2024-09-07 02:37:15,Romain Vimont,"Allow to pass an explicit version name on release

To build with a specific version name:

    VERSION=pr1234 ./release.sh

If not set, it will use the result of ""git describe"" (as before).",False
21e2e2606e683326d9171afb106a5473f16d8bb9,2024-08-29 18:14:20,Romain Vimont,Fix markdown formatting in documentation,False
0c95794463ee21317725f6934dc55bd8dc83e0c0,2024-08-10 17:59:26,Romain Vimont,"Do not apply all workarounds for ONYX devices

Calling fillAppInfo() breaks video mirroring on ONYX devices.

Fixes #5182 <https://github.com/Genymobile/scrcpy/issues/5182>
Refs 2b6089cbfc29c41643e0c0e8049bda3ede777b61",False
523f9395326356024f7098107af25c54eab0a6c9,2024-08-09 00:02:35,Romain Vimont,"Do not create UHID thread if not used

The HandlerThread is used only via the looper queue.",False
dd47cefa47f6cbd2e453c14df8e52de592ea6661,2024-08-05 19:43:02,yangfl,"Fix typos

Refs <https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1077968#27>
PR #5171 <https://github.com/Genymobile/scrcpy/pull/5171>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
44b3fd82b1831f4aa436268870adf32bddb81924,2024-08-03 02:28:09,Romain Vimont,Update links to 2.6.1,False
cc41115625553d2f9ed8e96302174f189f2f40c7,2024-08-03 02:02:04,Romain Vimont,Bump version to 2.6.1,False
773c23fda298fd3dace4ded5a89e8716d3c0fc76,2024-08-03 01:54:31,Romain Vimont,"Inject finger input whenever possible

Even if the pointer is a mouse, inject it as a finger unless it is
required to be a mouse, that is:
 - when it is a HOVER_MOUSE event, or
 - when a secondary button is pressed.

Some apps/games only accept events from a finger/touchscreen, so using a
mouse by default does not work for them.

For simplicity, make this change on the server side just before
event injection (so that the client does not need to know about this
hacky behavior).

Refs 6808288823239b0f3a76f9be377e4de82e91b35a
Refs c7b1d0ea9af8bb9603ec8f713f1a5fbf3f628b6a
Fixes #5162 <https://github.com/Genymobile/scrcpy/issues/5162>
Fixes #5163 <https://github.com/Genymobile/scrcpy/issues/5163>",False
992b4922fe32fd5bf96d0df204300f7c35f120fe,2024-08-02 22:14:42,Romain Vimont,"Document INJECT_EVENTS permission issue on Xiaomi

Make explicit in the prerequisites the exact error message when ""USB
debugging (Security Settings)"" is not set.",False
67f93350f679e40ba979198753f4c657fe589c87,2024-08-01 22:16:10,Romain Vimont,Update links to 2.6,False
52136268ef931e37f93cb05350479e386bb51fbf,2024-08-01 21:45:59,Romain Vimont,Bump version to 2.6,False
0a6ccdc4df6cc51fee65f64b640653070271b1eb,2024-08-01 21:45:40,Romain Vimont,Merge branch 'master' into release,True
5d2441d1983d2b20854817d55b45a565af16694f,2024-08-01 21:45:37,Romain Vimont,Upgrade SDL (2.30.5) for Windows,False
2b6089cbfc29c41643e0c0e8049bda3ede777b61,2024-08-01 15:46:35,Romain Vimont,"Enable workarounds by default

Workarounds were disabled by default, and only enabled for some devices
or under specific conditions.

But it seems they are needed for more and more devices, so enable them
by default. They could be disabled for specific devices if necessary in
the future.

In the past, these workarounds caused a (harmless) exception to be
printed on some Xiaomi devices [1]. But this is not a problem anymore
since commit b8c5853aa6ac9cfbe3fb4e46bf10978b3fa212e3.

They also caused problems for audio on Vivo devices [2], but it seems
this is not the case anymore [3].

They might also impact an old Nvidia Shield [4], but hopefully this is
fixed now.

[1]: <https://github.com/Genymobile/scrcpy/issues/4015#issuecomment-1595382142>
[2]: <https://github.com/Genymobile/scrcpy/issues/3805#issuecomment-1596148031>
[3]: <https://github.com/Genymobile/scrcpy/issues/3805#issuecomment-2260205882>
[4]: <https://github.com/Genymobile/scrcpy/issues/940>

PR #5154 <https://github.com/Genymobile/scrcpy/pull/5154>",False
f691ebb1b4fde44789292d1e8ed41adaee8e6854,2024-07-31 18:25:00,Al Grimes,"Add workaround for TCL Android 12 Smart TVs

Fixes #5140 <https://github.com/Genymobile/scrcpy/issues/5140>
PR #5148 <https://github.com/Genymobile/scrcpy/pull/5148>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
071d459ad7d32fb6465216a0f5df7696db3adc02,2024-07-29 23:33:44,Romain Vimont,"Fix --no-audio

By default, the audio source is initialized to SC_AUDIO_SOURCE_AUTO, and
is ""resolved"" only if audio is enabled.

But the server arguments were built assuming that the audio source was
never SC_AUDIO_SOURCE_AUTO (even with audio disabled), causing a crash.

Regression introduced by a10f8cd798023f858796b023cb846fa2184ad2c7.",False
bbfac9ae1fba08a045557abe9612703ace8a3890,2024-07-19 21:26:26,Romain Vimont,"Add FUNDING.yml

The donation links were already in the README.

Also add them in the format expected by GitHub in FUNDING.yml.",False
65bd6bd8d4cd16baf44a80911b67afcfa8615106,2024-07-19 21:21:50,Romain Vimont,"Explicitly accept issues for general questions

Add an empty question template, and reword the ""Contact"" section in the
README.

Refs #5117 <https://github.com/Genymobile/scrcpy/issues/5117>",False
ed4066902d08e4abb91b4b6c7d828f190ab65bfb,2024-07-19 21:18:39,Romain Vimont,"Update documentation for audio playback capture

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
127a271d34816f4f06cb7dbcba2b939f24c1ca6a,2024-07-19 21:18:39,Romain Vimont,"Switch audio source if audio-dup is set

Automatically switch implicit audio source to ""playback"" if --audio-dup
is passed.

This allows to run:

    scrcpy --audio-dup

without specifying explicitly:

    scrcpy --audio-source=playback --audio-dup

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
31116a60d7b03f8489a4f73d81ab0c0689a67d9b,2024-07-19 21:18:39,Romain Vimont,"Add --audio-dup

Add an option to duplicate audio on the device, compatible with the new
audio playback capture (--audio-source=playback).

Fixes #3875 <https://github.com/Genymobile/scrcpy/issues/3875>
Fixes #4380 <https://github.com/Genymobile/scrcpy/issues/4380>
PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
a10f8cd798023f858796b023cb846fa2184ad2c7,2024-07-19 21:18:39,Romain Vimont,"Add audio playback capture method

Add a new method to capture audio playback.

It requires Android 13 (where the Shell app has MODIFY_AUDIO_ROUTING
permission).

The main benefit is that it supports keeping audio playing on the device
(implemented in a further commit).

Fixes #4380 <https://github.com/Genymobile/scrcpy/issues/4380>
PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
53c6eb66ea8fc07433ffe686e9994c8d7c104b7a,2024-07-19 21:18:39,Romain Vimont,"Move audio source value

The MediaRecorder constant should not belong to the AudioSource enum.

This will allow to add a new AudioSource which has no meaningful
MediaRecorder audio source value.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
0f076083e88cdd313ab98c028598999f38b5a02f,2024-07-19 21:18:39,Romain Vimont,"Extract AudioCapture interface

Move the implementation to AudioDirectCapture and extract an
AudioCapture interface.

This will allow to provide another AudioCapture implementation.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
053bf83f581be543815cf859cedcb496fbb0bc75,2024-07-19 21:18:39,Romain Vimont,"Extract AudioRecordReader

Move the logic to read from an AudioRecord and handle all corner cases
for PTS. This simplifies AudioCapture.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
414ce4c7545d62c0f1e34b2978ace5745d199fd4,2024-07-19 21:18:39,Romain Vimont,"Move createAudioFormat() to AudioConfig

This will allow to reuse this method.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
a2f3a5cf1887261ff526245a9e9e9caa3fb87385,2024-07-19 21:18:39,Romain Vimont,"Move hardcoded audio configuration to AudioConfig

This will allow to use these constants from different classes not
directly related to AudioCapture.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
5e605b9b8f8a31b53a41695a831696edad29327e,2024-07-19 21:18:39,Romain Vimont,"Move audio compatibility check

The compatibility depends on the capture constraints, not the encoding.

This will allow to add a new capture implementation with different
constraints.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
cf09e78323775f97516e09c17c1201b4f39be940,2024-07-19 21:18:39,Romain Vimont,"Throw AudioCaptureException on workaround error

Replace a RuntimeException by a specific AudioCaptureException.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
3b8ec0c38db43a5dd5ed46bc416743ba8e169408,2024-07-19 21:18:39,Romain Vimont,"Rename audio capture exception

The AudioCaptureForegroundException was very specific. Rename it to
AudioCaptureException to support other capture failures.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
39132ff2dd7f85af7aa03d68df3d42e5b6646b97,2024-07-19 21:18:39,Romain Vimont,"Make encode() method private

It is only used from AudioEncoder.

PR #5102 <https://github.com/Genymobile/scrcpy/pull/5102>",False
9d1d79b004ed7171f481225993d54c3b100411a7,2024-07-17 21:32:29,Kaiming Hu,"Fix ""turn screen off"" for Honor Android 14 devices

Fixes #4823 <https://github.com/Genymobile/scrcpy/issues/4823>
PR #5109 <https://github.com/Genymobile/scrcpy/pull/5109>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e0cdc2ace32c63892d8fa6f1c22cbbdae5622bea,2024-07-17 21:32:26,Romain Vimont,"Fix method name

The method indicates whether GetPhysicalDisplayIds() exists. The ""Get""
was missing.",False
bbcd7636121d03db2b7f46c0c2109082c5ae5632,2024-07-17 21:30:27,Romain Vimont,"Exclude install-release tags from git describe

The install_release.sh script is updated one commit after the release
tag, which may be confusing.

For convenience, new lightweight tags have been added (for example
v2.5-install-release) to point to the commit where install_release.sh is
updated.

But these tags interfere with ""git describe"" to generate pretty
filenames when executing ./release.sh on a development branch, so ignore
them.

Before:

    release-v2.5-install-release-17-gc57a0512b

After:

    release-v2.5-18-gc57a0512b

Refs #4098 comment <https://github.com/Genymobile/scrcpy/issues/4098#issuecomment-1600332180>",False
c57a0512ba5b49534c0c10142998e2aa4172ce01,2024-07-17 01:01:31,Romain Vimont,"Add assertions

Passing an unknown enum value to convert them to string would return
NULL without any error, possibly causing undefined behavior later.

Add assertions to catch such programming errors early.",False
e84db2914dfa99ac9be7d789016f08b3e97e089e,2024-07-12 02:08:00,Romain Vimont,"Reorganize server packages

There are now a lot of classes in the server, reorganize them into
subpackages.",False
80ca7b15e5f8df6d6940b0dce779fb73d3bad1c9,2024-07-12 02:04:58,Romain Vimont,"Extract sources paths in build_without_gradle.sh

This avoids duplication, and will be useful to add more packages.",False
79242957a0ddba1c326f414cf5eafff6cc7b39c1,2024-07-11 15:51:38,Romain Vimont,"Add clipboard workaround for Honor device

Fixes #5073 <https://github.com/Genymobile/scrcpy/issues/5073>",False
fe7494c4922b2dd9a8af18842d82af1e5ebf8897,2024-07-11 15:49:47,Romain Vimont,"Linearize try-catch blocks

There are many possible method signatures for getPrimaryClip() and
setPrimaryClip().

Avoid the nested try-catch blocks.",False
9989668226f100534452e0af812807562ff5212f,2024-07-11 15:34:09,Romain Vimont,"Add mouse secondary bindings

Add secondary bindings (Shift+click) for mouse buttons.

In addition to:

    --mouse-bind=xxxx

It is now possible to pass a sequence of secondary bindings:

    --mouse-bind=xxxx:xxxx
                 <--> <-->
             primary   secondary
            bindings   bindings

If the second sequence is omitted, then it is the same as the first one.

By default, for SDK mouse, primary bindings trigger shortcuts and
secondary bindings forward all clicks.

For AOA and UHID, the default bindings are reversed: all clicks are
forwarded by default, whereas pressing Shift+click trigger shortcuts.

    --mouse-bind=bhsn:++++  # default for SDK
    --mouse-bind=++++:bhsn  # default for AOA and UHID

Refs 035d60cf5d3f4c83d48735b4cb4cd108a5b5f413
Refs f5e6b8092afd82bab402e7c2c3d00b1719f9bb57
Fixes #5055 <https://github.com/Genymobile/scrcpy/issues/5055>
PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
6baea57987a1867f2157f5c1001e77ca3cb1c6c5,2024-07-11 15:34:09,Romain Vimont,"Track mouse buttons state manually

The buttons state was tracked by SDL_GetMouseState(), and scrcpy applied
a mask to ignore buttons used for shortcuts.

Instead, track the buttons actually pressed (ignoring shortcuts)
manually, to prepare the introduction of more dynamic mouse shortcuts.

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
86b8286217b0909bf409e68ac1885ee59cc4cefc,2024-07-11 15:34:09,Romain Vimont,"Remove unused virtual mouse

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
51fee79bf50b124223523eb51c437c1267c2724a,2024-07-11 15:34:09,Romain Vimont,"Use finger source when a pointer is simulated

For pinch-to-zoom, rotation and tilt simulation, always use a finger
source (instead of a mouse) for both pointers (the real one and the
simulated one).

A ""virtual"" mouse does not work on all devices (e.g. on Pixel 8).

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
6808288823239b0f3a76f9be377e4de82e91b35a,2024-07-11 15:34:09,Romain Vimont,"Make pointer id independent of mouse bindings

The device source (MOUSE or FINGER) to use depended on whether a
secondary click was possible via mouse bindings.

As a first step, always use a mouse source to break this dependency.
Note that this change might cause regressions in some (unknown) cases
(refs f70359f14fb13f277c65b96f43ec83aba4722457), but hopefully not.

Further commits will restore a finger source in some specific use cases,
but independent of secondary clicks.

Refs #5055 <https://github.com/Genymobile/scrcpy/issues/5055>
Fixes #5067 <https://github.com/Genymobile/scrcpy/issues/5067>
PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
0bce4d7f56a4d109d450c4e41e4387a086c820ef,2024-07-11 15:34:09,Romain Vimont,"Add missing SC_ prefix for pointer id constants

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
6d98766cd5cf93804fd14d1eb9765ab9e1357cb1,2024-07-11 15:34:09,Romain Vimont,"Simplify boolean condition using XOR

(A && !B) || (!A && B) <==> A ^ B

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
487a6b9cf4a2ddc777a336d4b4c747ed33fa87a6,2024-07-11 15:34:09,Romain Vimont,"Remove top-level const

For consistency, never use top-level const for local variables.

PR #5076 <https://github.com/Genymobile/scrcpy/pull/5076>",False
b50f9eb41d1bd7b75a77e2c388b0144365e3cd5f,2024-07-08 20:46:01,Romain Vimont,"Add workaround for Skyworth devices

The vendor-modified ROM of Skyworth devices needs a valid app
info/context.

Fixes #4922 <https://github.com/Genymobile/scrcpy/issues/4922>",False
46041e0cc0d2467d470b444cb50cd9b6ae1fa695,2024-07-06 03:41:48,Yan,"Always initialize display->gl_context on macOS

Otherwise SDL_GL_DeleteContext() tried to access an uninitialized
pointer upon exit when not using the OpenGL renderer.

SDL_GL_DeleteContext() doesn't try to delete a NULL pointer, so no need
to check for that.

Fixes #5057 <https://github.com/Genymobile/scrcpy/issues/5057>
PR #5058 <https://github.com/Genymobile/scrcpy/pull/5058>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b419eef55e19a4700af3ea0a170d8d0a9ce6bd16,2024-07-06 03:34:07,Romain Vimont,"Do not report error on device disconnected

A device disconnection (when the adb connection is closed) makes the
read() on the ""receiver"" socket fail.

Since commit 063a8339ed27b94a8fe1e53a284507eb2d044e15, this is reported
as an error. As a consequence, scrcpy fails with:

    ERROR: Controller error

instead of:

    WARN: Device disconnected

To fix the issue, report a device disconnection in that case.

PR #5044 <https://github.com/Genymobile/scrcpy/pull/5044>",False
cc8e6133b0c9975ef2ed16086960e822ab750404,2024-07-06 03:30:56,Romain Vimont,Upgrade default versions in bug report template,False
126da0cb18576cc40b9506c676af3a2d569c760c,2024-07-06 03:30:55,Romain Vimont,"Rework bug report template checks

Remove explicit checkboxes, and add a link to prerequisites.",False
1d3b6dac6962d67d91b6e5ec93a39d99c5f44641,2024-07-06 03:27:53,Fr_Dae,"Improve bug report template

Use titles and capital letters.

PR #5051 <https://github.com/Genymobile/scrcpy/pull/5051>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
a4f8c025027964a9978925396459d36b8337623d,2024-07-02 11:44:58,Romain Vimont,"Reorder initialization to simplify

This also avoids a warning with some compilers which do not understand
that the condition to initialize the variable is the same as the
condition to use it:

    ../app/src/scrcpy.c: In function ‘scrcpy’:
    ../app/src/scrcpy.c:750:13: warning: ‘src’ may be used uninitialized in this function [-Wmaybe-uninitialized]
      750 |             sc_frame_source_add_sink(src, &s->screen.frame_sink);
          |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Refs 45fe6b602b4c050c5b1fba87cec7160093052af3
Refs <https://github.com/Genymobile/scrcpy/issues/5045#issuecomment-2201589757>",False
a8871bfad77ed1d0b968f3919df685a301849f8f,2024-06-29 21:21:36,Romain Vimont,Update links to 2.5,False
89df38f64160556aaf3db5b56e93d165c5eb76fd,2024-06-29 20:22:45,Romain Vimont,Bump version to 2.5,False
c95e6964c5411a2c78be9174abb3842082ad98c5,2024-06-29 20:22:32,Romain Vimont,Merge branch 'master' into release,True
343f715323580398d446d6d1935a31cdbb668031,2024-06-29 16:40:45,Romain Vimont,Upgrade platform-tools (35.0.0) for Windows,False
f13f00021fddebb3249748dca82ccb4ac7547505,2024-06-29 16:40:45,Romain Vimont,Upgrade SDL (2.30.4) for Windows,False
48c2c030938a87426ce8e5e7e1f26b8f059d1932,2024-06-29 16:40:45,Romain Vimont,Upgrade FFmpeg (7.0.1) for Windows,False
1e3deabd6c9e9937094bba27c8a7c452453534be,2024-06-29 16:40:45,Romain Vimont,"Do not call avcodec_close()

The documentation of avcodec_close() says:

> Do not use this function. Use avcodec_free_context() to destroy a
> codec context (either open or closed).

It was deprecated in FFmpeg 7 by commit
1cc24d749569a42510399a29b034f7a77bdec34e:

<https://git.ffmpeg.org/gitweb/ffmpeg.git/commit/1cc24d749569a42510399a29b034f7a77bdec34e>

> Its use has been discouraged since 2016, but now is no longer used in
> avformat, so there is no reason to keep it public.",False
76332282783f72bc611dcb1b871f4baacd59de1d,2024-06-29 16:12:19,Romain Vimont,"Forward mouse hover events

Also add an option --no-mouse-hover to get the old behavior.

Fixes #2743 <https://github.com/Genymobile/scrcpy/issues/2743>
Fixes #3070 <https://github.com/Genymobile/scrcpy/issues/3070>
PR #5039 <https://github.com/Genymobile/scrcpy/pull/5039>",False
f5e6b8092afd82bab402e7c2c3d00b1719f9bb57,2024-06-25 02:47:59,Romain Vimont,"Forward all clicks by default for UHID/AOA

By default, only the left click is forwarded to the device, and
secondary clicks trigger shortcuts (the behavior can be configured by
--mouse-bind=xxxx).

But when the mouse mode is relative (AOA and UHID modes), forward all
clicks by default. This makes more sense since the cursor is handled on
the device side, the user expects all mouse buttons to be forwarded.

Refs <https://github.com/Genymobile/scrcpy/issues/4727#issuecomment-2069869750>
PR #5022 <https://github.com/Genymobile/scrcpy/pull/5022>",False
035d60cf5d3f4c83d48735b4cb4cd108a5b5f413,2024-06-25 02:47:23,Romain Vimont,"Add option to configure mouse bindings

Add a new option --mouse-bind=xxxx.

The argument must be exactly 4 characters, one for each secondary click:

    --mouse-bind=xxxx
                 ^^^^
                 ||||
                 ||| `- 5th click
                 || `-- 4th click
                 | `--- middle click
                  `---- right click

Each character must be one of the following:
 - `+`: forward the click to the device
 - `-`: ignore the click
 - `b`: trigger shortcut BACK (or turn screen on if off)
 - `h`: trigger shortcut HOME
 - `s`: trigger shortcut APP_SWITCH
 - `n`: trigger shortcut ""expand notification panel""

This deprecates --forward-all-clicks (use --mouse-bind=++++ instead).

Refs <https://github.com/Genymobile/scrcpy/pull/2258#issuecomment-2182394460>
PR #5022 <https://github.com/Genymobile/scrcpy/pull/5022>",False
40493dff608cda7f0f37c166a2d8fef92581acf0,2024-06-25 02:30:33,Romain Vimont,"Fix ""resize to fit"" when all clicks are forwarded

To resize the window to fit the device screen, it is possible to
double-click in the ""black bars"".

This feature was mistakenly disabled when --forward-all-clicks was set.

Instead, disable it only if mouse relative mode is enabled (AOA or
UHID), because in that case the mouse cursor is on the device.",False
09ce0307feb239487982bfd62f57bd762f2a9165,2024-06-25 02:26:49,Romain Vimont,"Fix zsh completion script

An '=' was missing for some options with an argument.",False
9fa30ab1aeeb5cff32d2f6ad603a3a426bc04d69,2024-06-25 02:25:24,Romain Vimont,"Fix error message parameter

Use the local argument value, not the global optarg variable (even if it
has the same value in practice, as it's passed as argument).",False
0b926922bc169eab704f9805e6d35f79f7a1aa95,2024-06-23 22:45:56,Romain Vimont,"Ignore shortcut keycodes

Never inject keycodes used as shortcut modifiers.

Refs #4732 <https://github.com/Genymobile/scrcpy/issues/4732>
PR #4741 <https://github.com/Genymobile/scrcpy/pull/4741>",False
24bcc3fa2b4323091a487ad1a2568d02ad0d2042,2024-06-23 22:45:45,Romain Vimont,"Simplify shortcut modifiers

Restrict shortcut modifiers to be composed of only one item each.

Before, it was possible to select a list of multiple combinations of
modifier keys, like --shortcut-mod='lctrl+lalt,rctrl+rsuper', meaning
that shortcuts would be triggered either by LCtrl+LAlt+key or
RCtrl+RSuper+key.

This was overly generic, probably not used very much, and it prevents to
solve inconsistencies between UP and DOWN events of modifier keys sent
to the device.

Refs #4732 <https://github.com/Genymobile/scrcpy/issues/4732>
PR #4741 <https://github.com/Genymobile/scrcpy/pull/4741>",False
592ca0b59b3f57e6d721a57554e0efc5a52bb70f,2024-06-21 17:55:47,wuderek,"Try newer display API first

The old createDisplay() API has been removed from Android. Try the newer
API first, since more and more devices will use that version.

PR #5008 <https://github.com/Genymobile/scrcpy/pull/5008>",False
30e42af2d4ca660b06bce2ada7b1a0d303c73239,2024-06-21 17:50:33,wuderek,"Add missing virtual display release()

PR #5008 <https://github.com/Genymobile/scrcpy/pull/5008>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9030bd8be434ee54abbcd7aad0d4e37c699a362b,2024-06-21 15:42:13,Romain Vimont,Upgrade AGP from 8.1.3 to 8.3.0,False
576e7552a29e30b40205f81f2ff4d461f018313f,2024-06-13 12:44:40,Romain Vimont,"Mention that the Debian package is obsolete

It cannot be updated until the android-framework-XX Debian package is
fixed.

Refs <https://tracker.debian.org/pkg/scrcpy>",False
24b9e0a9705ab0b283fd2796493a25c6e4d7db42,2024-06-11 13:34:27,Romain Vimont,"Retrieve icon decoder directly

The call to av_find_best_stream() gives the decoder directly, this
avoids to retrieve it afterwards in a separate step.",False
9ea4446369e53936032668d483aede39e49c84c1,2024-06-09 22:55:32,Romain Vimont,"Release the audio lock early

The final write from the writer thread does not require a lock: it is
guaranteed that enough space is available since the reader thread never
writes.",False
5d1d5bdc169fdc1ef836a8c04f794fabe363f44b,2024-06-09 21:57:30,Romain Vimont,"Fix thread leak on Windows

Fixes #4973 <https://github.com/Genymobile/scrcpy/issues/4973>",False
fd9498e07c949828a6aedfc17340641b6ec56c0c,2024-05-30 19:26:37,Romain Vimont,"Avoid zero-length copies

Return early if there is nothing to read/write.",False
c27ab46efbcab0b9558a91e691d799ffef496c97,2024-05-30 11:53:42,Romain Vimont,"Remove suggestion to install from winget

It does not work.

Refs #4027 <https://github.com/Genymobile/scrcpy/issues/4027>
Refs #4389 <https://github.com/Genymobile/scrcpy/issues/4389>
Refs #4956 <https://github.com/Genymobile/scrcpy/issues/4956>",False
b5849db32fdd4bd1bba4e8084e5bfa368f6e9747,2024-05-29 14:02:58,Romain Vimont,"Document missing package to build for Windows

To build ffmpeg, libz is necessary.

Refs #4955 <https://github.com/Genymobile/scrcpy/issues/4955>",False
09e8c20168a7d608fa850aabada4f404e1c698b4,2024-05-14 11:53:57,Romain Vimont,"Rename streamScreen() to streamCapture()

The capture source may be either the screen or the camera.",False
da484b7ab9904beae0128aa2066f5d04a9c9e840,2024-05-12 14:14:27,Romain Vimont,"Reject recording with control only

If video and audio are disabled, there is nothing to record.",False
063a8339ed27b94a8fe1e53a284507eb2d044e15,2024-05-11 20:42:00,Romain Vimont,"Terminate on controller error

This is particularly important to react to server socket disconnection
since video and audio may be disabled.

PR #4868 <https://github.com/Genymobile/scrcpy/pull/4868>",False
b5c8de08e0439b1d6c5827a36faf341fad8986af,2024-05-11 20:42:00,Romain Vimont,"Update documentation for --no-window

PR #4868 <https://github.com/Genymobile/scrcpy/pull/4868>",False
45fe6b602b4c050c5b1fba87cec7160093052af3,2024-05-11 20:36:16,Romain Vimont,"Add scrcpy window without video playback

Add the possibility to solely control the device without screen
mirroring:

    scrcpy --no-video --no-audio

This is different from OTG mode, which does not require USB debugging at
all. Here, the standard mode is used but with the possibility to disable
video playback.

By default, always open a window (even without video playback), and add
an option --no-window.

Fixes #4727 <https://github.com/Genymobile/scrcpy/issues/4727>
Fixes #4793 <https://github.com/Genymobile/scrcpy/issues/4793>
PR #4868 <https://github.com/Genymobile/scrcpy/pull/4868>",False
cca2c9ffb7a7d400c20ee3a9962462ed4631d6db,2024-04-19 16:27:18,Romain Vimont,"Disable FPS counter when no video playback

There is no frame rate to count.",False
22d78e8a82bc3d6d1c18a1cc419be536201a003c,2024-04-19 16:19:03,Romain Vimont,"Fix boolean condition

Use the short-circuit operator && between booleans.",False
bcb8503b261969c1ec176c7b852f9e0a4924db7b,2024-04-17 14:15:18,Romain Vimont,"Handle reported camera sizes array is null

The array of sizes may be null. Handle this case gracefully.

Fixes #4852 <https://github.com/Genymobile/scrcpy/issues/4852>",False
9aa6cc71be3116be4195e3df0bc0b13ae038a944,2024-04-16 19:20:44,Romain Vimont,"Forbid --no-control in OTG mode

The whole purpose of OTG is to only control the device.",False
54e08b4eaef3fb6b603332e6aa67f95a9627ea51,2024-04-16 19:20:41,Romain Vimont,"Fix code style

Limit to 80 columns.",False
bd8b945bb321ac73b00353c7bea74b0a5292d9a3,2024-04-12 20:52:45,Romain Vimont,"Register rotation watcher only when possible

Old Android versions may not be able to register a rotation watcher for
a secondary display. In that case, report the error instead of
registering a rotation watcher for the default display.

Refs <https://github.com/Genymobile/scrcpy/pull/4740#issuecomment-2051245633>

Suggested by: Kaiming Hu <huxxx1234@gmail.com>",False
a73bf932d61a1677f8898ba28adbffafacc97886,2024-04-12 20:50:15,Kaiming Hu,"Fix could not rotate secondary display

The version of the methods with the display id parameter must be tried
first, otherwise they will never be used (since the old versions without
the display id are still present).

Regression introduced by ee6620d123e87d4af8e51cd272de5eafb677122a.

Refs #4740 <https://github.com/Genymobile/scrcpy/pull/4740>
PR #4841 <https://github.com/Genymobile/scrcpy/pull/4841>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7011dd1ef0fe0f745387251c0a97bac338ce767d,2024-04-06 21:08:24,Stepan Salenikovich,"Fix freeze and thaw rotation for Android 14

Changed since AOSP/framework_base commit
670fb7f5c0d23cf51ead25538bcb017e03ed73ac, included in tag
android-14.0.0_r29.

Refs <https://android.googlesource.com/platform/frameworks/base/+/670fb7f5c0d23cf51ead25538bcb017e03ed73ac%5E%21/>
PR #4740 <https://github.com/Genymobile/scrcpy/pull/4740>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ee6620d123e87d4af8e51cd272de5eafb677122a,2024-04-06 21:08:21,Romain Vimont,"Refactor WindowManager methods

Select the available method to invoke the same way as in other wrappers
(using a version field).

Refs d894e270a7719b92e38b4f5e0294b9d55e90a6df
Refs #4740 <https://github.com/Genymobile/scrcpy/pull/4740>",False
aa34d63171c86a23942d575ac62410a0f8765a4d,2024-04-04 12:22:32,Romain Vimont,"Fix segfault on close with --no-video

Do not call sc_screen_hide_window() if screen is not initialized.

To reproduce:

    scrcpy --no-video --record=file.mp4

This only segfaults in debug mode since commit
fd0f432e877153d83ed435474fb7b04e41de4269.",False
206809a99affad9a7aa58fcf7593cea71f48954d,2024-04-02 21:31:21,Romain Vimont,Fix typo in documentation,False
bf625790faccd86b5cdf89234ee405825f76b662,2024-03-30 19:58:57,Simon Chan,"Request limited color range by default

Most devices currently use limited color range, but some recent devices
encode in full color range, which is currently not supported by the SDL
opengl render driver.

Fixes #4756 <https://github.com/Genymobile/scrcpy/issues/4756>
Refs <https://github.com/Genymobile/scrcpy/issues/4756#issuecomment-2003710860>
Refs libusb/#9311 <https://github.com/libsdl-org/SDL/issues/9311>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
db55edb196134ab39f14c76edfd35225055f1227,2024-03-30 19:58:09,Romain Vimont,"Fix YUV conversion for full color range

Take the color range (full vs limited) into account to render the
picture.

Note that with the current version of SDL, it has no impact with the SDL
opengl render driver.

Fixes #4756 <https://github.com/Genymobile/scrcpy/issues/4756>
Refs <https://github.com/Genymobile/scrcpy/issues/4756#issuecomment-2003228916>
Refs libusb/#9311 <https://github.com/libsdl-org/SDL/issues/9311>

Suggested-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
1c3801a0b1624258e5004e651c9dbcff7eafe324,2024-03-30 18:50:51,Romain Vimont,"Add a shortcut to pause/unpause display

Pause/unpause display on MOD+z and MOD+Shift+z.

It only impacts rendering, the device is still captured, the video
stream continues to be transmitted to the device and recorded (if
recording is enabled).

Fixes #1632 <https://github.com/Genymobile/scrcpy/issues/1632>
PR #4748 <https://github.com/Genymobile/scrcpy/pull/4748>",False
be3d357a6dcdf0f3fccabd795b869a30e1e5bee1,2024-03-30 18:48:47,Romain Vimont,"Use source repo tarball for libusb

Legitimate or not, we should not use sources that do not match the
repository.

Refs <https://github.com/libusb/libusb/issues/1468#issuecomment-1974787595>
Refs <https://news.ycombinator.com/item?id=39866309>
Refs #4713 <https://github.com/Genymobile/scrcpy/pull/4713>",False
79968a0ae63179c39d5f1d4f4d97da020c9e07dd,2024-03-11 22:35:27,Romain Vimont,"Reorder documentation

Present the --tcpip option without arguments first.",False
7f23ff3f2ca64dae6eb8b0ca9a881230184ae756,2024-03-03 04:36:54,Romain Vimont,"Add videos for pinch-to-zoom and tilt

A video is worth a thousand words.",False
cc7719079ab6301e6ab42b7cd078a1da5acfa5b2,2024-03-03 04:35:26,Romain Vimont,Italicize coordinates letters in documentation,False
0c94b75eefee510d3de6bc724eaeedfc600faadc,2024-03-03 04:30:24,Romain Vimont,Update links to 2.4,False
af573090741e73c66c4a543dcd94fd771c51b7be,2024-03-03 03:52:09,Romain Vimont,Bump version to 2.4,False
a720c946a6935d6873095c58585ea78bf4b4242e,2024-03-03 03:51:32,Romain Vimont,Merge branch 'master' into release,True
8d87b91f692914ada1c146bd911ab4623552174b,2024-03-03 03:22:54,Romain Vimont,"Build dependencies from sources

The project has 3 build dependencies:
 - SDL
 - FFmpeg
 - libusb

For Windows, the release script downloaded pre-built build dependencies
(either from upstream, or from the scrcpy-deps repository).

Instead, download the source releases and build locally. This offers
more flexibility.

The official adb release is still downloaded and included as is in the
release archive (it is not a build dependency).

Also upgrade FFmpeg to 6.1.1 and libusb to 1.0.27.

PR #4713 <https://github.com/Genymobile/scrcpy/pull/4713>",False
125b1103e1cdfe676d66a9223df82c423c5e75bf,2024-03-02 21:18:21,inson1,"Happy new year 2024!

PR #4716 <https://github.com/Genymobile/scrcpy/pull/4716>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
36189b90ea815d8fced961c36c80f146d5952324,2024-03-01 14:27:10,Romain Vimont,Remove spurious line,False
4dca08cfe3eadd4438bf235bd62050059aec1801,2024-03-01 14:27:10,Romain Vimont,"Set SDL hints before creating any thread

To avoid race conditions in SDL (reported by TSAN).",False
fd0f432e877153d83ed435474fb7b04e41de4269,2024-03-01 05:22:35,Romain Vimont,"Detect missing initializations

Write invalid data in memory to easily detect missing initializations in
debug mode.",False
cdf09805c042cc760397b08d9e7cf58fbf8f76a4,2024-03-01 05:22:34,Romain Vimont,Add missing initialization,False
bf069bd37bb064fb49b7f75c6ea665706b599784,2024-03-01 05:22:31,Romain Vimont,"Document usage examples

This exposes several common options on the front page.",False
b9d244b4c9eaca05f9202126519200603ebd0cbe,2024-03-01 05:22:28,Romain Vimont,"Document UHID

Rework the documentation to present the keyboard and mouse input modes.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
dd479ed17613e8f7d7c2cf2447f57045815192b8,2024-03-01 05:22:23,Romain Vimont,"Check options specific to SDK keyboard

Fail if an option specific to --keyboard=sdk is passed with another
keyboard input mode.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
5f12132c47178d88ca73f17e90de6891aee33f2d,2024-03-01 05:22:19,Romain Vimont,"Do not fallback keyboard mode if AOA fails

Initially, if AOA initialization failed, default injection method was
used, in order to use the same command/shortcut when the device is
connected via USB or via TCP/IP, without changing the arguments.

Now that there are 3 keyboard modes, it seems unexpected to switch to
another specific mode if AOA fails (and it is inconsistent). If the user
explicitly requests AOA, then use AOA or fail.

Refs #2632 comment <https://github.com/Genymobile/scrcpy/pull/2632#issuecomment-945190859>
PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
1c5ad0e8131c6e051e940c29acdc81a500df4673,2024-03-01 05:22:16,Romain Vimont,"Reassign -K and -M to UHID keyboard and mouse

The options were deprecated, but for convenience, reassign them to
aliases for --keyboard=uhid and --mouse=uhid respectively.

Their long version (--hid-keyboard and --hid-mouse) remain deprecated.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
6a103c809f4a208c25d7fd5d019bc6bc5b3046b4,2024-03-01 05:22:13,Romain Vimont,"Add UHID mouse support

Use the following command:

    scrcpy --mouse=uhid

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
151a6225d44f795bcc6066e8af9ccc65fefbaded,2024-03-01 05:22:10,Romain Vimont,"Add shortcut to open keyboard settings

The keyboard settings can be opened by:

    adb shell am start -a android.settings.HARD_KEYBOARD_SETTINGS

Add a shortcut (MOD+k) for convenience if the current keyboard is HID.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
54dede36307edc69553d7de620f6b4318e48c678,2024-03-01 05:22:05,Romain Vimont,"Fix startActivity() for supporting API < 30

Call the older startActivityAsUser() instead of
startActivityAsUserWithFeature() so that it also works on older Android
versions.

Fixes #4704 <https://github.com/Genymobile/scrcpy/issues/4704>
PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
f557188dc835e0a1b108d56b30641510901ecf13,2024-03-01 05:22:03,Romain Vimont,"Create UhidManager only on first use

There is no need to create a UhidManager instance (with its thread) if
no UHID is used.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
87da68ee0d74831a2b44230c573a3b315c8fd7d3,2024-03-01 05:22:00,Simon Chan,"Handle UHID output

Use UHID output reports to synchronize CapsLock and VerrNum states.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
021c5d371ad0d2c932b981151f45f794d8843ebe,2024-03-01 05:21:57,Romain Vimont,"Refactor DeviceMessageSender

Refactor DeviceMessage as a queue of message. This will allow to add
other message types.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
840680f546be59d1581ae4014a6546e137447cbc,2024-03-01 05:21:54,Simon Chan,"Add UHID keyboard support

Use the following command:

    scrcpy --keyboard=uhid

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4d5b67cc8018753a02a786cd4ca27e38cad50d65,2024-03-01 05:21:52,Romain Vimont,"Log controller handling errors

On close, the controller is expected to throw an IOException because the
socket is closed, so the exception was ignored.

However, message handling actions may also throw IOException, and they
must not be silently ignored.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
604e59ac7bd907567348627712185f1fa88e4659,2024-03-01 05:21:50,Romain Vimont,"Initialize controller before keyboards

The UHID keyboard initializer will need the controller.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
4d2c2514fc466fc1dd8cfb972c2697a843e28d70,2024-03-01 05:21:47,Romain Vimont,"Initialize controller in two steps

There is a dependency cycle in the initialization order:
 - keyboard depends on controller
 - controller depends on acksync
 - acksync depends on keyboard initialization

To break this cycle, bind the async instance to the controller in a
second step.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
107f7a83abe60ff1a25db42aa864ed13f5a4c0c1,2024-03-01 05:21:44,Romain Vimont,"Extract binary to hex string conversion

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
2e7f6a6fc4b3bf8347b7bba85335cb005d0fc63e,2024-03-01 05:21:41,Romain Vimont,"Rename default keyboard implementation to ""sdk""

Rename {keyboard,mouse}_inject to {keyboard,mouse}_sdk.

All implementations ""inject"" key events and mouse events, what differs
is the mechanism. For these implementations, the Android SDK API is used
to inject events.

Note that the input mode enum variants were already renamed
(SC_KEYBOARD_INPUT_MODE_SDK and SC_MOUSE_INPUT_MODE_SDK).

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
d95276467b93eb4b045fd15000eacaecf7c1874c,2024-03-01 05:21:39,Romain Vimont,"Extract mouse HID handling

Split the mouse implementation using AOA and the code handling HID
events, so that HID events can be reused for another protocol (UHID).

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
91485e2863603732348d86a4ed06cafa20d1225f,2024-03-01 05:21:37,Romain Vimont,"Extract keyboard HID handling

Split the keyboard implementation using AOA and the code handling HID
events, so that HID events can be reused for another protocol (UHID).

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
f2d62031561b4d1660c2c5bb3910e7a723d317f7,2024-03-01 05:21:34,Romain Vimont,"Extract HID events struct

An event contained several fields:
 - the accessory id
 - the HID event data
 - a field ack_to_wait specific to the AOA implementation.

Extract the HID event part to prepare the factorization of HID event
creation.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
2d32557fdea3e83dd8ec2a73e122338cbe5d417b,2024-03-01 05:21:30,Romain Vimont,"Embed HID event data

In the implementation, an HID event is at most 8 bytes. Embed the data
in the HID event structure to avoid allocations and simplify the code.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
ae303b8d07bf84a96d97c7cead9e0a405a5e1482,2024-03-01 05:21:29,Romain Vimont,"Rename hid event ""buffer"" to ""data""

This fields contains the HID event data (there is no ""bufferization"").

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
29ce03e3370d6d79c042e02abaa6666c4930d0ee,2024-03-01 05:21:25,Romain Vimont,"Rename ""buffer"" to ""data""

The variable name is intended to match the parameter name of
libusb_control_transfer().

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
48adae1728c6870a88a596ea092f98c76c7586b7,2024-03-01 05:21:21,Romain Vimont,"Fix HID mouse documentation

The size of a mouse HID event is 4 bytes.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
ea98d49baed749eea0f3c9a02c9f019e37c85af6,2024-03-01 05:21:15,Simon Chan,"Introduce --keyboard and --mouse

Until now, there was two modes for keyboard and mouse:
 - event injection using the Android system API (default)
 - HID/AOA over USB

For this reason, the options were exposed as simple flags:
 - -K or --hid-keyboard to enable physical keyboard simulation (AOA)
 - -M or --hid-mouse to enable physical mouse simulation (AOA)

Replace them by explicit --keyboard and --mouse options, with 3 possible
values:
 - disabled
 - sdk (default)
 - aoa

This will allow to add a new mode (uhid).

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
35add3daee0907f4ca4e706c60d1c00a27702a79,2024-03-01 05:21:02,Romain Vimont,"Accept disabled keyboard or mouse

The input manager assumed that if a controller was present, then both a
key processor and a mouse processor were present.

Remove this assumption, to support disabling keyboard and mouse
separately. This prepares the introduction of new command line options
--keyboard and --mouse.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
c0a1aee8cea2ce6a5dbe39117d0505786ea0db7b,2024-03-01 05:20:39,Romain Vimont,"Always pass input manager instance

Some functions in input_manager.c only have access to a sub-object (for
example the controller). For consistency, always pass the whole
input manager instance.

This will allow to add assertions when keyboard and mouse could be
disabled separately.

PR #4473 <https://github.com/Genymobile/scrcpy/pull/4473>",False
a97641757237fc9342f2d1b4b9573a99761ffc21,2024-03-01 04:41:48,Romain Vimont,Fix typo in error message,False
ffa238b9d35bb9c882537d32724bbadbe4da7ef6,2024-03-01 04:25:44,Romain Vimont,Remove duplicate lines in libusb script,False
f6459dd742f356fade275e2178aa9ecee05c23cc,2024-02-29 15:01:45,Romain Vimont,"Fix FAQ link

Refs ad05a018003a66b0a5f8afefb0d2f16a392d3077",False
295102a6d91e5a71fbcc7fa3f17a2cea9c9eb9e6,2024-02-27 14:36:27,Romain Vimont,"Check device messages assumptions at runtime

Do not assume the server behaves correctly (scrcpy should not require
the device to be trusted).",False
d894e270a7719b92e38b4f5e0294b9d55e90a6df,2024-02-27 00:56:56,eiyooooo,"Add rotation support for non-default display

Use new methods introduced by this commit:
<https://android.googlesource.com/platform/frameworks/base/+/90c9005e687aa0f63f1ac391adc1e8878ab31759%5E%21/>

PR #4698 <https://github.com/Genymobile/scrcpy/pull/4698>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
746eaea55683e8e97ba7763bc0fa567227004c5d,2024-02-26 13:06:18,Romain Vimont,"Add missing clipboard workaround for IQOO device

The first part of the workaround fixed getPrimaryClip(). This part fixes
setPrimaryClip().

Fixes #4703 <https://github.com/Genymobile/scrcpy/issues/4703>
Refs 5ce8672ebc56b7286e1078a39abc64903e5664d0
Refs #4492 <https://github.com/Genymobile/scrcpy/issues/4492>",False
78a7e4f293f59499fbb4be850a29e891171fcf4f,2024-02-24 00:37:52,Romain Vimont,Use sc_ prefix for device sender,False
9858eff85625abcbf392ae57220df1b1b03f793b,2024-02-24 00:37:52,Romain Vimont,"Fix device message deserialization checks

If any message is incomplete, the deserialization method must return
immediately.",False
9e22f3bf1cca9a957173193250eaeb084ab0c245,2024-02-24 00:37:52,Romain Vimont,"Replace unsigned char by uint8_t for buffers

For consistency.",False
25f1e703b7637c3eb1382e435113688520a38d36,2024-02-24 00:37:16,Romain Vimont,"Extract ControlChannel class

This prevents many components from depending on the whole
DesktopConnection.",False
a7cf4daf3bcb573add846c2f4c98b94944c05cb9,2024-02-17 20:39:38,Romain Vimont,"Avoid negative average buffering

The assumption that underflow and overbuffering are caused by jitter
(and that the delay between the producer and consumer will be caught up)
does not always hold.

For example, if the consumer does not consume at the expected rate (the
SDL callback is not called often enough, which is an audio output
issue), many samples will be dropped due to overbuffering, decreasing
the average buffering indefinitely.

Prevent the average buffering to become negative to limit the
consequences of an unexpected behavior.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
c12fdf900fb82e8ce958881e24a9f4f6185c0db7,2024-02-17 20:35:33,Romain Vimont,"Minimize buffer underflow on starting

If playback starts too early, insert silence until the buffer is filled
up to at least target_buffering before playing.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
4502126e3b2ab2d5a82f636e32524929b3b0d07e,2024-02-17 20:35:30,Romain Vimont,"Use early return to avoid additional indentation

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
dfa3f97a87c0b42289920777731b4da95369d7ed,2024-02-17 20:35:22,Romain Vimont,"Fix audio player comment

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
edac4b8a9a4a261a82400828b17d7b7ae0b33cd0,2024-02-17 20:33:10,Romain Vimont,"Increase buffering level smoothness

The buffering level does not change continuously: it increases abruptly
when a packet is received, and decreases abruptly when an audio block is
consumed.

To estimate the buffering level, a rolling average is used.

To make the buffering more stable, increase the smoothness of this
rolling average. This decreases the risk of enabling audio compensation
due to an estimation error.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
44abed5c68d657c664457eb562318168876d2208,2024-02-17 20:32:10,Romain Vimont,"Improve audio compensation thresholds

Use different thresholds for enabling and disabling compensation.

Concretely, enable compensation if the difference between the average
and the target buffering levels exceeds 4 ms (instead of 1 ms). This
avoids unnecessary compensation due to small noise in buffering level
estimation.

But keep a smaller threshold (1 ms) for disabling compensation, so that
the buffering level is restored closer to the target value. This avoids
to keep the actual level close to the compensation threshold.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
cfa4f7e2f2ac867dd6d6278a48cc470e82d42f37,2024-02-17 20:31:33,Romain Vimont,"Replace locks by atomics in audio player

The audio output thread only reads samples from the buffer, and most of
the time, the audio receiver thread only writes samples to the buffer.
In these cases, using atomics avoids lock contention.

There are still corner cases where the audio receiver thread needs to
""read"" samples (and drop them), so lock only in these cases.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
d47ecef1b561322872437368edbfff69dc5ad0bd,2024-02-17 20:29:58,Romain Vimont,"Limit buffering time value

This avoids unreasonable values which could lead to integer overflow.

PR #4572 <https://github.com/Genymobile/scrcpy/pull/4572>",False
9efa162949c2a3e3e42564862ff390700270394d,2024-02-17 20:19:08,Romain Vimont,"Configure clean up actions dynamically

Some actions may be performed when scrcpy exits, currently:
 - disable ""show touches""
 - restore ""stay on while plugged in""
 - power off screen
 - restore ""power mode"" (to disable ""turn screen off"")

They are performed from a separate process so that they can be executed
even when scrcpy-server is killed (e.g. if the device is unplugged).

The clean up actions to perform were configured when scrcpy started.
Given that there is no method to read the current ""power mode"" in
Android, and that ""turn screen off"" can be applied at any time using an
scrcpy shortcut, there was no way to determine if ""power mode"" had to be
restored on exit. Therefore, it was always restored to ""normal"", even
when not necessary.

However, setting the ""power mode"" is quite fragile on some devices, and
may cause some issues, so it is preferable to call it only when
necessary (when ""turn screen off"" has actually been called).

For that purpose, make the scrcpy-server main process and the clean up
process communicate the actions to perform over a pipe (stdin/stdout),
so that they can be changed dynamically. In particular, when the power
mode is changed at runtime, notify the clean up process.

Refs 1beec99f8283713b1fbf0b3704eb4dceecc9a590
Refs #4456 <https://github.com/Genymobile/scrcpy/issues/4456>
Refs #4624 <https://github.com/Genymobile/scrcpy/issues/4624>
PR #4649 <https://github.com/Genymobile/scrcpy/pull/4649>",False
be3f949aa5c4dcad276ac0f2b36671a3309ce12f,2024-02-10 14:31:22,wuderek,"Adapt to display API changes

The method SurfaceControl.createDisplay() has been removed in AOSP.

Use DisplayManager to create a VirtualDisplay object instead.

Fixes #4646 <https://github.com/Genymobile/scrcpy/issues/4646>
Fixes #4656 <https://github.com/Genymobile/scrcpy/issues/4656>
PR #4657 <https://github.com/Genymobile/scrcpy/pull/4657>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f7b4a18b4398c013b2bed9630b7bb35eb50ad97e,2024-02-10 14:30:28,Romain Vimont,"Catch generic ReflectiveOperationException

This exception is a super-type of:
 - ClassNotFoundException
 - IllegalAccessException
 - InstantiationException
 - InvocationTargetException
 - NoSuchFieldException
 - NoSuchMethodException

Use it to simplify.",False
05b5deacadf25f706a62b981a1558c75b37dea93,2024-02-10 14:30:26,Romain Vimont,"Move service managers creation

Create the service managers from each manager wrapper class rather than
from their getter in ServiceManager.

The way a wrapper retrieve the underlying service is an implementation
detail, and it must be consistent with the way it accesses it, so it is
better to write the creation in the wrapper.",False
d25cbc55f2238e2f9e621c83f27d675a7de913aa,2024-02-09 23:02:48,Romain Vimont,Remove unused field,False
3333e67452e52a1e0cd1c68181067f9eccdeb582,2024-02-01 13:49:47,Romain Vimont,"Fix memory leak on error

Fixes #4636 <https://github.com/Genymobile/scrcpy/issues/4636>",False
7c53a29d72cb0725e960c1b92732193251984558,2024-01-26 17:43:55,Romain Vimont,"Remove useless run script

This script was outdated and redundant with ./run.",False
5187f7254e4b556e3731fdb77fda68ae2e9fddce,2024-01-17 14:45:00,Romain Vimont,"Add another clipboard workaround for IQOO device

Fixes #4589 <https://github.com/Genymobile/scrcpy/issues/4589>
Refs 5ce8672ebc56b7286e1078a39abc64903e5664d0
Refs #4492 <https://github.com/Genymobile/scrcpy/issues/4492>",False
2ad93d1fc0094ba8263a05f0b162f2607aa68ea9,2024-01-16 02:31:19,Romain Vimont,"Fix scrcpy_otg() return value on error

The function now returns an enum scrcpy_exit_code, not a bool.",False
d067a11478e5a6312325bdd051c4ffd1362945c5,2024-01-08 01:42:39,Romain Vimont,"Do not power on if no video

Power on the device on start only if video capture is enabled.

Note that it only impacts display mirroring, since control is completely
disabled if video source is camera.

Refs 110b3a16f6d02124a4567d2ab79fcb74d78f949f",False
cd4056d0f333aee26efa8ba083e08c59b6d63a70,2024-01-02 14:52:28,Romain Vimont,Fix include formatting,False
6a58891e13bc3d5b531aa93718591ec495c4fb6f,2023-12-17 00:47:33,Romain Vimont,"Use current time as initial timestamp on error

If the initial timestamp could not be retrieved, use the current time as
returned by System.nanoTime(). In practice, it is the same time base as
AudioRecord timestamps.

Fixes #4536 <https://github.com/Genymobile/scrcpy/issues/4536>",False
ec41896c853325d670e361f641f4490ed71b641f,2023-12-17 00:46:31,Romain Vimont,"Fix integer overflow for audio packet duration

The result is assigned to a long (64-bit signed integer), but the
intermediate multiplication was stored in an int (32-bit signed
integer).

This value is only used as a fallback when no timestamp could be
retrieved, that's why it did not cause too much harm so far.

Fixes #4536 <https://github.com/Genymobile/scrcpy/issues/4536>",False
4cd61b5a9001043f1054502f0c29465707260cb1,2023-12-17 00:42:58,Romain Vimont,"Fix checkstyle violation

Reported by checkstyle:

> [ant:checkstyle] [INFO]
> scrcpy/server/src/main/java/com/genymobile/scrcpy/wrappers/ClipboardManager.java:48:
> Line is longer than 150 characters (found 167). [LineLength]",False
d2ed4510a76e0d273f9088bce6e85334b922c9cb,2023-12-16 02:42:07,Till Rathmann,"Simulate tilt multitouch event by pressing Shift

PR #4529 <https://github.com/Genymobile/scrcpy/pull/4529>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
604dfd7c6b07f583521c92f8391d3fdb6b1576e8,2023-12-14 21:38:19,Harsh Shandilya,"Fix incorrect compgen usage

PR #4532 <https://github.com/Genymobile/scrcpy/pull/4532>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
af69689ec1d52b442b0a4e1461ca71853c660cc6,2023-12-14 21:37:20,Harsh Shandilya,"Fix bash completion syntax

PR #4532 <https://github.com/Genymobile/scrcpy/pull/4532>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
cbce42336dce0bb4cd2c47ed7dfa56d40fc3aca1,2023-12-13 18:12:57,Romain Vimont,"Fix manpage syntax

The '-' character must be escaped.

Fixes #4528 <https://github.com/Genymobile/scrcpy/issues/4528>",False
5a6b8310cae1e0741b4375ca760d9c8dd49822c4,2023-12-13 17:25:14,Romain Vimont,Add note about official website,False
c9a4d2b38f318a4887e3db48a7d1bcf0affc0250,2023-12-04 13:20:12,Romain Vimont,"Use up-to-date values on display fold change

When a display is folded or unfolded, the maxSize may have been updated
since the option was passed, and deviceSize must be updated.

Refs #4469 <https://github.com/Genymobile/scrcpy/pull/4469>",False
1beec99f8283713b1fbf0b3704eb4dceecc9a590,2023-12-04 13:15:35,Romain Vimont,"Explicitly exit cleanup process

This avoids an internal crash reported in `adb logcat`.

Refs #4456 <https://github.com/Genymobile/scrcpy/pull/4456#issuecomment-1837427802>",False
5ce8672ebc56b7286e1078a39abc64903e5664d0,2023-12-04 13:13:31,Romain Vimont,"Add clipboard workaround for IQOO device

Fixes #4492 <https://github.com/Genymobile/scrcpy/issues/4492>",False
3001f8a2d581a921920d18c088d42e0cd747bf41,2023-12-03 22:31:11,Romain Vimont,"Adapt AudioRecord workaround to Android 14

Android 14 added a new int parameter ""halInputFlags"" to an internal
method:
<https://github.com/aosp-mirror/platform_frameworks_base/commit/f6135d75db79b1d48fad3a3b3080d37be20a2313>

Fixes #4492 <https://github.com/Genymobile/scrcpy/issues/4492>",False
c6ff78f4147ad5505b45cce8f1d6f44c8585a9b5,2023-12-02 17:09:05,Romain Vimont,Update links to v2.3.1,False
40f2560d987fbc88711b3aac14398d38c0e2a8f6,2023-12-02 17:00:19,Romain Vimont,Bump version to 2.3.1,False
26aa28c99846d69fd51c27c212bdaa41e83db670,2023-12-02 16:59:31,Romain Vimont,Merge branch 'master' into release,True
ef79fcbbd27d9f6e8096c278d2975c7c71bc67b9,2023-12-02 16:50:01,Romain Vimont,"Fix AV1 demuxing

For AV1, the config packet must not be merged with the next non-config
packet.

This fixes the following error when passing --video-codec=av1:

> INFO: [FFmpeg] libdav1d 1.3.0
> ERROR: [FFmpeg] Unknown OBU type 0 of size 29393
> ERROR: [FFmpeg] Error parsing OBU data
> ERROR: Decoder 'video': could not send video packet: -1094995529

PR #4487 <https://github.com/Genymobile/scrcpy/pull/4487>",False
9497f39fb47e899df1247942f90eba5daa0cf204,2023-11-29 16:46:05,Romain Vimont,"Do not fail if SDL_INIT_VIDEO fails without video

The SDL video subsystem may be initialized so that clipboard
synchronization works even without video playback.

But if the video subsystem initialization fails (e.g. because no video
device is available), consider it as an error only if video playback is
enabled.

Refs 5e59ed31352251791679e5931d7e5abf0c2d18f6
Fixes #4477 <https://github.com/Genymobile/scrcpy/issues/4477>",False
bf056b1fee904391bc932381c01052fb975ac62e,2023-11-29 16:44:07,Romain Vimont,"Do not initialize SDL video when not necessary

The SDL video subsystem is required for video playback and clipboard
synchronization.

If neither is used, it is not necessary to initialize it.

Refs 5e59ed31352251791679e5931d7e5abf0c2d18f6
Refs 110b3a16f6d02124a4567d2ab79fcb74d78f949f
Refs #4418 <https://github.com/Genymobile/scrcpy/issues/4418>
Refs #4477 <https://github.com/Genymobile/scrcpy/issues/4477>",False
bd9292931e868621294ec64ea85179a2803976ef,2023-11-28 13:02:28,Johannes Neyer,"Mention exclusive_caps mode in v4l2 documentation

PR #4435 <https://github.com/Genymobile/scrcpy/pull/4435>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
140a49b8bee1122b28d47b4385eccece7480f18e,2023-11-27 13:59:06,Romain Vimont,"Add workaround for Samsung devices issues

On some Samsung devices, DisplayManagerGlobal.getDisplayInfoLocked()
calls ActivityThread.currentActivityThread().getConfiguration(), which
requires a non-null ConfigurationController.

Fixes <https://github.com/Genymobile/scrcpy/issues/4467>",False
4135c411af419f4f86dc9ec9301c88012d616c49,2023-11-26 04:26:46,Romain Vimont,"Fix compilation error

Fix the following warning/error:

    ../app/src/cli.c:2158:17: warning: a label can only be part of a
    statement and a declaration is not a statement [-Wpedantic]

With some compilers, this is an error rather than a pedantic warning.

Refs <https://github.com/Genymobile/scrcpy/issues/2256#issuecomment-1467008307>",False
5e061636f65a5b95432d8dd5a64b4dcd2b7dd8c9,2023-11-26 02:45:07,Romain Vimont,Update links to v2.3,False
5f3fb843f59b058b7c38b5f7b1a561befc64e706,2023-11-26 02:10:27,Romain Vimont,"Bump version to 2.3

The previous version bump to 2.2 was incorrect, it was updated by:

    ./bump_version v2.2

instead of:

    ./bump_version 2.2

Correctly bump to version 2.3.

Refs #4433 <https://github.com/Genymobile/scrcpy/issues/4433#issuecomment-1816830875>",False
ce8126f322f310c5e8723ed3a15a8db6f3006648,2023-11-26 02:07:37,Romain Vimont,Merge branch 'master' into release,True
d037b02cc2205a4b4767340347bd562b6e7c68bc,2023-11-26 02:05:04,Romain Vimont,"Fix scrcpy-console.desktop

The argument passed to scrcpy was not applied, the full command must be
passed as a single argument.

PR #4448 <https://github.com/Genymobile/scrcpy/pull/4448>",False
89761213c3dd0d8ebe1ab0e8c2dd04b177b47dc2,2023-11-26 01:58:43,Kid,"Do not quote $SHELL in .desktop files

This does not work properly on some desktop environments (KDE), and
$SHELL is unlikely to require quoting.

Fixes #4367 <https://github.com/Genymobile/scrcpy/issues/4367>
PR #4448 <https://github.com/Genymobile/scrcpy/pull/4448>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8db4e78b34f9b2b08ce78910389a7f8f4c030f12,2023-11-26 01:58:43,Kid,"Fix Linux desktop files

There were too many backslashes in the Exec line.

Fixes #4367 <https://github.com/Genymobile/scrcpy/issues/4367>
PR #4448 <https://github.com/Genymobile/scrcpy/pull/4448>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5d4b8a7e6d18ee0e19a764945dc67efbd46f3e97,2023-11-26 01:55:26,Romain Vimont,"Fix turn screen off on Android 14

On Android 14, the methods to access the display have been moved to
DisplayControl, which is not in the core framework. Use a specific
ClassLoader to access this class and its native dependencies.

Fixes #3927 <https://github.com/Genymobile/scrcpy/issues/3927>
Refs #3927 comment <https://github.com/Genymobile/scrcpy/issues/3927#issuecomment-1790031953>
Refs #4446 comment <https://github.com/Genymobile/scrcpy/pull/4446#issuecomment-1824660915>
PR #4456 <https://github.com/Genymobile/scrcpy/pull/4456>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
eed06b141aa6cba15f1c163f8ec69adf13118b0e,2023-11-26 01:36:45,Romain Vimont,"Upgrade sdl (2.28.5) for Windows

Include the latest version of SDL in Windows releases.",False
825d7f72c0a81d2aac5594aaa8fe265b468280d4,2023-11-26 01:36:45,Romain Vimont,"Extract $VERSION for dependency scripts

This will allow to update the version only once in these files.",False
2370298b612bfd86da746a7480b8e159fc92c326,2023-11-26 01:36:45,Romain Vimont,"Download SDL prebuilt binaries from github

The server is faster than libsdl.org.",False
67f356f881898e21edabd4ecd2fb509ad4c92362,2023-11-26 01:36:37,Romain Vimont,"Improve crossbuild

Install all the prebuilt dependencies for Windows to a specific folder,
and use meson command line options to specify their location.

This removes crossbuild-specific code from the meson scripts and will
simplify dependency upgrades.

PR #4460 <https://github.com/Genymobile/scrcpy/pull/4460>",False
c573bd2a33c8fcd64005daca85a67a26bc958dfe,2023-11-24 04:20:00,Romain Vimont,Fix java code style,False
acb29888377580d21ab67c805576f97d5bda8bc7,2023-11-24 04:09:40,sam80180,"Do not hardcode server path on the device

The path can be retrieved from the classpath.

PR #4416 <https://github.com/Genymobile/scrcpy/pull/4416>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
85a94dd4b563e961304b2d9082932c5c1cc2e582,2023-11-24 04:09:40,Romain Vimont,"Fix meson deprecated 'pkgconfig' to 'pkg-config'

When running ./release.sh:

> DEPRECATION: ""pkgconfig"" entry is deprecated and should be replaced by
> ""pkg-config""",False
94031dfe97402d322e50c4d156456057fad53da0,2023-11-24 04:04:46,Romain Vimont,"Update documentation about video orientation

PR #4441 <https://github.com/Genymobile/scrcpy/pull/4441>",False
b43a9e8e7a70e3b847d13eeb17ebf18708c4d7fc,2023-11-24 04:04:46,Romain Vimont,"Add --orientation

Add a shortcut to set both the display and record orientations.

PR #4441 <https://github.com/Genymobile/scrcpy/pull/4441>",False
a9d6cb58374e27d34988db2245bfddf9402ad57d,2023-11-24 04:04:46,Romain Vimont,"Add --record-orientation

Add an option to store the orientation to apply in a recorded file.

Only rotations are supported (not flips).

PR #4441 <https://github.com/Genymobile/scrcpy/pull/4441>",False
2f926869300fdcdc1c668994739d0c379a9d525d,2023-11-24 03:57:32,Romain Vimont,"Pass --lock-video-orientation argument in degrees

For consistency with the new --display-orientation option, express the
--lock-video-orientation in degrees clockwise:

 * --lock-video-orientation=0 -> --lock-video-orientation=0
 * --lock-video-orientation=3 -> --lock-video-orientation=90
 * --lock-video-orientation=2 -> --lock-video-orientation=180
 * --lock-video-orientation=1 -> --lock-video-orientation=270

PR #4441 <https://github.com/Genymobile/scrcpy/pull/4441>",False
bb88b60227427959b931b5a4417202a85c5b0cdc,2023-11-24 03:57:28,Romain Vimont,"Add --display-orientation

Deprecate the option --rotation and introduce a new option
--display-orientation with the 8 possible orientations (0, 90, 180, 270,
flip0, flip90, flip180 and flip270).

New shortcuts MOD+Shift+(arrow) dynamically change the display
(horizontal or vertical) flip.

Fixes #1380 <https://github.com/Genymobile/scrcpy/issues/1380>
Fixes #3819 <https://github.com/Genymobile/scrcpy/issues/3819>
PR #4441 <https://github.com/Genymobile/scrcpy/pull/4441>",False
25e33566f5bca3b052dbb2b4262be96cd8f71caa,2023-11-21 13:16:38,Romain Vimont,Mention turning off audio in camera documentation,False
9df92ebe3765d2515f8e561896a239cdf82110bb,2023-11-20 18:35:54,Romain Vimont,Fix manpage style syntax,False
0801cf062722064506f2353c2c9bcd3504c59281,2023-11-20 18:33:51,Romain Vimont,"Fix options alphabetical order

Renaming --display to --display-id broke the alphabetical order.

Refs 23e116064dc97f2af843e764f13eebd54fab486d",False
4658c0e5d223d3d9aff19a37622e701261b09aef,2023-11-16 14:32:25,Romain Vimont,"Update record format error message

Recording now supports formats other than mp4 and mkv.

Refs e637feba51c2eac6de27ebb318a2f7a1aa54a62d",False
45a073a333564a3c596cfe4067de51bb339e8e2b,2023-11-16 13:40:28,Romain Vimont,"Do not create Device instance for camera

The device instance manages the display and the injection of input
events. It is not necessary for camera capture.",False
7e3b9359322fff65bd350febfdc02a76186981cd,2023-11-16 13:26:04,Romain Vimont,"Recreate the display on rotation

On Android 14 (Pixel 8), a device rotation while the camera app was
running resulted in an incorrect capture.

Destroying and recreating the display fixes the issue.",False
abcb10059749d9536c6e344f5c61466305afd2ee,2023-11-16 01:43:12,Romain Vimont,Upgrade Android SDK to 34,False
e8801cc3c0493f72ece976f2b1d3a3bdef8237ac,2023-11-16 01:43:12,Romain Vimont,"Upgrade AGP (8.1.3) and Gradle to 8.4

Android Gradle Plugin 8.1.3.
Gradle 8.4.

From now on, Java 17 is required.",False
86808e811424560c7ed188b9fd4213c3838b0724,2023-11-16 01:43:12,Romain Vimont,"Upgrade Android checkstyle to 10.12.5

Upgrade to the latest version.",False
15a3bad4abca691d6459821bbcaf4c4f52a52f28,2023-11-16 01:36:53,Romain Vimont,"Log PTS fixing at debug level

Audio PTS are retrieved by AudioRecord.getTimestamp(), so they do not
necessarily exactly match the number of samples (this allows to take
drift and lag into account).

As a consequence, two consecutive timestamps in microseconds may
sometimes end up within the same millisecond, causing the warning. This
is particularly true for the Matroska muxer which uses a timebase of
1/1000 (1 ms precision).

Since this is ""expected"", lower the log level from warning to debug.",False
200488111e9f54585c67f915265094f7f22e8888,2023-11-16 01:35:38,Romain Vimont,"Add support for RAW audio (WAV) recording

RAW audio forwarding was supported but not for recording.

Add support for recording a raw audio stream to a `.wav` file (and
`.mkv`).",False
1713422c13265946a15b25e9de5762727a33edfb,2023-11-15 16:32:57,Romain Vimont,"Upgrade FFmpeg build to 6.1-scrcpy-2

Use a build with WAV muxer.",False
4b4f045e196fe037a841f7004eaabb09cf571942,2023-11-15 16:32:57,Romain Vimont,"Fix audio PTS by the duration of 1 sample

If the difference of PTS between two consecutive blocks of audio is less
than 1 sample, then it will be considered as non-increasing by FFmpeg
muxers having a time_base of 1/sample_rate.

Increase the PTS by 1 sample instead.",False
a402eac7f293b1f63ce1c0a9449cf3a997dc061e,2023-11-15 16:32:57,Romain Vimont,"Compute PTS of intermediate blocks

If several reads are performed for a single captured audio block (e.g.
if the read size is smaller than the captured block), then the provided
timestamp was the same for all packets.

Recompute the timestamp for each of them.",False
3bb6b0cb9f4a67046bd96b53bef46e34818ae0f3,2023-11-15 16:32:57,Romain Vimont,"Read audio by blocks of 1024 samples

In practice, the system captures audio samples by blocks of 1024
samples.

Remplace the hardcoded value of 5 milliseconds (240 samples), and let
AudioRecord fill the input buffer provided by MediaCodec (or by
AudioRawRecorder), with a maximum size of 1024 samples (just in case).",False
258eaaae2af9c1e41611f8f570bd46fe10165859,2023-11-15 16:32:57,Romain Vimont,"Increase default audio buffer for FLAC

FLAC is not low latency: the default encoder produces blocks of 4096
samples, which represent ~85.333ms.

Increase the audio buffer by default so that audio playback works.",False
4857c5dd5964eccd2c8f772ae570332d12f4f825,2023-11-15 16:32:57,megapro17,"Add support for FLAC audio codec

PR #4410 <#https://github.com/Genymobile/scrcpy/pull/4410>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f23be823fded5090792deccdb2b892074208e9d3,2023-11-15 16:32:57,Romain Vimont,"Upgrade FFmpeg build to 6.1-scrcpy

Upgrade to FFmpeg 6.1, and with FLAC support enabled.",False
783719c72e6659e20c48fd57171ac957df5a148b,2023-11-15 16:32:57,Romain Vimont,"Fix OPUS packet in an endian-independent way

Reading the header id as an int assumed that the current endianness was
little endian. Read to a byte array to remove this assumption.",False
80defdd8aa29a89bc656df0f2cdc8a1474f95741,2023-11-15 16:31:10,Romain Vimont,"Suppress private APIs lints to Workarounds class

The whole class need them (including the static block).",False
e637feba51c2eac6de27ebb318a2f7a1aa54a62d,2023-11-14 13:38:24,Romain Vimont,"Update muxers documentation

Recording now supports formats other than mp4 and mkv.",False
5e59ed31352251791679e5931d7e5abf0c2d18f6,2023-11-11 16:11:15,Romain Vimont,"Always initialize SDL with the video subsystem

Clipboard synchronization requires SDL_INIT_VIDEO, so always initialize
the video subsystem, even if --no-video or --no-video-playback is
passed.

Refs caf594c90ef1b71ed844b2a9b42c3b3371215d6f
Fixes #4418 <https://github.com/Genymobile/scrcpy/issues/4418>",False
4eb33054cda35043983b57eb37395cbdac8724eb,2023-11-11 15:54:47,Romain Vimont,"Do not log EPIPE on close for raw audio

Handle EPIPE the same way in AudioRawRecorder as in AudioEncoder.

This prevents useless errors on close.",False
420d3a40ddea61be80ef1e7026fa2edb22f66a41,2023-11-11 15:54:47,Romain Vimont,"Fix error handling in raw audio recorder

It is incorret to ever call:

    streamer.writeDisableStream(...);

after:

    streamer.writeAudioHeader();

Move the try-catch block so that it can never happen.",False
9d5f53caa76151e0983700e4ae6ccb3a445e1379,2023-11-11 15:54:47,Romain Vimont,"Stop capture on any RAW audio error

The server was stopped only if an IOException occurred during RAW audio
capture, but it did not catch RuntimeExceptions.",False
3c456253242ed96796f71b2ab3dc66e2bedf6ea3,2023-11-11 15:54:47,Romain Vimont,"Log recording RAW audio codec as error

It is not possible to record with a RAW audio codec, so the log before
exiting should be an error rather than a warning.",False
11d738321f8661a46c5f211ec4285047657177cb,2023-11-06 02:15:15,Romain Vimont,"Recover on invalid camera FPS ranges

Some devices may provide invalid ranges, causing an
IllegalArgumentException ""lower must be less than or equal to upper"".

Catch the exception to list the cameras anyway.

Refs #4403 <https://github.com/Genymobile/scrcpy/issues/4403>",False
ccaa832f48d0454986777d9521e1028ec0d3eb35,2023-11-06 02:14:33,Romain Vimont,"Simplify --list-cameras output

Remove --video-source=camera from the output of --list-cameras (this is
implicit).",False
4e4ddc499fcf571109126fbe3722eb0cc60fe1b0,2023-11-03 23:37:15,Romain Vimont,"Return the FakeContext as application context

This avoids getApplicationContext() to return null and cause
NullPointerException.

Fixes #4392 <https://github.com/Genymobile/scrcpy/issues/4392#issuecomment-1792806080>",False
8d76b3e06dcd4b996ef20779feaf4cd8494a4a5c,2023-11-03 23:37:08,Romain Vimont,"Fill application context for camera

Using the camera fails on some devices without a proper application
context.

Fixes #4392 <https://github.com/Genymobile/scrcpy/issues/4392>",False
85a0b935c9d70a7f082eb3df5f3c9f61ea48009a,2023-11-03 23:35:50,Romain Vimont,"Always assign a system context as base context

FakeContext used ActivityThread.getSystemContext() as base context only
in some cases, because it caused problems on some devices:
 - warnings on Xiaomi devices [1], which are now fixed by
   b8c5853aa6ac9cfbe3fb4e46bf10978b3fa212e3
 - issues related to Looper [2], which are solved by just calling
   Looper.prepare*()

Therefore, we can now always assign a base context, which simplifies and
helps to solve camera issues on some devices (#4392).

[1] <https://github.com/Genymobile/scrcpy/issues/4015#issuecomment-1595382142>
[2] <https://github.com/Genymobile/scrcpy/issues/3805#issuecomment-1596148031>

Fixes #4392 <https://github.com/Genymobile/scrcpy/issues/4392>",False
8c3e2bae7be47a0f17ddec8da25b89e0aea2617e,2023-11-03 23:35:28,Romain Vimont,"Simplify Application instantiation

The constructor is public.",False
446ea818a44eb75f03f21d08d307801b20ca2871,2023-11-01 23:17:58,Romain Vimont,Update links to v2.2,False
c3c7bf7af329c8a5fd9f0310eae3b4e0a5f86207,2023-11-01 23:06:33,Romain Vimont,Bump version to v2.2,False
5000368c2f0c6f2969df57052bc85b98ec012b9c,2023-11-01 23:06:13,Romain Vimont,Merge branch 'master' into release,True
855ae4adb1a55c23aca2ce9cb1a17cd6bf1ef03d,2023-11-01 23:06:10,Romain Vimont,"Upgrade SDL (2.28.4) for Windows

Include the latest version of SDL in Windows releases.",False
a8db3ec9e2ed3540bf33c2d0ad173a37613b5d8c,2023-11-01 23:06:10,Romain Vimont,"Upgrade platform-tools (34.0.5) for Windows

Include the latest version of adb in Windows releases.",False
ff579990c21d73653aa74a3d8f2ad75b90504657,2023-11-01 23:06:10,Romain Vimont,"Shutdown connection before joining threads

Interrupting async processors may require to shutdown the connection to
wake up blocking calls.

Therefore, shutdown the connection first, then join the threads, then
close the connection.

Refs commit 9c08eb79cb7941848882cb908cefee9933450de5",False
b8c5853aa6ac9cfbe3fb4e46bf10978b3fa212e3,2023-11-01 23:06:04,Romain Vimont,"Disable default stdout/stderr

Some devices (mostly Xiaomi) print internal errors using
e.printStackTrace(), flooding the console with irrelevant errors.

Disable system streams used via System.out and System.err streams, to
print only the logs from scrcpy.

Refs #994 <https://github.com/Genymobile/scrcpy/issues/994>
Refs #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
c64d1502024e3adaaf10761bd8d50149a113dcc3,2023-10-31 23:50:59,Romain Vimont,Improve manpage formatting,False
8350a619261d0349a7aea291cb9fe7f6b20078c8,2023-10-31 23:49:34,Romain Vimont,"Simplify URLs in manpage

The .UR-formatted URLs are not always rendered correctly. Use simple
brackets instead.",False
55808034066b51f8e3c96f3a7e054898fb1f590e,2023-10-31 23:49:33,Romain Vimont,"Always print device model and version

Print the log before checking for --list-* options so that it is
printed in all cases.",False
9bfc749803d79a7de5bcc46b3db376a12ef66e31,2023-10-31 20:27:06,Romain Vimont,"Add camera documentation

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
6af4bd601f028d4e3d96eb90326a2330f03bc960,2023-10-31 20:27:06,Andrew Gunnerson,"Add support for high frame rate camera capture

Add --camera-high-speed to enable high frame rate camera capture. If
the option is enabled, then --camera-fps is mandatory.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Andrew Gunnerson <accounts+github@chiller3.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4722bff42316c0ecef1d3ee69d1a327c3405d5b5,2023-10-31 20:27:06,Andrew Gunnerson,"Add --camera-fps

Add a new option for specifying the camera frame rate.

By default, Android's default frame rate (30 fps) is used.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Signed-off-by: Andrew Gunnerson <accounts+github@chiller3.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
928f8b8eb39597141c12d248e74cb6cac672ff07,2023-10-31 20:27:06,Romain Vimont,"Do not arbitrary limit --max-fps to 1000

Limit to the variable type size, for consistency.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
9fc583548535ceb2d517ca522189d9814e9d2c13,2023-10-31 20:27:06,Simon Chan,"Fail-fast camera mirroring on Android 11 and older

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
dd36d6135fb08f8d3a99f9e9eb4ec8e19af0a660,2023-10-31 20:27:06,Romain Vimont,"Support camera size selection using -m/--camera-ar

In addition to --camera-size to specify an explicit size, make it
possible to select the camera size automatically, respecting the maximum
size (already used for display mirroring) and an aspect ratio.

For example, ""scrcpy --video-source=camera"" followed by:
 - (no additional arguments)
    : mirrors at the maximum size, any a-r
 - -m1920
    : only consider valid sizes having both dimensions not above 1920
 - --camera-ar=4:3
    : only consider valid sizes having an aspect ratio of 4:3 (+/- 10%)
 - -m2048 --camera-ar=1.6
    : only consider valid sizes having both dimensions not above 2048
      and an aspect ratio of 1.6 (+/- 10%)

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
faebb7d70ab4076fcbe84f00a1e2d07d871e41d9,2023-10-31 20:27:06,Simon Chan,"Add --camera-facing

Add an option to select the camera by its lens facing (front, back or
external).

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7f8d079c8c5dd28942992361d2f521a554d18416,2023-10-31 20:27:06,Romain Vimont,"Make camera id optional

If no camera id is provided, use the first camera available.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
64930e71b9636544468646e61dac3d7a4a62896c,2023-10-31 20:27:06,Romain Vimont,"Handle camera disconnection

Stop mirroring on camera disconnection.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
d544e577c086efc89443c388466b14ae0f25af59,2023-10-31 20:27:06,Romain Vimont,"Automatically select audio source

If --audio-source is not specified, select the default value
according to the video source:
 - for display mirroring, use device audio by default;
 - for camera mirroring, use microphone by default.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
bfeecc01316cb04b992f56c2b5d0ea9f21a45b7d,2023-10-31 20:27:06,Simon Chan,"Add camera mirroring

Add --video-source=camera, and related options:
 - --camera-id=<id>: select the camera by its id (see --list-cameras);
 - --camera-size=<width>x<height>: select the capture size.

Fixed #241 <https://github.com/Genymobile/scrcpy/issues/241>
PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f032262cd76b27621813f9fe13f4e18981471d4c,2023-10-31 20:27:06,Romain Vimont,"Add --list-camera-sizes

Add an option to list the device camera declared sizes.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
cd63896d63c6a504441397706729648d48e45d96,2023-10-31 20:26:25,Simon Chan,"Add --list-cameras

Add an option to list the device cameras.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f085765e04a22508b237fc83b077c18d23dd26a1,2023-10-31 17:15:40,Romain Vimont,"Factorize --list- options handling

This will limit code duplication as more list options will be added.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
a2fb1b40f690a1e4556a2ac058d7c069513b7402,2023-10-31 17:15:40,Simon Chan,"Extract SurfaceCapture from ScreenEncoder

Extract an interface SurfaceCapture from ScreenEncoder, representing a
video source which can be rendered to a Surface for encoding.

Split ScreenEncoder into:
 - ScreenCapture, implementing SurfaceCapture to capture the device
   screen,
 - SurfaceEncoder, to encode any SurfaceCapture.

This separation prepares the introduction of another SurfaceCapture
implementation to capture the camera instead of the device screen.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
41ccb5883ed3538b3f0a99c583beec16bfc893ce,2023-10-31 17:15:40,Romain Vimont,"Force server exit at the end of main()

By default, the Java process exits when all non-daemon threads are
terminated.

The Android SDK might start some non-daemon threads internally,
preventing the scrcpy server to exit in some cases.

So force the process to exit explicitly.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
23e116064dc97f2af843e764f13eebd54fab486d,2023-10-31 17:15:40,Romain Vimont,"Rename --display to --display-id

The option is named ""display id"" everywhere.

This will be consistent with --camera-id (there will be many camera
options, so an option --camera would be confusing).

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
3432029a3dd9a910f7735b216b41839e3afdcafa,2023-10-31 17:15:31,Romain Vimont,"Make separator configurable for parsing integers

The separator was hardcoded to ':'. This will allow to reuse the
function to parse sizes as WIDTHxHEIGHT.

PR #4213 <https://github.com/Genymobile/scrcpy/pull/4213>",False
7a2b756f1ed2c0ba582f51493043fe148f897e1b,2023-10-31 17:05:04,Romain Vimont,"Fix incorrect comment about AV1 constant

MediaFormat.MIMETYPE_VIDEO_AV1 has been added in API 29, not 21.",False
b7ad652a755fc3b4cfd42de47c71b1d67d8705e9,2023-10-27 02:12:46,Romain Vimont,"Move empty string test for crop option parsing

For consistency with other options.",False
76a99a7fcdb0a03c2e6185486090ad9123a4ce81,2023-10-25 19:43:36,Avinash Sonawane,"Replace raw number by its name

PR #4373 <https://github.com/Genymobile/scrcpy/pull/4373>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
68b55ef2fed371f1be55f8373c14a4328cd026bf,2023-10-25 19:43:34,Avinash Sonawane,"Replace sprintf() with safer snprintf()

PR #4373 <https://github.com/Genymobile/scrcpy/pull/4373>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
bc8913e12bf775c050a655a4d44feab5ab5a0181,2023-10-25 02:42:36,Avinash Sonawane,"Use `char *` for pointer arithmetic

PR #4374 <https://github.com/Genymobile/scrcpy/pull/4374>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3c2013de10bad9e18ac81ff46e954078a1effd2d,2023-10-25 02:36:57,Romain Vimont,"Enable missing-prototypes warning

Warn if a global function is defined without a previous prototype
declaration. It is not enabled by default at warning_level=2.",False
8cef8bac947418435f23635711f463f9ca7e9ea6,2023-10-25 02:36:57,Avinash Sonawane,"Declare local functions as static

PR #4374 <https://github.com/Genymobile/scrcpy/pull/4374>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0bbe8a700708ca6cf2b5112e5d4eed9a8800a8c6,2023-10-25 02:28:33,Avinash Sonawane,"Wrap macros in do-while(0)

To fix the warnings of stray `;`.

PR #4374 <https://github.com/Genymobile/scrcpy/pull/4374>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9fdb882509ad7c7b67f8d8ad68ce702ea7746f28,2023-10-25 02:23:41,Romain Vimont,"Fix --pause-on-exit parsing

The function incorrectly returned `false` instead of a valid (and
expected) enum value.",False
8e7b041f3596e119ee74fcc1a4dece2f1c1e1230,2023-10-24 01:20:40,Romain Vimont,Add missing `void`s for empty parameter list,False
9ade389069a6898196dd8648461f30ea1e27aee1,2023-10-23 19:09:19,Avinash Sonawane,"Make sc_usb_devices_destroy() static

It is only called from the implementation file.

PR #4371 <https://github.com/Genymobile/scrcpy/pull/4371>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
90ba885547e74568a69b7f9cd8e917fc5ce8d0c1,2023-10-23 18:39:26,Avinash Sonawane,"Remove redundant `;`

PR #4371 <https://github.com/Genymobile/scrcpy/pull/4371>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7adf98e9d491fc0cf218c661c3580827e8c89eb9,2023-10-23 18:37:24,Avinash Sonawane,"Use `void` for empty function parameter list

PR #4371 <https://github.com/Genymobile/scrcpy/pull/4371>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
90ca46ee415514513da9dff8c558d726c8e34318,2023-10-21 12:31:50,AmirSina Mashayekh,"Add scrcpy-server to .gitignore

The script install_release.sh downloads a file named scrcpy-server to
the repo root directory. Add it to .gitignore so that it is ignored.

PR #4364 <https://github.com/Genymobile/scrcpy/pull/4364>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1c864a88ebf113553c00928e7a7e5de94889a6e2,2023-10-11 13:13:44,Romain Vimont,"Use --pause-on-exit from launchers

The terminal opened by scrcpy-console (.bat or .desktop) must not close
if scrcpy terminates with an error, so that error messages can be read.

Refs #3817 <https://github.com/Genymobile/scrcpy/pull/3817>
Refs #3822 <https://github.com/Genymobile/scrcpy/pull/3822>
PR #4130 <https://github.com/Genymobile/scrcpy/pull/4130>",False
1650b7c0581df65e9ab5df92f2d81cca4c150ac7,2023-10-11 13:13:44,Romain Vimont,"Add --pause-on-exit

Add an option to make scrcpy pause on exit.

Three behaviors are possible:
 - always pause on exit:
    --pause-on-exit
    --pause-on-exit=true
 - never pause on exit:
    (no option)
    --pause-on-exit=false
 - pause when scrcpy returns with an error (a non-zero exit code):
    --pause-on-exit=if-error

This is useful to prevent the terminal window from automatically
closing, so that error messages can be read.

Refs #3817 <https://github.com/Genymobile/scrcpy/pull/3817>
Refs #3822 <https://github.com/Genymobile/scrcpy/pull/3822>
PR #4130 <https://github.com/Genymobile/scrcpy/pull/4130>",False
a7c3c9a54c928124e00fe127833b655bf3ea40c6,2023-08-22 23:40:06,Romain Vimont,"Make fillBaseContext() method private

This is consistent with fillAppInfo() and fillAppContext(), which are
also private.",False
111d02fca46c4cff50adbbafa946eb8d451f004a,2023-08-22 22:22:29,Romain Vimont,"Add missing 'final' in Java classes

For consistency.",False
36670dda40c405f7fbcf622a4553651284f8aa96,2023-08-07 23:52:17,Romain Vimont,"Fix warning typo

A parenthesis was missing.",False
0983f0a194db154823842a4728f3c2bb5a3b1cc3,2023-08-01 15:35:16,Romain Vimont,"Report device disconnection on audio EOS

If --no-video was set, then device disconnection was not reported. To
avoid the problem, report device disconnection also on audio
end-of-stream (EOS).

If both video and audio are enabled, then a device disconnection event
will be sent twice, but only the first one will be handled (since it
makes scrcpy exit).

Fixes #4207 <https://github.com/Genymobile/scrcpy/issues/4207>",False
110b3a16f6d02124a4567d2ab79fcb74d78f949f,2023-07-28 18:15:33,Romain Vimont,"Do not disable controls without video playback

Some control messages can still be used even when video playback is
disabled (i.e. there is no window), for example to turn the screen off.

This reverts commit 92483fe11b6fd6bae5ef775ccaff78fefa92aad4
(semantically).

Fixes #4175 <https://github.com/Genymobile/scrcpy/issues/4175>",False
1ee46970e373ea3c34c3d9b632fef34982d7a52b,2023-07-26 23:28:13,Aritz T,"Fix TCP/IP link in README

Refs 328ed3650dd8abbdb138f629b4e5aa622f172cae
PR #4173 <https://github.com/Genymobile/scrcpy/pull/4173>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fcdf847dd39daf61b936ec7fe7d34f41705ce0ae,2023-07-15 03:07:19,Romain Vimont,Add missing syntax highlighting in audio doc,False
ad05a018003a66b0a5f8afefb0d2f16a392d3077,2023-07-15 03:06:21,Romain Vimont,"Add Encoder section

This will allow to reference the encoder section directly in issues.",False
328ed3650dd8abbdb138f629b4e5aa622f172cae,2023-07-15 03:01:26,Romain Vimont,"Extract device connection to a separate doc page

Create a new ""Connection"" documentation page.",False
c14668b17779d9fe8f3e209bbe18669c443ddf8b,2023-07-15 02:56:52,Romain Vimont,Move display section to video documentation,False
637f48f360d0dce1b0927a9df24236ad48ab2130,2023-07-15 02:39:44,Romain Vimont,Update links to v2.1.1,False
d391fc3b695679f4770ed2e3950b135ebbda2f27,2023-07-14 22:28:58,Romain Vimont,Bump version to 2.1.1,False
75ad925423a2d65b8d616989cdf5c3e5a0f942e8,2023-07-14 22:28:34,Romain Vimont,Merge branch 'master' into release,True
7e936fa879d9ee37608d9d0ce36f66ea06a6317d,2023-07-14 01:16:50,Romain Vimont,"Fix meizu deadlock

Some devices (Meizu) assume that the video encoding thread has a
Looper. By moving video encoding to a separate thread, commit
feab87053abcceded41342d9d856763dedc09187 broke this assumption.

Call Looper.prepare() from this thread to fix the problem.

Fixes #4143 <https://github.com/Genymobile/scrcpy/issues/4143>",False
01d785d9a3407dc0389abee688f1a58a5e4f8923,2023-07-07 21:51:17,Romain Vimont,"Increase attempts to start AudioRecord

Making the shell app foreground (specific for Android 11) may take more
than 300ms on some devices, so increase the number of attempts from 3 to
5 (separated by 100ms).

Fixes #4147 <https://github.com/Genymobile/scrcpy/issues/4147>
Refs #3796 <https://github.com/Genymobile/scrcpy/issues/3796>
Refs 02f4ff7534649153d6f87b05a0757431a2d0ee5f",False
fe6e9acb36298a19f2e667ace724b249a04a7f30,2023-07-04 21:52:33,Romain Vimont,"Log device selection at INFO level

The selected device should be logged by default.",False
625934fb1b078a5d66bc4864e8082840d57d4557,2023-07-01 00:51:13,Cédric Skwar,"Fix fedora package in build instructions

In Fedora, the package is libusb1-devel.

Fixes #4131 <https://github.com/Genymobile/scrcpy/issues/4131>
PR #4132 <https://github.com/Genymobile/scrcpy/pull/4132>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
85b55b3c4e3b05c155225e035c4a9544f8864268,2023-06-29 22:48:32,Romain Vimont,"Fix possible division by zero

On sway (a window manager), SDL_WINDOWEVENT_EXPOSED and
SDL_WINDOWEVENT_SIZE_CHANGED might not be called before a mouse event is
triggered. As a consequence, the ""content rectangle"" might not be
initialized when the mouse event is processed, causing a division by
zero.

To avoid the problem, initialize the content rect immediately when the
window is shown.

Fixes #4115 <https://github.com/Genymobile/scrcpy/issues/4115>",False
7b7076ef85684707e314b9ca0ef5066a7c9f8727,2023-06-28 14:28:00,Romain Vimont,Add direct links to donations,False
808bd14e301351ce63b4fc45ac54d3bf34423e94,2023-06-27 22:13:22,Romain Vimont,"Ignore fold change events for other display ids

Scrcpy mirrors a specific display id, it must ignore events for other
display ids.

Fixes #4120 <https://github.com/Genymobile/scrcpy/issues/4120>",False
0049b3ce078d4abaad3cc94a462502951dabc243,2023-06-23 11:53:29,Romain Vimont,"Remove superfluous log

This line was committed by error in commit
a52053421abee7c96b1071a06cb68bbeac2fd464.",False
5764f47fee0f54f0b7e9270576588a67e7b7955f,2023-06-22 04:48:17,Romain Vimont,Update links to v2.1,False
2dab1f7024dd7edbd3b630a1a435c14b98f368c1,2023-06-22 04:45:44,Romain Vimont,Bump version to 2.1,False
744312ec64d2552271fd2918abce2e14b6137843,2023-06-22 04:45:39,Romain Vimont,Merge branch 'master' into release,True
b9315620e2dfae363ba4ddb88d14badc88bd5dee,2023-06-22 04:43:53,Romain Vimont,"Fix adb forward initialization

In forward mode, the dummy byte must be written immediately after the
first accept(), otherwise the client will wait indefinitely, causing a
deadlock (or a timeout).

Regression introduced by 8c650e53cd37a53d5c3aa746c30a71c6b742a4e2.",False
ea59d525bd6910583fdbf901182ff0e102223c62,2023-06-22 04:37:09,Romain Vimont,"Fix code style

The code should fit in 80 columns.",False
0ffcfa0f5c444e2ebc919bfcd44a090c8511f02a,2023-06-22 04:22:54,Romain Vimont,"Accept failure in rotation or fold registration

Do not make scrcpy fail if rotation or display fold listeners could not
be registered.",False
c0f3c080b63eb70c0941c300e461fc2ea1246cec,2023-06-22 04:19:11,Romain Vimont,"Register DisplayFoldListener only for Android 10+

This listener does not exist on Android < 10, and it makes scrcpy fail.",False
d046678f85c0730570e807a2d25267280beab086,2023-06-22 03:40:37,Romain Vimont,"Upgrade platform-tools (34.0.3) for Windows

Include the latest version of adb in Windows releases.",False
fae3fbc934b6b58f877439a1bffa6aaf9793f46a,2023-06-22 03:33:26,Romain Vimont,Update developer documentation,False
5061b7e02c3aa932f245adc98686bee57d6abfaf,2023-06-22 03:33:26,Romain Vimont,"Fix build without gradle

Add missing class generation from IDisplayFoldListener.aidl.

Refs 24999d0d32daf50246168dde212f01cf109569f9",False
09009c2aa71e1f748abd32b74c0f2014ad606f4e,2023-06-21 01:15:14,Romain Vimont,"Upgrade SDL (2.28.0) for Windows

Include the latest version of SDL in Windows releases.

Fixes #3825 <https://github.com/Genymobile/scrcpy/issues/3825>
Refs libsdl/#7478 <https://github.com/libsdl-org/SDL/issues/7478>",False
fb21bbf763691407bc069d84b8e6248667a80e6f,2023-06-19 22:15:40,Romain Vimont,"Add workarounds for Honor devices

Audio did not work on Honor devices.

To make it work, a system context must be set as a base context of
FakeContext (so that a PackageManager is available), and a current
Application and ActivityThread must be set.

These workarounds must not be applied for all devices, because they
might cause other issues.

Fixes #4015 <https://github.com/Genymobile/scrcpy/issues/4015>
Refs #3085 <https://github.com/Genymobile/scrcpy/issues/3805>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
0f1afff7a62e3fcc51a93025ed61a09408147413,2023-06-19 22:15:11,Romain Vimont,"Move workarounds execution

Expose a single public static method in the Workarounds class to apply
all necessary workarounds.",False
48a00fb481cec1d60cb41c1d7a6aa9eebf87878e,2023-06-17 03:55:01,Romain Vimont,"Log device BRAND

The BRAND value is not always the same as the MANUFACTURER value.",False
3b7e2ca9c8c648b3dadbeec25cdb087772cc6c99,2023-06-17 02:54:08,Romain Vimont,"Fix lint warning

Suppress lint ""DiscouragedPrivateApi"" in Workarounds.java.",False
5bd75148716496755dc32daab21a322f51dc58ca,2023-06-13 18:49:24,wuderek,"Add InputManagerGlobal for Android 14 beta 3

Parts of the InputManager class have been moved to a new
InputManagerGlobal class in Android 14 preview.

Fixes #4074 <https://github.com/Genymobile/scrcpy/issues/4074>
PR #4075 <https://github.com/Genymobile/scrcpy/pull/4075>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d3c2955fb9e46949694ce91cbe6cc15ca068207b,2023-06-10 19:34:51,Romain Vimont,"Add --time-limit

Add an option to stop scrcpy automatically after a given delay.

PR #4052 <https://github.com/Genymobile/scrcpy/pull/4052>
Fixes #3752 <https://github.com/Genymobile/scrcpy/issues/3752>",False
5042f8de933faecbeea270fc78713c294d93ec06,2023-06-10 19:33:27,Romain Vimont,Improve recording documentation,False
7536f95d1c1a8b48f12a7a4556d571b9a2f72667,2023-06-10 15:39:43,Romain Vimont,"Rename raw_video_stream to raw_stream

This server-specific option impacts both the video and audio streams.",False
6832e8d629305b8ad90b125258ebf612aae88af0,2023-06-10 15:37:35,Romain Vimont,Remove spurious empty line,False
28313631e549444795d9282574c1526c5d4008ce,2023-06-10 01:58:01,Romain Vimont,"Reformat Java code

Fix code style.",False
fdbc9397a7cb93eeac29481effb71eacbb74d24b,2023-06-10 01:57:35,Romain Vimont,"Name Java threads

Give a user-friendly name to Java threads created by the server.",False
4ad74794255b7669a89c023afc7ae7a2c0da4dc3,2023-06-08 12:22:21,Romain Vimont,"Add missing shortcut in documentation

MOD+Backspace also triggers BACK.",False
a3cdf1a6b86ea22786e1f7d09b9c202feabc6949,2023-06-05 23:18:21,Romain Vimont,"Add option to kill adb on close

Killing adb on close by default would be incorrect, since it would break
any other usage of adb in parallel.

It could be easily done manually by calling ""adb kill-server"" once
scrcpy terminates, but add an option --kill-adb-on-close for
convenience.

Fixes #205 <https://github.com/Genymobile/scrcpy/issues/205>
Fixes #2580 <https://github.com/Genymobile/scrcpy/issues/2580>
Fixes #4049 <https://github.com/Genymobile/scrcpy/issues/4049>",False
b16d4d18359cced40c4218a353c16b0093ee0608,2023-06-05 23:15:20,Romain Vimont,"Fix adb server vs adb daemon confusion

The adb daemon runs on the device, the adb server runs as a background
process on the computer.",False
b8d43866d24495c543edc63d48d180975713e93c,2023-06-05 23:14:15,Romain Vimont,"Fix options alphabetical order

Commit fc52b2450333beb94c0dc2f94d01d4de13afeec5 missed this one.",False
2d79aeb117a4532761ffd26c4093f6cbf4a8d337,2023-06-04 22:13:35,Romain Vimont,"Simplify command in documentation

If --no-video is passed, --no-playback is equivalent to
--no-audio-playback.",False
888a5aae7d90e6aba969baabb4c951b4ab9f4a7f,2023-06-04 22:10:55,Romain Vimont,"Fix typo in recording documentation

The option is --record, not --record-file.",False
323ea2f1d947f6e8917b66db797380a739cd261d,2023-06-03 22:20:28,Romain Vimont,"Fix PTS when not monotonically increasing

Some decoders fail to guarantee that PTS is strictly monotonically
increasing. Fix the (rescaled) PTS when it does not respect this
constraint.

Fixes #4054 <https://github.com/Genymobile/scrcpy/issues/4054>",False
9ca554ca417b3f92f8dc1603ed2100706f9ba578,2023-06-03 22:18:01,Romain Vimont,"Extract stream-specific structure in recorder

For now, it only contains the stream index, but more fields will be
added.",False
9d3c656414ac096ae30e42c22671c72a6bd491af,2023-06-03 22:16:39,Romain Vimont,"Fix recorder waiting when stream disabled

In the recorder, if the video or audio stream is disabled, do not wait
for its initialization (it will never happen) to process the header.

In that case (scrcpy --no-audio --record=file.mp4), this caused the
whole content to be buffered in memory, and written only on exit.",False
379caf8551cdf1f2603decd9b44a8771c3b78475,2023-06-03 18:40:42,Romain Vimont,"Use a single condvar in recorder

The sc_cond_wait() in sc_recorder_process_header() needs to be notified
of changes to video_init/audio_init (protected by stream_cond) and
video_queue/audio_queue (protected by queue_cond).

Use only one condition variable to simplify.",False
2aec7b4c9d8637f16790a435e14ee020e49b5636,2023-06-02 12:30:33,Romain Vimont,"Mention how to interrupt scrcpy without video

There is no window to close if video playback is disabled.",False
fc52b2450333beb94c0dc2f94d01d4de13afeec5,2023-06-01 16:22:48,Romain Vimont,"Reorder options in alphabetical order

Fix the options order, using the short option as key first (if any) in
all cases for consistency.",False
ff5ffc892fa50993e7b5f9ea9d9790c7e4f29693,2023-06-01 12:51:09,Romain Vimont,"Add option to select audio source

Pass --audio-source=mic to capture the microphone instead of the device
audio output.",False
360f2fea1e66a34fb4a6739887d2efc926dee856,2023-06-01 12:51:09,Romain Vimont,"Extract AudioCapture creation

This will allow to pass capture options without code duplication.",False
24999d0d32daf50246168dde212f01cf109569f9,2023-06-01 12:50:00,Adonis Najimi,"Reset video capture on folding event

Handle folding event the same way as rotation events.

Fixes #3960 <https://github.com/Genymobile/scrcpy/issues/3960>
PR #3979 <https://github.com/Genymobile/scrcpy/pull/3979>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8e2c0d64079672d802b52c03862492671a0351d6,2023-06-01 12:50:00,Romain Vimont,"Rename rotationChanged to resetCapture

The flag is used to reset the capture (restart the encoding) on rotation
change. It will also be used for other events (on folding change), so
rename it.

PR #3979 <https://github.com/Genymobile/scrcpy/pull/3979>",False
9a2abba09827b162f0dc5e2d48badde897c3f7dc,2023-06-01 12:34:00,Romain Vimont,"Update demuxer comment

The comment was outdated:
 - the ""meta"" header is now always present (not only when recording is
   enabled);
 - it is not only used for the video stream, but also for the audio
   stream.",False
b2d860382fd6ccefe85c45343da622ffbed8b3fa,2023-05-31 13:39:56,shuax,"Fix stream offset on audio buffer underflow

The `read` variable is in number of samples, while the offset must be in
bytes.

PR #4045 <https://github.com/Genymobile/scrcpy/pull/4045>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4c4a03ebe16749aec8a83d27cd28e3d686de171c,2023-05-31 01:06:48,Romain Vimont,Reorder options to maintain alphabetical order,False
798dfd240e53e964094c656f4e365f0cef33b943,2023-05-27 13:41:42,Yan,"Turn device screen off after set up

Sometimes it can take quite a while for everything to get set up and
the screen to appear.

PR #3902 <https://github.com/Genymobile/scrcpy/pull/3902>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c4caa6b81d86cb82fa648612b1b4e4a405d8cab0,2023-05-27 13:38:10,Romain Vimont,"Document --no-{video,audio}-playback

PR #4033 <https://github.com/Genymobile/scrcpy/pull/4033>",False
1efbfe1175b023880b99f55df054f53ba3b30aa7,2023-05-27 13:38:10,Romain Vimont,"Add separate video and audio playback options

Add --no-video-playback and --no-audio-playback. The option
--no-playback is now an alias for both.

PR #4033 <https://github.com/Genymobile/scrcpy/pull/4033>",False
751c09f47a025f0affbd44db2e9a1f343d827cb5,2023-05-27 13:25:49,Romain Vimont,"Simplify V4L2/USB ifdefs

Define local variables whose value depends on ifdefs, to avoid
cluttering all conditions with ifdefs.",False
6ad46d70b8190a8f409cdd62870f51a6e24baa50,2023-05-27 13:25:49,Romain Vimont,"Define v4l2_buffer only if HAVE_V4L2

If V4L2 support is disabled, there is no v4l2 buffer option.",False
f46758d1c5ccef668435d712958a6c5acfb1c44c,2023-05-27 13:25:49,Romain Vimont,"Fix V4L2 error message when disabled

For consistency, use the same error message for --v4l2-sink and
--v4l2-buffer.",False
e71f5358b3ebf44569b1f3798c13ed65554b69b9,2023-05-27 13:25:49,Romain Vimont,"Reorder command line options checks

Perform checks that impact the options first.",False
a2c89100065f684dcf8859be4ea5274a7e6d5b26,2023-05-27 13:25:38,Romain Vimont,"Rename --no-mirror to --no-playback

This option impacts video and audio _playback_. For example, if we use
V4L2, the device is still ""mirrored"" (via V4L2), even if playback is
disabled. Therefore, ""playback"" is more approriate than ""mirror"".

The initial option --no-display option was renamed to --no-mirror by
commit 6928acdeac29eee404a7c7014654965ef5128b88, but this has never been
released, so it is ok to rename it one more time.

Refs #3978 <https://github.com/Genymobile/scrcpy/pull/3978#issuecomment-1549420103>
PR #4033 <https://github.com/Genymobile/scrcpy/pull/4033>",False
cab354102d722c27660e83817ecff6fd3cb9cfc7,2023-05-26 22:26:43,Simon Chan,"Create AudioRecord by reflection as a fallback

Some devices (Vivo phones) fail to create an AudioRecord from an
AudioRecord.Builder (which throws a NullPointerException).

In that case, create an AudioRecord instance directly by reflection.

The AOSP version of AudioRecord constructor code can be found at:
 - Android 11 (R):
   <https://cs.android.com/android/platform/superproject/+/android-11.0.0_r1:frameworks/base/media/java/android/media/AudioRecord.java;l=335;drc=64ed2ec38a511bbbd048985fe413268335e072f8>
 - Android 12 (S):
   <https://cs.android.com/android/platform/superproject/+/android-12.0.0_r1:frameworks/base/media/java/android/media/AudioRecord.java;l=388;drc=2eebf929650e0d320a21f0d13677a27d7ab278e9>
 - Android 13 (T, functionally identical to Android 12):
   <https://cs.android.com/android/platform/superproject/+/android-13.0.0_r1:frameworks/base/media/java/android/media/AudioRecord.java;l=382;drc=ed242da52f975a1dd18671afb346b18853d729f2>
 - Android 14 (U): Not released, but expected to change

PR #3862 <https://github.com/Genymobile/scrcpy/pull/3862>
Fixes #3805 <https://github.com/Genymobile/scrcpy/issues/3805>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
597d2ccc01b6fe32fe21d315182eac4a523e014d,2023-05-25 01:43:09,Romain Vimont,"Rename FORMAT to ENCODING

The AudioFormat contains several properties. This specific value is
named ""encoding"".",False
38900d77307d24690168ad05e4f95fe238d9e83a,2023-05-25 01:43:09,Romain Vimont,"Extract audio source to a static constant

For consistency with the other parameters.",False
e926bf1fe8546dc3df129d1ecab555539af5c19e,2023-05-22 21:52:45,Romain Vimont,"Delay window resize when minimized

On some window managers (e.g. on Windows), performing a resize while the
window is minimized does nothing (the restored window keeps its old
size).

Therefore, like for maximized and fullscreen states, wait for the window
to be restored to apply a resize.

Refs #3947 <https://github.com/Genymobile/scrcpy/issues/3947>",False
6298ef095ffa9a2cdd2b4d245e71280743b5a59e,2023-05-22 21:51:10,Romain Vimont,"Accept texture failures

When the scrcpy window is minimized on Windows with D3D9, texture
creation and update fail.

In that case, do not terminate scrcpy. Instead, store the pending size
or frame to update, to attempt again during the next update or
rendering.

Fixes #3947 <https://github.com/Genymobile/scrcpy/issues/3947>",False
958f22490b3ab86677bd8b6126ddaa4de4082798,2023-05-17 23:06:39,Marek Madejski,"Document installation via winget on Windows

PR #4005 <https://github.com/Genymobile/scrcpy/pull/4005>
Refs #1444 <https://github.com/Genymobile/scrcpy/issues/1444>
Refs #3932 <https://github.com/Genymobile/scrcpy/issues/3932>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7d33798b40bf9c371d417c4911d67141d62365ec,2023-05-16 01:25:22,Romain Vimont,"Upgrade FFmpeg build to 6.0-scrcpy-4

Use FFmpeg DLLs which do not depend on zlib1.dll.",False
d50055021284bf0da49a5ff7810b48fe0f7c492d,2023-05-15 17:58:55,Romain Vimont,"Update audio recording documentation

Document how to record audio-only to .opus and .aac files.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
a166eee909a66385dc5b00169f4f61b490e163dd,2023-05-15 17:58:53,Romain Vimont,"Upgrade FFmpeg build to 6.0-scrcpy-3

Use a build which includes the opus muxer, to support recording to .opus
files.

Refs <https://github.com/rom1v/scrcpy-deps/commits/6.0-scrcpy-3>
PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
b11b363e8ec1666927ca4931e24520daa8ef7ef3,2023-05-08 20:41:34,Romain Vimont,"Add recording to aac file

It is just an alias for mp4.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
7321db6f28914df81e654cc4e2fbb3deec15fe2c,2023-05-08 20:41:34,Romain Vimont,"Add recording to opus file

Use the FFmpeg opus muxer to record an opus file.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
d6bcde565f8155b6a51ce4682ada367fe62d5a18,2023-05-08 20:41:34,Romain Vimont,"Accept .m4a and .mka

These are just aliases for mp4 and mkv when there is no video stream.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
98f4f4e68a21dd072d83b1e474d71e6f28d9eb91,2023-05-08 20:41:34,Romain Vimont,"Refactor command line checks

Several checks are performed when opts->record_filename is not NULL.
Group them in a single block.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
be86e14e051a40c62837f690282f2214f467778f,2023-05-08 20:41:34,Romain Vimont,"Factorize record format parsing

Convert either the filename extension or the explicit record format
to a sc_record_format using the same function.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
8c650e53cd37a53d5c3aa746c30a71c6b742a4e2,2023-05-08 20:41:34,Romain Vimont,"Add --no-video

Similar to --no-audio, add --no-video to play audio only.

Fixes #3842 <https://github.com/Genymobile/scrcpy/issues/3842>
PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
e89e772c7c3df65e33362a542cd900f46cf62baf,2023-05-08 20:11:12,Romain Vimont,"Remove unnecessary 'else'

Some server parameters may depend on one another. For example,
audio_bit_rate is meaningless if audio is false.

But it is inconsistent to disable some parameters based on these
dependencies checks, but not others. Handling all dependencies between
parameters would add too much complexity for no benefit.

So just pass individual parameters independently.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
feab87053abcceded41342d9d856763dedc09187,2023-05-08 20:11:09,Romain Vimont,"Convert screen encoder to async processor

Contrary to the other tasks (controller and audio capture/encoding), the
screen encoder was executed synchronously. As a consequence,
scrcpy-server could not terminate until the screen encoder returned.

Convert it to an async processor. This allows to terminate on controller
error, and this paves the way to disable video mirroring.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
751a3653a0ab36b98d29da689f26d315c8426701,2023-05-08 20:11:06,Romain Vimont,"Add missing @Override annotations

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
9c08eb79cb7941848882cb908cefee9933450de5,2023-05-08 20:11:04,Romain Vimont,"Close connection at the end of finally-block

The async processors use the socket file descriptors from the
connection. Therefore, the connection must not be closed before all
async processor threads are joined.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
92483fe11b6fd6bae5ef775ccaff78fefa92aad4,2023-05-08 20:11:01,Romain Vimont,"Disable controls on --no-mirror

If mirroring is disabled, control must also be disabled.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
6928acdeac29eee404a7c7014654965ef5128b88,2023-05-08 20:10:58,Romain Vimont,"Rename --no-display to --no-mirror

The option impacts both video and audio playback, so ""no display"" is not
an appropriate name.

PR #3978 <https://github.com/Genymobile/scrcpy/pull/3978>",False
cb20bcb16f4ca191e237c8744a7c2e6d29701d60,2023-04-26 23:03:28,parknich081,"Clarify API versions that support Audio Forwarding

Reword the supported API versions for audio forwarding sentence to
clarify that it supports API >= 30

PR #3949 <https://github.com/Genymobile/scrcpy/pull/3949>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0f3af2d20b201a07ad999699e07e59cf8066e32f,2023-04-23 15:56:46,Romain Vimont,"Fix build for FFmpeg < 3.3

The constant AV_CODEC_ID_AV1 was introduced in FFmpeg 3.3. Add an ifdef
to support older versions.

Fixes #3939 <https://github.com/Genymobile/scrcpy/issues/3939>",False
c083a7cc9015b52e12b0fb78e5a488ab1f5b68f6,2023-04-13 00:56:24,Yan,"Force OpenGL Core Profile context on macOS

By default, SDL creates an OpenGL 2.1 context on macOS for an OpenGL
renderer. As a consequence, mipmapping is not supported.

Force to use a core profile context, to get a higher version.

Before:

    INFO: Renderer: opengl
    INFO: OpenGL version: 2.1 NVIDIA-14.0.32 355.11.11.10.10.143
    WARN: Trilinear filtering disabled (OpenGL 3.0+ or ES 2.0+ required)

After:

    INFO: Renderer: opengl
    DEBUG: Creating OpenGL Core Profile context
    INFO: OpenGL version: 4.1 NVIDIA-14.0.32 355.11.11.10.10.143
    INFO: Trilinear filtering enabled

when running with:

    scrcpy --verbosity=debug --render-driver=opengl

Note: Since SDL_CreateRenderer() causes a fallback to OpenGL 2.1, the
profile and version attributes have to be set and the context created
_after_.

PR #3895 <https://github.com/Genymobile/scrcpy/pull/3895>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9eb6591913bed3601df156a38bc6491f0360c8ce,2023-04-10 23:00:04,Romain Vimont,Add missing --no-audio option in manpage,False
9cfea347d0c4f460d2f06bb14f59363024f41c0a,2023-04-09 23:32:39,Romain Vimont,"Remove Options setters

Now that options parsing is performed from the Options class, setters
are not necessary anymore.",False
ce064fb5e00f6999d9fe9f66e932d6dee71dfe7d,2023-04-09 23:32:39,Romain Vimont,Move options parsing to Options class,False
afcdfc7fd7440782a9924cd8ccb8a40933b4ba90,2023-04-09 23:31:58,Romain Vimont,"Fix checkstyle violation

Checkstyle reported this error:

    [ant:checkstyle] [ERROR] AudioCapture.java:89:145: '+' should be on
    a new line. [OperatorWrap]",False
051b74c88338702508d98bd532057b343e0a177c,2023-04-06 23:18:26,Romain Vimont,"Extract sc_display from sc_screen

Move the display code to a separate component.",False
2e532afd2baf63096a156251220044409be42802,2023-04-06 23:18:01,Romain Vimont,"Pass const pointers to events

SDL_Events are only read.",False
fdf465851c786f153255d044c621c1ac4766e5fd,2023-04-04 22:07:30,Simon Chan,"Add Android version check in raw audio recorder

Do not attempt to capture audio below Android 11, this may cause a
segfault on the device.

PR #3889 <https://github.com/Genymobile/scrcpy/pull/3889>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
669e9a8d1ecf3bc94195c6d57c0fec59c51a8367,2023-04-02 23:00:23,Romain Vimont,"Fix ""ip route"" parsing

If a line did not end with '\r', then the final `\n' was replaced by
'\0' for parsing the current line. This `\0` was then mistakenly
considered as the end of the whole ""ip route"" output, so the remaining
lines were not parsed, causing ""scrcpy --tcpip"" to fail in some cases.

To fix the issue, read the final character of the current line before it
is (possibly) overwritten by '\0'.",False
f77e1c474edfafcd46f692452413f35a18c70949,2023-04-01 15:22:37,Romain Vimont,"Fix copy-paste for some devices

On Honor Magic 5 Pro, the method to get the clipboard content has been
modified in the framework.

Adapt the call to make it work also on this device.

Fixes #3885 <https://github.com/Genymobile/scrcpy/issues/3885>",False
8f0b38cc4f503ea16dd57c705ae0ede81efc8630,2023-03-31 11:25:13,Romain Vimont,Specify in README that OTG does not require adb,False
2f9396e24a5beb76f8754bca37a858aa95536abc,2023-03-31 00:28:33,Romain Vimont,"Simplify clock estimation

The slope encodes the drift between the device clock and the computer
clock. Its real value is expected very close to 1.

To estimate it, just assume it is exactly 1.

Since the clock is used to estimate very close points in the future, the
error caused by clock drift is totally negligible, and in practice it is
way lower than the slope estimation error.

Therefore, only estimate the offset.",False
a1e8a340016875cfea4b42b326026889d684f221,2023-03-28 12:02:07,Romain Vimont,Fix documentation link in FAQ,False
00534b0b2d06a2b31a94e2bbbfe35961a9b8879a,2023-03-28 12:01:01,Romain Vimont,Fix typo in FAQ,False
0ebb3df69cb5e7c977c12a7be31abde5511e4d13,2023-03-27 18:58:59,Yan,"Fix debug build by adding compat.c to tests

Linking of tests that needed something from compat.c failed.

PR #3865 <https://github.com/Genymobile/scrcpy/pull/3865>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
21df2c240e544b1c1eba7775e1474c1c772be04b,2023-03-23 23:36:44,Romain Vimont,"Mention necessary reboot

After setting ""USB debugging (security settings)"", a reboot is
necessary.",False
2d3059e1ab687a18123636784f1e98ac653d3469,2023-03-21 00:12:23,Romain Vimont,"Reference FAQ from HID/OTG documentation

Reference the FAQ section about ""HID/OTG issues on Windows"" from the
HID/OTG documentation.",False
2fff9b9edf749dd7a8ccf36fe2df3c3587f535ab,2023-03-20 13:10:34,Romain Vimont,"Adapt FakeContext for Android 14

This fixes audio for Android 14 developer preview 2.

Fixes #3784 <https://github.com/Genymobile/scrcpy/issues/3784>

Suggested-by: Namelesswonder <Namelesswonder@users.noreply.github.com>",False
57f879d68a72c0d84f17d71ddf49c3b564bc614c,2023-03-20 13:10:25,Romain Vimont,"Adapt clipboard wrappers to Android 14

A new deviceId parameter has been added.

Fixes #3784 <https://github.com/Genymobile/scrcpy/issues/3784>",False
478aece68f2b24def8f9be198a733a106b25616f,2023-03-20 13:05:13,Romain Vimont,"Replace ""bit-rate"" with ""bit rate""",False
55899c091e0b4940516cd811a248bad1a9c8cff4,2023-03-20 13:02:58,NextDev65,"Fix typo in doc/audio.md

The documentation is about audio bit rate, not video bit rate.

PR #3839 <https://github.com/Genymobile/scrcpy/pull/3839>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3626d90004c9946320152564a375e56f9c5030f4,2023-03-18 02:00:04,Romain Vimont,"Use separate audio capture code for Android 11

The code to start audio capture is more complicated for Android 11
(launch a fake popup, wait, make several attempts, close the shell
package).

Use a distinct code path specific to Android 11.",False
02f4ff7534649153d6f87b05a0757431a2d0ee5f,2023-03-18 02:00:04,Romain Vimont,"Make 3 attempts to start AudioRecord

On Android 11, a fake popup must be briefly opened to make the system
think that the shell app is in the foreground so that audio may be
recorded.

Making the shell app foreground may take some time depending on the
device, so make 3 attempts, waiting 100ms before each.

Fixes #3796 <https://github.com/Genymobile/scrcpy/issues/3796>",False
a3871130cc540e1391e6576ae55fd0a5902e4b07,2023-03-18 01:59:45,Romain Vimont,"List available encoders on failure

When the creation of an encoder fails, log an explicit error message
with the list of available encoders.",False
53cb5635cfbe022061e44a39a3f9f6044b0da5e4,2023-03-16 22:51:00,sixg0000d,"Fix pause message

The pause terminates only once the Enter key is pressed, not any key.

PR #3826 <https://github.com/Genymobile/scrcpy/pull/3826>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d7841664f4569b24823df1d153665828a3138e05,2023-03-16 00:23:58,Romain Vimont,"Simplify logic in setScreenPowerMode()

Refs <https://github.com/Genymobile/scrcpy/commit/f2dee20a207b9906574d9b3d62a0ab2585dade20#r104417398>

Suggested-by: brunoais <brunoaiss@gmail.com>",False
d9a644df9c060ae844cee0bf451af608e5284c66,2023-03-15 15:16:36,Romain Vimont,"Clarify V4L2 feature in README

The previous formulation could suggest that the device camera could be
used as a webcam. This is not the case (yet?).",False
45717733a10b8e73ae70b25722b2ddf5922c1c07,2023-03-15 05:11:07,Romain Vimont,"Document missing Opus encoder error

And how to solve it.",False
39544f34b4d63a6cdb91802a9c6136b3d6a6003a,2023-03-15 04:24:07,Romain Vimont,"Add --audio-output-buffer

On some systems, the SDL audio callback is not called frequently enough
(for example it requests 5ms of samples every 10ms), because the output
buffer is too small.

By default, we want to use a small value (5ms) to minimize latency and
buffer underrun, but if it does not work well, users need a way to
increase it.

Refs #3793 <https://github.com/Genymobile/scrcpy/issues/3793>",False
4755b97908bdf8e7d5b9ac1f3557da7ae083f076,2023-03-15 04:21:48,Romain Vimont,"Fix bash auto-completion handling

Options having an argument impossible to auto-complete must be handled
separately.",False
cba2501254209073d5bb09b6d43e973a4013f6b4,2023-03-15 04:11:06,Romain Vimont,Add missing auto-completion for --audio-buffer,False
6ba99a62ff51c0ce209db78a9ed17f1633170027,2023-03-15 03:53:57,Romain Vimont,"Split workarounds to fix audio on some devices

There were several workarounds applied in a single method. Some of them
are specific to Meizu phones, but cause issues on other devices.

Split the method to be able to only fill the app context for audio
capture without applying the Meizu workarounds.

Fixes #3801 <https://github.com/Genymobile/scrcpy/issues/3801>",False
d2b7315ba693e11bd9b9a0421a75b7df8a31c5cc,2023-03-15 03:45:09,Bernard Cafarelli,"Fix linux desktop files validation

Follow quoting rules from:
<https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#exec-variables>

PR #3817 <https://github.com/Genymobile/scrcpy/pull/3817>
Fixes #3633 <https://github.com/Genymobile/scrcpy/issues/3633>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
6ad037ea043debb1fb240912a8a4b639a5e2d96e,2023-03-15 02:33:21,Bernard Cafarelli,"Update Gentoo instructions

scrcpy is available directly in the distro, drop link to the overlay
(which only contains older versions).

PR #3816 <https://github.com/Genymobile/scrcpy/pull/3816>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
337d6c2fd351226ede8b7b2b164ffd3d67a6953f,2023-03-14 23:57:11,Romain Vimont,"Fail on empty AudioRecord read()

If read() returns 0, then there is no data. According to the
documentation, it happens if the buffer is not a direct buffer:
<https://developer.android.com/reference/android/media/AudioRecord#read(java.nio.ByteBuffer,%20int)>

Refs #3812 <https://github.com/Genymobile/scrcpy/issues/3812>",False
2eced46a37e5d73c23f37e031aab4bfcc1f589b0,2023-03-14 23:51:43,Romain Vimont,"Update broken link in documentation

The Android documentation has been updated.",False
1a80333747de602b03ca7ae6b8e58790eeefc3dc,2023-03-13 14:49:22,Romain Vimont,"Replace link to enable USB debugging in README

Link to a more relevant page in the official documentation to enable USB
debugging.",False
fb61b779a6da299b1f93ec598b2332af9d387416,2023-03-13 13:13:54,Romain Vimont,"Add references to prerequisites

Users sometimes only read the OS-specific instructions, they must be
aware of the prerequisites.",False
5899af6a2fda6c326912a7d49bae268c0c60b71c,2023-03-13 01:38:51,Romain Vimont,Add blogpost link about scrcpy 2.0,False
cbca79b95baa2b2cf39b72d0a0b2b3de0725959a,2023-03-12 17:15:49,Romain Vimont,"Fix v4l2 sink

The codec id to write as codec parameters is the one from the v4l2
encoder, not from the decoder.

Regression introduced by be985b8242e0626288674b84c5039725170f8f0c.

Fixes #3795 <https://github.com/Genymobile/scrcpy/issues/3795>",False
02586cf21f18d52160a982e9b55e19d8b0b9993f,2023-03-12 13:24:42,Romain Vimont,"Fix build issue on FFmpeg < 5.1

An include was missing.

Fixes #3783 <https://github.com/Genymobile/scrcpy/issues/3783>",False
80a6fa7a01f019e59e95bfcca47de1a80fe17c6a,2023-03-12 13:07:08,Romain Vimont,"Fix comparison warning

An int was compared with an unsigned:

    ../app/src/audio_player.c:290:27: warning: comparison of integers of
    different signs: 'int' and 'unsigned int' [-Wsign-compare]
                if (abs(diff) < ap->sample_rate / 1000) {
                    ~~~~~~~~~ ^ ~~~~~~~~~~~~~~~~~~~~~~",False
6b769675fa68e60c9765022e43c4d7b1e329353a,2023-03-12 12:56:17,Ruoyu Zhong,"Fix an ""expected expression"" error

In C, a label can only be followed by a statement, not a declaration.
An error in `app/src/screen.c` violated this, and led to a build error
with an error message similar to the one below:

    ../app/src/screen.c:821:13: error: expected expression
                bool ok = sc_screen_init_size(screen);
                ^
    /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/13.0.0/include/stdbool.h:15:14: note: expanded from macro 'bool'
    #define bool _Bool
                 ^
    ../app/src/screen.c:822:18: error: use of undeclared identifier 'ok'
                if (!ok) {
                     ^
    2 errors generated.

This could be fixed by introducing a new block (or compound statement;
as is already being done in the next `case`). That is a statement.

Fixes #3785 <https://github.com/Genymobile/scrcpy/issues/3785>
PR #3787 <https://github.com/Genymobile/scrcpy/pull/3787>

Signed-off-by: Ruoyu Zhong <zhongruoyu@outlook.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e5aa2ce01f638ebe083c821fd204a45d9d8f317d,2023-03-12 07:29:44,Romain Vimont,Fix broken link in Windows download page,False
cbc638c6baa31b989ea40ac22dc109ae6c1cce60,2023-03-12 07:20:10,Romain Vimont,Fix broken link in shortcuts documentation,False
abc1be4872ee1869b307405b091d736b7cd2e0ff,2023-03-12 07:19:28,Romain Vimont,Update links to v2.0,False
f1b2d6bbbb5afd1f95913a49b94eda7cfb85226b,2023-03-12 06:35:37,Romain Vimont,Bump version to 2.0,False
90926d40adae0b8124bd2ec4e6b8f82fcc2c9f9e,2023-03-12 06:35:24,Romain Vimont,Merge branch 'master' into dev,True
f12590ed08b892b289fb382dd1e4f89fe2640a2d,2023-03-12 06:34:58,Romain Vimont,"Rework README and documentation

The README.md page is HUGE. Split it up.

Also document audio forwarding and improve installation instructions for
each platform and user documentation.

PR #3774 <https://github.com/Genymobile/scrcpy/pull/3774>",False
05a55e36878b78754d0c031d5c81dc7de7ac1893,2023-03-12 06:34:58,Romain Vimont,Happy new year 2023!,False
affda26bfa5678f358f834248179cbe98e38dcc2,2023-03-12 06:34:58,Romain Vimont,"Document audio player

Add some high-level documentation on the audio player implementation.",False
0bf866fa8d98e8d35c08de5c69e33b80ccda8c44,2023-03-12 06:34:58,Romain Vimont,"Apply new compensation only if it changed

If the compensation is the same (typically when it is 0), do not reapply
it.",False
73727e7fdfdd579f14f957dce680a3fc9e454437,2023-03-12 06:34:58,Romain Vimont,"Disable clock drift compensation for tiny values

For less than 1ms, the estimated drift is just noise.",False
c22c87ededb2b97249a956b0d0a29b16a14bb5d8,2023-03-12 06:34:58,Romain Vimont,"Fail on deprecated options

Suggest the video and audio specific options instead.",False
426dfbf21d9518fc8b325fc1ccf106f3b03e33c1,2023-03-12 06:34:58,Romain Vimont,"Remove dead code about the deprecated -F option

The -F option was already removed.",False
5512777404617ed34a2e0343985f949ae4b554c2,2023-03-12 06:34:58,Romain Vimont,"Remove deprecated option --render-expired-frames

This option did nothing since it was deprecated. Totally remove it.",False
cc07f8dac4247c7d6b175b1f58e71d50e87f85db,2023-03-12 06:34:58,Romain Vimont,"Upgrade platform-tools (34.0.1) for Windows

Include the latest version of adb in Windows releases.",False
f5bb9e576dfae8444215e36e4fbd28bc2947f4c9,2023-03-12 06:34:58,Romain Vimont,"Upgrade SDL (2.26.4) for Windows

Include the latest version of SDL in Windows releases.",False
2380879376bd0aeeffb0262f98b9f168bfe198fb,2023-03-12 06:34:58,Romain Vimont,"Remove unused IOException

IOException may not be thrown from this method.",False
eca87665455f6d5a3092e90150e5a7929045cf1a,2023-03-12 06:34:58,Romain Vimont,"Compute buffering and compensation without lock

Once underflow has been read with a lock, the buffering and compensation
may be performed without shared variables.",False
0b8a5ca923bdd17bd551e9f5565979373ec319c4,2023-03-12 06:34:58,Romain Vimont,"Do not read avg_buffering from the player thread

On buffer underflow, the average buffering must be updated, but it is
intended to be accessed only from the receiver thread.

Make the player and the receiver thread communicate the underflow via a
new field (ap->underflow).",False
e06acc1ba23b7a2dd6a822d04e51a031e629aa35,2023-03-12 06:34:57,Romain Vimont,"Simplify bytebuf naming

Rename read_available to can_read and write_available to can_write.
This is more readable.",False
14f9d82fdad4bce7887a65603946e43e1a8318e3,2023-03-12 06:34:07,Romain Vimont,"Add audio sample ring-buffer

Add a thin wrapper around bytebuf to handle samples instead of bytes.
This simplifies the audio player, which mostly handles samples.",False
bb509d9317ec073cd650f9ae9796a24b4cfff34c,2023-03-11 20:27:25,Romain Vimont,"Define the audio output buffer in milliseconds

In theory, this buffer must be dimensioned for a target duration, so its
size in bytes should depend on the sample rate.",False
238ab872ba0ea18c2553dfe3c2202d64d67d8960,2023-03-11 20:27:25,Romain Vimont,"Pass video size as codec metadata

On initial connection, scrcpy sent some device metadata:
 - the device name (to be used as window title)
 - the initial video size (before any frame or even SPS/PPS)

But it is better to provide the initial video size as part as the video
stream, so that it can be demuxed and exposed via AVCodecContext to
sinks.

This avoids to pass an explicit ""initial frame size"" for the screen, the
recorder and the v4l2 sink.",False
3a72f3fb4da0dca0ab34824396c3efdf1819e5df,2023-03-11 20:27:25,Romain Vimont,"Report errors on screen event error

Make scrcpy fail if an important screen event (like frame update) fails.",False
aa1efbc35c468b1748b2ae4c542da443ab0e4714,2023-03-11 20:27:25,Romain Vimont,"Rename sendCodecId to sendCodecMeta

This will allow the codec header to contain more than the codec id.",False
be985b8242e0626288674b84c5039725170f8f0c,2023-03-11 20:27:25,Romain Vimont,"Copy codec parameters from context

Now that the recorder have access to the codec context, it may
automatically initialize the stream codec parameters.

The V4L2 sink could do the same.",False
a9f6001f51b9348d65578178a3e1f6a89efc4aa8,2023-03-11 20:27:25,Romain Vimont,"Simplify recorder

After the refactor performed by the previous commit, the functions to
wait the video stream and the audio stream could be inlined.",False
5052e15f7fd5049d9c65712182c1a4a1d349a65e,2023-03-11 20:27:25,Romain Vimont,"Create recorder streams from packet sinks ops

Previously, the packet sink push() implementation just set the codec and
notified a wait condition. Then the recorder thread read the codec and
created the AVStream.

But this was racy: an AVFrame could be pushed before the creation of the
AVStream, causing its video_stream_index or audio_stream_index to be
initialized to -1.

Also, in the future, the AVStream initialization might need data
provided by the packet sink open(), so initialize it there (with a
mutex).",False
4bdf632dfadec432582db64bff898588a4ed6e13,2023-03-11 20:27:25,Romain Vimont,"Pass AVCodecContext to packet sinks

Create the codec context from the demuxer, so that it can fill context
data for the decoder and recorder.",False
4db50ddbb7b80df2f5b8240027619bf1ed7decb1,2023-03-11 20:25:44,Romain Vimont,"Enable log signaling buffering threshold exceeded

It is as important as underflow logs.",False
46f691817983c8c251956e5115ace6a8af8e08d4,2023-03-11 03:15:48,Romain Vimont,"Stop and join sc_file_pusher only if initialized

The sc_file_pusher is lazy-initialized, but it was stopped and joined in
all cases (accessing uninitialized values).

Detected by poisoning the struct scrcpy instance with ASAN enabled.",False
d93582724ddb300044e0a3e0e7c728390da5762d,2023-03-11 03:03:52,chengjian.scj,"Initialize interrupted field explicitly

The field sc_fps_counter.interrupted was never initialized explicitly.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
408f45863617465cee36453fb9ce2c7403e159e0,2023-03-11 02:52:16,Romain Vimont,"Decrease recorder thread priority

Recording is background task, writing the packets to a file is not
urgent.",False
aa450ffc3f618a286c0eb7a5f60244b53d650e75,2023-03-11 02:52:16,Romain Vimont,"Increase audio thread priority

The audio demuxer thread is the one filling the audio buffer read by the
SDL audio thread. It is time critical to avoid buffer underflow.",False
5ee59e0f133b079f0652f10b80bb6320b41be278,2023-03-11 02:52:16,Romain Vimont,"Add thread priority API

Expose an API to change the priority of the current thread.",False
4a25f3e53bdac8c2510cc1c7f06e479a17a42e6b,2023-03-11 02:52:15,Romain Vimont,"Print info logs to stdout

All server logs were printed to stdout, while all client logs were
printed to stderr.

Instead, use stderr for warnings and errors, stdout for the others:
 - stdout: verbose, debug, info
 - stderr: warn, error",False
bb56472d4eb15d7c318a05a8236af6d0f5a46a04,2023-03-11 02:52:15,Romain Vimont,"Print server logs and newline in one call

System.out.println() first prints the message, then the new line.
Between these two calls, the client might print a message, breaking
formatting.

Instead, call System.out.print() with '\n' appended to the message.",False
7da45c246e919386f7d4fd3facc4597bb056e752,2023-03-11 02:52:15,Romain Vimont,"Warn on ignored audio options

For raw audio codec, some audio options are ignored.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
d2952c7e93f151d773f38aa368b7163b0ff31cf2,2023-03-11 02:52:15,Romain Vimont,"Add --audio-codec=raw option

Add support for raw (PCM S16 LE) audio codec (a raw decoder is included
in FFmpeg).

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
66b6c06443130a8a11984ca2cd6d80f5cd3db6ec,2023-03-11 02:52:15,Romain Vimont,"Add raw audio recorder

Add an alternative AudioRecorder to stream raw packets without encoding.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
dc228eaad0ea53f57c27e9aba2b51a422ed3aa94,2023-03-11 02:52:15,Romain Vimont,"Extract async processor interface

On the server side, several components are started, stopped and joined.
Extract an interface to handle them generically.

This will help to support both encoded and raw audio stream, because
they will be two different concrete components, but implementing the
same interface.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
65cc9d765d8d0feb26a41c2287b3abe13dc37d12,2023-03-11 02:52:15,Romain Vimont,"Extract audio capture

The audio capture was implemented in AudioEncoder.

In order to reuse it without encoding, extract it to a separate class.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
02dd1be4a1ab24795a10ca769e2998dec28806f7,2023-03-11 02:52:15,Romain Vimont,"Stop on decoder frame push error

On push, frame sinks report downstream errors to stop upstream
components. Do not ignore the error.",False
df55bc2683e2ca2aec105d6e435cb0b170037ed7,2023-03-11 02:52:15,Romain Vimont,"Add --audio-buffer

Expose an option to add a buffering delay (in milliseconds) before
playing audio.

This is similar to the options --display-buffer and --v4l2-buffer for
video frames.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
d66b0b3dccc118600b83988173e6631ad661df51,2023-03-11 02:52:15,Romain Vimont,"Add compat support for FFmpeg < 5.1

The new chlayout API has been introduced in FFmpeg 5.1. Use the old
channel_layout API on older versions.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
fbe0f951e113e6055c4365c2986663cb3ef16d0e,2023-03-11 02:52:15,Romain Vimont,"Add audio player

Play the decoded audio using SDL.

The audio player frame sink receives the audio frames, resample them
and write them to a byte buffer (introduced by this commit).

On SDL audio callback (from an internal SDL thread), copy samples from
this byte buffer to the SDL audio buffer.

The byte buffer is protected by the SDL_AudioDeviceLock(), but it has
been designed so that the producer and the consumer may write and read
in parallel, provided that they don't access the same slices of the
ring-buffer buffer.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
e1333f6f3b29fd68239f3991271e63bff316abc0,2023-03-11 02:52:15,Romain Vimont,"Optionally do not delay the first frame

A delay buffer delayed all the frames except the first one, to open the
scrcpy window immediately and get a picture.

Make this feature optional, so that the delay buffer might also be used
for audio (especially for simulating a high delay for debugging).

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
9b3ca208bfe21ceb303798c2f05e2364aa364880,2023-03-11 02:52:15,Romain Vimont,"Accept clock estimation with a single point

If there is only one point, assume the slope is 1.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
48a537d45c48bdff45c85197584f5570e9d9dc57,2023-03-11 02:52:15,Romain Vimont,"Remove anonymous struct in delay buffer

For clarity, the fields used only when a delay was set were wrapped in
an anonymous structure.

Now that the delay buffer has been extracted to a separate component,
the delay is necessarily set (it may not be 0), so the fields are always
used.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
1230149fdd73e9e90230b0f592612edbe078650a,2023-03-11 02:52:15,Romain Vimont,"Use delay buffer as a frame source/sink

The components needing delayed frames (sc_screen and sc_v4l2_sink)
managed a sc_video_buffer instance, which itself embedded a
sc_frame_buffer instance (to keep only the most recent frame).

In theory, these components should not be aware of delaying: they should
just receive AVFrames later, and only handle a sc_frame_buffer.

Therefore, refactor sc_delay_buffer as a frame source (it consumes)
frames) and a frame sink (it produces frames, after some delay), and
plug an instance in the pipeline only when a delay is requested.

This also removes the need for a specific sc_video_buffer.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
974227a3fcfa5b60921aeb71d43da4ac84c73d91,2023-03-11 02:52:15,Romain Vimont,Use frame source trait in decoder,False
6543964f12b9089d2b5cf57a9aab7e7fe624842f,2023-03-11 02:52:15,Romain Vimont,"Introduce frame source trait

There was a frame sink trait, implemented by components able to receive
AVFrames, but each frame source had to manually send frame to sinks.

In order to mutualise sink management, add a frame sink trait.",False
f3197e178d297544774c37c766907b1992929e67,2023-03-11 02:52:15,Romain Vimont,Use packet source trait in demuxer,False
c39054a63da52ab266ed26d78e2329c48e4e0216,2023-03-11 02:52:15,Romain Vimont,"Introduce packet source trait

There was a packet sink trait, implemented by components able to
receive AVPackets, but each packet source had to manually send packets
to sinks.

In order to mutualise sink management, add a packet source trait.",False
f410f2bdc468cd32dd099679471af08ca6a76a54,2023-03-11 02:52:15,Romain Vimont,"Extract sc_delay_buffer

A video buffer had 2 responsibilities:
 - handle the frame delaying mechanism (queuing packets and pushing them
   after the expected delay);
 - keep only the most recent frame (using a sc_frame_buffer).

In order to be able to reuse only the frame delaying mechanism, extract
it to a separate component, sc_delay_buffer.",False
6379c08012454300e399006e665a5e4f7d436202,2023-03-11 02:52:15,Romain Vimont,"Fix buffering pts conversion

The mistake had no effect, because tick is also internally expressed in
microseconds.",False
4540f1d69e7435b78af2c968c3b07b06729a714f,2023-03-11 02:52:15,Romain Vimont,"Report video buffer downstream errors

Make the video buffer stop if its consumer could not receive a frame.",False
ad94ccca0bbed9cd8ddaaa931da2c7ed18bf060c,2023-03-11 02:52:15,Romain Vimont,"Stop the video buffer on error

If an error occurs from the video buffer thread (typically an
out-of-memory error), then stop.",False
a3703340fc5f2d10d8b8d1a248200f302831c432,2023-03-11 02:52:15,Romain Vimont,"Fix possible race condition on video_buffer end

The video_buffer thread clears the queue once it is stopped, but new
frames might still be pushed asynchronously.

To avoid the problem, do not push any frame once the video_buffer is
stopped.",False
6f38c6311b4db17858e221f66cbe9be1c7da12ca,2023-03-11 02:52:15,Romain Vimont,"Remove sc_queue

All uses have been replaced by VecDeque.",False
338310677e2ef441d09048e19a30c94ecf4fbca4,2023-03-11 02:52:15,Romain Vimont,"Remove cbuf

All uses have been replaced by VecDeque.",False
f978e4d6dea2958b449906e33fdb965ef5bc26d4,2023-03-11 02:52:15,Romain Vimont,"Use VecDeque in aoa_hid

Replace cbuf by VecDeque in aoa_hid",False
a0a65b3c4da6b56ca320959451fdf2979a34738d,2023-03-11 02:52:15,Romain Vimont,"Use VecDeque in file_pusher

Replace cbuf by VecDeque in file_pusher.

As a side-effect, the new implementation does not limit the queue to an
arbitrary value.",False
4d989de9ae27a88b08677d2cb44c0cce86380ee4,2023-03-11 02:52:15,Romain Vimont,"Use VecDeque in controller

Replace cbuf by VecDeque in controller.",False
f25a67f3424406c9cbf33b7b11956ad7dcf2ddb3,2023-03-11 02:52:15,Romain Vimont,"Use VecDeque in video_buffer

The packets queued for buffering were wrapped in a dynamically allocated
structure with a ""next"" field.

To avoid this additional layer of allocation and indirection, use a
VecDeque.",False
efc15744da576206f407099927bceea8421b79bb,2023-03-11 02:52:15,Romain Vimont,"Use VecDeque in recorder

The packets queued for recording were wrapped in a dynamically allocated
structure with a ""next"" field.

To avoid this additional layer of allocation and indirection, use a
VecDeque.",False
33df484912f8ac4af759a1cf865a2cebbdecbf34,2023-03-11 02:52:15,Romain Vimont,"Introduce VecDeque

Introduce a double-ended queue implemented with a growable ring buffer.

Inspired from the Rust VecDeque type:
<https://doc.rust-lang.org/std/collections/struct.VecDeque.html>",False
457385d5f468f87c31b44ad8d0fec1cd743c627c,2023-03-11 02:52:15,Romain Vimont,"Add sc_allocarray() util

Add a function to allocate an array, which fails safely in the case
where the multiplication would overflow.",False
c735b8c127bba489df8d45e397fc47089ae9f00b,2023-03-11 02:52:15,Romain Vimont,"Use reallocarray() in sc_vector

This fails safely in case of overflow.",False
6dceb328173ed9dc9c7fcdfc250621b4c57ae415,2023-03-11 02:52:15,Romain Vimont,"Add compat for reallocarray()

This function fails safely in the case where the multiplication would
overflow.",False
6e05d7047a9914bdba0bd833e909bc781d5b1a81,2023-03-11 02:52:15,Romain Vimont,"Call avcodec_receive_frame() in a loop

Since in scrcpy a video packet passed to avcodec_send_packet() is always
a complete video frame, it is sufficient to call avcodec_receive_frame()
exactly once.

In practice, it also works for audio packets: the decoder produces
exactly 1 frame for 1 input packet.

In theory, it is an implementation detail though, so
avcodec_receive_frame() should be called in a loop.",False
c1528cdca92d72d98f8f0d1b5cd088a1dd79467c,2023-03-11 02:52:15,Romain Vimont,"Add --require-audio

By default, scrcpy mirrors only the video when audio capture fails on
the device. Add an option to force scrcpy to fail if audio is enabled
but does not work.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
de40cac6ad929f1d150b332f0e987c0d70ba5d38,2023-03-11 02:52:15,Simon Chan,"Add workaround to capture audio on Android 11

On Android 11, it is possible to start the capture only when the running
app is in foreground. But scrcpy is not an app, it's a Java application
started from shell.

As a workaround, start an existing Android shell existing activity just
to start the capture, then close it immediately.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b60a8aa657f62a596e528f244f1c101dc2f054b7,2023-03-11 02:52:15,Romain Vimont,"Add two-step write feature to bytebuf

If there is exactly one producer, then it can assume that the remaining
space in the buffer will only increase until it writes something.

This assumption may allow the producer to write to the buffer (up to a
known safe size) without any synchronization mechanism, thus allowing
to read and write different parts of the buffer in parallel.

The producer can then commit the write with a lock held, and update its
knowledge of the safe empty remaining space.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
20d41fdd7e236b33fc70a12758dacdf47099c83e,2023-03-11 02:52:15,Romain Vimont,"Introduce bytebuf util

Add a ring-buffer for bytes. It will be useful for audio buffering.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
619730edafe7ab2fd2fb022f9eb6e350bfe1bb52,2023-03-11 02:52:15,Romain Vimont,"Pass AVCodecContext to frame sinks

Frame consumers may need details about the frame format.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
e22660d698900f949cfc6afdb41d49cb371f7cff,2023-03-11 02:52:15,Romain Vimont,"Add an audio decoder

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
05f0e35d2a9074ecb214d70303f3f271631af645,2023-03-11 02:52:15,Romain Vimont,"Give a name to decoder instances

This will be useful in logs.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
99837fa600af9f128fa0830b9b007a6944b9808f,2023-03-11 02:52:15,Romain Vimont,"Rename decoder to video_decoder

This prepares the introduction of audio_decoder.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
a205ff6c8b5ac1cae5a5b2763742247da84cd4b5,2023-03-11 02:52:15,Romain Vimont,"Log display sizes in display list

This is more convenient than just the display id alone.",False
b65301f672e852fe2f3fded1fac2091c85679c35,2023-03-11 02:52:15,Romain Vimont,"Add --list-displays

Add an option to list the device displays properly.",False
2596ca02f0d9b53ddf322873ad141197216f00f4,2023-03-11 02:52:15,Romain Vimont,"Move log message helpers to LogUtils

This class will also contain other log helpers.",False
50d56a9a2bb75398c562e71b131de5c3ed43e95e,2023-03-11 02:52:15,Romain Vimont,"Quit on audio configuration failure

When audio capture fails on the device, scrcpy continues mirroring the
video stream. This allows to enable audio by default only when
supported.

However, if an audio configuration occurs (for example the user
explicitly selected an unknown audio encoder), this must be treated as
an error and scrcpy must exit.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
9196dc156376760eb637024d5c0448ceeaa2a8ff,2023-03-11 02:52:15,Romain Vimont,"Add --list-encoders

Add an option to list the device encoders properly.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
b7e5284adf1074d6d851a0a7d164461325ccaa58,2023-03-11 02:52:15,Romain Vimont,"Move await_for_server() logs

Print the logs on the caller side. This will allow to call the function
in another context without printing the logs.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
f9960e959fa7b46cc1ed6b15115fe2958724766d,2023-03-11 02:52:15,Romain Vimont,"Add --audio-encoder

Similar to --video-encoder, but for audio.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
6f332a2bc73853884c894ee2400ad9c92aabc34c,2023-03-11 02:52:15,Romain Vimont,"Extract unknown encoder error message

This will allow to reuse the same code for audio encoder selection.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
b03c864c70c4388ae788c494cfffeed2c00aabb8,2023-03-11 02:52:15,Romain Vimont,"Add --audio-codec-options

Similar to --video-codec-options, but for audio.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
58cf8e540199ca5a1a25bb0e9bdac56f8de17a14,2023-03-11 02:52:15,Romain Vimont,"Extract application of codec options

This will allow to reuse the same code for audio codec options.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
4601735e51b14e85b67fdc557868f022653b4230,2023-03-11 02:52:15,Romain Vimont,"Add support for AAC audio codec

Add option --audio-codec=aac.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
839b842aa71a848510d9407dacc7742c61a17fea,2023-03-11 02:52:15,Romain Vimont,"Add --audio-codec

Introduce the selection mechanism. Alternative codecs will be added
later.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
0870b8c8be18261b0930721dfa8e9f5454bd3081,2023-03-11 02:52:15,Romain Vimont,"Add --audio-bit-rate

Add an option to configure the audio bit-rate.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
8e640dc90f66e9b7f6b22feeb7e5bc9d2bb3e6f0,2023-03-11 02:52:15,Romain Vimont,"Disable MethodLength checkstyle on createOptions()

This method will grow as needed to initialize options.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
e694619d53d1f38ed02b269be1649c7a67a11916,2023-03-11 02:52:15,Romain Vimont,"Rename --encoder to --video-encoder

This prepares the introduction of --audio-encoder.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
31555fa5309b80f6e65a19dc3aa8932fe9265b8d,2023-03-11 02:52:15,Romain Vimont,"Rename --codec-options to --video-codec-options

This prepares the introduction of --audio-codec-options.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
9087e85c3f076c54b81a8895a9936bbb49a41812,2023-03-11 02:52:15,Romain Vimont,"Rename --bit-rate to --video-bit-rate

This prepares the introduction of --audio-bit-rate.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
cee40ca047f02c68e59372ae7305fce6d6ead8f0,2023-03-11 02:52:15,Romain Vimont,"Rename --codec to --video-codec

This prepares the introduction of --audio-codec.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
a1802dab763d5031bc26576e45ab1d388a8904fc,2023-03-11 02:52:15,Romain Vimont,"Remove default bit-rate on client side

If no bit-rate is passed, let the server use the default value (8Mbps).

This avoids to define a default value on both sides, and to pass the
default bit-rate as an argument when starting the server.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
17d5301c0fd6f93c5b9d4dd325e4303739d93ffb,2023-03-11 02:52:15,Romain Vimont,"Record at least video packets on stop

If the recorder is stopped while it has not received any audio packet
yet, make sure the video stream is correctly recorded.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
80c0780b7779acc27a563ee5acdd3ac645108763,2023-03-11 02:52:15,Romain Vimont,"Disable audio before Android 11

The permission ""android.permission.RECORD_AUDIO"" has been added for
shell in Android 11.

Moreover, on lower versions, it may make the server segfault on the
device (happened on a Nexus 5 with Android 6.0.1).

Refs <https://android.googlesource.com/platform/frameworks/base/+/4feeee88911503cc365b223a712437abcd91c94f%5E%21/>
PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
13a3395a332eca55c884edc05a5052457b519f60,2023-03-11 02:52:15,Romain Vimont,"Disable audio on initialization error

By default, audio is enabled (--no-audio must be explicitly passed to
disable it).

However, some devices may not support audio capture (typically devices
below Android 11, or Android 11 when the shell application is not
foreground on start).

In that case, make the server notify the client to dynamically disable
audio forwarding so that it does not wait indefinitely for an audio
stream.

Also disable audio on unknown codec or missing decoder on the
client-side, for the same reasons.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
7de062221465fef6c6be5998b3884bdc833c8526,2023-03-11 02:52:15,Romain Vimont,"Add audio recording support

Make the recorder accept two input sources (video and audio), and mux
them into a single file.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
3d29f6ef0684aa9ef7a47690aa82326b6f830293,2023-03-11 02:52:15,Romain Vimont,"Rename video-specific variables in recorder

This paves the way to add audio-specific variables.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
609b098a97322b73de8ec6cd375926ac1f6f8307,2023-03-11 02:52:15,Romain Vimont,"Do not merge config audio packets

For video streams (at least H.264 and H.265), the config packet
containing SPS/PPS must be prepended to the next packet (the following
keyframe).

For audio streams (at least OPUS), they must not be merged.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
de430bc4aa3b63e8a602032a42613d9672f7c181,2023-03-11 02:52:15,Romain Vimont,"Add an audio demuxer

Add a demuxer which will read the stream from the audio socket.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
f60b5767f4aec15d07e8053e25d5a68961618411,2023-03-11 02:52:15,Romain Vimont,"Force --no-audio if no display and no recording

The client does not use the audio stream if there is no display and no
recording (i.e. only V4L2), so disable audio so that the device does not
attempt to capture it.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
d499f890e7fe019ac3c60bec7ceb61d39aaca97b,2023-03-11 02:52:15,Romain Vimont,"Give a name to demuxer instances

This will be useful in logs.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
e9876788c9901d43d75031b090c81c0e604ed994,2023-03-11 02:52:15,Romain Vimont,"Rename demuxer to video_demuxer

There will be another demuxer instance for audio.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
15556d1f3be9aa0cf98c43205b516e622e9c7856,2023-03-11 02:52:15,Romain Vimont,"Extract OPUS extradata

For OPUS codec, FFmpeg expects the raw extradata, but MediaCodec wraps
it in some structure.

Fix the config packet to send only the raw extradata.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
7cf5cf5875b217a5d2e141214d1dc344bdde4e73,2023-03-11 02:52:15,Romain Vimont,"Use a streamer to send the audio stream

Send each encoded audio packet using a streamer.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
5eed2c52c2f38192544d909ee639a3f02720fe56,2023-03-11 02:52:15,Romain Vimont,"Encode recorded audio on the device

For now, the encoded packets are just logged into the console.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
464a35b05e7896ce5173a1fa3e27f00e0899f19e,2023-03-11 02:52:15,Romain Vimont,"Make streamer more generic

Expose a method to write a packet from raw metadata (without
BufferInfo).",False
11d32616a91f90ec49515a8f72f386bb9322766b,2023-03-11 02:52:15,Simon Chan,"Capture device audio

Create an AudioRecorder to capture the audio source REMOTE_SUBMIX.

For now, the captured packets are just logged into the console.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e841241a8ea135772a339687b9e7c45779c7864c,2023-03-11 02:52:15,Simon Chan,"Add a new socket for audio stream

When audio is enabled, open a new socket to send the audio stream from
the device to the client.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3cf03e4a4bea7b93766f6e5fb66d8e8878a6a906,2023-03-11 02:52:15,Simon Chan,"Add --no-audio option

Audio will be enabled by default (when supported). Add an option to
disable it.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8487ddba644b5d2aad762bea586654f9a7891b5e,2023-03-11 02:52:15,Romain Vimont,"Use FakeContext for Application instance

This will expose the correct package name and UID to the application
context.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
84ba6435bb39c1bee194fd658a7aeb913f4ca0d9,2023-03-11 02:52:15,Romain Vimont,"Use shell package name for workarounds

For consistency.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
42285ae86906447708def6783d3edee433624406,2023-03-11 02:52:15,Romain Vimont,"Use ROOT_UID from FakeContext

Remove USER_ID from ServiceManager, and replace it by a constant in
FakeContext.

This is the same as android.os.Process.ROOT_UID, but this constant has
been introduced in API 29.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
820189b6a6b570388187f166b8def499d73ced8a,2023-03-11 02:52:15,Romain Vimont,"Use PACKAGE_NAME from FakeContext

Remove duplicated constant.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
9a815ceba8eccc53c724ef0eb79c6ab277446ad9,2023-03-11 02:52:15,Romain Vimont,"Use AttributionSource from FakeContext

FakeContext already provides an AttributeSource instance.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
a5541b3476fe32306de7cb02472cf9077dd45498,2023-03-11 02:52:15,Simon Chan,"Add a fake Android Context

Since scrcpy-server is not an Android application (it's a java
executable), it has no Context.

Some features will require a Context instance to get the package name
and the UID. Add a FakeContext for this purpose.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
10ef8da95d9f5d66b3755b88b4d1fda032163260,2023-03-11 02:52:15,Romain Vimont,"Improve error message for unknown encoder

The provided encoder name depends on the selected codec. Improve the
error message and the suggestions.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
90d88a6927901345afbe81550c7a489304a61e63,2023-03-11 02:52:15,Romain Vimont,"Rename ""codec"" variable to ""mediaCodec""

This will allow to use ""codec"" for the Codec type.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
10ce0f376a89579408337b084be3e05ebcd18d92,2023-03-11 02:52:15,Romain Vimont,"Make streamer independent of codec type

Rename VideoStreamer to Streamer, and extract a Codec interface which
will also support audio codecs.

PR #3757 <https://github.com/Genymobile/scrcpy/pull/3757>",False
c2267979917215415befb67115bce5cbca1e5006,2023-03-11 02:52:15,Romain Vimont,"Pass all args to ScreenEncoder constructor

There is no good reason to pass some of them in the constructor and some
others as parameters of the streamScreen() method.",False
ae9b08b90540d0f357255b97e5b2d3d51b9b0d4e,2023-03-11 02:52:15,Romain Vimont,"Move screen encoder initialization

This prepares further refactors.",False
51628201b77c7f7c990e26471aa88c5ef930061c,2023-03-11 02:52:15,Romain Vimont,"Write streamer header from ScreenEncoder

The screen encoder is responsible for writing data to the video
streamer.",False
ae29e5b56200035a81c7321c1617fe05928fc5b0,2023-03-11 02:52:15,Romain Vimont,"Use VideoStreamer directly from ScreenEncoder

The Callbacks interface notifies new packets. But in addition, the
screen encoder will need to write headers on start.

We could add a function onStart(), but for simplicity, just remove the
interface, which brings no value, and call the streamer directly.

Refs 87972e2022686b1176bfaf0c678e703856c2b027",False
5b2ec662220d87aa95d3794e7748a00c1163bcd6,2023-03-11 02:52:15,Romain Vimont,"Simplify error handling on socket creation

On any error, all previously opened sockets must be closed.

Handle these errors in a single catch-block. Currently, there are only 2
sockets, but this will simplify even more with more sockets.

Note: this commit is better displayed with --ignore-space-change (-b).",False
ef6a3b97a73f3aa85cb2226b21f4cc1b4372fb12,2023-03-11 02:52:15,Romain Vimont,"Reorder initialization

Initialize components in the pipeline order: demuxer first, decoder and
recorder second.",False
f9efe48aac25c37c4b974b2794fbe61a84d9e6db,2023-03-11 02:52:15,Romain Vimont,"Refactor recorder logic

Process the initial config packet (necessary to write the header)
separately.",False
4b246cd963ebe0cafa2fe2743e4f9b066dcec293,2023-03-11 02:52:15,Romain Vimont,"Move last packet recording

Write the last packet at the end.",False
3c407773e9ddf9debd1de71ff0d12f571bd36718,2023-03-11 02:52:15,Romain Vimont,"Add start() function for recorder

For consistency with the other components, do not start the internal
thread from an init() function.",False
a039124d5d21c3886aacb4463a747edd69da1a46,2023-03-11 02:52:15,Romain Vimont,"Open recording file from the recorder thread

The recorder opened the target file from the packet sink open()
callback, called by the demuxer. Only then the recorder thread was
started.

One golden rule for the recorder is to never block the demuxer for I/O,
because it would impact mirroring. This rule is respected on recording
packets, but not for the initial recorder opening.

Therefore, start the recorder thread from sc_recorder_init(), open the
file immediately from the recorder thread, then make it wait for the
stream to start (on packet sink open()).

Now that the recorder can report errors directly (rather than making the
demuxer call fail), it is possible to report file opening error even
before the packet sink is open.",False
6b5dfef92357421fc033bf99a5ceeb006c322811,2023-03-11 02:52:15,Romain Vimont,"Inline packet_sink impl in recorder

Remove useless wrappers.",False
fb2913559144c1f3b062f08b7225216f0e31b3ee,2023-03-11 02:52:15,Romain Vimont,"Initialize recorder fields from init()

The recorder has two initialization phases: one to initialize the
concrete recorder object, and one to open its packet_sink trait.

Initialize mutex and condvar as part of the object initialization.

If there were several packet_sink traits (spoiler: one for video, one
for audio), then the mutex and condvar would still be initialized only
once.",False
b1b33e3eaf00b94d6a7d7a3c625b8bbc8c7c8014,2023-03-11 02:52:15,Romain Vimont,"Report recorder errors

Stop scrcpy on recorder errors.

It was previously indirectly stopped by the demuxer, which failed to
push packets to a recorder in error. Report it directly instead:
 - it avoids to wait for the next demuxer call;
 - it will allow to open the target file from a separate thread and stop
   immediately on any I/O error.",False
db5751a76a9303e13adc470b45c0a203fc72980c,2023-03-11 02:52:15,Romain Vimont,"Move previous packet to a local variable

It is only used from run_recorder().",False
b6744e788708e330ceef618d0961e1a2ce0a98e8,2023-03-11 02:52:15,Romain Vimont,"Move pts_origin to a local variable

It is only used from run_recorder().",False
181fb555bb72ac5ba5460db6ec8efbf7366a12f3,2023-03-11 02:52:15,Romain Vimont,"Change PTS origin type from uint64_t to int64_t

It is initialized from AVPacket.pts, which is an int64_t.",False
fa9976366895c1adbfdbf98fb624107e71d4b24e,2023-03-11 02:52:15,Romain Vimont,"Fix --encoder documentation

Mention that it depends on the codec provided by --codec (which is not
necessarily H264 anymore).",False
b43938fa66bb854e45c97a76b4600edecdb0fb9b,2023-03-11 02:52:15,Romain Vimont,"Do not print stacktraces when unnecessary

User-friendly error messages are printed on specific configuration
exceptions. In that case, do not print the stacktrace.

Also handle the user-friendly error message directly where the error
occurs, and print multiline messages in a single log call, to avoid
confusing interleaving.",False
9f8e96e895b8af51be2b1123a483c7d4d3decdf7,2023-03-11 02:52:15,Romain Vimont,"Fix --no-clipboard-autosync bash completion

Fix typo.",False
c78254fcd1c8d88fbc258d2a50ee925c282c5c64,2023-03-11 02:52:15,Romain Vimont,"Split server stop() and join()

For consistency with the other components, call stop() and join()
separately.

This allows to stop all components, then join them all.",False
e30e692b3640e5e8db4fb5c31445194d1fad31b6,2023-03-11 02:52:15,Romain Vimont,"Print FFmpeg logs

FFmpeg logs are redirected to a specific SDL log category.

Initialize the log level for this category to print them as expected.",False
10e8295aea0163f80d88eab234be5b918a7571eb,2023-03-11 02:52:15,Romain Vimont,"Move FFmpeg callback initialization

Configure FFmpeg log redirection on start from a log helper.",False
f30fd963a104649e7d388cc68f3fbc5d635baa4a,2023-03-11 02:52:15,Romain Vimont,"Upgrade FFmpeg custom builds for Windows

Use a build which includes the pcm_s16le decoder, to support RAW audio.

Refs <https://github.com/rom1v/scrcpy-deps/commits/6.0-scrcpy-2>",False
9d60d7880bdc467545c883ccfc8d2609927894cb,2023-03-11 02:52:15,Romain Vimont,"Upgrade FFmpeg (6.0) for Windows

Use the latest version (specifically built for scrcpy).

Refs <https://www.ffmpeg.org/download.html#release_6.0>",False
0fc62bfcd63fdccba759c1421ca7e4b5a2278cb9,2023-03-11 02:52:15,Romain Vimont,"Use minimal prebuilt FFmpeg for Windows

On the scrcpy-deps repo, I built FFmpeg 5.1.2 binaries for Windows with
only the features used by scrcpy.

For comparison, here are the sizes of the dll for FFmpeg 5.1.2:
 - before: 89M
 - after: 4.7M

It also allows to upgrade the old FFmpeg version (4.3.1) used for win32.

Refs <https://github.com/rom1v/scrcpy-deps>
Refs <https://github.com/Genymobile/scrcpy/issues/1753>",False
a20615066d435cd3160f80196d25a2d7fb3e8ccc,2023-03-11 02:52:15,Romain Vimont,"Simplify libusb prebuilt scripts

In theory, include/ might be slightly different for win32 and win64
builds. Use each one separately to simplify.",False
14a85fd61e8fba2f4cfbf97dfd639d19b7adb70e,2023-03-03 15:43:48,Romain Vimont,"Silence lint warning about constant in API 29

MediaFormat.MIMETYPE_VIDEO_AV1 has been added in API 29, but it is not
a problem to inline the constant in older versions.",False
5bf52a98ed701ca8bb9ce1b9e769acedf9fa3315,2023-03-03 15:43:48,Romain Vimont,"Remove manifest package name

As reported by gradle:

> Setting the namespace via a source AndroidManifest.xml's package
> attribute is deprecated.
>
> Please instead set the namespace (or testNamespace) in the module's
> build.gradle file, as described here:
> https://developer.android.com/studio/build/configure-app-module#set-namespace",False
a252194161a20b7aaf30e4f4a16f99f0057ac9e0,2023-03-03 15:43:48,Romain Vimont,"Upgrade gradle build tools to 7.4.0

Plugin version 7.4.0.
Gradle version 7.5.

Refs <https://developer.android.com/studio/releases/gradle-plugin#updating-gradle>",False
b5d41ad4f6017cf76fb7fad9e1af919eac34330f,2023-03-03 15:42:31,Romain Vimont,"Fix useless garbage initialization

The variable `p` was initialized with a garbage value (a `const char **`
casted to `char *`). Fortunately, it was never read.

Refs <https://github.com/Genymobile/scrcpy/issues/3765>",False
389dd77b5060af9989527729bad5f72c0818d2e6,2023-03-03 05:48:10,Romain Vimont,"Fix MIN/MAX macros

Expressions like ""x < MAX(y, z)"" were broken.",False
3c3c07db05088963210c3522b21069dbe72d429c,2023-02-28 17:04:34,Romain Vimont,"Initialize server->serial in all cases

Running scrcpy --tcpip on a device already connected via TCP/IP did not
initialize server->serial.

As a consequence, in debug mode, an assertion failed:

    scrcpy: ../app/src/server.c:770: run_server: Assertion
    `server->serial' failed.

In release mode, scrcpy failed with this error:

    adb: -s requires an argument",False
6b422e21bf82d5b2a7913598d14af2da5573173e,2023-02-28 01:21:54,Romain Vimont,Fix error message on icon loading failure,False
8e8b039a633a848bd2498cb6c937ba5d99972cc2,2023-02-28 01:21:54,Romain Vimont,"Do not use avformat network

Scrcpy does not use FFmpeg network features. Initialize network locally
instead (useful only for Windows).

The include block has been moved to fix the following warning:

    Please include winsock2.h before windows.h",False
0702be86d8b0dbdba2a74f4a0638f40457a30e51,2023-02-28 01:21:54,Romain Vimont,"Accept Windows Sockets from version 1.1

Version 2.2 is probably not necessary (1.1 is the version required by
FFmpeg when network is enabled).

Refs <https://github.com/FFmpeg/FFmpeg/blob/891ed24f77da99c6d41bb7c116ba5925e3206ce2/libavformat/network.c#L63>
Refs <https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-wsastartup>",False
0cea7fb24cf83b04797a96f579fbc34ab8c3184b,2023-02-28 01:21:35,Romain Vimont,Fix WSAStartup() error check on Windows,False
3d10fbd9b4b9451ecca5d7305d1e5c42416d63ad,2023-02-22 00:20:01,Romain Vimont,"Fix --bit-rate option in bash completion script

The option is --bit-rate, not --bitrate.",False
3e3756a323c947678daa753cd1b8e0b110a833d1,2023-02-22 00:18:28,Romain Vimont,"Add auto-completion for --codec option

Add missing command to bash and zsh completion scripts.",False
5d6bcc59662e520b48362163d65e4dabaaada965,2023-02-22 00:17:27,Romain Vimont,"Use enum for long options constants

This avoids to manually assign values.",False
5973d4cdd7a355b6e73997e0a7d95bc41bc1e107,2023-02-21 16:41:39,Romain Vimont,"Initialize mouse_input_mode explicitly

The explicit initialization was missing. It had no consequences because
SC_MOUSE_INPUT_MODE_INJECT == 0.

Fixes #3749 <https://github.com/Genymobile/scrcpy/issues/3749>",False
0a151b96fe7f2331a75306341369acc3dc638ebf,2023-02-21 01:19:56,Romain Vimont,"Accept muxing AV1 into MP4 container

MP4 supports AV1.

Refs d2dce5103832d6a9fc29f56a9795c22e44ceafa1",False
ebecbe6bc66f6d2c5d7fb18fe37641fdacb0a8df,2023-02-19 20:48:19,Romain Vimont,"Fix inconsistent quotes

The encoder name started with a simple quote but ended with a
double quote. Use a single quote for both.",False
d5dff239c858d22e8f8aad7dc51524e149561299,2023-02-19 20:48:19,Romain Vimont,Suggest commands with an explicit '=',False
5cf86ef7ffb374a8a1d0426b801c97f759375f5d,2023-02-19 20:29:05,Romain Vimont,"Move finally-block to fix deadlock on stop

DesktopConnection implements Closeable, so it is implicitly closed after
its try-with-resources block. Closing the DesktopConnection shutdowns
the sockets, so it is necessary in particular to wake up blocking read()
calls from the controller.

But the controller thread was joined before the DesktopConnection was
closed, causing a deadlock. To fix the problem, join the controller
thread only after the DesktopConnection is closed.

Refs 400a1c69b198103feff9682895529529890c1acc",False
e02f30f8957adf09987c5bf2c7449f8241de7c8e,2023-02-19 06:40:14,Romain Vimont,"Remove unnecessary error logs

When a call to a packet or frame sink fails, do not log the error on the
caller side: either the ""failure"" is expected (explicitly stopped) or it
must be logged by the packet or frame sink implementation.",False
25e2eb7d7c21b65ad0c206f63bbadb0a19a890c6,2023-02-18 23:40:25,Romain Vimont,"Document default video codec

Mention the default option value, like for other commands.",False
280a9afda8d44cf2450a5365fbb1072f45a4ad6f,2023-02-18 22:41:34,Romain Vimont,Fix command-line help typo,False
e91618586ca822e02de3a72fafccc962478ca79b,2023-02-18 14:07:31,Romain Vimont,"Prefix receiver by sc_

Like all other components in scrcpy.",False
680ddf64bed1d5f225176d3805ab766741d6299e,2023-02-18 14:01:06,Romain Vimont,"Fix demuxer error message

Now that there are several possible codecs, do not hardcode H.264 in the
error message.

Refs 3e517cd40eb50f8afb5137f39b0676fead58902a",False
f4e7085c349fe79fa5744957e26d18a4b035e0c1,2023-02-17 13:03:16,Romain Vimont,"Log non-EPIPE I/O exceptions

On close, the client closes the socket. This wakes up socket blocking
calls on the server-side, by throwing an exception. Since this exception
is expected, it was not logged.

However, other IOExceptions might occur, which must not be ignored. For
that purpose, log only IOException when they are not caused by an EPIPE
error.",False
439a1fd4ed3d7ada4c5098a6d52893dd4e87082a,2023-02-11 14:28:40,Romain Vimont,"Rename 'uid' to 'scid'

A random identifier is generated to differentiate multiple running
scrcpy instances. Rename it from 'uid' to 'scid' (scrcpy id) not to
confuse it with Linux UID.

Fixes #3729 <https://github.com/Genymobile/scrcpy/issues/3729>
Refs 4315be164823d2c8fc44b475b52af79bfee98ff1",False
49eb326ce9beb0a993dce0f2a7beb7dcfc3b1c51,2023-02-11 14:14:33,Romain Vimont,"Extract packet merging

Config packets must be prepended to the next media packet. Extract the
logic to a new sc_packet_merger helper to simplify the demuxer code.",False
f03f32267e8c40301a435b5ec9db9655c852b8f9,2023-02-11 03:48:11,Romain Vimont,"Remove unused parser

Since 1c02b58412db2646ba6e57a7e305d26482b9bc0d, the parser is not used
anymore.",False
45b2e6db5c8df04b85cf646d1744646d1e679c6d,2023-02-10 23:36:17,Romain Vimont,"Log component stopped in finally clause

The message must be logged even when no exception occurs.",False
400a1c69b198103feff9682895529529890c1acc,2023-02-10 23:34:56,Romain Vimont,"Join all threads before end of main

Some calls from separate threads may throw exceptions once the main()
method has returned.",False
730eb1086ad32fbd368a6ded61ef8b79741e5f66,2023-02-10 23:25:43,Romain Vimont,"Properly report demuxer errors

All demuxer errors were reported as ""device disconnected"", even if the
failure was not related to device socket read.",False
4f9e9c6619cdf847e3ee78f480fc4ca642ae7c2c,2023-02-10 23:25:43,Romain Vimont,Prefix UI events constants by SC_,False
953edfd1df95aadb794167274e2be2f1037848fa,2023-02-10 23:25:43,Romain Vimont,"Split codec_id reading

Receive codec id and convert it to AVCodecID separately.

This will allow the caller to distinguish between EOS and unknown codec
id.",False
230b8274b90cd035b94f849165e8a807346c93d3,2023-02-10 23:25:43,Romain Vimont,"Fix error return value

The function returns an enum AVCodecID, not a bool.",False
40866ddc10f35368d25ec05eb2a6cd3d0ebc803e,2023-02-10 23:25:39,Romain Vimont,"Fix demuxer error message

The message applies to all packets, not only config packets.",False
bd56c0abf7287b985702f1d0c24dab56d817969e,2023-02-10 23:16:01,Romain Vimont,"Remove unused codec context

The demuxer does not need any codec context.",False
6524e90c68d5e85ab2acc6177abed3603b4e9f78,2023-02-08 03:41:42,Romain Vimont,"Remove unused constant

This line was committed by error.

Refs 3e517cd40eb50f8afb5137f39b0676fead58902a",False
b4caa483dd6682279170b5ec61963e6239f15072,2023-02-06 15:43:18,Kartik Kushwaha,"Add Fedora instructions in README

Add the command to install the scrcpy package for Fedora directly.

PR #3715 <https://github.com/Genymobile/scrcpy/pull/3715>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f2dee20a207b9906574d9b3d62a0ab2585dade20,2023-02-06 15:37:14,Romain Vimont,"Set power mode on all physical displays

Android 10 and above support multiple physical displays. Apply power
mode to all of them.

Fixes #3716 <https://github.com/Genymobile/scrcpy/issues/3716>",False
d2dce5103832d6a9fc29f56a9795c22e44ceafa1,2023-02-06 15:30:49,Romain Vimont,"Add support for AV1

Add option --codec=av1.

PR #3713 <https://github.com/Genymobile/scrcpy/pull/3713>",False
4342c5637d74de2a6af5a6c83b81060bdf198af4,2023-02-06 15:30:49,Romain Vimont,"Add support for H265

Add option --codec=h265.

PR #3713 <https://github.com/Genymobile/scrcpy/pull/3713>
Fixes #3092 <https://github.com/Genymobile/scrcpy/issues/3092>",False
3e517cd40eb50f8afb5137f39b0676fead58902a,2023-02-06 15:28:45,Romain Vimont,"Add option to select video codec

Introduce the selection mechanism. Alternative codecs will be added in
further commits.

PR #3713 <https://github.com/Genymobile/scrcpy/pull/3713>",False
f70f6cdd3e5ffee2a687f47e8227544788932701,2023-02-03 17:01:28,Romain Vimont,"Simplify server info initialization

Use sc_read16be() to read 16-bit integer fields.",False
87972e2022686b1176bfaf0c678e703856c2b027,2023-02-03 17:01:28,Romain Vimont,"Extract video streaming to a separate class

ScreenEncoder handled both capture/encoding and sending over the
network.

Move the streaming part to a separate VideoStreamer.",False
3aac74e9e945c7fc71c5e54b3c53afe666707af7,2023-02-03 17:01:28,Romain Vimont,"Move variable assignment

Computing eof flag is not necessary if rotation changed.",False
1c82c3923d63985655686dd5884a7a9e9407619e,2023-02-03 17:01:28,Romain Vimont,"Compute relative PTS on the client-side

The PTS received from MediaCodec are expressed relative to an arbitrary
clock origin. We consider the PTS of the first frame to be 0, and the
PTS of every other frame is relative to this first PTS (note that the
PTS is only used for recording, it is ignored for mirroring).

For simplicity, this relative PTS was computed on the server-side.

To prepare support for multiple stream (video and audio), send the
packet with its original PTS, and handle the PTS offset on the
client-side (by the recorder).

Since we can't know in advance which stream will produce the first
packet with the lowest PTS (a packet received later on one stream may
have a PTS lower than a packet received earlier on another stream),
computing the PTS on the server-side would require unnecessary waiting.",False
36d656e91f11718dfe43aceaa27f6a7439e93b7e,2023-02-03 17:01:28,Romain Vimont,Improve workarounds call comments,False
bdbf1f4eb7dac0f00c5419a99f23cd9f05e39871,2023-02-03 17:01:28,Romain Vimont,"Move Workarounds call

Workarounds are not specific to the screen encoder.

Co-authored-by: Simon Chan <1330321+yume-chan@users.noreply.github.com>",False
4177de5880b4f93c03ce30b754b22c57d245ec3a,2023-02-03 17:01:28,Romain Vimont,"Do not expose controller threads

The way the controller executes its events asynchronously is an
implementation detail.",False
6a07e3d470d9b849676a54406fceb44554b68557,2023-02-03 17:01:28,Romain Vimont,"Fix manpage formatting

Only the option arguments must be underlined.",False
9b286ec8a7d014c2a91bbc6d24343f9496724521,2023-01-31 01:27:54,Simon Chan,"Inject additional ACTION_BUTTON_* events for mouse

On mouse click events:
 - the first button pressed must first generate ACTION_DOWN;
 - all button pressed (including the first one) must generate
   ACTION_BUTTON_PRESS;
 - all button released (including the last one) must generate
   ACTION_BUTTON_RELEASE;
 - the last button released must in addition generate ACTION_UP.

Otherwise, Chrome does not work properly.

Fixes #3635 <https://github.com/Genymobile/scrcpy/issues/3635>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8c5c55f9e193be8a195b885799ba84377c413cc5,2023-01-31 01:27:54,Simon Chan,"Fix mouse pointer state update

If the pointer is a mouse, the pointer is UP only when no buttons are
pressed (not when a button is released, because there might be other
buttons still pressed).

Refs #3635 <https://github.com/Genymobile/scrcpy/issues/3635>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0afef0c6349e3c79ebcdc24d955f61fdc27c42f4,2023-01-31 01:27:54,Simon Chan,"Forward action button to device

On click event, only the whole buttons state was passed to the device.
In addition, on ACTION_DOWN and ACTION_UP, pass the button associated to
the action.

Refs #3635 <https://github.com/Genymobile/scrcpy/issues/3635>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
07806ba9159b1f4dbd2ede77b110e254af1fd7f6,2023-01-31 01:25:51,Romain Vimont,"Retry on spurious error

MediaCodec may fail spuriously, typically when stopping an encoding and
starting a new one immediately (for example on device rotation).

In that case, retry a few times, in many cases it should work.

Refs #3693 <https://github.com/Genymobile/scrcpy/issues/3693>",False
a52053421abee7c96b1071a06cb68bbeac2fd464,2023-01-29 19:19:36,Romain Vimont,"Extract retry handling

Move the code to downscale and retry on error out of the catch-block.

Refs 26b4104844fb9516be13ff1f2be34e2945090e79",False
a9b2697f3e3d43f329d43ee091516fbd4270b136,2023-01-28 03:13:16,Romain Vimont,"Move local variables declarations

This makes it clear that these local variables are only passed to
setDisplaySurface().",False
b53d2c66e0549d434b187f39f3a7d71e27e64a79,2023-01-28 03:09:28,Romain Vimont,"Remove useless setSize() method

Inline its content. It makes the logic of internalStreamScreen() more
readable (it reduces the number of indirections).",False
6cccf3ab2a67e0353d746dc00e8adf0893c56e55,2023-01-28 03:08:37,Romain Vimont,"Remove useless configure() method

Inline its single call.",False
52f85fd6f150907818ccd1213719c1d21aa4684d,2023-01-28 03:01:09,Romain Vimont,"Keep the same MediaCodec instance across sessions

Calling codec.reset() is sufficient.",False
91c69ad95c639f8c6b84ed71165323227d92e676,2023-01-28 02:58:11,Romain Vimont,"Remove useless destroyDisplay() method

The method made exactly one simple call. Just make the call directly.",False
75d7c01a0c6be9495edf05eb84d081c892bab414,2023-01-28 02:56:01,Romain Vimont,"Keep the same display binder across sessions

Do not destroy/recreate the display when starting a new encoding session
(on device rotation for example).",False
74d32e612db1dfb26900d0a11a98f3a20a27ecfd,2023-01-28 02:50:35,Romain Vimont,"Terminate loop explicitly on interrupted

Make explicit that the loop terminates when the current thread is
interrupted.",False
bdba55411829ab84112f6b62f2a72907639afc98,2023-01-28 02:46:36,Romain Vimont,Use Java lambdas where possible,False
234ad7ee78e6b466757da4b57a5899d0f081affe,2023-01-28 02:38:25,Romain Vimont,"Support Java lambdas in build_without_gradle.sh

Building Java source code using lambdas requires core-lambda-stubs.jar.

Refs #3657 <https://github.com/Genymobile/scrcpy/issues/3657>",False
8cbbcc939f95f4f5660503233b73f520b1fffdce,2023-01-28 02:38:17,Romain Vimont,Add missing final modifiers,False
b22810b17c1319f02919af493aa174db5d2e174e,2023-01-28 02:29:26,Romain Vimont,"Use try-with-resources

Replace an explicit try-finally by a try-with-resources block.",False
4315be164823d2c8fc44b475b52af79bfee98ff1,2023-01-28 02:21:59,Romain Vimont,"Use random name for device socket

For the initial connection between the device and the computer, an adb
tunnel is established (with ""adb reverse"" or ""adb forward"").

The device-side of the tunnel is a local socket having the hard-coded
name ""scrcpy"". This may cause issues when several scrcpy instances are
started in a few seconds for the same device, since they will try to
bind the same name.

To avoid conflicts, make the client generate a random UID, and append
this UID to the local socket name (""scrcpy_01234567"").",False
74e3f8b2531ee873c3555060d5b02791a325553a,2023-01-27 23:56:19,Romain Vimont,"Add random util

Add a user-friendly tool to generate random numbers.",False
059ec45f8244ac3b01cf024c5182c77cb40c76d9,2023-01-26 22:41:23,Romain Vimont,"Add jrand48()/nrand48() compat functions

These functions are not available on all platforms.",False
e6cd42355b773bd0e9613ca9fb5f8364352ac38b,2023-01-26 15:14:31,Romain Vimont,"Use separate gen dir to build without gradle

The generated source files were written to the classes dir. Use a
separate gen dir instead.",False
87da1372380ebddb60e4d89cff9a251c866e21c5,2023-01-18 19:07:55,Romain Vimont,"Remove ""on Linux"" in FAQ

HID now works on all platforms.",False
b3f626feee7efd34e1d7417a4b6fcfcdfd735d89,2023-01-03 13:18:46,Romain Vimont,"Add FAQ section about HID/OTG on Windows

Refs #3654 <https://github.com/Genymobile/scrcpy/issues/3654>",False
bf8696d02e2fdc81854909b43513981b20228f13,2023-01-02 20:48:23,Romain Vimont,"Avoid unnecessary copy on config packets demuxing

Use av_packet_ref() to reference the packet without copy.

This also simplifies the logic, by making the ""offset"" variable and the
memcpy() call local to the if-block.",False
d8c2fe6ef2279769089fb617e93735217a8668b4,2022-12-26 17:12:59,Romain Vimont,"Revert ""Remove continuous resizing workaround for Windows""

This reverts commit 18082f60697ae8edad2db950637638c8bb6bf0d2.

I can't reproduce, but it seems the workaround improves the behavior on
some Windows versions.

Fixes #3640 <https://github.com/Genymobile/scrcpy/issues/3640>
Refs #3458 <https://github.com/Genymobile/scrcpy/issues/3458>",False
54c7baceac11626618392f4312d592fd97238dff,2022-12-22 17:37:07,Romain Vimont,"Use ""meson setup"" from install_release.sh

Refs 64821466a1ddcdf7f0a50fa39067f066284ef9ca",False
4c43784fd1e4e0fad8e3816b240bda5694ea0717,2022-12-22 17:14:01,Romain Vimont,Update links to v1.25,False
fe21158c2023017df39ee7ecc6462579a1f3fe45,2022-12-22 17:03:29,Romain Vimont,Bump version to 1.25,False
8e0c89921856c495a102e30db27d52060aa176dd,2022-12-22 17:03:08,Romain Vimont,"Upgrade FFmpeg (5.1.2) for Windows 64-bit

Use the latest version of FFmpeg in Windows 64-bit releases.",False
725a922271170706ef29c8883f179f71a89e21ab,2022-12-22 16:59:08,Romain Vimont,"Upgrade SDL (2.26.1) for Windows

Include the latest version of SDL in Windows releases.",False
b5773a6fe8f6b6cc84594418fc64bcd40eba9b2f,2022-12-22 16:59:08,Romain Vimont,"Upgrade platform-tools (33.0.3) for Windows

Include the latest version of adb in Windows releases.",False
67fb457dcb014d8a9704ef18831ee338a64a41c1,2022-12-22 16:59:00,Romain Vimont,Merge branch 'master' into dev,True
c7b1d0ea9af8bb9603ec8f713f1a5fbf3f628b6a,2022-12-22 15:56:26,Pawel Jasinski,"Force mouse source when --forward-all-clicks

Right click and middle click require the source device to be a mouse,
not a touchscreen. Therefore, the source device was changed only when a
button other than the primary button was pressed (see
adc547fa6e8e6167cd9633a97d98de6665b8c23a).

However, this led to inconsistencies between the ACTION_DOWN when a
secondary button is pressed (with a mouse as source device) and the
matching ACTION_UP when the secondary button is released (with a
touchscreen as source device, because then there is no button pressed).

To avoid the problem in all cases, force a mouse as source device when
--forward-all-clicks is set.

Concretely, for mouse events in --forward-all-clicks mode:
 - device source is set to InputDevice.SOURCE_MOUSE;
 - motion event toolType is set to MotionEvent.TOOL_TYPE_MOUSE;

Otherwise (when --forward-all-clicks is unset, or for real touch
events), finger events are injected:
 - device source is set to InputDevice.SOURCE_TOUCHSCREEN;
 - motion event toolType is set to MotionEvent.TOOL_TYPE_FINGER.

Fixes #3568 <https://github.com/Genymobile/scrcpy/issues/3568>
PR #3579 <https://github.com/Genymobile/scrcpy/pull/3579>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
18082f60697ae8edad2db950637638c8bb6bf0d2,2022-12-22 02:36:43,Romain Vimont,"Remove continuous resizing workaround for Windows

It turns out that the workaround only worked for MacOS.

Refs #3458 <https://github.com/Genymobile/scrcpy/issues/3458>
Refs SDL/#1059 <https://github.com/libsdl-org/SDL/issues/1059>",False
8b38b11875eee81186adebe709ef0fcfd68d88ab,2022-12-21 18:01:18,Romain Vimont,"Add parent directory in release zipfile

This avoids to mistakenly extract all the files in the current
directory.",False
64821466a1ddcdf7f0a50fa39067f066284ef9ca,2022-12-21 17:59:27,Romain Vimont,"Use ""meson setup""

This fixes the following warning:

> WARNING: Running the setup command as `meson [options]` instead of
> `meson setup [options]` is ambiguous and deprecated.",False
82cb8ab870140403f244fba80ddf2bc5b26b2d78,2022-12-21 17:58:22,Romain Vimont,"Adapt ClipboardManager for Android 13

A new ""attributionTag"" parameter has been added to the methods
getPrimaryClip(), setPrimaryClip() and addPrimaryClipChangedListener()
of IClipboard.aidl.

Refs <https://android.googlesource.com/platform/frameworks/base.git/+/0e3e509b3bf4d561c26d87213387a290dfd688e3%5E%21/>

Fixes #3497 <https://github.com/Genymobile/scrcpy/issues/3497>",False
b51841e85d22284eb5dda42096dc46197c710daf,2022-12-21 17:58:22,Romain Vimont,Upgrade junit to 4.13.2,False
bd1deffa70832a2ab30b8d060992ca70e3136ba8,2022-12-02 23:39:53,Romain Vimont,"Use current adb port (if any) for --tcpip

If the current adb port is not 5555 (typically 0 because it is not in
TCP/IP mode), --tcpip automatically executes (among other commands):

    adb tcpip 5555

In case adb was already listening on another port, this command forced
to listen on 5555, and the connection should still succeed.

But this reconfiguration might be inconvenient for the user. If adb is
already in TCP/IP mode, use the current enabled port without
reconfiguration.

Fixes #3591 <https://github.com/Genymobile/scrcpy/issues/3591>",False
6469b55861a820e7b7d897376acd3f1f4988e689,2022-11-24 13:57:10,Romain Vimont,"Fix CommandParserTest code style

Make checkstyle happy.",False
c00a9ead5e383b00d6b36464c2b234909720f095,2022-11-17 13:57:05,Romain Vimont,"Always use --key=value in README

Mandatory arguments may be passed in either of these two forms:
 1. --key value
 2. --key=value

Optional argument may only be passed in the second form.

For consistency, always document using --key=value.

Refs f76fe2c0d4847d0e40d8708f97591abf3fa22ea5",False
597703b62e05faea3c556565e0add4cff6bb54e6,2022-11-12 22:45:45,SeungHoon Han,"Fix DisplayInfo parsing for Android Q

The DisplayInfo dump format has slightly changed in AOSP:
<https://android.googlesource.com/platform/frameworks/base.git/+/1039ea50f3e1944f5d670cfdeadfdb17b3442ed7>

PR #3573 <https://github.com/Genymobile/scrcpy/pull/3573>
Ref #3416 <https://github.com/Genymobile/scrcpy/pull/3416>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
48bb6f2ea858a02e05900d9828c0089166de17df,2022-10-24 03:15:00,Yu-Chen Lin,"Support wchar_t in argv for Windows

PR #3547 <https://github.com/Genymobile/scrcpy/pull/3547>
Fixes #2932 <https://github.com/Genymobile/scrcpy/issues/2932>

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d71587e39ba0d0c1541629a2cc8dce443de6581d,2022-10-23 16:01:44,Yu-Chen Lin,"Avoid string concatenation in crossfiles

This feature is not supported on older meson versions:

    ERROR: Malformed value in cross file variable prebuilt_libusb.

Refs <https://github.com/mesonbuild/meson/issues/3878>
PR #3546 <https://github.com/Genymobile/scrcpy/pull/3546>

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b62424a98abe301a23525befe7d97cb2dd141ea5,2022-10-19 18:47:43,Romain Vimont,"Build log.c for test_cli

On Windows, sc_log_windows_error() is called from net.c, so log.c must
also be compiled.

Fixes #3542 <https://github.com/Genymobile/scrcpy/issues/3542>",False
ffc7b9169303374f3bf3cae3ea3251111f9ab825,2022-10-19 18:44:56,Romain Vimont,Add missing include <string.h> for strlen(),False
cb46e4a64ae33054a019c70479e2cf71e2a1970d,2022-10-19 18:43:55,Romain Vimont,Add missing include <string.h> for memmove(),False
16e2c1ce26d0bd73b914530263a46e3ea6c7ba6c,2022-10-12 16:54:43,Anima C13,"Add -s auto-completion for zsh

Fixes #3522 <https://github.com/Genymobile/scrcpy/pull/3522>
PR #3523 <https://github.com/Genymobile/scrcpy/pull/3523>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1bfbadef9658c50d8d6206a2114785cdfa176bdf,2022-10-12 16:54:43,Anima C13,"Add -s auto-completion for bash

Fixes #3522 <https://github.com/Genymobile/scrcpy/pull/3522>
PR #3523 <https://github.com/Genymobile/scrcpy/pull/3523>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
40644994e8fb400dfd298810cd05227a7d5915eb,2022-10-02 21:27:35,Romain Vimont,"Make ServiceManager and Settings methods static

There were exactly one instance of ServiceManager and Settings, stored
in Device.

Since a Device instance is not created by the CleanUp executable, it was
not straightforward to call wrapper methods on cleanup.

Remove this artificial restriction and expose them publicly via static
methods (this is equivalent to expose a singleton, but less verbose).",False
7505f7117e19de18e405a3662a38523bf7d20209,2022-09-27 17:42:37,Romain Vimont,Fix typo in logs,False
949b64dff2efe23039fa4801fbc95ef46e208477,2022-09-25 19:52:51,SeungHoon Han,"Add fallback to get DisplayInfo

PR #3416 <https://github.com/Genymobile/scrcpy/pull/3416>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
00e9e69c2a198974d992d8bcbb97866f10da4e9f,2022-09-25 19:12:33,Romain Vimont,"Use /dev/null instead of closing fds

Some adb commands do not like when stdin, stdout or stderr are closed
(they hang forever). Open /dev/null for each.",False
4a5cdcd3908b5bdce7e8528d9045553a6019faa6,2022-09-25 17:56:07,Romain Vimont,"Extract $BUILD_TOOLS_DIR

In the script to build without gradle, the build-tools full path is used
at several places. Use a separate variable for readability.",False
e5e210506f62ded9417b252d059ed79505e3b4eb,2022-09-09 22:36:29,Romain Vimont,"Add scrcpy-console.desktop

Add a launcher which opens a terminal, and keep it open in case of
errors (so that the user has time to read error messages).

The behavior is the same as scrcpy-console.bat on Windows.

PR #3351 <https://github.com/Genymobile/scrcpy/pull/3351>",False
a2a22f497f38daa35b5dc42b5e93f06f3b37a3cc,2022-09-09 22:36:29,Chih-Hsuan Yen,"Use shell environment to execute launcher

Make Exec= compatible with $PATH configured in .bashrc or .zshrc…

PR #3351 <https://github.com/Genymobile/scrcpy/pull/3351>
Refs #296 <https://github.com/Genymobile/scrcpy/pull/296#discussion_r224987002>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
51a1762cbd3fc522bdb81afe58962277b8af8a04,2022-09-09 22:36:29,Addison Snelling,"Add desktop entry file for Linux app launchers

Refs <https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html>

PR #3351 <https://github.com/Genymobile/scrcpy/pull/3351>
Replaces PR #296 <https://github.com/Genymobile/scrcpy/pull/296>
Fixes #295 <https://github.com/Genymobile/scrcpy/issues/295>
Fixes #748 <https://github.com/Genymobile/scrcpy/issues/748>
Fixes #1636 <https://github.com/Genymobile/scrcpy/issues/1636>

Co-authored-by: Chih-Hsuan Yen <yan12125@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c1ec1d1023e9056195a386200fedf5f038c3ea6f,2022-09-09 22:36:29,Romain Vimont,"Replace hardcoded 'share/' by datadir variable

Meson defines a variable for the data directory.

PR #3351 <https://github.com/Genymobile/scrcpy/pull/3351>",False
0a0a446ea6d790420c3d52eb1e6d4afebd086b35,2022-09-02 18:12:37,Romain Vimont,Upgrade Android SDK to 33,False
fccfc43b9ed702480dcf89cc446b35f90b673b18,2022-09-02 18:10:16,Romain Vimont,"Upgrade gradle build tools to 7.2.2

Plugin version 7.2.2.
Gradle version 7.3.3.

Refs: <https://developer.android.com/studio/releases/gradle-plugin#updating-gradle>",False
121bb71dfe15bbb8797acf47f02f60a043817762,2022-09-02 18:01:15,Romain Vimont,"Move from jcenter() to mavenCentral()

Refs <https://developer.android.com/studio/build/jcenter-migration>
Refs <https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/>",False
57056d078ddcac73fe10fcb41395ed21f3d486b6,2022-08-28 18:53:08,Simon Chan,"Use precise scrolling values

Since SDL 2.0.18, the amount scrolled horizontally or vertically is
exposed as a float (between 0 and 1). Forward a precise value to the
Android device when possible.

Refs <https://wiki.libsdl.org/SDL_MouseWheelEvent>
Fixes #3363 <https://github.com/Genymobile/scrcpy/issues/3363>
PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1f138aef41de651668043b32c4effc2d4adbfc44,2022-08-28 18:53:08,Romain Vimont,"Add conversion from float to fixed-point i16

To encode float values between -1 and 1.

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
1ab6c19486b43c55a14c0a309f34cd081bfab85d,2022-08-28 18:53:08,Romain Vimont,"Add unit test for float encoding

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
fd3483c83730a0a59f7b731e9cceabacb759ab20,2022-08-28 18:53:08,Romain Vimont,"Extract conversion from float to u16 fixed-point

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
041cdf6cf5a5afa0d7794c89c5e477c67b31af24,2022-08-28 18:53:08,Romain Vimont,"Rename buffer_util.h to binary.h

It will allow to expose more binary util functions not related to
buffers.

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
136ab8c19902e1b41915dabb23e36945e5b6e394,2022-08-28 18:53:08,Romain Vimont,"Add unit test for float decoding

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
3848ce86f118496467ebd91b40dbf571e2a29e24,2022-08-28 18:53:08,Romain Vimont,"Extract conversion from u16 fixed-point to float

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
5b8e9aa0e95dd5e4aa234dfcbd0445005d197bf0,2022-08-28 18:53:08,Romain Vimont,"Move toUnsigned() to a Binary util class

PR #3369 <https://github.com/Genymobile/scrcpy/pull/3369>",False
3a66b5fd01f23ea24c1c540267fdd86a68a958a8,2022-08-28 18:46:31,Romain Vimont,"Remove deprecated meson.source_root()

This method is deprecated since Meson 0.56.0:
<https://mesonbuild.com/Release-notes-for-0-56-0.html#mesonbuild_root-and-mesonsource_root-are-deprecated>

We could replace it with meson.project_source_root(), but this would
make Meson 0.56 or above mandatory. Since the path in always computed
from the server/ directory, just add '..' to reference the root project
directory.

Refs c456e3826470753bdaefcffc93e9ae1bf25b12f7",False
72ba913324d65cded8672dca7a57415cb82da095,2022-08-28 18:43:03,Romain Vimont,"Move README and FAQ translations to the wiki

This lowers the barrier to contribute to translations, and frees up my
maintenance time used to review and merge translations and their updates
in many languages.",False
77ebe786ea18ed0a049107231668bb48c5f32d01,2022-08-21 17:22:51,Romain Vimont,Fix FAQ formatting,False
9c1722f42846859866d26823a8f6cf07495ab803,2022-08-19 21:33:38,Derek Wu,"Use DisplayManagerGlobal instance

Use the client instance to communicate with the DisplayManager server.

Fixes #3446 <https://github.com/Genymobile/scrcpy/issues/3446>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d19606eb0cd51b532177f80d3a9bc6619be304de,2022-08-17 20:10:45,Romain Vimont,"Rename net_listen() parameter

For consistency with net_accept(), which necessarily uses a server
socket, name the net_listen() parameter ""server_socket"".",False
d23b3e88a4010716a50502da03c8326c2d0a1e81,2022-08-04 02:55:09,Romain Vimont,"Replace '%g' by '%f' as printf format

For some reason, '%g' does not work correctly with MinGW.

Refs #3369 <https://github.com/Genymobile/scrcpy/pull/3369>
PR #3399 <https://github.com/Genymobile/scrcpy/pull/3399>",False
a47848f304965fe4baf548697ae79ed8db73e8b3,2022-07-27 18:24:27,Romain Vimont,"Detect Windows using _WIN32 in network util

For consistency, always use _WIN32 instead of a mix of __WINDOWS__ and
_WIN32.",False
db8c1ce8e1e4a7d3f96fad7d36a281798f529453,2022-07-20 15:11:04,Romain Vimont,"Fix protocol documentation in comments

Flags were in the correct order in the schema, but their description
were reversed.",False
4aeb78ece280d44607eda23f7996bae3d0c9415a,2022-07-19 15:47:02,Romain Vimont,Add missing allocation failure check,False
396e4bd9258cba5c841cc40a02e7fea0819f2c7f,2022-07-19 15:45:06,Romain Vimont,Add missing LOG_OOM() on malloc failure,False
7f2f5950f2624c1a3fd847af6248bcbef71a3124,2022-06-21 00:53:05,Romain Vimont,"Remove useless dependencies reference

There is no libs/ directory with local jar files.",False
ed84e18b1ae3e51d368f8c7bc88ba4db088e6855,2022-06-17 12:14:17,Romain Vimont,"Document envvars for all platforms

Document how to set environment variables from the terminal for bash,
cmd and PowerShell.",False
a83c3e30f3afbe1e0008dc50f769bb06fcdf0a87,2022-06-17 12:06:58,Romain Vimont,"Fix environment variable configuration in FAQ

In bash, the variable is set using ""export"".",False
af4b7855e115878b7b87c7fe2e719d62c07af40d,2022-06-09 18:32:42,Romain Vimont,"Remove unused stream.h

The file was not removed by 7dec225cebbf208cf1d607bd45fb49e3a9fa1167.",False
b1d8c7278054f33fffb57b163a1bf07aaba53305,2022-06-09 18:32:42,Romain Vimont,"Rename function to simplify

For consistency with sc_adb_parse_device(), do not include ""from_output""
in the function name.",False
55e65fa270643519d55d12d73d628d02e73de464,2022-06-09 18:32:42,Romain Vimont,Add missing return 0 in tests,False
69fb5f6ee118f1e732c58f3b190e5cb4f1edc575,2022-06-09 18:32:42,Romain Vimont,"Fix function declarations

Add missing void in function parameters list.",False
faf4535487926853250ebe842c76a40e7b5f8ceb,2022-04-29 01:04:56,Romain Vimont,"Reduce SHA-256 size in README and BUILD

This avoids breaking the page layout on GitHub.",False
3a99e129e628911dde73f486aece1ca3ebe06ead,2022-04-29 00:33:03,Romain Vimont,Update links to v1.24,False
ef13d394fd83a2c534d86f2dbc188f4324a6ee34,2022-04-29 00:16:28,Romain Vimont,Bump version to 1.24,False
0049893e10b98a8cd1bca7b0d022d64d40ff7f3f,2022-04-29 00:16:19,Romain Vimont,Merge branch 'master' into dev,True
2f038c834a5f891d20095ed1fe7c44a05d6760e0,2022-04-29 00:15:46,Romain Vimont,"Revert ""Make OTG window resizable""

On Windows and macOS, resizing blocks the event loop. Handling it
properly would require the same workaround as done in screen.c.

This reverts commit 436b368f9df4469274502f29626586b48db44a0c.",False
76b3fcf9863ce42de4057b583f9261104c78cda1,2022-04-29 00:15:46,Romain Vimont,"Fix inverted check

SDL_RenderSetLogicalSize() returns 0 on success.

Refs fc8942aa03dd18b20d6b2e450b13ba56d2c3489e",False
05d84084efb07d07673123427c31331ca0de4f2c,2022-04-29 00:15:38,Romain Vimont,"Fix release script for platform-tools 33.0.1

These paths were not updated by commit
b8d78743f7fbe7aefed957f41e68efc4791573ba.",False
471a360099f73d6a3fa3ea5abb7d5b8f59b23415,2022-04-28 23:20:35,Romain Vimont,Use quotes for commands in documentation,False
349dcd8e7b501d39ab2b854378a1974e38f3dac2,2022-04-28 23:19:34,Romain Vimont,Update installed files list in BUILD documentation,False
f9e3275d4e77394e19ac789ea46e16a244ec4dfe,2022-04-28 23:02:14,Romain Vimont,"Upgrade FFmpeg (5.0.1) for Windows 64-bit

Use the latest version of FFmpeg in Windows 64-bit releases.",False
91706ae3d079abafa009c574845ddb12377588aa,2022-04-28 22:53:59,Romain Vimont,"Upgrade SDL (2.0.22) for Windows

Include the latest version of SDL in Windows releases.",False
854a56e58893da352410d6e01708704f550fd6e4,2022-04-28 22:48:16,Romain Vimont,"Enable linear filtering in OTG mode

This improves the icon quality with non-standard window size.

PR #3219 <https://github.com/Genymobile/scrcpy/pull/3219>",False
436b368f9df4469274502f29626586b48db44a0c,2022-04-28 22:48:12,Romain Vimont,"Make OTG window resizable

PR #3219 <https://github.com/Genymobile/scrcpy/pull/3219>",False
fc8942aa03dd18b20d6b2e450b13ba56d2c3489e,2022-04-28 22:48:09,Romain Vimont,"Apply requested window size in OTG mode

Fixes #3099 <https://github.com/Genymobile/scrcpy/issues/3099>
PR #3219 <https://github.com/Genymobile/scrcpy/pull/3219>",False
c6d97111097514cdf333689900abafd57ad354ec,2022-04-28 22:47:49,Romain Vimont,"Create OTG window with HIGHDPI flag

This will avoid poor quality with HiDPI displays.

PR #3219 <https://github.com/Genymobile/scrcpy/pull/3219>",False
0fca2ad830dbcc24a9a38b974d922359be40b0d2,2022-04-28 22:42:52,Romain Vimont,"Add option to not power on on start

By default, on start, the device is powered on. To prevent this
behavior, add a new option --no-power-on.

Fixes #3148 <https://github.com/Genymobile/scrcpy/issues/3148>
PR #3210 <https://github.com/Genymobile/scrcpy/pull/3210>",False
326897a0d4ab3ea0cf741cd87f01d2703db38374,2022-04-25 22:05:06,Romain Vimont,"Add missing mouse shortcuts in --help

Document 4th-click and 5th-click shortcuts.

Fixes #3122 <https://github.com/Genymobile/scrcpy/issues/3122>",False
a90dfb46bc2266f93eae5585f84b6a9265dd05c2,2022-04-25 21:55:59,Sean Wei,"Fix GitHub case in BUILD

Replace ""Github"" with ""GitHub"".

PR #3218 <https://github.com/Genymobile/scrcpy/pull/3218>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
85512b14670db9b41606ec9841b8755a86633536,2022-04-25 21:55:59,Sean Wei,"Fix typo in German README

Replace ""Wifi"" with ""Wi-Fi"", as in English and other translations.

PR #3217 <https://github.com/Genymobile/scrcpy/pull/3217>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c05981587f1a322c9d7c16f5ec6e9392f7e98849,2022-04-25 21:55:47,Sean Wei,"Fix typos in Indonesian README

Fix `code` blocks.

PR #3216 <https://github.com/Genymobile/scrcpy/pull/3216>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4db97531e887ef3455548ce09dd6cbff54b630ed,2022-04-22 17:04:58,Romain Vimont,"Upgrade libusb (1.0.26) for Windows

Upgrade and enable libusb support for Windows 32-bit builds.

Refs #3011 <https://github.com/Genymobile/scrcpy/pull/3011>
Fixes #3204 <https://github.com/Genymobile/scrcpy/issues/3204>
PR #3206 <https://github.com/Genymobile/scrcpy/pull/3206>",False
b8d78743f7fbe7aefed957f41e68efc4791573ba,2022-04-22 17:04:11,Romain Vimont,"Upgrade platform-tools (33.0.1) for Windows

PR #3206 <https://github.com/Genymobile/scrcpy/pull/3206>",False
6a4a4a283d4b79f41cf46fc6eb314af4b36cc1a5,2022-04-22 13:22:41,Romain Vimont,"Remove obsolete alternative injection method

The previous commit replaced the IInterface instance (the ""input""
service) by the InputManager instance (retrieved by
InputManager.getInstance()).

Both define an ""injectInputEvent"" method, but the alternate version
(probably) does not concern the InputManager.

This reverts commit b7a06278fee0dbfbb18b651ad563d9fb0797c8bc.

PR #3190 <https://github.com/Genymobile/scrcpy/pull/3190>",False
7d8b72d4a644baf0b8ced72c2313605ad0a32a12,2022-04-22 13:22:41,Romain Vimont,"Adapt event injection to Android 13

Using the ""input"" service results in a permission error in Android 13.

Use the InputManager instance (retrieved by InputManager.getInstance())
instead.

Fixes #3186 <https://github.com/Genymobile/scrcpy/issues/3186>
PR #3190 <https://github.com/Genymobile/scrcpy/pull/3190>",False
3c8ebf9abd4410fd46485db43035e35b3780e8d4,2022-04-16 13:33:52,Gitoffthelawn,"Improve README

Improve clarity, grammar, consistency, punctuation, and formatting.

PR #3177 <https://github.com/Genymobile/scrcpy/pull/3177>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
53b1e16f420d818071840889da52d6ac63b14b4d,2022-04-14 13:48:45,John Veness,"Fix typos/grammar issues in README

PR #3174 <https://github.com/Genymobile/scrcpy/pull/3174>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fc65c6cc4baced6d9758ee54d9fdab57966d09b8,2022-04-14 13:41:03,Alessandro Sarretta,"Update README.it.md to v1.23

PR #3151 <https://github.com/Genymobile/scrcpy/pull/3151>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fa5b2a29e983a46b49531def9cf3d80c40c3de37,2022-04-13 03:29:01,Romain Vimont,Add missing SC_ prefix to header guards,False
0c94887075b4c84532b71cbdbad4f0121ab94099,2022-04-13 03:21:05,Romain Vimont,"Add missing include

Refs c3d45c8397b7886d9071ccd69f04e2c9245fb8e7",False
7b7cfc3a3e463e83067da2669b401338a9826953,2022-04-10 17:27:44,e1e0,"Fix reference to FAQ in README

PR #3065 <https://github.com/Genymobile/scrcpy/pull/3065>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
88543cb5453f74ac611759ff483b6a413f367e1b,2022-03-30 17:30:05,Romain Vimont,"Fix icon path in ./run

The data/ directory has been moved to app/data/.

Refs 36c75e15b8e9eeb01bd287a42fa3f1513a728ebb",False
aaf3869a544d6700032f0a834e047737f18fb145,2022-03-30 15:31:01,Romain Vimont,Fix OpenGL ES prefix skip,False
2edc73e4b80d35acc594adef2d35d99e743befed,2022-03-25 13:08:58,IskandarMa,"Improve README.zh-Hans.md

Fix misleading zoom instruction, which gave opposite action steps.

PR #3126 <https://github.com/Genymobile/scrcpy/pull/3126>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c3d45c8397b7886d9071ccd69f04e2c9245fb8e7,2022-03-23 01:38:08,Romain Vimont,"Consider emulators as TCP/IP devices

Emulators were wrongly considered as USB devices, so they were selected
using -d instead of -e (which was inconsistent with the adb behavior).

Refs #3005 <https://github.com/Genymobile/scrcpy/issues/3005>
Refs #3137 <https://github.com/Genymobile/scrcpy/issues/3137>",False
e56f2ac7a9a3c6bbe8ea3d311e2054f5c1fa1c0d,2022-03-20 19:26:52,Romain Vimont,"Log an error on unexpected device state

Refs #3129 <https://github.com/Genymobile/scrcpy/issues/3129>",False
4ce7af42c635a6e9edd7c67902718d3a2c7f45fd,2022-03-15 13:02:34,Romain Vimont,"Use $ANDROID_SERIAL if no selector is specified

Like adb, read the ANDROID_SERIAL environment variable to select a
device by serial if no explicit selection (-s, -d, -e or --tcpip=<addr>)
is provided via the command line.

Fixes #3111 <https://github.com/Genymobile/scrcpy/issues/3111>
PR #3113 <https://github.com/Genymobile/scrcpy/pull/3113>",False
b1dbc30072bdf4171f7d73532607ca329003094c,2022-03-10 13:43:21,Romain Vimont,"Document exit status in --help

Refs #3085 <https://github.com/Genymobile/scrcpy/pull/3085>",False
b3f5dfe1de03ff8e19225aee08dcbd62d6089d56,2022-03-07 02:49:46,martin f. krafft,"Add specific exit code for device disconnection

Modify the return logic such that exit code 1 is used when the initial
connection fails, but if a session is established, and then the device
disconnects, exit code 2 is emitted.

Fixes #3083 <https://github.com/Genymobile/scrcpy/issues/3083>
PR #3085 <https://github.com/Genymobile/scrcpy/pull/3085>
Signed-off-by: martin f. krafft <madduck@madduck.net>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1f4c801f3c4b2b46d001f705abb921c3f3c8a212,2022-03-07 02:46:13,Romain Vimont,"Report server connection state

We must distinguish 3 cases for await_for_server():
 - an error occurred
 - no error occurred, the device is connected
 - no error occurred, the device is not connected (user requested to
   quit)

For this purpose, use an additional output parameter to indicate if the
device is connected (only set when no error occurs).

Refs #3085 <https://github.com/Genymobile/scrcpy/pull/3085>",False
8d91cda4f61b710caee719609ed9a8c043cb41c8,2022-02-25 03:58:20,Romain Vimont,"Improve HID event push error message

On HID event push failure, add the event type in the error message.",False
59656fe649d8fd46062fd130e41921b53d517bca,2022-02-25 03:56:12,Romain Vimont,Fix typo in error message,False
e4bb2b8728168aebb942bfdeabbba30a29f6b405,2022-02-25 03:55:02,Romain Vimont,"Add libusb error log

Log libusb_get_string_descriptor_ascii() errors.

Refs #3050 <https://github.com/Genymobile/scrcpy/issues/3050>",False
adbe7908c6e05899d8c4a03cd5cbc10209e3d221,2022-02-23 05:51:18,Romain Vimont,"Fix icon path in README

The data/ directory was moved to app/data/.

Refs 36c75e15b8e9eeb01bd287a42fa3f1513a728ebb",False
49434da36ea9bd52907609c08c0b644c2d0d6649,2022-02-23 04:18:00,Romain Vimont,Update links to v1.23,False
7deccef1c2f609870fae00a3a1eb11d0eb2a28a5,2022-02-23 01:31:55,Romain Vimont,Bump version to 1.23,False
977735f916b25f26daae866f971c1afd1866b27a,2022-02-23 01:31:43,Romain Vimont,Merge branch 'master' into dev,True
71ef5cc0a9936f3a1f0f6e1809135953ca74bc98,2022-02-23 01:30:43,Romain Vimont,"Add missing include for vector

Include stdlib.h for realloc().",False
4ab4548769cb3d27052f366f5c1755895b10c375,2022-02-23 00:06:22,Romain Vimont,"Add contact links to the README

Add Reddit and Twitter links (and an additional link to the GitHub
issues).",False
3ce6f8ca91bd28e980943f9346ce6efcbee145b8,2022-02-22 23:52:12,Romain Vimont,"Add Bash completion script

Fixes #2930 <https://github.com/Genymobile/scrcpy/issues/2930>
Refs #3012 <https://github.com/Genymobile/scrcpy/pull/3012>",False
26953784d96c14f66e8b55ec2a1e7a13167ce547,2022-02-22 23:45:27,hltdev8642,"Add ZSH completion script

PR #3012 <https://github.com/Genymobile/scrcpy/pull/3012>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
2716385887291d205716be85a0f209610ab04d9c,2022-02-22 23:42:02,Romain Vimont,"Move ""Device unauthorized"" in FAQ

Put ""Device not detected"" first.",False
1f951f1a3a85377fbcecc6c10aba462517fdab9e,2022-02-22 23:38:15,Romain Vimont,Update FAQ to match the latest version,False
6a9b2f2c36fe48edd451ca019523bff61914e499,2022-02-22 23:01:37,Romain Vimont,Remove spurious empty line,False
ff8a69d8eccac57b53dbebf001d1dce2245ab9b7,2022-02-22 22:57:25,Flying Press,"Mention adb wireless option for Android 11+

Add a paragraph about toggling an option to bypass having to physically
connect the device to the user's computer.

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
16937972770df9ae20f8e5ae5579df15d1b00e57,2022-02-22 22:57:25,Flying Press,"Make step more explicit in wireless section

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8610e9a454048b710eb84b45ce197d8d8b8e5382,2022-02-22 22:57:25,Flying Press,"Add troubleshooting in wireless section

Add a small troubleshooting section since wireless might add some
complexity, and to lessen incoming relevant issue posts.

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
528275d5011189539af1fe7a493755002c5bbbf0,2022-02-22 22:57:25,Flying Press,"Improve phrasing in wireless section

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
78b18b7cee8b0f31ce979d3ddf180370132c4703,2022-02-22 22:57:25,Flying Press,"Renumber steps in wireless section

The actual numbers are ignored by markdown, but start at 1 for
consistency.

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
90816291d499ea0bc759f7d10e3d65d6d4313d81,2022-02-22 22:57:25,Flying Press,"Add an explicit first step in wireless section

Mention that the device must be plugged via USB before configuring
TCP/IP connections.

It wasn't obvious that the device should be first plugged before running
scrcpy wirelessly, especially to those who aren't very familiar with
adb.

Note from committer: add this new step with index 0 to make the diff
readable, the next commit will renumber all the steps.

PR #1303 <https://github.com/Genymobile/scrcpy/pull/1303>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3e0df6ad0586bc435fc1571e8d7fa3953c900f04,2022-02-22 22:57:13,Romain Vimont,"Update HID/OTG features in README

HID/OTG features are not limited to Linux anymore.

Refs 82a99f69ec464a0637a16bdccfe5ff806777e942",False
79ed83ab687a848efaddbfbfd195d4252158fe8d,2022-02-22 22:40:30,Romain Vimont,"Reorder --tcpip option in cli

To keep options in alphabetic order.",False
71b41d846fdcae475e3e735adea8491a2663bbc4,2022-02-22 14:57:11,Romain Vimont,"Also retry on IllegalArgumentException

MediaCodec.configure() may throw an IllegalArgumentException if it does
not support the requested size. Also retry on this exception.

Fixes #2993 <https://github.com/Genymobile/scrcpy/issues/2993>
Refs #2947 <https://github.com/Genymobile/scrcpy/pull/2947>
Refs #2990 <https://github.com/Genymobile/scrcpy/pull/2990>
PR #3043 <https://github.com/Genymobile/scrcpy/pull/3043>",False
e2e76c5d4858530db691a4d8c2bb7a97eaebdfb3,2022-02-21 04:33:45,Romain Vimont,"Increase `adb devices -l` max output size

For simplicity, the parsing of `adb devices -l` output is performed in a
single pass on the whole output.

This output was limited to 4096 bytes. Since there are about 100 chars
per device line, this limited the number of connected devices to ~40.

Increase to 65536 bytes to avoid a limitation in practice.

PR #3035 <https://github.com/Genymobile/scrcpy/pull/3035>",False
4b8cb042c41e29002d562e80809a6b3a9f01e49f,2022-02-21 04:29:35,Romain Vimont,"Use vector for listing ADB devices

This avoids the hardcoded maximum number of ADB devices detected (16).

Refs #3029 <https://github.com/Genymobile/scrcpy/pull/3029>
PR #3035 <https://github.com/Genymobile/scrcpy/pull/3035>

Co-authored-by: Daniel Ansorregui <d.ansorregui@samsung.com>",False
1790e88278dee3779073849287f5084c5a275eb6,2022-02-21 04:29:35,Romain Vimont,"Use vector for listing USB devices

This avoids the hardcoded maximum number of USB devices detected (16).

Refs #3029 <https://github.com/Genymobile/scrcpy/pull/3029>
PR #3035 <https://github.com/Genymobile/scrcpy/pull/3035>",False
c070723bc8b9b60255605c409b7a43329d27b4cd,2022-02-21 04:29:35,Romain Vimont,"Add sc_vector

Adapt vlc_vector [1], that I initially wrote while implementing the VLC
playlist [2].

Change the implementation to use ""statement expressions"" [3], which are
forbidden in VLC because ""non-standard"", but:
 - they are supported by gcc and clang;
 - they are already used in the scrcpy codebase;
 - they avoid implementation hacks (VLC_VECTOR_FAILFLAG_);
 - they allow a better API (sc_vector_index_of() may return the result
   without an output parameter).

PR #3035 <https://github.com/Genymobile/scrcpy/pull/3035>

[1]: https://code.videolan.org/videolan/vlc/-/blob/0857947abaed9c89810cd96353aaa1b7e6ba3b0d/include/vlc_vector.h
[2]: https://blog.rom1v.com/2019/05/a-new-core-playlist-for-vlc-4
[3]: https://gcc.gnu.org/onlinedocs/gcc/Statement-Exprs.html",False
36c75e15b8e9eeb01bd287a42fa3f1513a728ebb,2022-02-20 22:26:50,Romain Vimont,"Move data/ to app/

The files in data/ are specific to the client app (not the server).

This also avoids to reference the parent directory (../) from
app/meson.build.

Refs 8d583d36e259ba7f5f21d7a703cca73184200aa9",False
d9bc5082ab24d214928be499f70c2aaed107b0df,2022-02-20 22:09:52,Romain Vimont,"Disable USB features for win32

Currently, there is an issue with the libusb prebuilt dll.

Refs libusb/#1049 <https://github.com/libusb/libusb/issues/1049>
PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
73a5311ac6c6570f1c9d23cd943c8d9aa0b281fe,2022-02-20 22:09:42,Romain Vimont,"Forbid HID input without OTG on Windows

On Windows, if the adb daemon is running, opening the USB device will
necessarily fail, so HID input is not possible.

Refs #2773 <https://github.com/Genymobile/scrcpy/issues/2773>
PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
25296ae16710c0c7bf69e60f4e1aa952e0443075,2022-02-20 22:09:39,Romain Vimont,"Kill adb daemon in OTG mode on Windows

On Windows, it is not possible to open a USB device from several
process, so HID events may only work if no adb daemon is running.

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
3bb24b3926a2db0fa38393c829b4e703471c0fcc,2022-02-20 22:09:36,Romain Vimont,"Make intr optional for adb commands

All adb commands are executed with an ""interruptor"", so that they can be
interrupted on Ctrl+C.

Make this interruptor optional, so that we could call ""adb kill-server""
in OTG mode. This command always returns almost immediately anyway.

Ideally, we should make all blocking calls interruptible (including
libusb calls, by using the asynchronous API), but it's a lot of work,
and in practice it works well enough.

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
6ee75c0cff3eb995486901757e682f960516b6b0,2022-02-20 22:09:30,Romain Vimont,"Remove obsolete text in error message

The HID/OTG features are now available on all platforms.

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
6b65cd405a56d09b00a609ef43f2846c2cc349f7,2022-02-20 22:09:12,Romain Vimont,"Build for Windows with libusb support

Fixes #2773 <https://github.com/Genymobile/scrcpy/issues/2773>
PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
ff3cb31cb4a5d58354e6a7b59c6e2486091ff691,2022-02-20 22:09:09,Romain Vimont,"Fix libusb callback for Windows

Add LIBUSB_CALL so that the callback has the correct signature on
Windows (including __attribute__((stdcall))).

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
06243e7c3cd313e2d4d4b34fe0d2c3f35d9aee6d,2022-02-20 22:09:04,Romain Vimont,"Avoid PRIx16 printf format on Windows

Convert uint16_t to unsigned to avoid using PRIx16, which may not exist
on Windows.

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
b9b28797893c9449b89b44e1c0ac209a5358cca5,2022-02-20 22:08:51,Romain Vimont,"Remove USB hotplug callback error log

If it fails, the error is already logged by sc_usb_register_callback().

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
be1936bb85de6a19a805ed320dcabe217e52d656,2022-02-20 22:08:14,Romain Vimont,"Report USB device disconnection when detected

USB device disconnection is detected via a hotplug callback when it is
supported.

In addition, report disconnection on libusb calls returning
LIBUSB_ERROR_NO_DEVICE or LIBUSB_ERROR_NOT_FOUND. This allows to detect
disconnection after a libusb call when hotplug is not available.

PR #3011 <https://github.com/Genymobile/scrcpy/pull/3011>",False
3ee3f8dc027fe4e2d21ef144df4c29acbd709ee7,2022-02-20 21:58:02,Romain Vimont,"Work around mouse capture SDL bug on macOS

On macOS, SDL relative mouse mode does not work correctly when the
cursor is outside the window.

As a workaround, move the cursor inside the window before setting the
relative mouse mode.

Refs SDL/#5340 <https://github.com/libsdl-org/SDL/issues/5340>
PR #3031 <https://github.com/Genymobile/scrcpy/pull/3031>",False
9db42341e4934989921099c60e307c847eb625b6,2022-02-20 21:57:53,Romain Vimont,"Pass screen instance to mouse capture functions

Using the screen instance or not in these functions is an implementation
detail. Further changes will require the screen instance.

Refs 7848a387c8281cb156f0e0da6bbbb05cda31db22
PR #3031 <https://github.com/Genymobile/scrcpy/pull/3031>",False
82a99f69ec464a0637a16bdccfe5ff806777e942,2022-02-20 21:57:43,Romain Vimont,"Remove ""linux-only"" mentions for HID/OTG features

HID/OTG features are not limited to Linux anymore.

PR #3031 <https://github.com/Genymobile/scrcpy/pull/3031>",False
33202491e13fa44f894a5f4256c7be1f3eaf7551,2022-02-20 21:57:22,Romain Vimont,"Build on macOS with libusb support

Fixes #2774 <https://github.com/Genymobile/scrcpy/issues/2774>
PR #3031 <https://github.com/Genymobile/scrcpy/pull/3031>",False
b4fd882ece2e673f084b7820b7a8925a86c9bfce,2022-02-20 21:51:25,Romain Vimont,Fix typo,False
c4ab65eb790b8b88d561f1cbcbda5afbabd93bfe,2022-02-19 01:48:36,Romain Vimont,Remove useless '\n' in log,False
6edf50d447874f3bb93cbccff52c92f528d7aa9a,2022-02-19 00:04:54,Romain Vimont,"Remove fprintf() in tests

It was committed by mistake.",False
4b018be78907eec4d85e24e64402e1fbb5860aea,2022-02-18 22:46:50,Romain Vimont,"Add --print-fps to enable FPS counter on start

The FPS counter could be enabled/disabled via MOD+i.

Add a command line option to enable it on start. This is consistent with
other features like --turn-screen-off or --fullscreen.

Fixes #468 <https://github.com/Genymobile/scrcpy/issues/468>
PR #3030 <https://github.com/Genymobile/scrcpy/pull/3030>",False
fa93c8a91b6ea6ce82e61b05c0c3b96da9c589c7,2022-02-18 22:46:12,Romain Vimont,"Move FPS counter start/stop logs

This will allow to print the same logs for every start/stop call.

PR #3030 <https://github.com/Genymobile/scrcpy/pull/3030>",False
0e22032710728baf3c78d20a53e89cba202138ec,2022-02-18 22:43:35,Romain Vimont,"Update FAQ about Windows scaling behavior

Recommend to update to v1.22 before suggesting manual configuration.

Fixes #3028 <https://github.com/Genymobile/scrcpy/issues/3028>
PR #3032 <https://github.com/Genymobile/scrcpy/pull/3032>",False
03705b828b0a03ce982ac890bd595d4c43b71f7b,2022-02-18 00:25:24,Romain Vimont,Use sc_prefix for fps counter,False
7a138c6929026b8dee103027ab91182533c6d8d0,2022-02-17 01:14:09,Firq,"Fix links in German README

There were three links that weren't displayed correctly due to incorrect
references:
 - the Windows release link to `README.md#windows`
 - 2 links that expected a German reference but got an English reference

PR #3026 <https://github.com/Genymobile/scrcpy/pull/3026>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
85edba20e79cdbde5295696ecc4950f584819899,2022-02-16 22:59:30,Romain Vimont,"Enforce deadline reached on timeout

The value of sc_tick_now() has microsecond precision, but
sc_cond_timedwait() has only millisecond precision.

To guarantee that sc_tick_now() >= deadline when sc_cond_timedwait()
returns due to timeout, round up to the next millisecond.

This avoids to call a non-blocking sc_cond_timedwait() in a loop for no
reason until a target deadline during up to 1 millisecond.

Refs 682a6911735cb8f6dccd9653ce30b72f267235c6",False
2a872c3865ad3446cbf64ed72dbfa846110d675d,2022-02-16 22:42:57,Romain Vimont,"Fix fps_counter tick type

The type uint32_t is not sufficient to store the result of
sc_tick_now().

As a consequence, the FPS counter entered a live loop and caused a lock
starvation (deadlock in practice).

Refs ec871dd3f596a8183e37982821645ac5a5791fe0
Refs 682a6911735cb8f6dccd9653ce30b72f267235c6",False
b58b566fa5c1d7b5c5386399b592d203d7dd9bbf,2022-02-16 02:22:08,Firq,"Add German translation of README.md

PR #3023 <https://github.com/Genymobile/scrcpy/pull/3023>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ccbe370cc52c5cd4315aec0d153b4108e6237498,2022-02-15 23:55:57,Romain Vimont,"Add --no-cleanup option

It might be useful not to cleanup on exit, for example to leave the
screen turned off, or keep the server binary on the device (via the
server option ""cleanup=false"").

Fixes #1764 <https://github.com/Genymobile/scrcpy/issues/1764>
PR #3020 <https://github.com/Genymobile/scrcpy/pull/3020>",False
bb991f829cda06e024caa613ae91c34f4cc908b7,2022-02-13 21:56:34,Romain Vimont,"Fix order of options

In alphabetic order, ""no-clipboard-autosync"" is before
""no-downsize-on-error"".",False
ca9e1a05148d46793de0118a8cbcef62877df534,2022-02-12 18:45:07,Romain Vimont,"Add compilation flag for USB features

This allows to disable HID/OTG features on Linux to build without
libusb.",False
cc27771dd18529fafc450529615c72582104991f,2022-02-12 18:45:07,Romain Vimont,"Add compilation flag for V4L2 feature

This allows to disable V4L2 support on Linux to build without
libavdevice.",False
d0ab8c0e7beb33c3a2f31c735a56a58277038be1,2022-02-12 18:45:02,Romain Vimont,"Fix double adb tunnel closing

On error, close the adb tunnel only if it has not already been closed
beforehand.",False
5c62f3419d252d10cd8c9cbb7c918b358b81f2d0,2022-02-12 13:42:46,Romain Vimont,Rename buffer util functions with sc_ prefix,False
044acc2259f2898730ef1ccd4d780e69e3705614,2022-02-12 02:04:58,Romain Vimont,"Rename HEADER_SIZE to SC_PACKET_HEADER_SIZE

Prefix the constant for consistency.",False
6fc388f3691ce888331eb04a60014df51df31923,2022-02-12 02:04:12,Romain Vimont,Remove unused BUFSIZE,False
1c02b58412db2646ba6e57a7e305d26482b9bc0d,2022-02-12 02:03:09,Romain Vimont,"Remove sc_demuxer_parse()

Now that the key frame flag is known, parsing the packet is useless.",False
67068e4e3d7ab17de425651848eecea530ac8b88,2022-02-12 02:02:55,Romain Vimont,"Pass key frame flag from the device

MediaCodec indicates when a packet is a key frame. Transmit it to the
client.",False
e3c2398aa208d9f85e6cd5474e3201b8b5f203f9,2022-02-12 02:02:11,Romain Vimont,"Store packet flags in PTS most significant bits

A special PTS value was used to encode a config packet.

To prepare for adding more flags, use the most significant bits of the
PTS field to store flags.",False
29c163959cfe9b25a4f431e7a504905da5309cb7,2022-02-10 13:54:19,Romain Vimont,"Indent ifdef for clarity

Make it explicit that the ifdef is an inner block.",False
4a95c08d56063db10a0456dcdafb1f683cc6be52,2022-02-10 13:24:43,Romain Vimont,Improve error message for unsupported usb hotplug,False
7848a387c8281cb156f0e0da6bbbb05cda31db22,2022-02-10 13:20:18,Romain Vimont,"Do not duplicate relative mouse mode state

The relative mouse mode is tracked by SDL, and accessible via
SDL_GetRelativeMouseMode().

This is more robust in case SDL changes the relative mouse mode on its
own.",False
43ae418752b30738a7bd3fd5beb55b9476697022,2022-02-10 13:17:39,Romain Vimont,"Fix USB device leak on connection error

If sc_usb_connect() failed, then the sc_usb_device was never destroyed.

The assignment was mistakenly removed by commit
61969aeb80093d0777c7716a61698cbdaf9ddd71.",False
8d583d36e259ba7f5f21d7a703cca73184200aa9,2022-02-10 03:48:34,Romain Vimont,"Move prebuilt-deps/ to app/

The prebuilt dependencies are specific to the client app (not the
server).

This also avoids to reference the parent directory (../) from
app/meson.build.",False
8498a2e8a669a28fb1078575a09b32e9f020658d,2022-02-10 03:31:49,Romain Vimont,"Reorder release.mk recipes

Group prepare-deps for win32 and win64.",False
c00a31f1b063280a763b44b61a7cf4aab6576ff6,2022-02-09 22:46:34,Romain Vimont,"Pass --buildtype=release as a single meson arg

For consistency with the other arguments",False
f86df817f908a5fd5e7e6eaf9565ec76b5ead092,2022-02-09 14:45:19,Romain Vimont,Print libusb version on --version,False
9a546ef1afccb7457fea29ad8b51d8ae24137e46,2022-02-09 14:45:19,Romain Vimont,"Print both compiled and linked versions of libs

On --version, print both the version scrcpy had been compiled against,
and the version linked at runtime.",False
9477594f80d0851423d842993b7a658f33ace03b,2022-02-09 14:45:07,Romain Vimont,"Move version handling to a separate file

This will avoid to include all dependencies headers from main.c.",False
29828aa3307c78f54a3169db156222ae91182468,2022-02-09 14:34:09,Romain Vimont,"Log device opening errors during listing

Without this log, the user would have no way to know that a USB device
is rejected because it could not be opened (typically due to
insufficient permissions).",False
dc5276b0e17cf7acd80726f3a31a8ac911f35e5e,2022-02-09 14:30:25,Romain Vimont,"Mention --select-usb and --select-tcpip in README

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
582161607e8cb2d6496b1962a5f2efa091ab3ccb,2022-02-09 14:30:25,Romain Vimont,"Add option to select USB or TCP/IP devices

If several devices are connected (as listed by `adb devices`), it was
necessary to provide the explicit serial via -s/--serial.

If only one device is connected via USB (respectively, via TCP/IP), it
might be convenient to select it automatically. For this purpose, two
new options are introduced:
 - -d/--select-usb: select the single device connected over USB
 - -e/--select-tcpip: select the single device connected over TCP/IP

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
146f65d7b2b046c2d9a218116b4483f1633b0322,2022-02-09 14:30:25,Romain Vimont,"Introduce adb device selector

Currently, a device is selected either from a specific serial, or if it
is the only one connected.

In order to support selecting the only device connected via USB or via
TCP/IP separately, introduce a new selection structure.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
5ed13ef4776f41afd98df4cc22e27832d9c9bd3f,2022-02-09 14:30:14,Romain Vimont,"Execute adb start-server

This does nothing if the adb daemon is already started, but allows to
print any output/errors to the console.

Otherwise, the daemon starting would occur during `adb devices`, which
does not output to the console because the result is parsed.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
9c545e8c29b743d908285ca17fa34187717936a3,2022-02-09 14:26:26,Romain Vimont,"Remove sc_adb_get_serialno()

The device serial is now retrieved from `adb devices -l`, `adb
get-serialno` is not called anymore.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
0a619dc9efa358c03372e08192bda075ecbeb0a6,2022-02-09 14:26:26,Romain Vimont,"Allow selecting a device from IP without port

Since the previous commit, if a serial is given via -s/--serial (either
a real USB serial or an IP:port), a device is selected if its serial
matches exactly.

In addition, if the user pass an IP without a port, then select any
device with this IP, regardless of the port (so that ""192.168.1.1""
matches any ""192.168.1.1:port""). This is also the default behavior of
adb.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
4692d13179fc244333975769c3236ed5fc8fcbd2,2022-02-09 14:26:26,Romain Vimont,"Expose simple API to select a single adb device

Select an adb device from the output of `adb device -l`.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
02d46b226210e407d940ea95f16047985f883174,2022-02-09 14:26:25,Romain Vimont,"Expose function to test if a serial is TCP/IP

In practice, it just tests if the serial contains a ':', which is
sufficient to distinguish ip:port from a real USB serial.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
4389de1c239c524f2a3aed2c985893dd3de74824,2022-02-09 14:26:25,Romain Vimont,"Add adb devices parser

Add a parser of `adb device -l` output, to extract a list of devices
with their serial, state and model.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
85ff70fc95b9b6a10f3aa834db0d2d1efcbbce0a,2022-02-09 14:25:25,Romain Vimont,"Refactor device configuration

Depending on the parameters passed to scrcpy, either the initial device
serial is necessary or not. Reorganize to simplify the logic.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
700503df6c4df77867f6172bc7a344a56bb91481,2022-02-09 14:25:25,Romain Vimont,"List and select USB devices separately

List all USB devices in a first step, then select the matching one(s).

This allows to report a user-friendly log message containing the list of
devices, with the matching one(s) highlighted.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
61969aeb80093d0777c7716a61698cbdaf9ddd71,2022-02-09 14:25:25,Romain Vimont,"Expose simple API to select a single USB device

The caller just wants a single device. Handle all cases and error
messages internally.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
b88c4aa75e73c0bbe981dd8f5e986c67d18abe22,2022-02-09 14:25:23,Romain Vimont,"Add move-function for sc_usb_device

Add a function to ""move"" a sc_usb_device into another instance.

This will avoid unnecessary copies.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
8c50342fb28b71f3632ad53903dc10920f0fb1d8,2022-02-09 14:23:19,Romain Vimont,"Move SC_PRIsizet to compat.h

Define the printf format macro for size_t in compat.h so that it can be
used from anywhere.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
0eadf95a3e8382ad6f5aceb94eba9f1e2d4780e0,2022-02-09 14:23:19,Romain Vimont,"Rename function to destroy a list of USB devices

Rename from ""usb_device_"" to ""usb_devices_"".

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
6df2205cf3450feb3023990fecc7aba8d2982911,2022-02-09 14:23:11,Romain Vimont,"Add generic LOG() macro with level parameter

One log macro was provided for each log level (LOGV(), LOGD(), LOGI(),
LOGW(), LOGE()).

Add a generic macro LOG(LEVEL, ...) accepting a log level as parameter,
so that it is possible to write logging wrappers.

PR #3005 <https://github.com/Genymobile/scrcpy/pull/3005>",False
61b6324ee902f48da4c4e6a76b3123e8768b4a9f,2022-02-09 14:22:15,Romain Vimont,"Remove LOGC()

It is not clear when to use LOGC() rather than LOGE(). Always use
LOGE().

Moreover, enum sc_log_level has no ""critical"" log level.",False
f20137d2ac524dd9dc0c7073fbc0f5f4e266b371,2022-02-07 17:40:53,Romain Vimont,"Improve USB device open log

For consistency with ""List USB devices"", log ""Open USB device"".",False
b60809a4da23f52c1efaebc2813d3a45d97a8ca5,2022-02-07 17:33:23,Romain Vimont,"Inline USB device opening

Such a separate function was useless.",False
b0e04aa327141937f47175a86a10efc5cb11da8d,2022-02-07 17:26:25,Romain Vimont,"Remove log_libusb_error()

This helper did not help a lot, and prevented the client to choose the
log level and the prefix error message.",False
137d2c97914fd9ac4b79869185c94c402d7719ab,2022-02-06 19:09:51,Romain Vimont,"Remove confusing sc_str_truncate()

This util function was error-prone:
 - it accepted a buffer as parameter (not necessarily a NUL-terminated
   string) and its length (including the NUL char, if any);
 - it wrote '\0' over the last character of the buffer, so the last
   character was lost if the buffer was not a NUL-terminated string, and
   even worse, it caused undefined behavior if the length was empty;
 - it returned the length of the resulting NUL-terminated string,
   which was inconsistent with the input buffer length.

In addition, it was not necessarily optimal:
 - it wrote '\0' twice;
 - it required to know the buffer length, that is the input string
   length + 1, in advance.

Remove this function, and let the client use strcspn() manually.",False
6d41c53b61dbd433a094d4b33e86c83e12e3399b,2022-02-06 19:01:32,Romain Vimont,"Fix adb connect parsing

The function assumed that the raw output of ""adb connect"" was a
NUL-terminated string, but it is not the case.

It this output did not end with a space or a new line character, then
sc_str_truncate() would write '\0' over the last character. Even worse,
if the output was empty, then sc_str_truncate() would write
out-of-bounds.

Avoid the error-prone sc_str_truncate() util function.",False
8d540e83c707e249a72a88ef939a5b8395e36e87,2022-02-06 19:00:19,Romain Vimont,"Fix adb get-serialno parsing

The function assumed that the raw output of ""adb get-serialno"" was a
NUL-terminated string, but it is not the case.

It this output did not end with a space or a new line character, then
sc_str_truncate() would write '\0' over the last character. Even worse,
if the output was empty, then sc_str_truncate() would write
out-of-bounds.

Avoid the error-prone sc_str_truncate() util function.",False
2ea12f73db333d0d6b01f92f2a092ada034c7f27,2022-02-06 19:00:13,Romain Vimont,"Fix adb getprop parsing

The function assumed that the raw output of ""adb getprop"" was a
NUL-terminated string, but it is not the case.

It this output did not end with a space or a new line character, then
sc_str_truncate() would write '\0' over the last character. Even worse,
if the output was empty, then sc_str_truncate() would write
out-of-bounds.

Avoid the error-prone sc_str_truncate() util function.",False
5d6bd8f9cd69036b331bb1898fe7c6353777f592,2022-02-06 19:00:07,Romain Vimont,"Fix adb device ip parsing

The parser assumed that its input was a NUL-terminated string, but it
was not the case: it is just the raw output of ""adb devices ip route"".

In practice, it was harmless, since the output always ended with '\n'
(which was replaced by '\0' on truncation), but it was incorrect
nonetheless.

Always write a '\0' at the end of the buffer, and explicitly parse as a
NUL-terminated string. For that purpose, avoid the error-prone
sc_str_truncate() util function.",False
5b3ae2cb2f95a333b3b90253ac959a34d51dd4ea,2022-02-05 15:47:45,Romain Vimont,"Store actual serial in sc_server

Before starting the server, the actual device serial (possibly its
ip:port if it's over TCP/IP) must be known.

A serial might be requested via -s/--serial (stored in the
sc_server_params), but the actual serial may change afterwards:
 - if none is provided, then it is retrieved with ""adb get-serialno"";
 - if --tcpip is requested, then the final serial will be the target
   ip:port.

The requested serial was overwritten by the actual serial in the
sc_server_params struct, which was a bit hacky.

Instead, store a separate serial field in sc_server (and rename the one
from sc_server_params to ""req_serial"" to avoid confusion).",False
08f16a9dde12a5631ca3a24b888816465212963b,2022-02-05 15:26:58,Romain Vimont,"Simplify switch to TCPIP function

Do not use an output parameter to return the value. Instead, return the
actual ip:port string on success or NULL on error.",False
386cf7d7acf305827dc49c621be7a6b64e6633d2,2022-02-05 15:26:58,Romain Vimont,"Build adb argv statically

Now that providing a serial is mandatory for adb commands where it is
relevant, the whole argv array may be built statically, without
allocations at runtime.",False
5e2bfccab4e8489da02c01a8fca1f568de50e6b7,2022-02-05 15:26:58,Romain Vimont,"Expose adb executable path publicly

This will allow the caller to build the argv array directly.",False
ba30ca5c1edc53fca3f230a2fdc5dbb7648588a5,2022-02-05 15:26:58,Romain Vimont,"Rename adb_command to adb_executable

Semantically, a ""command"" refers to the whole command line argv (adb and
its arguments).",False
028e7afe32091a6073a1eb7854a47e13719a9156,2022-02-05 15:26:58,Romain Vimont,"Assert non-NULL serial

If no serial is passed, then the command would work if there is exactly
one device connected, but will fail with multiple devices.

To avoid such cases, ensure that a serial is always provided.",False
6ca9825c0f54b2d8cd11c01c6faa970bfec96330,2022-02-05 15:26:21,Romain Vimont,"Assert ""adb disconnect"" is called with an argument

Calling ""adb disconnect"" without argument would disconnect every TCP/IP
device. We must make sure scrcpy never does that.",False
f807131c0af4c77139fb7a7b3e67fa8000c3bde5,2022-02-05 14:39:24,Romain Vimont,"Remove useless undef

The #define was removed in 1c71bd16bec1db0788e72a7c6b02f80ed40f1601.",False
21106bd70a07696198982bbaf00b72558b1e58c0,2022-02-04 13:42:28,Romain Vimont,"Remove screensaver log

If --disable-screensaver is passed, then screensaver is disabled,
otherwise it is enabled. No need for a log.",False
bd3c93ae3dfa3dd1b41594450a20dc5611fef50a,2022-02-04 13:09:10,Romain Vimont,"Remove platform-tools installation suggestion

On Windows, adb is provided in the release archive. Most missing adb
issues come from users setting the ADB environment variable to an
incorrect value (on all platforms).

Suggesting to install platform-tools to solve the problem will just make
things worse (there will be one more adb in yet another location).",False
9e3902f30c9132d275b5bd1a58cb174b7c96b3e9,2022-02-04 13:09:10,Romain Vimont,Use sc_ prefix for adb,False
7810ca61b0022500a9b19b23fb1b163c032a90ec,2022-02-04 13:09:10,Romain Vimont,Move ADB code to adb/,False
c460243ce2c21cfd89535ec7cd301684e8f3ee18,2022-02-03 01:33:55,Romain Vimont,"Simplify demuxer

Call the same push_packet_to_sinks() in all cases, and make
sc_demuxer_parse() return void.",False
7dec225cebbf208cf1d607bd45fb49e3a9fa1167,2022-02-03 01:33:55,Romain Vimont,"Rename stream to sc_demuxer

For consistency with recorder and decoder, name the component which
demuxes a ""demuxer"".

And add the missing sc_ prefix.",False
4ee62abe1d7fc14fa4812ed40cf7e2d6577ba962,2022-02-03 01:33:55,Romain Vimont,Use sc_ prefix for recorder,False
0080d0b0ff5a8b91430e12942ba8bb8e66e9e84b,2022-02-03 01:33:55,Romain Vimont,Use sc_ prefix for decoder,False
0bf7e4ddc42dc73d43666f58dd10edf89c62ae66,2022-02-02 17:02:39,CennoxX,"Add missing spaces in help

PR #2994 <https://github.com/Genymobile/scrcpy/pull/2994>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c0a75ca7462b6c22847e8cefe5c25aa410591b79,2022-02-02 12:52:17,Romain Vimont,"Downscale and retry also on early MediaCodec error

The new retry mechanism with a lower definition only worked if the error
occurred during encode(). For example:

    java.lang.IllegalStateException
        at android.media.MediaCodec.native_dequeueOutputBuffer(Native Method)
        at android.media.MediaCodec.dequeueOutputBuffer(MediaCodec.java:3452)
        at com.genymobile.scrcpy.ScreenEncoder.encode(ScreenEncoder.java:114)
        at com.genymobile.scrcpy.ScreenEncoder.internalStreamScreen(ScreenEncoder.java:95)
        at com.genymobile.scrcpy.ScreenEncoder.streamScreen(ScreenEncoder.java:61)
        at com.genymobile.scrcpy.Server.scrcpy(Server.java:80)
        at com.genymobile.scrcpy.Server.main(Server.java:255)

However, MediaCodec may also fail before encoding, during configure() or
start(). For example:

    android.media.MediaCodec$CodecException: Error 0xfffffc0e
        at android.media.MediaCodec.native_configure(Native Method)
        at android.media.MediaCodec.configure(MediaCodec.java:1956)
        at android.media.MediaCodec.configure(MediaCodec.java:1885)
        at com.genymobile.scrcpy.ScreenEncoder.configure(ScreenEncoder.java:158)
        at com.genymobile.scrcpy.ScreenEncoder.streamScreen(ScreenEncoder.java:68)
        at com.genymobile.scrcpy.Server.scrcpy(Server.java:28)
        at com.genymobile.scrcpy.Server.main(Server.java:110)

Also downscale and retry in these cases.

Refs #2947 <https://github.com/Genymobile/scrcpy/pull/2947>
Refs #2988 <https://github.com/Genymobile/scrcpy/issues/2988>
PR #2990 <https://github.com/Genymobile/scrcpy/pull/2990>",False
f02f2135cdd03f174bba6ce18ee7840469111378,2022-02-02 02:10:15,Romain Vimont,Fix include for standard library header,False
9b4360b6b8e1ba4234f5b11b8217379faafcb3b7,2022-02-02 02:09:14,Romain Vimont,"Add warning in function documentation

The function parsing ""ip route"" output modifies the input buffer to
tokenize in place. This must be mentioned in the function documentation.",False
c8d0f5cdeb75cde4f5cff9a75daf000f15077acc,2022-02-02 02:08:50,Romain Vimont,"Fix sc_str_truncate() documentation

The function was initially implemented to truncate lines, but was later
generalized to accept custom delimiters. The whole documentation has not
been updated accordingly.

Refs 9619ade706824a92ea387bdc9d0d27816bf79da5",False
22d9f0faf4fe22e6316450041585a2cdd04d0eca,2022-02-02 01:39:02,Romain Vimont,Fix comment typo,False
a1967b4dfdc01e70a29e7d679f425ab413c90aa4,2022-01-30 21:26:18,Cccc_owo,"Update FAQ.zh-Hans.md to v1.22

PR #2989 <https://github.com/Genymobile/scrcpy/pull/2989>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
a86deab3d4dcf7471b493ba82365aa284e1f74b8,2022-01-30 21:25:45,Cccc_owo,"Update README.zh-Hans.md to v1.22

PR #2989 <https://github.com/Genymobile/scrcpy/pull/2989>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f4c7044b46ae28eb64cb5e1a15c9649a44023c70,2022-01-29 20:46:41,Romain Vimont,Update links to v1.22,False
64a09513ae8a3941952e6e82969193f4cf393e81,2022-01-29 20:14:52,Romain Vimont,Bump version to 1.22,False
28054cd471f848733e11372c9d745cd5d71e6ce7,2022-01-29 20:10:48,Romain Vimont,Merge branch 'master' into dev,True
334f46995a92df381df4c0ce818c3a533eaa203c,2022-01-29 19:40:05,Cccc_owo,"Update README.zh-Hans.md to v1.21

PR #2978 <https://github.com/Genymobile/scrcpy/pull/2978>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
38cdcdda50de8872230921fb5681bcd4665bc1e6,2022-01-29 19:10:21,Romain Vimont,"Improve prebuilt system

This aims to fix two issues with the previous implementation:
 1. the whole content of downloaded archives were extracted, while only
    few files are necessary;
 2. the archives were extracted in the prebuild-deps/ directory as is.

As a consequence of (2), the actual directory name relied on the root
directory of the archive. For adb, this root directory was always
""platform-tools"", so when bumping the adb version, the target directory
already existed and the dependency was not upgraded (the old one had to
be removed manually).

Expose common function to download a file and check its checksum, but
let the custom script for each dependency extract only the needed files
and reorganize the content if necessary.",False
eaba6136334e5fb50d3276ca7405b77e48c8f29e,2022-01-29 16:16:39,Romain Vimont,"Revert ""Upgrade platform-tools (32.0.0) for Windows""

This reverts commit c0de365f672110959cec8fca936bd6aeaa01b59d.

The new adb.exe crashes.

Refs #2981 comment <https://github.com/Genymobile/scrcpy/issues/2981#issuecomment-1024569778>",False
b8d7f36ba37c153aa1516392e08afdbe6386e46b,2022-01-29 12:35:59,Romain Vimont,"Fix SC_EXIT_CODE_NONE value

The exit code on windows is stored in a DWORD, an unsigned long:
<https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/262627d8-3418-4627-9218-4ffe110850b2>

Use the max value of this type for SC_EXIT_CODE_NONE.",False
80bec708523ea7b8cefc9f74057611e8ac499b89,2022-01-28 13:45:18,Romain Vimont,"Add helper to log Windows system errors

It will help to log errors returned by GetLastError() or
WSAGetLastError():
 - <https://docs.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror>
 - <https://docs.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-wsagetlasterror>
 - <https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes#system-error-codes>

Always log the errors in English to be able to read them in bug reports.",False
5508c635cb11b61df9bfc3d9e5e603492100b067,2022-01-28 04:06:30,Romain Vimont,"Enable mouse focus clickthrough in OTG mode

A single click on the window must both give focus and capture the mouse.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
ea68a003a2e5d584a19f83d81d1aeb86690f6102,2022-01-28 04:06:27,Romain Vimont,"Make HID keyboard and mouse optional in OTG mode

Allow to only enable HID keyboard or HID mouse:

    scrcpy --otg -K   # keyboard only
    scrcpy --otg -M   # mouse only
    scrcpy --otg -KM  # keyboard and mouse
    scrcpy --otg      # keyboard and mouse

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
c5be0d6438c14a059fc4b581b2645fce6b6666cd,2022-01-28 04:06:25,Romain Vimont,"Document OTG mode in README

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
91418c79ab3b7056c21ef6c64f903704c8f00a52,2022-01-28 04:06:23,Romain Vimont,"Add OTG mode

Add an option --otg to run scrcpy with only physical keyboard and mouse
simulation (HID over AOA), without mirroring and without requiring adb.

To avoid adding complexity into the scrcpy initialization and screen
implementation, OTG mode is implemented totally separately, with a
separate window.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
36aaf702791b77d65b7b1bf87ee58a808cdf70d0,2022-01-28 04:06:21,Romain Vimont,"Move input event helpers

Input events helpers to convert from SDL events to scrcpy events were
implemented in input_manager. To reuse them for OTG mode, move them to
input_events.h.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
1a03206e36b6065b421b3e7635a48211cdf0ce4a,2022-01-28 04:06:18,Romain Vimont,"Detect USB device disconnection

The device disconnection is detected when the video socket closes.

In order to introduce an OTG mode (HID events) without mirroring (and
without server), we must be able to detect USB device disconnection.

This feature will only be used in OTG mode.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
37987b822e8f0f57f27c867ef6c573f98791b5bd,2022-01-28 04:06:16,Romain Vimont,"Make acksync optional for AOA initialization

Acksync is used to delay HID events until some request (in practice,
device clipboard synchronization) is acknowledged by the device.

This mechanism will not be necessary for OTG mode.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
8fc9dca8cb4d35fb329826fffa00e1403eb7ed43,2022-01-28 04:06:15,Romain Vimont,"Make serial optional to find USB devices

If no serial is provided, then list all available USB devices (which can
be open and having a serial).

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
1c17f57c101fc08fd54c99b5c6c947414f5f35be,2022-01-28 04:06:13,Romain Vimont,"Find a list of devices instead of a single one

Several devices may match the requested serial, but above all, this
paves the way to list all devices (when no serial is provided).

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
d8b37fe189d5cacf9bac8162d25c58c1a6890a6c,2022-01-28 04:06:11,Romain Vimont,"Wrap libusb_device

Introduce a structure to wrap a libusb_device and expose its descriptor
data read during discovery.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
0ee9e2ff51baa4826283b521053a383550b93ea1,2022-01-28 04:06:08,Romain Vimont,"Expose function to find a USB device

The device was automatically found by sc_usb_connect(). Instead, expose
a function to find a device from a serial, and let the caller connect to
the device found (if any).

This will allow to list all devices first, then select one device to
connect to.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
1ab3692f3dec0f28e2f228d604a037f1a801d337,2022-01-28 04:06:06,Romain Vimont,"Add util function to read USB descriptor string

Use it from accept_device() to simplify (at the cost an additional
allocation for each serial, but it is not important).

It will also be useful in other functions in further commits.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
bbef426a4bb69dc96fbd8c1075c0e569d71fdff4,2022-01-28 04:06:04,Romain Vimont,"Split USB initialization and connection

This will allow to execute other USB calls (retrieving the device list
for example) before connecting to the selected device.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
2114f48185ff69e8b2849c75d4b77c9352a3b6f6,2022-01-28 04:06:02,Romain Vimont,"Find device with USB context

An explicit context was used everywhere except for listing the devices.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
b779eca8d37896072ddc5017f1c63a3056515869,2022-01-28 04:06:00,Romain Vimont,"Remove libusb_device field

It is possible to retrieve the device instance from the handle via
libusb_get_device(), so we don't need to reference the device one more
time.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
adda47b0f72eb18fa0abc68c67acd435eccdd310,2022-01-28 04:05:59,Romain Vimont,"Move sc_usb out of sc_aoa

This will allow to initialize a USB device separately and pass it to
sc_aoa.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
48e3ff284f538c470e0bf15cc91b8c3430304bf4,2022-01-28 04:05:57,Romain Vimont,"Make serial mandatory for sc_usb

In practice, it is already mandatory.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
1d6f9952ee290564bce5876183e691dbc7b01055,2022-01-28 04:05:55,Romain Vimont,"Extract USB handling from AOA

The AOA code handled both USB initialization and AOA commands/events.
Extract USB-related code to a separate file and structure.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
d48d191262957402fa73e94d6eda15afce528a13,2022-01-28 04:05:48,Romain Vimont,"Rename HAVE_AOA_HID to HAVE_USB

The condition actually determines whether scrcpy can use libusb or not.

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
2762f5d18351d5e610a110d731867bd1c27248cf,2022-01-28 04:05:34,Romain Vimont,"Move AOA/HID code to usb/

PR #2974 <https://github.com/Genymobile/scrcpy/pull/2974>",False
c996a6d462d7499b1421eabcfcadf0a58baae60e,2022-01-28 03:56:46,Romain Vimont,"Fix socket close race condition

The server needs to interrupt the sockets on stop, but it must not close
them while other threads may attempt to read from or write to them.

In particular, the video_socket is read by the stream thread, and the
control_socket is written by the controller and read by receiver.

Therefore, close the socket only on sc_server_destroy(), which is called
after all other threads are joined.

Reported by TSAN on close:

    WARNING: ThreadSanitizer: data race (pid=3287612)
      Write of size 8 at 0x7ba000000080 by thread T1:
        #0 close ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1690 (libtsan.so.0+0x359d8)
        #1 net_close ../app/src/util/net.c:280 (scrcpy+0x23643)
        #2 run_server ../app/src/server.c:772 (scrcpy+0x20047)
        #3 <null> <null> (libSDL2-2.0.so.0+0x905a0)

      Previous read of size 8 at 0x7ba000000080 by thread T16:
        #0 recv ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:6603 (libtsan.so.0+0x4f4a6)
        #1 net_recv_all ../app/src/util/net.c:228 (scrcpy+0x234a9)
        #2 stream_recv_packet ../app/src/stream.c:33 (scrcpy+0x2045c)
        #3 run_stream ../app/src/stream.c:228 (scrcpy+0x21169)
        #4 <null> <null> (libSDL2-2.0.so.0+0x905a0)

Refs ddb9396743072f97628fab168ef7fcd45a597b03",False
8ea6fb1f0f4e2c06ecf51fa184d08a71663c0e7b,2022-01-28 01:56:56,Romain Vimont,"Print version on stdout

Refs b25404ee4b6f2cbdd41992fa3e087dd8a73412c9",False
b546c33eff4daa9a9b69a2c98de39e70fd08109e,2022-01-28 01:42:46,Romain Vimont,"Do not print scrcpy version twice on --version

Refs 6da6d905c2aeac17255347037d44c32a62c4c504",False
86158130051d450a449a2e7bb20b0fcef1b62e80,2022-01-27 23:44:07,Tomás Raiti,"Update README.sp.md to v1.21

PR #2962 <https://github.com/Genymobile/scrcpy/pull/2962>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f51c53e913d4614a677f656d973fa69c496d585a,2022-01-27 23:35:33,Romain Vimont,"Mention ""screen copy"" in README

Help users make sense of the app name :)",False
c0de365f672110959cec8fca936bd6aeaa01b59d,2022-01-27 23:32:07,Romain Vimont,"Upgrade platform-tools (32.0.0) for Windows

Include the latest version of adb in Windows releases.",False
34e19dcc57f35d8f152b1f5b0988800581af15df,2022-01-27 23:32:07,Romain Vimont,"Upgrade SDL (2.0.20) for Windows

Include the latest version of SDL in Windows releases.",False
4817cadd09aa391746343f9daa2a028a2fa19b6a,2022-01-27 23:32:07,Romain Vimont,"Fix code style

Align function parameters.",False
02b5e87802aa2dce4b8dbacf47dfded55688944b,2022-01-27 23:31:43,Romain Vimont,"Slightly reduce lock usage

Locking the frame_buffer mutex to reference the input frame into the
tmp_frame is unnecessary.

This also fixes the missing unlock on error.",False
8e4d3beb01ba4623acc91deaaed2d10aef19f718,2022-01-27 21:17:51,Romain Vimont,Fix return value on adb commands error,False
50f4f1639c552f2195f1b99f67aeac884c0337a5,2022-01-27 21:17:51,Romain Vimont,"Add a shorcut ""open a terminal here"" on Windows

On Windows, the file explorer does not provide any ""open a terminal
here"" shortcut.

Add a bat file which just runs `cmd` to easily open a terminal directly
in the scrcpy directory (so there is no need to `cd C:\path\…`).

PR #2970 <https://github.com/Genymobile/scrcpy/pull/2970>",False
c8dc1917f47a3f9b4ef6026b912c2792b69e676a,2022-01-27 21:17:51,Romain Vimont,"Do not restore power mode if --no-control

This totally disables deferred cleanup when --no-control is passed.

Refs f289d206ea0e10cc052137781c39da862ebe2f73",False
9d2e00697e5b6c27def3791e55cee67b8dd395b5,2022-01-27 21:17:51,Romain Vimont,"Use sc_ prefix for control_msg enums

Refs afa4a1b728d6f130acff23c0e3fb4609bcb8a6b2",False
2faf9715bebe720ed75ce98f5f8c2b2b1532880a,2022-01-27 21:17:51,Romain Vimont,"Add server option raw_video_stream

For convenience, this new option forces the 3 following options:
 - send_device_meta=false
 - send_frame_meta=false
 - send_dummy_byte=false

This allows to send a raw H.264 stream on the video socket.

Concretely:

    adb push scrcpy-server /data/local/tmp/scrcpy-server.jar
    adb forward tcp:1234 localabstract:scrcpy
    adb shell CLASSPATH=/data/local/tmp/scrcpy-server.jar \
        app_process / com.genymobile.scrcpy.Server 1.21 \
        raw_video_stream=true tunnel_forward=true control=false

As soon as a client connects via TCP to localhost:1234, it will receive
the raw H.264 stream.

Refs #1419 comment <https://github.com/Genymobile/scrcpy/pull/1419#issuecomment-1013964650>
PR #2971 <https://github.com/Genymobile/scrcpy/pull/2971>",False
45a5e560dfeabed8b32482caad857424ff472518,2022-01-26 16:00:46,Romain Vimont,"Add server option send_dummy_byte

If set to false, no dummy byte is written to detect a connection error.

PR #2971 <https://github.com/Genymobile/scrcpy/pull/2971>",False
3ba32c2a0d57b708980df121caad84252f720699,2022-01-26 16:00:37,Romain Vimont,"Add server option send_device_meta

Similar to send_device_frame, this option allows to disable sending the
device name and size on start.

This is only useful when using the scrcpy-server alone to get a raw
H.264 stream, without using the scrcpy client.

PR #2971 <https://github.com/Genymobile/scrcpy/pull/2971>",False
6b21f4ae13e0644632d2bef4f14ff590b1fa5e18,2022-01-26 16:00:30,Romain Vimont,"Reorder scrcpy-server options

Move the options unused by the scrcpy client at the end.

These options may be useful to use scrcpy-server directly (to get a raw
H.264 stream for example).

PR #2971 <https://github.com/Genymobile/scrcpy/pull/2971>",False
31a5d0c2bfab4d8f74b116d634f63a0f3a79889a,2022-01-26 16:00:19,Romain Vimont,"Move call to send device name and size

This will allow to optionally disable it.

PR #2971 <https://github.com/Genymobile/scrcpy/pull/2971>",False
f289d206ea0e10cc052137781c39da862ebe2f73,2022-01-25 02:15:44,Romain Vimont,"Disable more actions if --no-control

If control is disabled, then do not enable ""show touches"" or
automatically power off the device on close.",False
ca516f4318100e93d8fa4a88e05f004bafd1dc91,2022-01-25 02:14:28,Romain Vimont,"Refactor if-block in cli

Several tests must be performed if opts->control is false.",False
5d6076bffd9ffe03ce7299f7f3459f6d018fb8c7,2022-01-25 02:08:30,Romain Vimont,"Move misplaced break statements

With ifdefs, the resulting code could contain both a return statement
and a break.",False
e0bce1725bdb6b5f114051b9611d90f57050a77c,2022-01-25 02:07:40,Romain Vimont,Fix header guard prefix,False
ae8fdda09ec5730bf84e80261b7e09fe44680b8d,2022-01-24 13:25:27,Romain Vimont,Improve FAQ explanations,False
1ff69e21c28ad69f6a39219c5da4c5f77dbaf9f6,2022-01-24 13:24:09,Romain Vimont,"Update error messages in FAQ

With the recent versions, scrcpy first executes ""adb get-serialno"", so
the adb error messages are not exactly the same.",False
a9429efa34b3cbdc57847cb37d3621b889522c7f,2022-01-24 02:16:57,Romain Vimont,"Fix downsize on error before first frame

Retry with a lower definition if MediaCodec fails before the first
frame, not the first packet.

In practice, the first packet is a config packet without any frame, and
MediaCodec might fail just after.

Refs 2eb6fe7d81c15912a2252f229d317ae03f618a33
Refs #2963 <https://github.com/Genymobile/scrcpy/issues/2963>",False
063d103dd6f959f6f1619f20e4e964a042c700ad,2022-01-24 02:01:53,Romain Vimont,"Capture mouse on start for --hid-mouse

If relative mode is enabled, capture the mouse immediately.",False
4bf9c057fe00c397982bc610998f7f1d1fd39017,2022-01-24 02:01:11,Romain Vimont,"Extract relative mode check to an inline function

This will allow to reuse the condition in another function.",False
17c97820b2030759e8b7e431e7d353c30bcff3dc,2022-01-24 01:46:40,Romain Vimont,"Never forward capture keys

In relative mode, Alt and Super are ""capture keys"". Never forward them
to the input manager, to avoid inconsistencies between UP and DOWN
events.",False
8c7f0ed5ead5dc15dc10fb1b521b7ec91523c50e,2022-01-24 01:46:35,Romain Vimont,"Fix warning message

Make the message consistent for HID keyboard and HID mouse.",False
ac038f276eb5e7dcc6fac7fa7120da23a38bc0ec,2022-01-23 19:31:11,Romain Vimont,"Add missing break statement

This was harmless because this is the last ""case"" of the switch, but for
consistency, add the missing break.",False
1f65b1bf87d835bdd96475b27c1712cd7c63b00b,2022-01-23 19:31:11,Romain Vimont,"Remove inline hint

There is no reason to request inlining here.",False
d41a46dc95d13922d7b1166d8454842402e67a92,2022-01-23 17:02:37,Romain Vimont,"Handle libusb_get_device_descriptor() error

The function libusb_get_device_descriptor() might return an error.
Handle it.",False
308a1f8192be145242919b153577d319497cd2fd,2022-01-23 17:02:37,Romain Vimont,"Simplify error handling in sc_aoa_init()

Use goto to avoid many repetitions.",False
241a587e61706321a7f8767d90aaf9876037c2eb,2022-01-23 17:02:04,Romain Vimont,"Fix missing HID mouse destructor call

The destructor unregisters the HID mouse, so it was not reported as a
leak, but it must still be called.",False
7e35bfe382da9f66aefdd46f0610a420a0815f2c,2022-01-23 16:46:24,Romain Vimont,"Refactor if-blocks

Group all conditions requiring a controller in a single if-block.",False
855819bbd83d9d8e06988357ac1b548b11a4a0db,2022-01-23 16:46:24,Romain Vimont,"Remove redundant control boolean

The controller is NULL if and only if control is disabled, so an
additional control boolean is redundant.",False
557daf280e03932ab1289a140d7920f756b0ad1f,2022-01-23 16:46:24,Romain Vimont,"Pass NULL controller if control is disabled

If --no-control is requested, then the controller instance is not
initialized. However, its reference was still passed to screen and
input_manager.

Instead, pass NULL if no controller is available.",False
0b8e9263305a388faabafac83565322e18da0537,2022-01-23 16:46:24,Romain Vimont,"Do not process finger events if no control

If --no-control is passed, then im->mp is NULL, so processing touches
would crash.",False
0ec3361bc9711332a30725b03b9592a4c68f0248,2022-01-23 16:46:07,Romain Vimont,"Fix crash on --no-control

Relative mouse mode assumed that a mouse processor was always available,
but this is not the case if --no-control is passed.",False
81ff7ebd065eaf6917905e64e4e7017e9f83fc3b,2022-01-22 02:22:41,Romain Vimont,"Simplify event loop

Merge single event handling with the event loop function.",False
1ffe312369ee2b223c8a946e053ad70932bec173,2022-01-22 02:22:41,Romain Vimont,"Handle file drop from input_manager

A file is pushed (or an apk is installed) to the device on file drop.
This behavior is specific to the screen and its input_manager.",False
ebef027c4f13e7cd30743525e845ad06b3660679,2022-01-22 02:22:41,Romain Vimont,"Do not return status for event handling

It is never read. Simplify.",False
8e4e7d42f1d776dc8a6e14322fdda494c973135e,2022-01-22 02:22:41,Romain Vimont,"Fix leak on file pusher error

If a file_push request fails, the allocated filename must be freed.",False
b066dc0bbfc608d52706dc59e826c75d7ad46fef,2022-01-22 02:22:41,Romain Vimont,"Rename file_handler to sc_file_pusher

Rename handler to pusher (""handler"" is too generic), and add sc_ prefix.",False
262506c733ba5fb63ea08ef1a7cb7a667a741ccf,2022-01-22 02:22:29,Romain Vimont,"Limit retry-on-error to IllegalStateException

MediaCodec errors always trigger IllegalStateException or a subtype
(like MediaCodec.CodecException).

In practice, this avoids to retry if the error is caused by an
IOException when writing the video packet to the socket.",False
2eb6fe7d81c15912a2252f229d317ae03f618a33,2022-01-21 23:14:05,Romain Vimont,"Downsize on error only before the first frame

The purpose of automatic downscaling on error is to make mirroring work
by just starting scrcpy without an explicit -m value, even if the
encoder could not encode at the screen definition.

It is only useful when we detect an encoding failure before the first
frame. Downsizing later could be surprising, so disable it.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
3a0ba7d0a439c0933f74e2433122c15cb7ee7318,2022-01-21 23:14:05,Romain Vimont,"Disable downsizing on error if V4L2 is enabled

V4L2 device is created with the initial device size, it does not support
resizing.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
75c5dc6859d29e2fb4d273e6c261288b802e16c0,2022-01-21 23:13:46,Romain Vimont,"Position and size the window on first frame

The optimal initial size was computed from the expected dimensions, sent
immediately by the server before encoding any video frame.

However, the actual frame size may be different, for example when the
device encoder does not support the requested size.

To always handle this case properly, position and size the window only
once the first frame size is known.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
fa30f9806aa928da5010c7110e6f0fafb5220eaf,2022-01-21 23:12:39,Romain Vimont,"Move ""show window"" call on first frame

Show the window only after the actual frame size is known (and if no
error has occurred).

This will allow to properly position and size the window when the size
of the first frame is different from the size initially announced by the
server.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
4fb61ac83de7c99edcd1febd9635d822b3d0a075,2022-01-21 23:12:39,Romain Vimont,"Fix screen comments

The position fields accept SC_WINDOW_POSITION_UNDEFINED, not the size
fields.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
8fa9e6b01a4b5ee715cc6ba51d95ce8522ccc99c,2022-01-21 23:12:38,Romain Vimont,"Mention auto-downsize feature in FAQ

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
0ec64baad437cc11d7fe7e046adb74eb2cdd9eb7,2022-01-21 23:11:26,Romain Vimont,"Remove MediaCodec error suggestion fix

Now that scrcpy attempts with a lower definition on any MediaCodec
error (or the user explicitly requests to disable auto-downsizing), the
suggestion is unnecessary.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
15bf27afdddc64c2887085e075398f71d2748d06,2022-01-21 23:06:46,Romain Vimont,"Make auto-downsize on error optional

Add --no-downsize-on-error option to disable attempts to use a lower
definition on MediaCodec error.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
26b4104844fb9516be13ff1f2be34e2945090e79,2022-01-21 23:06:46,Romain Vimont,"Downsize on error

Some devices are not able to encode at the device screen definition.

Instead of just failing, try with a lower definition on any MediaCodec
error.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
723faa5dee2915086c3b07fd1bfb6d541680b042,2022-01-21 23:06:46,Romain Vimont,"Remember Device parameters

This will allow to reuse them to recreate a ScreenInfo instance in order
to change the maxSize value on MediaCodec error.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
162043911e1d742489bf836113fe0797191a5160,2022-01-21 23:06:46,Romain Vimont,"Compute screen size without DisplayInfo instance

Use the actual rotation and size values directly.

This will allow to automatically change the maxSize value on MediaCodec
error.

PR #2947 <https://github.com/Genymobile/scrcpy/pull/2947>",False
117fe32626892c57a432ccd19347d36ae83661bd,2022-01-21 23:06:44,Romain Vimont,"Fix visibility modifier

Refs b7a06278fee0dbfbb18b651ad563d9fb0797c8bc",False
b7a06278fee0dbfbb18b651ad563d9fb0797c8bc,2022-01-18 14:45:55,Thomas Rebele,"Fix NoSuchMethodException for injectInputEvent()

Some devices with modified ROMs expose a different signature for
injectInputEvent().

Fixes #2250 <https://github.com/Genymobile/scrcpy/issues/2250>
PR #2946 <https://github.com/Genymobile/scrcpy/pull/2946>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b3ff1f6b3b6629a0ed55e759178b3e3378572cc4,2022-01-18 14:43:41,Romain Vimont,"Upgrade FFmpeg (5.0) for Windows 64-bit

Use FFmpeg win64 binaries from gyan.dev (referenced from ffmpeg.org):

 - https://www.gyan.dev/ffmpeg/builds/
 - https://ffmpeg.org/download.html#build-windows

Keep the old FFmpeg prebuilt binaries (4.3.1) for win32 builds.

Fixes #1753 <https://github.com/Genymobile/scrcpy/issues/1753>
Refs #1838 <https://github.com/Genymobile/scrcpy/pull/1838>
Refs #2583 <https://github.com/Genymobile/scrcpy/pull/2583>
PR #2952 <https://github.com/Genymobile/scrcpy/pull/2952>

Co-authored-by: Yu-Chen Lin <npes87184@gmail.com>
Co-authored-by: nkh0472 <nkh0472@hotmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
a2495c5ef192e86f4dc5204e4e250f3b6cc56ef4,2022-01-18 14:43:38,Romain Vimont,"Use symlink to simplify Windows ffmpeg dependency

The FFmpeg dependency is downloaded from two separate zipfiles.

Symlink include/ to expose everything from a single directory, to
simplify the meson script.

PR #2952 <https://github.com/Genymobile/scrcpy/pull/2952>",False
37c7827d463ba99f87aa87553b661946113d0412,2022-01-18 14:43:18,Romain Vimont,"Simplify ffmpeg dependencies Makefile

The fact that the current prebuilt FFmpeg is split into two separate
zipfiles is an implementation detail.

Use a single Makefile recipe for both files.

PR #2952 <https://github.com/Genymobile/scrcpy/pull/2952>",False
479abc8c7723d2d05b7c5027528acd91946a328c,2022-01-16 22:16:43,Tobias Preuss,"Reference Windows USB driver for Google devices

PR #2945 <https://github.com/Genymobile/scrcpy/pull/2945>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5e8fa56e7a8b13b7c9c6d0d4ee56636c76b821d2,2022-01-16 22:07:28,Bernhard Rosenkränzer,"Fix build with ffmpeg 5.0

PR #2948 <https://github.com/Genymobile/scrcpy/pull/2948>

Signed-off-by: Bernhard Rosenkränzer <bero@lindev.ch>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
60bf133ac28c76bcbef79e6610f34c6b66e5e82e,2022-01-16 03:55:55,Romain Vimont,"Add final modifier to ScreenEncoder fields

These fields are only set from the constructor.",False
1c71bd16bec1db0788e72a7c6b02f80ed40f1601,2022-01-16 03:55:43,Romain Vimont,"Use constant string for known booleans

Boolean options explicitly passed to the server are statically known.",False
afa4a1b728d6f130acff23c0e3fb4609bcb8a6b2,2022-01-15 02:47:30,Romain Vimont,Use sc_ prefix for control_msg,False
3a4d5c7f18de27de450191a4b5401ad94f9d7285,2022-01-15 02:47:30,Romain Vimont,Use sc_ prefix for controller,False
5f7ddff8ae5e906b3c0835e649ca536ff69316b3,2022-01-15 02:47:30,Romain Vimont,Use sc_ prefix for input_manager,False
2a0c2e5e99ac5479c2b7ec867f21957deb1c3fbe,2022-01-15 02:47:30,Romain Vimont,Use sc_ prefix for screen,False
a6644e831bbd005af1a92f6614bf901764d6eac8,2022-01-15 01:27:03,Romain Vimont,"Fix code style

Limit to 80 chars.",False
75655194fb08d8ea92cd72ca42d6bd0bea191f05,2022-01-15 01:25:44,Romain Vimont,"Do not pass scrcpy_options to keyboard inject

The components should be configurable independently of the global
scrcpy_options instance: their configuration could be provided
separately, like it is the case for example for some screen parameters.

For consistency, keyboard injection should not depend on scrcpy_options.",False
43aff4af73261a46ee291d5e8fbfd70c7d9cd0ea,2022-01-04 22:11:40,Romain Vimont,Document HID mouse in README,False
cba84f69993e3d7bdbb0e44493b70c0a14689487,2022-01-04 22:11:40,Romain Vimont,Add support for HID mouse,False
ed2e45ee29099cb6656782067f28376f65f94289,2022-01-04 22:11:40,Romain Vimont,"Refactor AOA/HID keyboard initialization

This paves the way to add support for HID mouse initialization.",False
aee1b397905ae9108fe239c9e3bb41ef33d0f43f,2022-01-04 22:11:40,Romain Vimont,Add CLAMP() macro,False
17d01b5bf7832d4c65435e6076a1c75f7aec66be,2022-01-04 22:11:40,Romain Vimont,"Add UI/UX support for relative mouse mode

In relative mouse mode, the mouse pointer must be ""captured"" from the
computer.

Toggle (disable/enable) relative mouse mode using any of the hardcoded
capture keys:
 - left-Alt
 - left-Super
 - right-Super

These capture keys do not conflict with shortcuts, since a shortcut is
always a combination of the MOD key and some other key, while the
capture key triggers an action only if it is pressed and released alone.

The relative mouse mode is also automatically enabled on any click in
the window, and automatically disabled on focus lost (it is possible to
lose focus even without the mouse).",False
40fca82b6002662c43a054079c0b8e0cbaa7d692,2022-01-04 22:11:40,Romain Vimont,"Forward all motion events to mouse processors

The decision to not send motion events when no click is pressed is
specific to Android mouse injection. Other mouse processors (e.g. for
HID mouse) will need to receive all events.",False
643293752dc92c2e175b6ad1c8ebb75ffc195a3d,2022-01-04 22:11:40,Romain Vimont,"Provide relative mouse motion vector in event

This will allow the mouse processor to handle relative motion easily.",False
b5855e5deb7482f96e1a0217218442ecdf21e3ab,2022-01-04 22:11:40,Romain Vimont,"Add relative mode flag to mouse processors

The default mouse injection works in absolute mode: it forwards clicks
at a specific position on screen.

To support HID mouse, add a flag to indicate that the mouse processor
works in relative mode: it forwards mouse motion vectors, without any
absolute reference to the screen.",False
924375487e63a5a9114182015a68aedef2f52d14,2022-01-04 22:11:40,Romain Vimont,"Pass buttons state in scroll events

A scroll event might be produced when a mouse button is pressed (for
example when scrolling while selecting a text). For consistency, pass
the actual buttons state (instead of 0).

In practice, it seems that this use case does not work properly with
Android event injection, but it will work with HID mouse.",False
7121a0dc5310182cc1b003e40d36bd81bc1f9471,2022-01-04 22:11:40,Romain Vimont,"Destroy acksync immediately on error

If AOA or HID keyboard may not be initialized for some reason, acksync
is useless.",False
f04812fc714f2fdb6b5ebadabc1007cc4895f70d,2022-01-04 22:11:40,Romain Vimont,"Remove duplicate boolean

The AOA initialization state is already tracked by aoa_hid_initialized.",False
5ce1ccde8518295ddd67179e1ed658f618bea296,2022-01-04 22:11:40,Romain Vimont,"Reorder controller and HID initialization

This allows to merge two ""#ifdef HAVE_AOA_HID"" blocks to simplify.",False
6102a0b5bb5b7c8473c407592707539be48da19e,2022-01-04 22:11:35,Romain Vimont,"Move input_manager into screen

The input_manager is strongly tied to the screen, it could not work
independently of the specific screen implementation.

To implement a user-friendly HID mouse behavior, some SDL events
will need to be handled both by the screen and by the input manager. For
example, a click must typically be handled by the input_manager so that
it is forwarded to the device, but in HID mouse mode, the first click
should be handled by the screen to capture the mouse (enable relative
mouse mode).

Make the input_manager a descendant of the screen, so that the screen
decides what to do on SDL events.

Concretely, replace this structure hierarchy:

     +- struct scrcpy
        +- struct input_manager
        +- struct screen

by this one:

     +- struct scrcpy
        +- struct screen
           +- struct input_manager",False
2b34e1224e97e21ca04ce751bf513d85fbcc4a45,2022-01-04 19:44:38,Romain Vimont,"Use separate struct for input manager params

This avoids to directly pass the options instance (which contains more
data than strictly necessary), and limit the number of parameters for
the init function.",False
a9d23400cdb763703a6d757b0c445e7700271abb,2022-01-04 19:41:33,Romain Vimont,"Remove unused enum value requiring SDL 2.0.18

Refs b8fed50639fe3bf8e02a8cc2409494cd6bf30fb7
Fixes #2924 <https://github.com/Genymobile/scrcpy/issues/2924>",False
cca3c953dae05493f7a076b6d8b1de6bf22d56f9,2022-01-02 04:30:33,Romain Vimont,"Enable virtual finger only on left click

The pinch-to-zoom feature must only be enabled with Ctrl+left_click.",False
57f1655d4bb18452615f59d6bb8058bc8d5adfc7,2022-01-02 04:04:56,Romain Vimont,"Make some mouse processors ops optional

Do not force all mouse processors to implement scroll events or touch
events.",False
bc674721dcc9b5b5461443c1b519333b4585fa7d,2022-01-02 04:01:01,Romain Vimont,"Make process_text() optional

Not all key processors support text injection (HID keyboard does not
support it).

Instead of providing a dummy op function, set it to NULL and check on
the caller side before calling it.",False
63e29b1782f18606984550c151a41209c4c809af,2022-01-02 04:01:01,Romain Vimont,"Apply buttons mask if not --forward-all-clicks

If --forward-all-clicks is not set, then only left clicks are forwarded.
For consistency, also mask the buttons state in other events.",False
3c15cbdaf89d352c0b2e79debe9ae04a8100e8b1,2022-01-02 04:01:01,Romain Vimont,"Reorder mouse processor ops

Group the mouse events callbacks before the touch event callback.",False
96e0e8974065312305642cbd2bc203d5f48422cd,2022-01-02 04:00:55,Romain Vimont,"Simplify mouse injection implementation

The static functions are now so simple that they become unnecessary: the
control message may be initialized directly instead.",False
a1f2f5fbd3591be594e1b70fe08f05e7e562c123,2022-01-02 03:58:45,Romain Vimont,"Make some event conversions infallible

When the implementation handles all possible input values, it may never
fail.",False
9460bdd87ba76f03ff27e98973073a6acd8ed306,2022-01-02 03:58:45,Romain Vimont,"Use scrcpy input events for mouse processors

Pass scrcpy input events instead of SDL input events to mouse
processors.

These events represent exactly what mouse processors need, abstracted
from any visual orientation and scaling applied on the SDL window.

This makes the mouse processors independent of the ""screen"" instance,
and the implementation source code independent of the SDL API.",False
b4b638e8fe2a632b045478e6038e6eef19562c5e,2022-01-02 03:58:45,Romain Vimont,"Use scrcpy input events for key processors

Pass scrcpy input events instead of SDL input events to key processors.

This makes the source code of key processors independent of the SDL API.",False
e4396e34c226bd5adfd6c011718a7f101967cce0,2022-01-02 03:58:45,Romain Vimont,"Use common sc_action in input manager

Now that the scrcpy input events API exposes a sc_action enum, use the
same from the input manager.",False
b8fed50639fe3bf8e02a8cc2409494cd6bf30fb7,2022-01-02 03:58:45,Romain Vimont,"Add intermediate input events layer

This aims to make the key/mouse processors independent of the ""screen"",
by processing scrcpy-specific input events instead of SDL events.

In particular, these scrcpy events are not impacted by any UI window
scaling or rotation (contrary to SDL events).",False
d540c72e7cbfe40fc746542c9d2a3e3a1f3193d4,2022-01-02 03:58:45,Romain Vimont,"Rename SC_MOD_* to SC_SHORTCUT_MOD_*

This will avoid conflicts with new SC_MOD_* constants.",False
cd5891fee6de32a79fe76b6269bd5fe8da0b7972,2022-01-02 03:58:45,Romain Vimont,"Remove actions bitset

The input manager exposed functions taking an ""actions"" parameter,
containing a bitmask-OR of ACTION_UP and ACTION_DOWN.

But they are never called with both actions simultaneously anymore, so
simplify.

Refs 964b6d2243fa1921543e48810f3064b9bd2d50d1
Refs d0739911a3e413b70275ded3eef839f9dc57ba7a",False
26ee7ce56638788a82f69a0dc4cf93f41575be71,2022-01-02 03:58:45,Romain Vimont,"Expose V4L2 option on all platforms

This allows to report a meaningful error message if an unsupported
feature is used on an incompatible platform. This is consistent with the
behavior of -K/--hid-keyboard.",False
ba28d817fbb38725cd5bcc5fe3c3c4d45ddfeace,2022-01-02 03:58:45,Romain Vimont,"Fail on unsupported HID option

If the feature is not supported on the platform, fail during command
line parsing instead of using a fallback.",False
37124e14527192799e15af664186d1504bbc68ec,2022-01-02 03:57:34,Romain Vimont,"Avoid unused function warning

If HAVE_SOCK_CLOEXEC is not defined, then sc_raw_socket_close() is never
used. Add an #ifndef block to remove the warning.",False
6b9f39773396c17124fd7411c0b38a4b7d96fa28,2022-01-01 21:50:36,Romain Vimont,Happy new year 2022!,False
1fbc590b26aa0f9b0144c4bbf99a0bf52fe31855,2021-12-31 15:19:22,Romain Vimont,"Fix memory leaks in tests

Tests were failing when run with ASAN enabled.",False
826ddf1a6ee7784e1f72ca6202ebf2cd51b335ef,2021-12-28 16:53:03,Romain Vimont,Document HID keyboard events,False
6261bb0b5a02a9ec0cea81ff3feff047bb94ebbb,2021-12-20 23:54:28,Romain Vimont,"Ignore display bounds on resize-to-fit

The ""resize to fit"" feature (MOD+w or double-click on black borders)
computed the ""optimal size"" using the same function computing the
initial window size on start.

However, on ""resize to fit"", only the black borders must be removed (the
content size must be preserved), so the display bounds must not be
considered.",False
2f091beeaadf991245bcdc1ce9eb5722def7f622,2021-12-20 23:54:28,Romain Vimont,"Simplify sc_size assignment

Assign the whole struct instead of each field separately.",False
720c3064dfd54c67a58df7aa8e94f12512607f37,2021-12-20 23:46:28,Romain Vimont,"Upgrade SDL (2.0.18) for Windows

Include the latest version of SDL in Windows releases.",False
ad11c5babb0ff89647dd606392ed7907a20277c7,2021-12-20 23:43:02,Romain Vimont,"Set DPI awareness for Windows

Add a windows manifest to set the DPI awareness by default:
<https://docs.microsoft.com/en-us/windows/win32/hidpi/setting-the-default-dpi-awareness-for-a-process>

Refs #40 <https://github.com/Genymobile/scrcpy/issues/40>
Fixes #2865 <https://github.com/Genymobile/scrcpy/issues/2865>",False
25a41359358a2032fdcc09482974d5fd15a06511,2021-12-18 21:18:44,Thomas Van Machelen,"Mention react-native menu shortcut in README

PR #2879 <https://github.com/Genymobile/scrcpy/pull/2879>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
feb250a9738ce80e27d8e82e87d08c4038670993,2021-12-15 22:57:45,Romain Vimont,Fix typos reported by codespell,False
d0496719080ccf9ee00fccf6cb0765e31765529f,2021-12-11 23:39:11,Chih-Hsuan Yen,"Fix adb server hang

Since commit 04267085441d6fcd05eff7df0118708f7622e237, the server is run
in a dedicated thread. For SDL, many signals, including SIGINT and
SIGTERM, are masked for new threads. As a result, if the adb server is
not already running, adb commands invoked by scrcpy will start an adb
server that ignores those signals and cannot be terminated at system
shutdown.

Fixes #2873 <https://github.com/Genymobile/scrcpy/issues/2873>
PR #2870 <https://github.com/Genymobile/scrcpy/pull/2870>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0685c491cd8f680b40e733adbbc367b48ec1801e,2021-12-11 00:20:58,Romain Vimont,"Improve crossbuild configuration

Use meson native features to detect crossbuild, and remove the
user-provided option crossbuild_windows.",False
892cfe943ee5cf2001c74a1d39ed8496ba5272db,2021-12-11 00:20:17,Romain Vimont,"Add script to bump version

The version must now be bumped at 4 different places. Add a script to
bump automatically:

    ./bump_version 1.23.4",False
29570ee819c7d08e9c17b3e66b8d8ad3ea735417,2021-12-10 04:08:13,Romain Vimont,"Add metadata to scrcpy.exe for Windows

Refs <https://stackoverflow.com/a/708382/1987178>",False
cfcbc2ac218612b2e9d2322ceb98ec99d7cd9381,2021-12-10 04:08:13,Romain Vimont,"Add icon to scrcpy.exe

The icon will be associated to scrcpy.exe in the Windows explorer.

The .ico was created using imagemagick:

    convert icon.png icon.ico

It is included as a binary for simplicity.

Refs #2815 <https://github.com/Genymobile/scrcpy/issues/2815>",False
2cb4e04209e316ff849d4b48cbac1f38dbfc0035,2021-12-10 04:07:40,Romain Vimont,"Update copyright date to 2021 in manpage

December, it's time to update to 2021!",False
878ffffc36393bc544f4a8cb5a3345d6aab52a02,2021-12-10 02:17:05,Romain Vimont,"Update environment variables section in manpage

Use the same content as the section printed with --help.",False
f0361fc8b374c1827cedcabf3ec011ac78d1f72c,2021-12-10 02:15:39,Romain Vimont,"Add environment variables in help

Print the list of environment variables used by scrcpy in --help.",False
b5d4ec61fcb82c88b7e25ad78651e070194c33f0,2021-12-10 02:13:54,Romain Vimont,"Move newline generation in help

If we removed the shortcuts intro, we would not need the additional '\n'
of the section title, so it should be printed along with the shortcuts
intro.",False
3ada5c51bc25cf4175d73ad69e4750ae7a81fe7e,2021-12-10 02:02:11,Romain Vimont,"Rename scrcpy threads

Prefix the name of threads by ""scrcpy-"". This improves readability in
the output of `top -H` for example.

Limit the thread names to 16 bytes, because it is limited on some
platforms.",False
09c55b0f93f1108d3829e9e4b22670b4ae685280,2021-12-09 04:23:54,Romain Vimont,"Set ""low delay"" decoder flag

I don't really know the concrete benefits, but scrcpy definitely wants
low delay decoding.

Suggested-by: François Cartegnie <fcvlcdev@free.fr>",False
682a6911735cb8f6dccd9653ce30b72f267235c6,2021-12-09 04:15:45,Romain Vimont,"Use timers with microsecond precision

SDL only provides millisecond precision. Use system timers to get a
better precision.",False
ddb9396743072f97628fab168ef7fcd45a597b03,2021-12-09 04:14:23,Romain Vimont,"Interrupt and close sockets on server stop

The sockets were never interrupted or closed by the client since recent
changes to run the server from a dedicated thread (see commit
04267085441d6fcd05eff7df0118708f7622e237).

As a side effect, the server could never terminate properly (it was
waiting on socket blocking calls), so it was always killed by the client
after the WATCHDOG_DELAY.

Interrupt the sockets on stop to give the servera chance to terminate
property, then close them.",False
cabcbc2b151255b49a442a1c43e7db44432eb58e,2021-12-09 04:11:38,Romain Vimont,"Do not create control socket if no control

If --no-control is enabled, then it is not necessary to create a second
communication socket between the client and the server.

This also facilitates the use of the server alone (without the client)
to receive only the raw video stream.",False
80fe12a95fd240e3698966842eef4c06e84fb152,2021-12-07 04:34:35,Romain Vimont,"Require libavcodec >= 57.37

In ffmpeg/doc/APIchanges:

> 2016-04-21 - 7fc329e - lavc 57.37.100 - avcodec.h
>   Add a new audio/video encoding and decoding API with decoupled input
>   and output -- avcodec_send_packet(), avcodec_receive_frame(),
>   avcodec_send_frame() and avcodec_receive_packet().

Refs de9b79ec2dd73e5442c6bf0161669bcd8ca7d5be

Refs #2862 <https://github.com/Genymobile/scrcpy/issues/2862>",False
099c54658057f283d0c4c91b160a77efdbeee4f2,2021-12-07 04:34:27,Romain Vimont,"Require libavformat >= 57.33

In ffmpeg/doc/APIchanges:

> 2016-04-11 - 6f69f7a / 9200514 - lavf 57.33.100 / 57.5.0 - avformat.h
>   Add AVStream.codecpar, deprecate AVStream.codec.

Refs 5d9e96dc4eaa41b185c41e8a6df6191762764b1c

Refs #2862 <https://github.com/Genymobile/scrcpy/issues/2862>",False
dca2c5f94fd0f35ef1c6583cc59bb9ba1b6bdbd4,2021-12-07 04:19:55,Romain Vimont,"Require SDL >= 2.0.5

Icon loading uses SDL_CreateRGBSurfaceWithFormatFrom(), available since
SDL 2.0.5 (in 2016).

Refs #2862 <https://github.com/Genymobile/scrcpy/issues/2862>",False
90cf956f57338e66c983960d767ad6cdf7e7c7a5,2021-12-04 13:59:30,Romain Vimont,Remove spurious ';',False
36c8778d2d83fe74a2de9873db0eabfed77f528c,2021-12-04 13:55:58,Romain Vimont,"Add missing comma

Thank you clang:

    ../app/src/control_msg.c:45:5: warning: suspicious concatenation of
    string literals in an array initialization; did you mean to separate
    the elements with a comma? [-Wstring-concatenation]
        ""hover-exit"",
        ^",False
ae90ef22db27ca0709ca57a3c08236ccb4cb4673,2021-12-04 13:52:35,Romain Vimont,"Add a unit test for clipboard text length

This would have catched the possible memcpy() overflow fixed by the
previous commit.

Refs #2859 <https://github.com/Genymobile/scrcpy/pull/2859>",False
d80bc25ebacc0fe1ba40ab836e03e6590156aecc,2021-12-04 13:48:55,Yu-Chen Lin,"Fix overflow in memcpy

In function ‘memcpy’,
    inlined from ‘control_msg_serialize.constprop’ at ../app/src/control_msg.c:77:5,
    inlined from ‘run_controller’ at ../app/src/controller.c:69:12:
        /usr/include/x86_64-linux-gnu/bits/string_fortified.h:34:10:
        warning: ‘__builtin___memcpy_chk’ writing 262138 bytes into a region
        of size 262130 overflows the destination [-Wstringop-overflow=]
   return __builtin___memcpy_chk (__dest, __src, __len, __bos0 (__dest));

Refs 901d8371655582b432d5d92430177a59df8058b9
PR #2859 <https://github.com/Genymobile/scrcpy/pull/2859>

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
daa06abd34981a09aaecd85307b5719ca34f6034,2021-12-04 13:48:43,Yu-Chen Lin,"Fix comment in control message serialization

Refs 245999aec4a4a1454212b38a988aa96fa701bb04

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
94702a4309c6b25cf87a18c729fda029f8eb6da1,2021-12-04 13:42:20,Romain Vimont,"Fix memset() size in tests

The memset() size was 1 byte too long. It was harmless because the last
'a' was overwritten by '\0`.",False
65fbec96436151e8ebce27c0d46e98b86e78c1ce,2021-12-04 02:17:31,Romain Vimont,Mention SCRCPY_ICON_PATH env var in manpage,False
a208400133a2a7e7392649b593f46eed87be4d91,2021-12-04 02:17:00,Romain Vimont,"Remove useless intermediate variable

Now that PLATFORM is correctly used in the if-condition,
PLATFORM_VERSION is useless.

PR #2850 <https://github.com/Genymobile/scrcpy/pull/2850>",False
ab00210b37b56f32da1d4e48188e4584c50e638b,2021-12-04 02:16:49,yangfl,"Fix script to build without gradle

The PLATFORM variable is assigned either from $ANDROID_PLATFORM or gets
a default value (currently $PLATFORM_VERSION).

The check to use either dx (SDK < 31) or d8 (SDK >= 31) must be based on
the actual $PLATFORM, not the default $PLATFORM_VERSION.

Refs 52138fd9213216a21fbdcda4d430394d7c8f0979
Refs <https://salsa.debian.org/yangfl-guest/scrcpy/-/blob/57d30780dd38b9641992a873d760ac0f4bc3a387/debian/patches/0002-Workaround-broken-script.patch>

PR #2850 <https://github.com/Genymobile/scrcpy/pull/2850>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5704ec6967c03510dd7d206e5f59c1e4fd6e10a0,2021-12-02 13:18:47,Archisman Panigrahi,"AUR to official Arch Repository

PR #2844 <https://github.com/Genymobile/scrcpy/pull/2844>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
64a04b8d4a263df1a6eaf5f9794b9e7974d3b591,2021-12-01 22:32:35,Romain Vimont,"Fix process execution on Windows 7

According to this bug report on Firefox:
<https://bugzilla.mozilla.org/show_bug.cgi?id=1460995>

> CreateProcess fails with ERROR_NO_SYSTEM_RESOURCES on Windows 7. It
> looks like the reason why is because PROC_THREAD_ATTRIBUTE_HANDLE_LIST
> doesn't like console handles.

To avoid the problem, do not pass console handles to
PROC_THREAD_ATTRIBUTE_HANDLE_LIST.

Refs #2783 <https://github.com/Genymobile/scrcpy/pull/2783>
Refs f801d8b3128cf5aae3725c981f32abfd4b6c307e
Fixes #2838 <https://github.com/Genymobile/scrcpy/issues/2838>
PR #2840 <https://github.com/Genymobile/scrcpy/pull/2840>",False
86c91e183d1fae21f43172c7d67140cefdc3cc1c,2021-11-30 14:11:47,Romain Vimont,"Log CreateProcessW() error code on Windows

Refs #2838 <https://github.com/Genymobile/scrcpy/issues/2838>",False
cb8713eb1fcb8baff914f04952c55411891f86a5,2021-11-30 02:54:06,Romain Vimont,Update links to v1.21,False
003e7381064f2c0e8ce1095d1a65522fab4e118b,2021-11-30 02:45:28,Romain Vimont,Bump version to 1.21,False
30c79f2d25ab1071ebfe1ba9d1c1eccc19dabcbc,2021-11-30 02:38:43,Romain Vimont,Merge branch 'master' into dev,True
b25b674c450db3817b529a89079908d75245a300,2021-11-30 02:33:58,Romain Vimont,Clarify TCP/IP mode in README,False
e2b3968c66ff1310d7644aef92dcb543604e1b6b,2021-11-30 02:30:55,Romain Vimont,"Always synchronize clipboard on explicit COPY/CUT

If --no-clipboard-autosync is enabled, the automatic clipboard
synchronization performed whenever the device clipboard changes is
disabled.

But on explicit COPY and CUT scrcpy shortcuts (MOD+c and MOD+x), the
clipboard should still be synchronized, so that it remains possible to
copy-paste from the device to the computer.

This is consistent with the behavior of MOD+v, which pastes the computer
clipboard to the device.

Refs #2228 <https://github.com/Genymobile/scrcpy/issues/2228>
Refs #2817 <https://github.com/Genymobile/scrcpy/pull/2817>
PR #2834 <https://github.com/Genymobile/scrcpy/pull/2834>",False
bfcb9d06c351e4976cdc3b69a24bf35b8f1bb1c2,2021-11-30 02:30:21,Romain Vimont,"Expose sync mode for injecting events

Expose the inject input event mode so that it is possible to wait for
the events to be ""finished"". This will be necessary to read the
clipboard content only after the COPY or CUT key event is handled.

PR #2834 <https://github.com/Genymobile/scrcpy/pull/2834>",False
dc19ae334dcc55f64a9e29ec9d5e754c6da69657,2021-11-30 02:28:30,Romain Vimont,"Move acknowledgment handling

Handle all actions related to SET_CLIPBOARD from the dedicated method.

PR #2834 <https://github.com/Genymobile/scrcpy/pull/2834>",False
cbe73b0bc3595ec191b6907edcace3fbb49b2506,2021-11-30 02:25:37,Romain Vimont,"Fix set_clipboard message log

If paste is disabled on set_clipboard, then the PASTE key is not
injected, but COPY is unrelated.

PR #2834 <https://github.com/Genymobile/scrcpy/pull/2834>",False
bf97a46b0c93fa1ef71dbeff86f42f5ceccdb2ab,2021-11-30 02:25:12,Romain Vimont,Upgrade gradle build tools to 7.0.3,False
bd56d81f728d29a0c710276f64e6c754edde217a,2021-11-30 01:45:41,Romain Vimont,"Add --raw-key-events

This option allows to inject all input keys as key events, and ignore
text events.

Fixes #2816 <https://github.com/Genymobile/scrcpy/issues/2816>
PR #2831 <https://github.com/Genymobile/scrcpy/pull/2831>",False
5e918ac0c39cf7004c7f6843f2d28d4a06fd216e,2021-11-30 01:45:32,Romain Vimont,"Use enum for key injection mode

There was only two key injection modes:
 - the default one
 - the mode with --prefer-text enabled

To prepare the addition of another mode (--raw-key-events), use an enum
instead of a bool.

PR #2831 <https://github.com/Genymobile/scrcpy/pull/2831>",False
0c0f62e4abe5bd58d9a2a90585b252c574009eec,2021-11-30 01:45:07,Romain Vimont,"Use static maps to convert input events

This improves readability (hopefully).

PR #2831 <https://github.com/Genymobile/scrcpy/pull/2831>",False
c96505200a21d6816740fa1d0e272180280306e6,2021-11-30 01:31:57,Romain Vimont,Fix code style in keyboard_inject,False
82a053015d01d3a1e1b6f60fbe6c0cd6910dc344,2021-11-30 01:31:15,Romain Vimont,"Improve HID keyboard documentation

Explain how to configure the keyboard layout.",False
1a6caeb18c06ddd3a1116a0e82d65be15b2f48b4,2021-11-30 01:09:03,Romain Vimont,"Document --tcpip in README

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
19858e6aeb99b57de28f042053b8c3d4372e56ca,2021-11-30 01:09:03,Romain Vimont,"Add --tcpip feature

Expose an option to automatically configure and reconnect the device
over TCP/IP, to simplify wireless connection without using adb
explicitly.

There are two variants:
 - If a destination address is provided, then scrcpy connects to this
   address before starting. The device must listen on the given TCP port
   (default is 5555).
 - If no destination address is provided, then scrcpy attempts to find
   the IP address of the current device (typically connected over USB),
   enables TCP/IP mode, then connects to this address before starting.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
3b310f8317e4f62ee5aa76786aa75e3d610d34e0,2021-11-30 01:09:03,Romain Vimont,"Extract interruptible sleep for server

This improves readability, and makes the function reusable.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
800ba33ff42be775a279e02deef4b655ec3e991f,2021-11-30 01:09:03,Romain Vimont,"Add function to read an adb property

This will allow to read the property ""service.adb.tcp.port"" to know if
the TCP/IP mode is enabled on the device, and which listening port is
used.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
8543d842ea4d73d6912c38f9702f7a18651b3d49,2021-11-30 01:09:03,Romain Vimont,"Add function to switch device to TCP/IP mode

Expose a function to execute ""adb tcpip <port>"".

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
f609b406c9226144d9a7fdd7cdd12919ceaa2c73,2021-11-30 01:09:03,Romain Vimont,"Add function to find the device IP address

Parse the result of ""adb shell ip route"" to find the device IP address.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
b7e631791cc0c9af407c9f625047754f6adf369c,2021-11-30 01:09:03,Romain Vimont,"Add util function to remove trailing '\r'

Depending on the platform and adb versions, the lines output by adb
could end with ""\r\r\n"". This util function helps to remove all trailing
'\r'.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
b52f87a892ec97beb2afb1e0a711632038ccfe4a,2021-11-30 01:09:03,Romain Vimont,"Add util function to locate a column in a string

This will help to parse the result of ""adb shell ip route"" to find the
device IP address.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
3bf6fd2894c283a976320b8f0862a63be0d78635,2021-11-30 01:09:03,Romain Vimont,"Workaround ""adb connect"" error detection

""adb connect"" always returns successfully (with exit code 0), even in
case of failure.

As a workaround, capture its output and check if it starts with
""connected"".

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
bfce22414fd3173b9671140d77d2e8a927d5ff94,2021-11-30 01:09:03,Romain Vimont,"Add adb connect and disconnect

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
e6e6f865a01879365f284fd3c8bfe7758ebf1bb5,2021-11-30 01:09:03,Romain Vimont,"Add adb flag to disable execution error logs

In addition to disable stdout and stderr of the child process, add a
flag to disable the error log printed by scrcpy if the command failed.

This will we useful for commands which are expected to fail in some
cases (like ""adb disconnect"" if the device is not connected).

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
e3d4aa8c5d42279e0095404d76f2b5bc2b7c52d7,2021-11-30 01:09:03,Romain Vimont,"Use flags for adb commands

Explicitly indicate, for each adb call, if stdout and stderr must be
inherited.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
f801d8b3128cf5aae3725c981f32abfd4b6c307e,2021-11-30 01:09:03,Romain Vimont,"Expose flags for process execution

Let the caller decide if stdout and stderr must be inherited on process
creation, i.e. if stdout and stderr of the child process should be
printed in the scrcpy console.

This allows to get output and errors for specific adb commands depending
on the context.

PR #2827 <https://github.com/Genymobile/scrcpy/pull/2827>",False
01ab503c229514196ae633966277b76639e438b2,2021-11-29 05:06:09,Romain Vimont,"Remove obsolete precision in README

Scrcpy is available in Debian stable packages, and several Ubuntu
versions.",False
b9b8b6aab828e0f1ca899171ecf5c7bfcaf9df46,2021-11-26 14:11:11,Romain Vimont,"Simplify Windows process inheritance configuration

Merge if-blocks together.",False
3e54773c4843b94f16df04af2c0edafef060f82e,2021-11-26 14:11:11,Romain Vimont,"Remove intermediate static functions from adb.c

They can easily be inlined into the public functions.",False
b90c89766b1e13afc82c2aba2ebd5d54c83c067f,2021-11-26 14:10:39,Romain Vimont,"Set CLOEXEC flag on sockets

If SOCK_CLOEXEC exists, then set the flag on socket creation.

Otherwise, use fcntl() (or SetHandleInformation() on Windows) to set the
flag afterwards.

This avoids the sockets to be inherited in child processes.

Refs #2783 <https://github.com/Genymobile/scrcpy/pull/2783>",False
904f0ae61e7902973e862a6151ef972877fc3380,2021-11-26 02:52:34,Romain Vimont,"Check process success locally for adb commands

Remove sc_process_check_success() from the process API, it is too
specific.",False
680d2cc9400d371a8c26402aa49ab4cf6a3d6b7e,2021-11-26 02:52:34,Romain Vimont,"Extract command argv building

This simplifies adb_execute_p().",False
8ed3328055c52fd415954626c4a1f763b24a1927,2021-11-26 02:52:34,Romain Vimont,"Use unsigned for connection attempts count

There is no reason to use an explicit uint32_t.",False
d31725f07708908ced7a71ea53a4d8a3e6bbb4b6,2021-11-26 02:52:34,Romain Vimont,"Reorder cli sanity checks

Check unexpected additional arguments before other sanity checks.",False
b0eb1a55d6f1180df2d19fda91d08290dff4f687,2021-11-26 02:52:34,Romain Vimont,"Fix adb get-serialno error handling

If pipe read fails, return.",False
3653fb6b152af502885734e6d6cadbdda3421773,2021-11-25 02:36:49,Romain Vimont,"Add OutOfMemory log helper

Add a special LOG_OOM() function to log all OutOfMemory errors (i.e.
allocations returning NULL).",False
92a458e846410ff7990229be86a5931046229c80,2021-11-25 02:18:57,Romain Vimont,Remove unreachable return statements,False
73e0311d149e8fc64b6ca6d6ac79e5dee219c18c,2021-11-25 02:16:02,Romain Vimont,"Add missing return on file_handler failure

Mistake introduced by 84334cf7db68732eb92caf6cf9682c7ef2c426f6.",False
007f616302d08993835588e98f2836e0bf6d732d,2021-11-25 02:14:29,Romain Vimont,"Add missing includes

Include these headers explicitly instead of relying on transitivity.",False
4c4759886518f8c6fed10eefe31043d871b293af,2021-11-25 02:03:58,Romain Vimont,"Make lockVideoOrientation option name uniform

On the server, the option was named lockedVideoOrientation.",False
7b29f5fd2de8f302e03365013093f5665efd3cfd,2021-11-25 02:01:12,Romain Vimont,"Do not pass default values to the server

By default, only pass the version and the bit rate (the default bitrate
is a client compilation option).",False
04e5537f8ce21dbae365dcd980efda911188c945,2021-11-25 01:53:20,Romain Vimont,"Pass server parameters as key=value pairs

The options values to configure the server were identified by their
command-line argument index. Now that there are a lot of arguments, many
of them being booleans, it became unreadable and error-prone.

Identify the arguments by a key string instead, and make them optional.

This will also simplify running the server manually for debugging.",False
2eb881c5f13ae2c3a8c9ca68188c1abce77b48bd,2021-11-25 01:40:18,Romain Vimont,"Allocate and format server command args

This simplifies formatting.",False
2c3099e2de13913332f3e0085faf646e19bb976b,2021-11-25 01:36:02,Romain Vimont,"Parse codec options early

For consistency with other options, parse the codec options on the
server before storing them in the Options instance.",False
5434ea543cf94fcec389483b1fc021c2f13a34b3,2021-11-25 01:31:25,Romain Vimont,"Remove local ""serial"" variable

In execute_server(), the serial is used only once. Moreover, it can be
retrieved from the `params` argument directly.",False
d5f6697f3a592245e8bd12a0ea8dbd24d3129296,2021-11-25 00:25:00,Romain Vimont,"Add (v)asprintf compatibility functions

In case they are not available on the platform.",False
d6c0054545dda7b105ecda51c4f99a221dc36f79,2021-11-25 00:08:33,Romain Vimont,"Move check_functions in meson script

Move the variable to the place it is actually used.",False
6f487a28928c396fb6d1d5bb8d58f5b5f5df4d29,2021-11-25 00:07:33,Romain Vimont,"Add missing includes in compat implementation

These includes are necessary for the strdup() compat implementation.",False
dc0ac01e0089c42703e422e00af439c57e41b9a4,2021-11-25 00:06:33,Romain Vimont,"Define common feature test macros for all systems

_POSIX_C_SOURCE, _XOPEN_SOURCE and _GNU_SOURCE are also used on Windows.

Fix regression introduced by ba547e3895397e3710e7eb14faafbabbd7e3a077.",False
6abff46c9f8414bfc62cc8bb85c10555ab62eff9,2021-11-24 14:14:39,Romain Vimont,"Add option to disable clipboard autosync

By default, scrcpy automatically synchronizes the computer clipboard to
the device clipboard before injecting Ctrl+v, and the device clipboard
to the computer clipboard whenever it changes.

This new option --no-clipboard-autosync disables this automatic
synchronization.

Fixes #2228 <https://github.com/Genymobile/scrcpy/issues/2228>
PR #2817 <https://github.com/Genymobile/scrcpy/pull/2817>",False
5d17bcf1bc38690739c88ad2b0a069a67c8bedce,2021-11-24 14:11:21,Romain Vimont,"Wait SET_CLIPBOARD ack before Ctrl+v via HID

To allow seamless copy-paste, on Ctrl+v, a SET_CLIPBOARD request is
performed before injecting Ctrl+v.

But when HID keyboard is enabled, the Ctrl+v injection is not sent on
the same channel as the clipboard request, so they are not serialized,
and may occur in any order. If Ctrl+v happens to be injected before the
new clipboard content is set, then the old content is pasted instead,
which is incorrect.

To minimize the probability of occurrence of the wrong order, a delay of
2 milliseconds was added before injecting Ctrl+v. Then 5ms. But even
with 5ms, the wrong behavior sometimes happens.

To handle it properly, add an acknowledgement mechanism, so that Ctrl+v
is injected over AOA only after the SET_CLIPBOARD request has been
performed and acknowledged by the server.

Refs e4163321f00bb3830c6049bdb6c1515e7cc668a0
Refs 45b0f8123a52f5c73a5860d616f4ceba2766ca6a

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
2d5525eac128c6bb02344d733ab487b3aedd2431,2021-11-24 01:45:05,Romain Vimont,"Move PRIu64 Windows workaround to compat.h

So that we can use it from several files.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
41abe021e2a73efd4899b0efcd0b9eef9ec68c9b,2021-11-24 01:45:05,Romain Vimont,"Make the device acknowledge device clipboard

If the client provided a sequence number on SET_CLIPBOARD request, make
the device send back an acknowledgement once the clipboard is set.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
2a0730ee9bacc8df92c7c38ce83a735182d685e0,2021-11-24 01:45:05,Romain Vimont,"Add device clipboard set acknowledgement

Add a device message type so that the device could send acknowledgements
for SET_CLIPBOARD requests.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
901d8371655582b432d5d92430177a59df8058b9,2021-11-24 01:45:05,Romain Vimont,"Add sequence number to set_clipboard request

This will allow the client to request an acknowledgement.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
aba1fc03c3702404b30b7a8aebd2489f8b7fed1c,2021-11-24 01:45:05,Romain Vimont,"Add acksync helper to wait for acks

This will allow to send requests with sequence numbers to the server
and wait for acknowledgements.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
5b3856c3b6bed67abfd20585daa8eb43fa863582,2021-11-24 01:45:05,Romain Vimont,"Explicitly indicate when device clipboard is set

Pass the information that device clipboard has been set to the key
processor. This avoids the keyprocessor to ""guess"", and paves the way to
implement a proper acknowledgement mechanism.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
854de9659a503291fc310ed6702bd4278bf2a725,2021-11-24 01:45:05,Romain Vimont,"Do not inject Ctrl+v if clipboard sync failed

This prevents to paste the current Android clipboard, which would be
unexpected.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
ea8028332ced7ef61e755742ad9e91586e3193e3,2021-11-24 01:44:49,Romain Vimont,"Synchronize computer-to-device empty clipboard

Set the device clipboard to empty string if necessary. Otherwise, the
current device clipboard will be pasted on Ctrl+v.

PR #2814 <https://github.com/Genymobile/scrcpy/pull/2814>",False
0427a981e59ff5c5f188de5d34722c7f098ecf43,2021-11-22 03:27:33,Romain Vimont,"Use UINT64_C macro for uint64_t constant in tests

A long constant might not be sufficient.",False
44721ed98235b262fc77d686ec5020c72a8dcb42,2021-11-22 03:07:52,Romain Vimont,"Document remote ADB server in README

Refs #2807 <https://github.com/Genymobile/scrcpy/pull/2807>",False
68eaee5bb086383e601ac64e9ff0aa65830599e3,2021-11-22 03:07:52,Romain Vimont,"Force adb forward if tunnel host/port is provided

Tunnel host and port are only meaningful in ""adb forward"" mode.

They indicate where the client must connect to communicate with the
server. In ""adb reverse"" mode, the client _listens_, it does not
_connect_.

Refs #2807 <https://github.com/Genymobile/scrcpy/pull/2807>",False
7bdbde7363836b79864f876f6a4cc107785a7147,2021-11-22 03:07:52,RipleyTom,"Add options to configure tunnel host and port

In ""adb forward"" mode, by default, scrcpy connects to localhost:PORT,
where PORT is the local port passed to ""adb forward"". This assumes that
the tunnel is established on the local host with a local adb server
(which is the common case).

For advanced usage, add --tunnel-host and --tunnel-port to force the
connection to a different destination.

Fixes #2801 <https://github.com/Genymobile/scrcpy/issues/2801>
PR #2807 <https://github.com/Genymobile/scrcpy/pull/2807>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
52e5181c841580b582e44dbdbdf08df533637d07,2021-11-22 03:07:37,RipleyTom,"Add function to parse IPv4 addresses

PR #2807 <https://github.com/Genymobile/scrcpy/pull/2807>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ba547e3895397e3710e7eb14faafbabbd7e3a077,2021-11-21 04:50:11,Romain Vimont,"Configure feature test macros in meson

Refs #2807 <https://github.com/Genymobile/scrcpy/pull/2807>

Co-authored-by: RipleyTom <RipleyTom@users.noreply.github.com>",False
226f3b2c915075266088d5483e385a7ce0d8b654,2021-11-21 04:43:25,Romain Vimont,Add missing include config.h,False
2d6a96776c9e4afeba74e98f70dd98d29e226b0d,2021-11-20 01:33:29,Romain Vimont,Improve SSH tunnel documentation in README,False
6da6d905c2aeac17255347037d44c32a62c4c504,2021-11-19 14:15:02,Romain Vimont,"Print scrcpy header first

Inconditionnally print the scrcpy version first, without using LOGI().

The log level is configured only after parsing the command line
parameters (it may be changed via -V), and command line parsing logs
should not appear before the scrcpy version.",False
b25404ee4b6f2cbdd41992fa3e087dd8a73412c9,2021-11-19 12:48:13,Romain Vimont,"Print help to stdout

The output of -h/--help was printed on stderr, although it is not an
error.

Printing on stdout allows to pipe the result directly:

    scrcpy --help | less

Instead of (in bash):

    scrcpy --help |& less",False
4cfc1cd70a269c8a27f8d2ef0ac5e7eaebaae8b5,2021-11-19 12:36:23,Romain Vimont,Assert that long options are correctly set,False
2fc80eae2db098f613b45b99b6d49ea9a455724d,2021-11-19 11:55:03,Romain Vimont,"Simplify adb_tunnel

With the new adb functions, the static adb_tunnel functions become
unnecessary.",False
3fdbd994e0f0a2608eed28ca8047b8bc1ec3f92c,2021-11-19 11:55:03,Romain Vimont,"Privatize low-level adb functions

Only expose the interruptible user-friendly API.",False
ce225f019accf3c9e043a04a7a405d76fb5b0888,2021-11-19 02:41:19,Romain Vimont,"Use new user-friendly adb API

Replace the adb_exec_*() calls by the new adb functions to simplify.",False
b7559744a7164124e7d358d2cb3bd744993487a2,2021-11-19 02:38:15,Romain Vimont,"Expose new user-friendly adb functions

Expose interruptible adb functions which return the expected result
directly, without exposing the process (sc_pid) to the caller.",False
afb5a5e80f8946dc4fb7d68d753ed3d0cd6bc877,2021-11-19 02:17:17,Romain Vimont,"Rename adb functions to adb_exec_*

This paves the way to replace them by more user-friendly functions that
will call them internally.",False
84334cf7db68732eb92caf6cf9682c7ef2c426f6,2021-11-19 02:03:25,Romain Vimont,"Use sc_intr in file_handler

Replace manual interruption handling by the recent sc_intr mechanism.",False
0ba2686e1db2fff2e65fc53a478d1266aca6b776,2021-11-19 00:16:47,Romain Vimont,"Simplify file_handler

Call the target functions directly.",False
55648d4d6479efd1052091fda34e60a871a2c1c1,2021-11-19 00:16:40,Romain Vimont,"Improve file_handler readability

Use local variables as short name aliases.",False
13fd693b501b59a95e4e72b7ccba7c267cdc8590,2021-11-19 00:13:10,Romain Vimont,"Simplify adb_execute_p()

Only pass the stdout pipe as parameter, scrcpy never writes to stdin or
reads from stderr of an adb process.",False
0426ae885c13e5901a4994f01086839a3bc13728,2021-11-19 00:11:41,Romain Vimont,"Make ""adb get-serialno"" interruptible

All process executions must be interruptible, so that Ctrl+c reacts
immediately.",False
ea454e9cee1cedb1fb7b8aed7fde46bd76bb031b,2021-11-19 00:09:11,Romain Vimont,"Add interruptible function to read from pipe

This will avoid to block Ctrl+c if the process the pipe is read from
takes too much time.",False
cb655315330f5435b7849d256e33f8c148fd38d6,2021-11-19 00:07:53,Romain Vimont,"Simplify sc_str_truncate()

Use strcspn() to get the prefix length directly.",False
9619ade706824a92ea387bdc9d0d27816bf79da5,2021-11-18 23:18:16,Romain Vimont,"Generalize string trunctation util function

Add an additional argument to let the client pass the possible end
chars.",False
f2781a8b6d5c37d1fa3c0d0291a01a8bd918dddd,2021-11-18 23:18:16,Romain Vimont,"Expose util function to truncate first line

Move the local implementation from adb functions to the string util
functions.",False
443cb14d6e8c37cb6f633bfd486ff669af9d4121,2021-11-18 23:18:11,Romain Vimont,"Assume non-NULL serial in file_handler

The previous commit guarantees to always initialize the serial, so the
file_handle may assume it is never NULL.",False
b30c3a429f63bfa83079d2af48378cd0dbc0bdb8,2021-11-18 23:02:15,Romain Vimont,"Always retrieve device serial

This allows to execute all adb commands with the specific -s parameter,
even if it is not provided by the user.

In practice, calling adb without -s works if there is exactly one device
connected. But some adb commands (for example ""adb push"" on drag & drop)
could be executed after another device is connected, so the actual
device serial must be known.",False
632bd5697b6e699e8945a79642a11fd3ffdcc289,2021-11-18 23:02:15,Romain Vimont,"Add missing error handling

If ""adb get-serialno"" fails, attempting to read from the uninitialized
pipe is incorrect.",False
de5084690524a9f01ef3012e8e87b116f65625d4,2021-11-18 23:01:36,Romain Vimont,"Close process on check success

The interruptible version of the function to check process success
(sc_process_check_success_intr()) did not accept a close parameter to
avoid a race condition. But as the result, the processes were not closed
at all.

Add a close parameter, and close the process separately to avoid the
race condition.",False
ee93d2aac17ddb996ba42e1f898e34a970ade88a,2021-11-18 13:07:32,Romain Vimont,"Configure init and cleanup asynchronously

Accessing the settings (like --show-touches) on start should not delay
screen mirroring.

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
c29a0bf675dc94fd350ea696d3ffa772651ff4bb,2021-11-18 13:07:28,Romain Vimont,"Do not quit on cleanup configuration failure

Cleanup is used for some options like --show-touches to restore the
state on exit.

If the configuration fails, do not crash the whole process. Just log an
error.

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
411bb0d18e4d09f10480d2a60dcb7187b4fc62aa,2021-11-18 13:07:26,Romain Vimont,"Move init and cleanup to a separate method

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
cc0902b13c87fc98b1ed90b0700cc53ac4d7ee3c,2021-11-18 13:07:22,Romain Vimont,"Read/write settings via command on Android >= 12

Before Android 8, executing the ""settings"" command from a shell was
very slow (~1 second), because it spawned a new app_process to execute
Java code. Therefore, to access settings without performance issues,
scrcpy used private APIs to read from and write to settings.

However, since Android 12, this is not possible anymore, due to
permissions changes.

To make it work again, execute the ""settings"" command on Android 12 (or
on previous version if the other method failed). This method is faster
than before Android 8 (~100ms).

Fixes #2671 <https://github.com/Genymobile/scrcpy/issues/2671>
Fixes #2788 <https://github.com/Genymobile/scrcpy/issues/2788>
PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
48b572c272901af1b32afa204ae011ebb9344b40,2021-11-18 13:07:18,Romain Vimont,"Add throwable parameter to Log.w()

When an exception occurs, we might want to log a warning instead of an
error.

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
94feae71f2bf603b1cbd78611a2fdecdfcf40b67,2021-11-18 13:07:02,Romain Vimont,"Report settings errors via Exceptions

Settings read/write errors were silently ignored. Report them via a
SettingsException so that the caller can handle them.

This allows to log a proper error message, and will also allow to
fallback to a different settings method in case of failure.

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
67170437f1eb2c9f2780d720b3079d7d8722b9f4,2021-11-18 13:06:48,Romain Vimont,"Wrap settings management into a Settings class

Until now, the code that needed to read/write the Android settings had
to explicitly open and close a ContentProvider.

Wrap these details into a Settings class.

This paves the way to provide an alternative implementation of settings
read/write for Android >= 12.

PR #2802 <https://github.com/Genymobile/scrcpy/pull/2802>",False
57fb08e443272a9d346b036fb421cdf0ccff3074,2021-11-17 23:44:32,LuXu,"Update Simplified Chinese README to 1.20

PR #2786 <https://github.com/Genymobile/scrcpy/pull/2786>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
02ae0db6cd14a06899e6f8e92bfe107210ec51a3,2021-11-16 03:12:08,Alex Burdusel,"Fix wrong package to install for Ubuntu/Debian

Without this package, meson fails:

    Run-time dependency libusb-1.0 found: NO (tried pkgconfig and cmake)
    app/meson.build:88:8: ERROR: Dependency ""libusb-1.0"" not found, tried pkgconfig and cmake

PR #2790 <https://github.com/Genymobile/scrcpy/pull/2790>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9cb14b51663d61c6f0b41da3c5699de418d633aa,2021-11-15 14:43:30,Romain Vimont,"Inherit only specific handles on Windows

To be able to communicate with a child process via stdin, stdout and
stderr, the CreateProcess() parameter bInheritHandles must be set to
TRUE. But this causes *all* handles to be inherited, including sockets.

As a result, the server socket was inherited by the process running adb
to execute the server on the device, so it could not be closed properly,
causing other scrcpy instances to fail.

To fix the issue, use an extended API to explicitly set the HANDLEs to
inherit:
 - <https://stackoverflow.com/a/28185363/1987178>
 - <https://devblogs.microsoft.com/oldnewthing/20111216-00/?p=8873>

Fixes #2779 <https://github.com/Genymobile/scrcpy/issues/2779>
PR #2783 <https://github.com/Genymobile/scrcpy/pull/2783>",False
9cb8766220b55e9ac5d222d16f2138c481034e0d,2021-11-15 12:19:01,Romain Vimont,"Factorize resource release after CreateProcess()

Free the wide characters string in all cases before checking for errors.",False
fd4ec784e02d5f3ce715c3b1e1f967716a069667,2021-11-15 03:23:49,Romain Vimont,"Remove useless assignments on error

Leave the output parameter untouched on error.",False
52cebe1597cef201f28dc3c6122dc022616362c2,2021-11-15 03:11:38,Romain Vimont,"Fix Windows sc_pipe function names

The implementation name was incorrect (it was harmless, because they are
not used on Windows).",False
6a27062f486a1abba07defac4ca0458b0e43ecb6,2021-11-14 20:10:59,Romain Vimont,"Stop connection attempts if interrupted

If the interruptor is interrupted, every network call will fail, but the
retry-on-error mechanism must also be stopped.",False
739ff9dce011238844dc00e4e245afbb0561928d,2021-11-14 20:07:30,Romain Vimont,"Fix compilation errors with old SDL versions

SDL_PixelFormatEnum has been introduced in SDL 2.0.10:
<https://github.com/libsdl-org/SDL/commit/cc6a8ac87e41d0df68075081dbf5cd2ba46f8fd4>

SDL_PIXELFORMAT_BGR444 has been introduced in SDL 2.0.12:
<https://github.com/libsdl-org/SDL/commit/a1c11854f28b7186a744df412aa6273862459c31>

Fixes #2777 <https://github.com/Genymobile/scrcpy/issues/2777>
PR #2781 <https://github.com/Genymobile/scrcpy/pull/2781>

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>",False
65b023ac6d586593193fd5290f65e25603b68e02,2021-11-14 06:21:32,Romain Vimont,Update links to v1.20,False
a045e28df83711ea5ea10d8dc9f8dfaf781a022a,2021-11-14 05:55:24,Romain Vimont,Bump version to 1.20,False
52138fd9213216a21fbdcda4d430394d7c8f0979,2021-11-14 05:55:24,Romain Vimont,"Update script to build without gradle to SDK 31

Build tools 31.x.x do not ship dx anymore. Use d8 instead.

Refs 8bf28e9f5340d2a54dbc9b2c9d924b7ee4fa8d31",False
1bb0df5da17a08473a7bdf2e6419a0f0966aa023,2021-11-14 05:55:24,Romain Vimont,"Extract ANDROID_JAR path in build script

This will allow to reuse it.",False
562ec6e9b35fdb8ee4bfc54eb7f3be1f37259880,2021-11-14 05:55:00,Romain Vimont,Merge branch 'master' into dev,True
1be5daf999a59cd4b70fbf8e4745217f90eb4e03,2021-11-14 05:53:06,Romain Vimont,Fix word order in README,False
57387fa7077850f11b9ab6ce699cb5c7876964d6,2021-11-14 05:53:06,Romain Vimont,Mention crash on Android 12 on old scrcpy in FAQ,False
4e811a4a685aba17c517db1f68e434dcfa907d5b,2021-11-14 05:53:06,Romain Vimont,"Adapt icon in README

Use SVG format, align to the right, and reduce its size.",False
99a4a4847711c4ab02dac63550bda8435330d338,2021-11-14 05:53:06,Romain Vimont,"Replace ""connected on"" to ""connected via""

I'm not sure ""connected on USB"" is correct.",False
1d97d77032f62cc48e6eb03e3c77d68951b5cb92,2021-11-14 05:53:06,Romain Vimont,Improve scrcpy presentation in README,False
45b0f8123a52f5c73a5860d616f4ceba2766ca6a,2021-11-14 05:53:06,Romain Vimont,"Increase delay to inject HID on Ctrl+v

2 milliseconds turn out to be insufficient sometimes. It seems that 5
milliseconds is enough (and still not noticeable).",False
c1a34881d733dd91d2c4d2184ad4b89ffee8314e,2021-11-14 05:53:05,Romain Vimont,Use sc_ prefix for server,False
057c7a4df4ec1bd70c660cfe03a590e996c744ad,2021-11-14 05:52:22,Romain Vimont,"Move str_util to str

Simplify naming.",False
979ce64dc091bc54a0ac8612a0368f5163500f39,2021-11-14 05:52:22,Romain Vimont,"Improve string util API

Use prefixed names and improve documentation.",False
9a0bd545d533d13fda8823481330329d6865cb2c,2021-11-14 05:52:22,Romain Vimont,"Rename SC_INVALID_SOCKET to SC_SOCKET_NONE

For consistency with SC_PROCESS_NONE.",False
c4d008b96ae3f23a467642fed38f91e54b1f36b8,2021-11-14 05:52:22,Romain Vimont,"Extract adb tunnel to a separate component

This simplifies the server code.",False
0d45c29d13be15764a3e58e47d5e55f07b4e5dee,2021-11-14 05:52:22,Romain Vimont,"Move IPV4_LOCALHOST to net.h

This constant will be used from several files.",False
37c840a4c83a240d7cf327395bd4be7a882eda65,2021-11-14 05:52:22,Romain Vimont,"Interrupt on process terminated

Interrupt any blocking call on process terminated, like on
server_stop().

This allows to interrupt any blocking accept() with correct
synchronization without additional complexity.",False
f488cbd7e7f8a74ace23416faa962b6a510f8374,2021-11-14 05:52:20,Romain Vimont,"Make server interruptible

Use an interruptor to immediately wake up blocking calls on
server_stop().",False
40340509d9245694bf46e60604c0fb262f668465,2021-11-14 03:24:18,Romain Vimont,"Add interruptor utilities

Expose wrapper functions for interrupting blocking calls, for process
and sockets.",False
e0896142dbbbadd87a6339111a406307edca1b97,2021-11-14 03:23:07,Romain Vimont,"Introduce interruptor tool

An interruptor instance will help to wake up a blocking call from
another thread (typically to terminate immediately on Ctrl+C).",False
04267085441d6fcd05eff7df0118708f7622e237,2021-11-13 14:49:52,Romain Vimont,"Run the server from a dedicated thread

Define server callbacks, start the server asynchronously and listen to
connection events to initialize scrcpy properly.

It will help to simplify the server code, and allows to run the UI event
loop while the server is connecting. In particular, this will allow to
receive SIGINT/Ctrl+C events during connection to interrupt immediately.",False
5b9c88693ea1b2d19f325ab6ff6c06119781a101,2021-11-13 14:47:51,Romain Vimont,"Wait using a condition variable in server

Currently, server_stop() is called from the same thread as
server_connect_to(), so interruption may never happen.

This is a step to prepare executing the server from a dedicated thread.",False
a54dc8212ffb1eec975a27a4d70fea25ed8c3f24,2021-11-13 14:46:35,Romain Vimont,"Reorder server functions

This will avoid forward declarations in future commits.",False
882e4cff5f2e1d22748b79d3371e47e4d0874ca3,2021-11-13 14:35:20,Romain Vimont,"Copy server params

This is a preliminary step necessary to move the server to a separate
thread.",False
9fa4d1cd4a7a54d19593aa460eacbd34a665216b,2021-11-13 14:35:20,Romain Vimont,"Reorder server and server_params

This will allow to define a server_params field in server.",False
0bfa75a48b49d70bf0a50d48d5d1d63dd1d126ac,2021-11-13 14:35:20,Romain Vimont,"Split socket creation and connect/listen

This will allow to assign the socket to a variable before connecting or
listening, so that it can be interrupted from another thread.",False
ed19901db1d24d4791f5836a613505083a0d94d3,2021-11-13 14:35:01,Romain Vimont,"Set video and control sockets only on success

Store the video and control sockets only if server_connect_to() returns
successfully.",False
e69356c5506667135a6479758b594863c8ef15f0,2021-11-13 14:33:03,Romain Vimont,"Initialize tunnel_enabled flag internally

Set the flag from the inner methods, to avoid bypassing the assignment
by mistake (on error for example).",False
03de9224fc45fdccf772b975a63851284a4579b3,2021-11-13 14:32:23,Romain Vimont,"Introduce process observer

Add a tool to easily observe process termination.

This allows to move this complexity out of the server code.",False
aa011832c155ad57230e8241932c3331218c95b3,2021-11-13 03:14:37,Romain Vimont,"Improve process API

Prefix symbols and constants names and improve documentation.",False
7e93abcf6d8982f194e016b3ea0227c1834893fa,2021-11-13 03:14:37,Romain Vimont,"Factorize common impl of process_execute()

Both implementations are the same. Move them to the common process.c.",False
e80e6631e4c259e2e217f8425900b56002850a40,2021-11-13 03:14:37,Romain Vimont,"Remove duplicate function declaration

The function process_terminate() was declared twice.",False
fcc04f967b9463a949641d8d22f15959ff79f2f9,2021-11-13 03:14:37,Romain Vimont,"Improve file API

Prefix symbols and constants names and improve documentation.",False
d4c262301fb0543ecd4b6c7240f3d87d908b3bf2,2021-11-13 03:14:37,Romain Vimont,"Move functions from process to file

Move filesystem-related functions from process.[ch] to file.[ch].",False
be55e250ca64563d1a24f0d0d2d8c9d5fecb6ada,2021-11-13 03:14:22,Romain Vimont,"Make screen_render() static

It is only used from screen.c.",False
c548f017bf26823c9781e6156c25f14e92144f45,2021-11-13 03:14:18,Romain Vimont,Upgrade junit to 4.13.1,False
7a733328bc5d20c1b5e2fed1b6f1715f2c89dc23,2021-11-11 19:52:39,Romain Vimont,"Adapt help to terminal size

If the error stream is a terminal, and we can retrieve the terminal
size, wrap the help content according to the terminal width.",False
38332f683c6744725d8f197f16fe513d4a287ee9,2021-11-11 19:52:39,Romain Vimont,Add util function to get terminal size,False
3f51a2ab43db7bfd0a09923e2a9d4604e556fce9,2021-11-11 19:29:34,Romain Vimont,"Generate getopt params from option structures

Use the option descriptions to generate the optstring and longopts
parameters for the getopt_long() command.

That way, the options are completely described in a single place.",False
74ab0a4df814064877d0f84b6c03c82c2039aba7,2021-11-11 19:29:34,Romain Vimont,Structure shortcuts help,False
f59e9e3cb03bb9cdb8d69767ed0ffa1b686f6d87,2021-11-11 19:29:34,Romain Vimont,"Structure command line options help

It will allow to correctly print the help for the current terminal size
(even if for now it is hardcoded to 80 columns).",False
9ec3406568a444fab5b2416944479fa6248ef409,2021-11-11 19:25:53,Romain Vimont,"Add line wrapper

Add a tool to wrap lines at words boundaries (spaces) to fit in a
specified number of columns, left-indented by a specified number of
spaces.",False
6dba1922c1fa00765ca6cdec264c53939364cda7,2021-11-11 19:25:52,Romain Vimont,"Add string buffer util

This will help to build strings incrementally.",False
570a003c39edc6e289695b0e97c064dcb8ba0b34,2021-11-08 02:05:57,Romain Vimont,"Remove deprecated -T option

The short option -T is deprecated since v1.11. Only the long version
(--always-on-top) remains.",False
b62df7ee91f30e0ca5c7e7787f649b51f9384156,2021-11-08 02:05:53,Romain Vimont,"Remove deprecated -c option

The short option -c is deprecated since v1.11. Only the long version
(--crop) remains.",False
30d40f4e786beaaeabde1f3c324b7680ef433be6,2021-11-07 23:57:53,Romain Vimont,"Document --power-off-on-close

The option was not documented.

Refs #824 <https://github.com/Genymobile/scrcpy/pull/824>",False
f489f7fcadac5325cdda7eac52e32c77ac207678,2021-11-07 23:21:22,Romain Vimont,Mention drag & drop for non-APK files in help,False
d72c7076f750f593abee4d041e3a3bd8d5a89bc6,2021-11-07 23:20:29,Romain Vimont,"Mention drag & drop APK in README

For consistency with --help and manpage.",False
fc64445555ecb29e145f45dd152f33f71d676dd8,2021-11-07 23:20:24,Romain Vimont,Remove extra space in README,False
f65c3fde69e216ecc3912601006cd4e19853269f,2021-11-07 23:20:24,Romain Vimont,Fix typos in help,False
48fcfa96ab659a830ca4bec6fa4d70ddacf855d5,2021-11-06 23:56:29,Romain Vimont,"Add missing include ""common.h""",False
676fa73d2c19d4828921640588e42d1911ad2147,2021-11-02 15:38:58,Romain Vimont,"Wrap device name and size in a struct

As a benefit, this avoids to take care of the device name length on the
caller side.",False
790f04e91faa14c5ebd2b987530d1e3db080e682,2021-10-31 17:33:27,Kaleidot725,"Update README.jp.md to v1.19

PR #2740 <https://github.com/Genymobile/scrcpy/pull/2740>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
58ea238fb2c5ddf69e1b2d598ccf58b6a9fe8270,2021-10-31 17:15:59,Romain Vimont,"Remove unnecessary variable

Test directly if a record filename is provided, without an intermediate
boolean variable.",False
13c4aa1a3bbcedb212c4b6ddf3b3855d02243ea0,2021-10-31 17:15:59,Romain Vimont,"Disable synthetic mouse events from touch events

Touch events with id SDL_TOUCH_MOUSEID are ignored anyway, but it is
better not to generate them in the first place.",False
caf594c90ef1b71ed844b2a9b42c3b3371215d6f,2021-10-31 17:15:59,Romain Vimont,"Split SDL initialization

Initialize SDL_INIT_EVENTS first (very quick) and SDL_INIT_VIDEO after
the server (quite long).",False
688477ff6521af87f925da80d9519b334bbb6736,2021-10-31 17:15:59,Romain Vimont,"Move SDL initialization

Inline SDL initialization in scrcpy(). This will allow to split
minimal initialization and video initialization.",False
ac539e13123e0638fab29f26b29b626d5d11d13f,2021-10-31 17:15:59,Romain Vimont,"Set SDL hints before initialization

In theory, some SDL hints should be initialized before calling
SDL_Init().",False
a57c7d3a2b6949635994fc0ba344ec4817624d3c,2021-10-31 17:15:56,Romain Vimont,"Extract SDL hints

Set all SDL hints in a separate function.",False
d2d18466d4bac6cb2d2d9f40ee07519e3342f204,2021-10-31 02:06:56,Romain Vimont,"Factorize SDL event push

Add a macro and inline function to call SDL_PushEvent() and log on error
(without actually handling the error, because there is nothing we could
do).",False
dae091e3ab58bcc592b166a55998addef23be01a,2021-10-30 23:55:20,Romain Vimont,"Handle SDL_PushEvent() errors

Pushing an event to the main thread may fail. If this happens, log an
error, and try to recover when possible.",False
4c4381de4cf2677376d1727d6fa040937c2c5d03,2021-10-30 18:50:39,Romain Vimont,"Use sc_ prefix for size, position and point",False
db484d82dbb41f3aeca6a02e4b818ad54af03a47,2021-10-30 15:02:48,Romain Vimont,Upgrade gradle build tools to 7.0.2,False
0c9666b733ef16e1c250d59773120d2635318e5f,2021-10-30 14:53:51,Romain Vimont,"Upgrade Android checkstyle to 9.0.1

Adapt checkstyle.xml to match the latest version, and remove a line
break between imports which trigger a checkstyle volation.",False
8bf28e9f5340d2a54dbc9b2c9d924b7ee4fa8d31,2021-10-30 14:53:51,Romain Vimont,Upgrade Android SDK to 31,False
06131ef634a1204da6c4f663cc5f9d71f2b456f1,2021-10-29 15:51:34,Romain Vimont,Fix typo in clock comments,False
34eb10ea0b736ff9e66716bc70d5f8e87411a0ec,2021-10-27 22:13:47,Romain Vimont,Define v4l2 option field only if HAVE_V4L2,False
27fa23846d5e82d0709001e045f35ca6572bcb5d,2021-10-27 22:13:47,Romain Vimont,"Define default options as const struct

This is more readable than a macro, and we could ifdef some fields.",False
e4d5c1ce363919e399958cf6342f63724ce4dd51,2021-10-27 22:13:47,Romain Vimont,"Move scrcpy option structs to options.h

This will allow to define symbols in options.c without all the
dependencies of scrcpy.c.",False
ac23bec14450a8f38ead09860564e42737ac047e,2021-10-27 22:11:58,Romain Vimont,"Expose socket interruption

On Linux, socket functions are unblocked by shutdown(), but on Windows
they are unblocked by closesocket().

Expose net_interrupt() and net_close() to abstract these differences:
 - net_interrupt() calls shutdown() on Linux and closesocket() on
   Windows (if not already called);
 - net_close() calls close() on Linux and closesocket() on Windows (if
   not already called).

This simplifies the server code, and prevents a data race on close
(reported by TSAN) on Linux (but does not fix it on Windows):

    WARNING: ThreadSanitizer: data race (pid=836124)
      Write of size 8 at 0x7ba0000000d0 by main thread:
        #0 close ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1690 (libtsan.so.0+0x359d8)
        #1 net_close ../app/src/util/net.c:211 (scrcpy+0x1c76b)
        #2 close_socket ../app/src/server.c:330 (scrcpy+0x19442)
        #3 server_stop ../app/src/server.c:522 (scrcpy+0x19e33)
        #4 scrcpy ../app/src/scrcpy.c:532 (scrcpy+0x156fc)
        #5 main ../app/src/main.c:92 (scrcpy+0x622a)

      Previous read of size 8 at 0x7ba0000000d0 by thread T6:
        #0 recv ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:6603 (libtsan.so.0+0x4f4a6)
        #1 net_recv ../app/src/util/net.c:167 (scrcpy+0x1c5a7)
        #2 run_receiver ../app/src/receiver.c:76 (scrcpy+0x12819)
        #3 <null> <null> (libSDL2-2.0.so.0+0x84f40)",False
e5ea13770b9ddefbbb147b8cabcff9387f677f83,2021-10-27 02:19:57,Romain Vimont,"Add socket wrapper

This paves the way to store an additional ""closed"" flag on Windows
to interrupt and close properly.",False
3eac212af1206ae798436ff018f3d2d77840e759,2021-10-27 02:19:45,Romain Vimont,"Use net_send() from net_send_all()

This will make net_send_all() continue to work even if net_send()
behavior is changed.",False
3adff37c2d33670937a4f3d94995a04b89d64f27,2021-10-27 02:19:45,Romain Vimont,"Use sc_ prefix for sockets

Rename:
 - socket_t to sc_socket
 - INVALID_SOCKET to SC_INVALID_SOCKET",False
eb6afe76698e3d974bae4615c0cba2e2744183de,2021-10-27 02:19:45,Romain Vimont,"Move net_init() and net_cleanup() upwards

These two functions are global, define them at the top of the
implementation file. This is consistent with the header file.",False
5222f213f4a588658a07441b5f91df152e671139,2021-10-27 01:00:04,Romain Vimont,Update FAQ to mention HID keyboard,False
e4163321f00bb3830c6049bdb6c1515e7cc668a0,2021-10-27 01:00:04,Romain Vimont,"Delay HID events on Ctrl+v

When Ctrl+v is pressed, a control is sent to the device to set the
device clipboard before injecting Ctrl+v.

With the InputManager method, it is guaranteed that the device
synchronization is executed before handling Ctrl+v, since the commands
are executed on the device in sequence.

However, HID are injected from the computer, so there is no such
guarantee. As a consequence, on Android, Ctrl+v triggers a paste with
the old clipboard content.

To workaround the issue, wait a bit (2 milliseconds) from the AOA
thread before injecting the event, to leave enough time for the
clipboard to be set before injecting Ctrl+v.",False
c96874b257db964c0172051f568534d99bf553b8,2021-10-27 01:00:04,Romain Vimont,"Synchronize HID keyboard state on first event

When an AOA HID keyboard is registered, CAPSLOCK and NUMLOCK are both
disabled, regardless of the state of the computer keyboard.

To synchronize the state, on first key event, inject CAPSLOCK and/or
NUMLOCK if necessary.",False
511356710d7aced5f363d6a56b7beacba59e140f,2021-10-27 01:00:04,Romain Vimont,"Retrieve device serial for AOA

The serial is necessary to find the correct Android device for AOA.

If it is not explicitly provided by the user via -s, then execute ""adb
getserialno"" to retrieve it.",False
d55015e4cfd419582a4c7710125571241a377480,2021-10-27 01:00:04,Romain Vimont,"Expose function to get the device serial

Expose adb_get_serialno() to retrieve the device serial via the command
""adb getserialno"".",False
068148080975126ceac222c656ae65ee46553ef2,2021-10-27 01:00:04,Romain Vimont,"Add read_pipe_all()

Add a convenience function to read from a pipe until all requested data
has been read.",False
96b18dabaad06b7fe417ad4fbf52031d11dd6080,2021-10-27 01:00:04,Romain Vimont,"Expose adb execution with redirection

Expose the redirection feature to the adb API.",False
eaf4afaad9c4217c04f053860d7e587ead8b49ca,2021-10-27 01:00:04,Romain Vimont,"Add command execution with redirection

Expose command execution with pipes to stdin, stdout and stderr.

This will allow to read the result of adb commands.",False
207082977a01b931c4451c1954c8197878c3ba10,2021-10-27 01:00:04,Alynx Zhou,"Add support for USB HID keyboard over AOAv2

This provides a better input experience, by simulating a physical
keyboard. It converts SDL keyboard events to proper HID events, and send
them over AOAv2.

This is a rewriting and bugfix of the origin code from @amosbird:
<https://github.com/Genymobile/scrcpy/issues/279#issuecomment-453819354>

The feature is enabled the command line option -K or --hid-keyboard,
and is only available on Linux, over USB.

Refs <https://source.android.com/devices/accessories/aoa2#hid-support>
Refs <https://www.usb.org/sites/default/files/hid1_11.pdf>

PR #2632 <https://github.com/Genymobile/scrcpy/pull/2632>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f7d1efdf1dc8d35a5de7e7654e71a96be2a8bd7c,2021-10-27 01:00:04,Romain Vimont,"Extract mouse processor trait

Mainly for consistency with the keyboard processor trait.

This could allow to provide alternative mouse processors.",False
bcf5a9750f65e63e3ab2abd263c7393cb2748b8e,2021-10-27 01:00:04,Romain Vimont,"Extract keyboard processor trait

This will allow to provide alternative key processors.",False
056d36ce4aee1a496bb90fb470b9b41f79d2df24,2021-10-27 01:00:04,Romain Vimont,Fix trait header guards,False
bea3197c3f3e906992486c28a604b10b22726bb0,2021-10-25 21:52:48,Romain Vimont,Remove unused markdown link in README,False
d6568f64af8bbb76b800fd083b270de0e9cb7e17,2021-10-25 21:52:17,Romain Vimont,Mention SCRCPY_ICON_PATH envvar in README,False
580f5d8bb929777cf101ebbc09a7235d177356ec,2021-10-25 21:38:37,Romain Vimont,Add scrcpy icon to README,False
1e340caf76ef0ffa3c9f3d0ecd7d9a42472ae73a,2021-10-25 21:38:37,Romain Vimont,"Remove legacy scrcpy icon

Remove the old icon in XPM format and the code to load it.",False
3d5b31e0cbd0025f5072bc530cc0840ae301379a,2021-10-25 21:38:37,Romain Vimont,"Add icon source in SVG format

Scrcpy only uses the PNG format (because SDL only supports bitmap
icons), but keep the SVG source in the repo.",False
6004f0b6b069ef8c97e00a7b6f240413e24b28d7,2021-10-25 21:38:37,Romain Vimont,"Use a new scrcpy icon

Use the new icon designed by @varlesh:
<https://github.com/Genymobile/scrcpy/pull/1987#issuecomment-949684080>

Load it from a PNG file (SDL only supports bitmap icons).",False
12ed2f24020b95e0699f48864962da819414fd44,2021-10-25 21:38:37,Romain Vimont,"Add support for palette icon formats

To support more icon formats.",False
0e4564da03df723dfe799cbcf15d26b3bdaaf6a5,2021-10-25 21:38:37,Romain Vimont,"Add icon loader

Add helper to load icons from image files via FFmpeg.",False
156d958e77763428eee48e3433af4d7f5344f00c,2021-10-25 21:38:31,Romain Vimont,"Move common instruction out of ifdef

Both ifdef-branches return server_path.",False
7229e3cce033591127148523197c9fd56a1ab78d,2021-10-25 19:59:43,Romain Vimont,"Extract util function to build a local file path

Finding a local file in the scrcpy directory may be useful for files
other than scrcpy-server in the future.",False
a7e41b0f85f3babb8916f9728d1d2c3e60aa40c8,2021-10-21 22:06:34,Romain Vimont,Fix code style,False
46d3e35c3079ede0ec4f92db9e35939d45aa3898,2021-10-21 19:56:48,zhongkaizhu,"Fix ""Could not find v4l2 muxer""

The AVOutputFormat name is a comma-separated list. In theory, possible
names for V4L2 are:

    - ""video4linux2,v4l2""
    - ""v4l2,video4linux2""
    - ""v4l2""
    - ""video4linux2""

To find the muxer in all cases, we must request exactly one muxer name
at a time.

PR #2718 <https://github.com/Genymobile/scrcpy/pull/2718>

Co-authored-by: Romain Vimont <rom@rom1v.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
07d75eb336264cab4eb4cabfde482ce0104eba2b,2021-10-17 19:51:37,Romain Vimont,"Simplify net_send_all()

There is no need to declare the variable before the loop.",False
96e3963afceb526cef8c099060ef32856180b0b2,2021-10-09 01:16:56,Pedro Miguel A Carraro,"Update Readme.pt-br.md to v1.19

PR #2686 <https://github.com/Genymobile/scrcpy/pull/2686>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
63b2b5ca4e2cca5165e2aede0ad8a8de659f0942,2021-10-08 12:04:49,Alberto Pasqualetto,"Update italian translation to v1.19

PR #2650 <https://github.com/Genymobile/scrcpy/pull/2650>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8df42cec82cb5856e6c10a4089e6b2953310da6e,2021-09-22 19:03:17,Romain Vimont,"Fix workarounds for Meizu

Workarounds.fillAppInfo() is necessary for Meizu devices even before the
first call to internalStreamScreen(), but it is harmful on other
devices (#940).

Therefore, simplify the workaround, by calling fillAppInfo() only if
Build.BRAND equals ""meizu"" (case insensitive).

Fixes #240 <https://github.com/Genymobile/scrcpy/issues/240> (again)
Fixes #2656 <https://github.com/Genymobile/scrcpy/issues/2656>",False
31131039bbb0d1840c64a0be79edfc3d5531bfb1,2021-09-20 21:57:37,Romain Vimont,"Add missing includes

Refs #2616 <https://github.com/Genymobile/scrcpy/issues/2616>",False
a846c01883e15cbf04ec2c76c07c7e0f074306b2,2021-09-12 01:06:21,Romain Vimont,Fix link in README,False
fa100b814b0d1866dbf30efbcfd24334dc8ddce2,2021-09-11 14:16:25,Romain Vimont,"Add support for expandNotificationsPanel() variant

Some custom vendor ROM added an int as a parameter.

Fixes #2551 <https://github.com/Genymobile/scrcpy/issues/2551>",False
069fe93f74b77edd75e2ddda0ba30d768d938248,2021-09-11 01:31:18,Romain Vimont,Update links to v1.19,False
228e2c15f44849032e9006dce1e0c47ae6e108ee,2021-09-11 01:10:08,Romain Vimont,Bump version to 1.19,False
9a8f06af65b2261b32280ba4476bfbd83cea0073,2021-09-10 23:56:17,Romain Vimont,Merge branch 'master' into dev,True
1d1c9f36f43314523187b8e1fb868d03718dcc79,2021-09-10 02:33:35,Romain Vimont,"Retrieve correct error messages on Windows

For sockets functions, Windows does not store error codes in errno, so
perror() does not print any error. Use WSAGetLastError() instead.

Refs #2624 <https://github.com/Genymobile/scrcpy/issues/2624>",False
4d6dd9d28130105ec6c0814364435ad36b6386ca,2021-09-09 16:21:18,Romain Vimont,"Compute scrcpy directory manually

The function dirname() does not work correctly everywhere with non-ASCII
characters.

Fixes #2619 <https://github.com/Genymobile/scrcpy/issues/2619>",False
b5e98db6352737ce82e89538ada264ccfc3a96dc,2021-09-08 01:11:40,a1346054,"Fix typo in manpage

PR #2606 <https://github.com/Genymobile/scrcpy/pull/2606>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
116acc8d25bc8c20efd88ace43baceaf20c66c20,2021-08-29 02:44:56,Romain Vimont,"Use SOURCE_MOUSE for scroll events

This has no practical impact (AFAIK), but a scroll events should come
from a mouse.

Refs #2602 <https://github.com/Genymobile/scrcpy/issues/2602>",False
3a39bacb76003fec3dcfd14200f12d52114c3289,2021-08-28 17:50:17,nkh0472,"Upgrade SDL (2.0.16) for Windows

Include the latest version of SDL in Windows releases.

PR #2589 <https://github.com/Genymobile/scrcpy/pull/2589>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3fdc89ad42f6543b2946567276e5bd0d42d6956d,2021-08-28 17:42:00,nkh0472,"Upgrade platform-tools (31.0.3) for Windows

Include the latest version of adb in Windows releases.

PR #2588 <https://github.com/Genymobile/scrcpy/pull/2588>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3761f56c28511dd62fc3c7116ccb2dfa88ffec7c,2021-08-26 15:56:44,Romain Vimont,"Declare callbacks static

It was a typo, ""static"" was missing.",False
c96f5c70e9c6fe82da059c7d24e77d9730aa7f86,2021-08-24 22:59:02,horizon86,"Add Simplified Chinese translation of FAQ

PR #2568 <https://github.com/Genymobile/scrcpy/pull/2568>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d6aaa5bf9aa3710660c683b6e3e0ed971ee44af5,2021-08-13 16:10:22,Romain Vimont,"Add a FAQ section for Wayland support

The video driver might need to be explicitly set to wayland.

Refs #2554 <https://github.com/Genymobile/scrcpy/issues/2554>
Refs #2559 <https://github.com/Genymobile/scrcpy/issues/2559>",False
4ab3e89c29bc990c1361e8578f36f5f8ada45d81,2021-08-11 19:12:31,kosantosbik,"Add README file in Turkish

PR #2514 <https://github.com/Genymobile/scrcpy/pull/2514>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4bc78244b97e6b1d4ded6dd844e6b6ea5d4bd260,2021-08-11 18:59:17,Hyperterminal Byte,"Fix OBS project ref URL

PR #2545 <https://github.com/Genymobile/scrcpy/pull/2545>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ea233d811d20827212dc6344004a9b0d71e530d7,2021-08-11 18:56:32,Stefan Huber,"Fix typo in DEVELOP.md

PR #2540 <https://github.com/Genymobile/scrcpy/pull/2540>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f78608ab298b1a9cd17e11e0b1219da9f6b5b88e,2021-07-15 21:46:56,Romain Vimont,"Fix type for assignment

The functions net_send_all() and net_recv_all() return ssize_t, not int.",False
6f03022646bc400ae02ba9d4ec863646cf1ae063,2021-07-15 21:46:26,Romain Vimont,"Fix net_send_all()

On partial writes, the final result was the number of bytes written by
the last send() rather than the total.",False
daf90d33d5a86d39352681c78734820710fd4cc7,2021-07-15 21:37:39,Romain Vimont,"Fix code style

Make the code fit into 80 columns.",False
0ae10f2b398868cb326a7adbe43574a4ac053e9a,2021-07-14 18:24:22,Romain Vimont,"Improve slope estimation on start

The first frames are typically received and decoded with more delay than
the others, causing a wrong slope estimation on start.

To compensate, assume an initial slope of 1, then progressively use the
estimated slope.",False
4c4d02295ca5551a5d3c2bada4ce455c516ec55b,2021-07-14 18:24:22,Romain Vimont,"Add buffering debugging tools

Output buffering and clock logs by disabling a compilation flag.",False
2f03141e9fed348ae3053e1d185df3e1f8028e4a,2021-07-14 18:24:22,Romain Vimont,"Add clock tests

The clock rolling sum is not trivial. Test it.",False
33977203305d76f72bab9bcbb61a1d8ab5643c67,2021-07-14 18:24:22,Romain Vimont,"Add buffering command line options

Add --display-buffer and --v4l2-buffer options to configure buffering
time.",False
79278961b9955173573f2af884fc468d1ec67380,2021-07-14 17:57:33,Romain Vimont,"Implement buffering

To minimize latency (at the cost of jitter), scrcpy always displays a
frame as soon as it available, without waiting.

However, when recording (--record), it still writes the captured
timestamps to the output file, so that the recorded file can be played
correctly without jitter.

Some real-time use cases might benefit from adding a small latency to
compensate for jitter too. For example, few tens of seconds of latency
for live-streaming are not important, but jitter is noticeable.

Therefore, implement a buffering mechanism (disabled by default) to add
a configurable latency delay.

PR #2417 <https://github.com/Genymobile/scrcpy/issues/2417>",False
408a301201fb170c1541028235e9d63cf88e53c7,2021-07-14 17:52:32,Romain Vimont,"Notify new frames via callbacks

Currently, a frame is available to the consumer as soon as it is pushed
by the producer (which can detect if the previous frame is skipped).

Notify the new frames (and frame skipped) via callbacks instead.

This paves the way to add (optional) buffering, which will introduce a
delay between the time when the frame is produced and the time it is
available to be consumed.",False
4d8bcfc68af15444ec587692c4393014598ea12d,2021-07-14 17:52:32,Romain Vimont,"Extract current video_buffer to frame_buffer

The current video buffer only stores one pending frame.

In order to add a new buffering feature, move this part to a separate
""frame buffer"". Keep the video_buffer, which currently delegates all its
calls to the frame_buffer.",False
336248df08873e904574f6246ff636822bf6bb69,2021-07-14 17:52:32,Romain Vimont,"Rename video_buffer to sc_video_buffer

Add a scrcpy-specific prefix.",False
28bce48d479be87ae72295fba0670d10d7eab697,2021-07-14 17:52:32,Romain Vimont,"Relax v4l2_sink lock constraints

To fix a data race, commit 5caeab5f6d12fe0fc69e708a829cfdbec3a401b4
called video_buffer_push() and video_buffer_consume() under the
v4l2_sink lock.

Instead, use the previous_skipped indication (initialized with video
buffer locked) to lock only for protecting the has_frame flag.

This enables the possibility for the video_buffer to notify new frames
via callbacks without lock inversion issues.",False
32e692d5d2284cc0d890e43fc2d370fc277643dc,2021-07-14 17:52:32,Romain Vimont,"Replace delay by deadline in timedwait()

The function sc_cond_timedwait() accepted a parameter representing the
max duration to wait, because it internally uses SDL_CondWaitTimeout().

Instead, accept a deadline, to be consistent with
pthread_cond_timedwait().",False
ec871dd3f596a8183e37982821645ac5a5791fe0,2021-07-14 17:52:32,Romain Vimont,"Wrap tick API

This avoids to use the SDL timer API directly, and will allow to handle
generic ticks (possibly negative).",False
5524f378c8907355ee6df17e435d0bc1f5f467cb,2021-07-14 04:09:35,Romain Vimont,"Add missing error log

Log video buffer initialization failure in v4l2_sink.",False
4ed3aa3604d0e78ef8b134bb94258efa672eb330,2021-07-14 04:05:10,Romain Vimont,"Move include fps_counter

The fps_counter is not used from video_buffer.",False
40cea1f677d35c6f7fe8c86d1d2bef1a313da9f5,2021-07-14 04:05:10,Romain Vimont,"Remove obsolete comment

Commit 2a94a2b119a9efd2cd06ded03280872c81abe6b4 removed video_buffer
callbacks, the comment is now meaningless.",False
099cba07f0349898938ef5a77753e65b3caa3e46,2021-07-14 04:05:10,Romain Vimont,"Rename queue to sc_queue

Add a scrcpy-specific prefix.",False
af8a21ed7c4e242f8c7d4cb5ba208622b85ad512,2021-07-06 22:03:04,Romain Vimont,Fix manpage formatting,False
5938e862a1c9fe09554c5238684272be4be54945,2021-07-06 22:02:40,Romain Vimont,"Fix --lock-video-orientation syntax in help

Commit f76fe2c0d4847d0e40d8708f97591abf3fa22ea5 fixed README and tests.

Fix command line help and manpage.",False
e9096e3e342a1b510573be5b9c009c651db829b1,2021-07-04 15:49:52,Romain Vimont,"Remove unnecessary calls to av_packet_unref()

av_packet_free() already calls av_packet_unref().",False
5caeab5f6d12fe0fc69e708a829cfdbec3a401b4,2021-06-26 19:33:52,Romain Vimont,"Fix v4l2 data race

The v4l2_sink implementation directly read the internal video_buffer
field ""pending_frame_consumed"", which is protected by the internal
video_buffer mutex. But this mutex was not locked, so reads were racy.

Lock using the v4l2_sink mutex in addition, and use a separate field to
avoid depending on the video_buffer internal data.",False
33fbdc86c7c61d34219c702b66419d476e028392,2021-06-26 19:33:34,Romain Vimont,"Initialize fields before starting a thread

To avoid data races.

Reported by TSAN.",False
f33d37976cab056e7fe3d86f275095782a5234e9,2021-06-26 19:01:50,Romain Vimont,"Fix assertion race condition in debug mode

Commit 21d206f360535047e16cc4ea7de889a55bd9444d added mutex assertions.

However, the ""locker"" variable to trace the locker thread id was read
and written by several threads without any protection, so it was racy.

Reported by TSAN.",False
7dca5078e75a913b76ecde794033791eaf1843f6,2021-06-26 01:18:07,Romain Vimont,"Initialize controller even if there is no display

The options --no-display and --no-control are independent.

The controller was not initialized when no display was requested,
because it was assumed that no control could occur without display. But
that's not true (anymore): for example, it is possible to pass
--turn-screen-off.

Fixes #2426 <https://github.com/Genymobile/scrcpy/issues/2426>",False
ab12b6c981d62aac2c4c86c5436378970723cc38,2021-06-21 13:17:15,Romain Vimont,"Update scrcpy-server in install-release.sh

Make the install script download the new prebuilt server (v1.18).

Fixes #2409 <https://github.com/Genymobile/scrcpy/issues/2409>",False
376201a83cfd3960027e471c9383d1a1f554ac20,2021-06-21 01:41:56,Romain Vimont,Update links to v1.18 in README and BUILD,False
60c4e886d409ec8a0688e2fd43d8d12c06ebd8df,2021-06-21 01:31:07,Romain Vimont,"Bump version to 1.18

Make the versionCode a decimal representation of the scrcpy version.

This will for example allow to correctly number the versionCode of
v1.17.1 after a v1.18 is released:
 - v1.18   -> 11800
 - v1.17.1 -> 11701
 - v1.18.1 -> 11801",False
ff7baad7093f4574eb04e82cebd7c1829310b663,2021-06-21 00:49:11,Romain Vimont,"Upgrade platform-tools (31.0.2) for Windows

Include the latest version of adb in Windows releases.",False
e712f30ceb1caacd856969d83b6ebd7312661fa1,2021-06-21 00:48:58,Romain Vimont,Merge branch 'master' into dev,True
a9d9cbf8b502cb537a1c7caaf2689be9eca3af60,2021-06-21 00:46:42,Wirtos_new,"Replace VLA by dynamic allocation

And increase the command buffer size.

Refs #1358 <https://github.com/Genymobile/scrcpy/issues/1358#issuecomment-862989748>
PR #2405 <https://github.com/Genymobile/scrcpy/pull/2405>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fda32928c1bc02afb2c1068084c228565305ce87,2021-06-21 00:46:42,Wirtos_new,"Rename cmd to argv

This is more explicit.

PR #2405 <https://github.com/Genymobile/scrcpy/pull/2405>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
710e80aa0dcef5e35f0a40fd0b3668cef8e9b5c9,2021-06-21 00:46:42,Romain Vimont,"Return build_cmd() success via a boolean

For consistency with other functions in the codebase.",False
77e96d745b0243323fc4cacec0081da062d2506f,2021-06-21 00:46:03,Romain Vimont,"Suggest --record-format instead of -F on error

The short option -F has been deprecated by
ff061b4f30c54dedc5073a588c6c697477b805db. On error, suggest the long
option --record-format instead.",False
1c950434784823d13e6bb9397bed1d6bfdad54ef,2021-06-20 20:14:59,Romain Vimont,"Attempt to log message only in verbose mode

If the log level is not verbose, there is no need to attempt to log
control messages at all.",False
488991116b9c56112a26daa1bb1069b57b9832ec,2021-06-20 19:34:18,Romain Vimont,"Expose function to get the current log level

This will allow to avoid unnecessary processing for creating logs which
will be discarded anyway.",False
5c95d18beb55e9dc24bf8b650042fcabeccce63f,2021-06-20 19:34:18,Romain Vimont,Move log level conversion to log API,False
1039f9b531e57f710432073b2fd525d8ecb857c5,2021-06-20 19:34:18,Romain Vimont,"Workaround PRIu64 on Windows

On Windows, PRIu64 is defined to ""llu"", which is not supported:

    error: unknown conversion type character 'l' in format",False
19ca02cd8f1a7554cd7c895482dca87134378baf,2021-06-20 19:33:52,Marti Raudsepp,"Log control messages in verbose mode

PR #2371 <https://github.com/Genymobile/scrcpy/pull/2371>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
937fa704a6bb07a264e247bb41de08b5378de39e,2021-06-20 16:04:19,Marti Raudsepp,"Add --verbosity=verbose log level

PR #2371 <https://github.com/Genymobile/scrcpy/pull/2371>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7db0189f23bc3dd3802c751ed44a1dd367523a5a,2021-06-20 16:04:19,Romain Vimont,"Forward mouse motion only on main clicks

Mouse motion events were forwarded as soon as any mouse button was
pressed.

Instead, only consider left-click (and also middle-click and right-click
if --forward-all-clicks is enabled).",False
8b90e1d3f46b77e162caa29a89952182edaa465c,2021-06-20 16:04:19,Romain Vimont,Remove extra ';' in #define,False
df017160ed9a9856c3a8eb08de29d77c14df70f0,2021-06-20 16:04:19,Romain Vimont,"Replace strcpy() by memcpy()

It was safe to call strcpy() since the input length was checked, but
then it is more straightforward to call memcpy() directly.",False
b846d3a085cc4a55a5a5751c2ab6114310997e30,2021-06-20 02:29:48,Romain Vimont,"Adapt call() on ContentProvider for Android 12

Android 12 changed one of the call() overloads with a new parameter
AttributionSource. Adapt the wrapper.

Fixes #2402 <https://github.com/Genymobile/scrcpy/issues/2402>",False
a1f2094787cf6267d9913dcf32e1782002a76729,2021-06-17 02:26:11,Romain Vimont,"Push to /sdcard/Download/ by default

Change the default push target from /sdcard/ to /sdcard/Download/.

Pushing to the root of /sdcard/ is not very convenient, many apps do not
expose its content directly.

It can still be changed by --push-target.

PR #2384 <https://github.com/Genymobile/scrcpy/pull/2384>",False
9b89b7ab7208cac0d7da91bb9a1811d6738c82a7,2021-06-15 00:54:51,Romain Vimont,"Center the window on resize-to-fit

When removing the black borders (by double-clicking on them, or by
pressing MOD+w), the window is resized to fit the device screen, but its
top-left position was left unchanged.

Instead, move the window so that the new window area is at the center of
the old window area.

Refs #2387 <https://github.com/Genymobile/scrcpy/issues/2387>",False
7343b233e457076d9419fb0f6e587ba13a7e79c8,2021-06-14 13:06:08,Romain Vimont,"Render screen on window restored

It should not be necessary, since screen_render() is called just after
on SDL_WINDOWEVENT_EXPOSED, but in practice the window content might not
be correctly displayed on restored if a rotation occurred while
minimized.

Note that calling screen_render() twice in a row on
SDL_WINDOWEVENT_EXPOSED also ""fixes"" the issue.",False
cd2894570d224d854d6e27abb401434fa6ec2840,2021-06-14 12:37:49,Romain Vimont,"Allocate AVPacket for v4l2_sink

From FFmpeg/doc/APIchanges:

    2021-03-17 - f7db77bd87 - lavc 58.133.100 - codec.h
      Deprecated av_init_packet(). Once removed, sizeof(AVPacket) will
      no longer be a part of the public ABI.

Refs #2302 <https://github.com/Genymobile/scrcpy/issues/2302>",False
4af317d40da70d63dee44bf645694ed5c4f05d65,2021-06-14 12:37:49,Romain Vimont,"Allocate AVPacket for recorder

From FFmpeg/doc/APIchanges:

    2021-03-17 - f7db77bd87 - lavc 58.133.100 - codec.h
      Deprecated av_init_packet(). Once removed, sizeof(AVPacket) will
      no longer be a part of the public ABI.

Refs #2302 <https://github.com/Genymobile/scrcpy/issues/2302>",False
318b6a572e0e866554c5aa5a2ed8c4d0d774a5dc,2021-06-14 12:37:49,Romain Vimont,"Allocate AVPacket for local stream packet

From FFmpeg/doc/APIchanges:

    2021-03-17 - f7db77bd87 - lavc 58.133.100 - codec.h
      Deprecated av_init_packet(). Once removed, sizeof(AVPacket) will
      no longer be a part of the public ABI.

Refs #2302 <https://github.com/Genymobile/scrcpy/issues/2302>",False
e8b053ad2f1da25f2b0e06d2874cabb12ff44e01,2021-06-14 12:37:49,Romain Vimont,"Allocate AVPacket for stream->pending

From FFmpeg/doc/APIchanges:

    2021-03-17 - f7db77bd87 - lavc 58.133.100 - codec.h
      Deprecated av_init_packet(). Once removed, sizeof(AVPacket) will
      no longer be a part of the public ABI.

Remove the has_pending boolean, which can be replaced by:

    stream->pending != NULL

Refs #2302 <https://github.com/Genymobile/scrcpy/issues/2302>",False
a5d71eee450b3c91c942d15b598959021126f31d,2021-06-14 11:46:05,Romain Vimont,Clarify --no-display usage with v4l2,False
af228706f14696e818f4004691d4de0006ac4910,2021-06-13 22:50:57,Romain Vimont,"Fix compatibility with old FFmpeg

V4L2 sink used a ""url"" field format AVFormatContext which has been
introduced in lavf 58.7.100.

Fixes #2382 <https://github.com/Genymobile/scrcpy/issues/2382>

Refs <https://github.com/FFmpeg/FFmpeg/commit/ea3672b7d67c432724bdbc8de0221f869b6a04c6>
Refs <https://github.com/FFmpeg/FFmpeg/commit/fa8308d3d4f27d6fb38ac2069887a7b259f1c6ab>",False
f76fe2c0d4847d0e40d8708f97591abf3fa22ea5,2021-06-11 22:10:12,Romain Vimont,"Fix --lock-video-orientation syntax

The argument for option --lock-video-orientation has been made optional
by 5af9d0ee0faddfca689f468c7d463c86233e8d93.

With getopt_long(), contrary to mandatory arguments, optional arguments
must be given with a '=':

    --lock-video-orientation 2   # wrong, parse error
    --lock-video-orientation=2   # correct",False
16a63e0917e423fb417eaad3ae0ca05f16227db6,2021-06-11 13:32:52,Romain Vimont,"Use non-secure display for Android 12 preview

Android 12 preview identifies as Android 11, but its codename is ""S"".

Refs #2129 <https://github.com/Genymobile/scrcpy/issues/2129>",False
f7533e8896c5e362af9a2f31b2b8d849d3207cc2,2021-06-11 13:07:29,Romain Vimont,"Use non-secure display for Android >= 12

Since Android 12, secure displays could not be created with shell
permissions anymore.

Refs commit 1fdde490fd2a0b89680a2b5da5e5274192398023
Fixes #2129 <https://github.com/Genymobile/scrcpy/issues/2129>",False
969bfd43744a88109d369089f9ee1313211ac9e1,2021-06-11 13:03:29,Romain Vimont,"Serialize clean-up configuration

This avoids to pass each option as individual parameter and parse them
manually (it's still ""manual"" in the Parcelable implementation).

Refs #824 <https://github.com/Genymobile/scrcpy/pull/824#issuecomment-780319422>

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>",False
506f918fb7cc944e08b108ff357c70d26bed90d2,2021-05-29 00:59:14,Romain Vimont,"Group components into struct scrcpy

This avoids to refer to many structs globally.",False
6fd7e89da1d3982697af9c581b322a1ca4398621,2021-05-29 00:53:18,Romain Vimont,"Explicitly initialize decoder sink_count

The zero-initialization relied on the fact that the decoder instance is
static.",False
4c31911df2cfb5ae7d918894df394f8a7a317e23,2021-05-29 00:51:54,Romain Vimont,"Pass serial within struct server_params

This was the only option passed separately.",False
d3d955f67b92d08bbee21bebce40fa072eea38f6,2021-05-28 13:49:17,Secreto31126,"Translate README.md into Spanish

PR #2318 <https://github.com/Genymobile/scrcpy/pull/2318>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
8121b0b7e72b393818f592a7858b5003a8de9c59,2021-05-28 13:49:17,Alberto Pasqualetto,"FAQ in Italian

PR #2316 <https://github.com/Genymobile/scrcpy/pull/2316>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
2e9d52008084696c2ad8809a03ff8e92988591df,2021-05-28 13:48:49,Alberto Pasqualetto,"README in Italian

PR #2316 <https://github.com/Genymobile/scrcpy/pull/2316>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1b7c9b3e1c4a8f934268bd5d0b3db6a558695c7d,2021-05-28 13:48:36,Romain Vimont,Reference translations from FAQ.md,False
9bed8cf3f44b551cbb9337b67581ee4f6fb5a23a,2021-05-28 13:36:26,Romain Vimont,Fix syntax highlighting in README,False
6adc97198bd6fc9122c9cd9cef319420219a384d,2021-05-17 12:22:08,Romain Vimont,"Provide device info directly on server connection

This avoids to retrieve them in a separate step.",False
6a2cd089a176bc907c151f7245df66f347c0ed28,2021-05-17 12:18:51,Romain Vimont,"Initialize input manager dynamically

The input manager was partially initialized statically, but a call to
input_manager_init() was needed anyway, so initialize all the fields
from the ""constructor"".

This is consistent with the initialization of the other structs.",False
dcee7c0f7f2fe5709dc947fa6bc4ff4cdc07654e,2021-05-16 22:18:04,Romain Vimont,Factorize screen_init() error management,False
e604e8a752f1a041bea2c782223e2b2d6769bfa7,2021-05-16 22:17:16,Romain Vimont,"Move fps_counter to screen

The FPS counter specifically count frames from the screen video buffer,
so it is specific to the screen.",False
f19c455110fb7d11864692208458591ab06f622d,2021-05-16 22:16:47,Romain Vimont,"Fix leak on error

Destroy video buffer if screen window creation failed.",False
83116fc19984bbed9da0200e341d140626fee3fd,2021-05-16 19:18:07,Romain Vimont,"Notify end-of-stream via callback

Do not send a SDL event directly, to make stream independent of SDL.",False
72081a241b85edc64569ece05d2178018e4913ca,2021-05-15 22:28:04,Alberto Pasqualetto,"Fix visualization of comment in code block

PR #2315 <https://github.com/Genymobile/scrcpy/pull/2315>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
42b3d1e66e91aa4c07e8c9ab5e8bb71ba309abbe,2021-05-15 22:26:45,LYK,"Reformat README.ko.md

PR #2311 <https://github.com/Genymobile/scrcpy/pull/2311>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1e64f0f931c2484ea6955205b83703776c03992b,2021-05-09 14:36:02,Romain Vimont,Use ARRAY_LEN() macro,False
8fb5715740e52bcb2ba8d4bac1e53f4ef76ef688,2021-05-09 14:31:16,Romain Vimont,"Add libavdevice-dev in BUILD instructions

On Linux, scrcpy now depends on libavdevice for v4l2.",False
f062dfd30b9cf27280c8675efcbdbe43aafd5f3a,2021-05-09 14:30:30,Romain Vimont,Merge branch 'master' into dev,True
644a5ef14ae9559ca72365c37d8f6b63edbdbd6f,2021-05-09 14:25:59,Haren S,"Add MacPorts documentation

PR #2299 <https://github.com/Genymobile/scrcpy/pull/2299>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1b9dcce23c8f52aa1ba97fe30fad83930c60578d,2021-05-04 00:13:45,Romain Vimont,"Fix double-free on error

On error, server->serial was freed twice: immediately and in
server_destroy().

Refs #2292 <https://github.com/Genymobile/scrcpy/issues/2292#issuecomment-831424820>",False
233f8e6cc4e84baaf3761ea61a60ba802aafeb88,2021-05-01 02:37:37,Romain Vimont,"Rename keycode injection method

Make it explicit that it injects both ""press"" and ""release"" events.",False
9a7d351d67396363f0d78473842d321f6c764877,2021-05-01 02:37:37,Romain Vimont,"Simplify non-static injectEvent() implementation

Just call the static version (having a displayId) from the non-static
version (using the displayId field).",False
d00ee640c0704412322aa4652cdccf5f3f3f9250,2021-05-01 02:37:29,Romain Vimont,"Simplify Device.java

Remove useless intermediate method with a ""mode"" parameter (it's always
called with the same mode).

This also avoids the need for a specific injectEventOnDisplay() method,
since it does not conflict with another injectEvent() method anymore.",False
ae6ec7a194257ddc72b8fa55f8a39486fb01b4c2,2021-04-26 21:35:43,Romain Vimont,"Unref decoder AVFrame immediately

The frame can be unref immediately after it is pushed to the frame
sinks.

It was not really a memory leak because the frame was unref every time
by avcodec_receive_frame() (and freed on close), but a reference was
unnecessarily kept for too long.",False
84f17fdeab518cbe9f9c1a5fdf7dc50981c01806,2021-04-26 21:35:11,Romain Vimont,"Fix v4l2 AVPacket memory leak on error

Unref v4l2 AVPacket even if writing failed.",False
1cde68a1fa01a9b37eeede3310edf163d4e79970,2021-04-26 21:34:51,Romain Vimont,"Fix v4l2 AVFrame memory leak

Unref frame immediately once encoded.

Fixes #2279 <https://github.com/Genymobile/scrcpy/pull/2279>",False
45e72801484deae6c931a4a79595b606227e547a,2021-04-26 21:29:35,Romain Vimont,"Rename --v4l2_sink to --v4l2-sink

This was a rebase issue, the previous version in #2268 was correct.

Refs #2268 <https://github.com/Genymobile/scrcpy/pull/2268>",False
41a0383d7ce42de79158ecd2f6eca3fd42602760,2021-04-25 18:30:56,Romain Vimont,Document v4l2 sink in README,False
d39161f7539b9d335e38385ffff5c3b4c21c7122,2021-04-25 18:29:10,Marco Martinelli,"Add support for v4l2loopback

It allows to send the video stream to /dev/videoN, so that it can be
captured (like a webcam) by any v4l2-capable tool.

PR #2232 <https://github.com/Genymobile/scrcpy/pull/2232>
PR #2233 <https://github.com/Genymobile/scrcpy/pull/2233>
PR #2268 <https://github.com/Genymobile/scrcpy/pull/2268>

Co-authored-by: Romain Vimont <rom@rom1v.com>",False
5af9d0ee0faddfca689f468c7d463c86233e8d93,2021-04-25 18:25:54,Romain Vimont,"Make --lock-video-orientation argument optional

If the option is set without argument, lock the initial device
orientation (as if the value ""initial"" was passed).",False
fd0dc6c0cdc22a283e56d1852bbccc57138fb12d,2021-04-25 18:25:54,Romain Vimont,"Add --lock-video-orientation=initial

Add a new mode to the --lock-video-orientation option, to lock the
initial orientation of the device.

This avoids to pass an explicit value (0, 1, 2 or 3) and think about
which is the right one.",False
151bc166444ba1a8aaaaa651532f42e3a3741061,2021-04-25 18:25:19,Romain Vimont,"Use strlist_contains() to find a muxer

The AVOutputFormat name is a string list: it contains names separated by
',' (possibly only one).",False
ffc00210e9deb8364bffffe1313fc123b9621bb9,2021-04-25 18:08:42,Romain Vimont,"Add strlist_contains()

Add a function to know if a string list, using some separator, contains
a specific string.",False
243854a408a79896dbe7ff566d258082b13160f6,2021-04-25 18:08:42,Romain Vimont,Fix recorder comment,False
8b90dc61b95679eadc82b2e4c193faa6621fe24e,2021-04-25 18:08:42,Romain Vimont,"Handle EAGAIN on send_packet in decoder

EAGAIN was only handled on receive_frame.

In practice, it should not be necessary, since one packet always
contains one frame. But just in case.",False
2a5dfc1c177bfeaf034b29c3128bcab5eadff969,2021-04-25 18:08:42,Romain Vimont,"Handle errors using gotos in recorder_open()

There are many initializations in recorder_open(). Handle RAII-like
deinitialization using gotos.",False
e3fccc5a5e697d55283a2a038a455af372ed6da6,2021-04-25 18:08:42,Romain Vimont,"Initialize recorder fields on open

Only initialize ops and parameters copy from recorder_init(). It was
inconsistent to initialize some fields from _init() and some others from
_open().",False
0541f1bff2be8dcf4de0765ce357836c0b2bf4ca,2021-04-25 18:08:42,Romain Vimont,"Hide the window immediately on close

The screen may not be destroyed immediately on close to avoid undefined
behavior, because it may still receive events from the decoder.

But the visual window must still be closed immediately.",False
0272e6dc772664bdbad21eab5c28919e63102bdd,2021-04-25 18:08:42,Romain Vimont,"Assert screen closed on destroy

The destruction order is important, but tricky, because the screen is
open/close by the decoder, but destroyed by scrcpy.c on the main thread.

Add assertions to guarantee that the screen is not destroyed before
being closed.",False
2a94a2b119a9efd2cd06ded03280872c81abe6b4,2021-04-25 18:08:42,Romain Vimont,"Remove video_buffer callbacks

Now that screen is both the owner and the listener of the video buffer,
execute the code directly without callbacks.",False
e91acdb0c43f2db43c211f43c4b9a46ce3e76084,2021-04-25 18:08:42,Romain Vimont,"Move video_buffer to screen

The video buffer is now an internal detail of the screen component.

Since the screen is plugged to the decoder via the frame sink trait, the
decoder does not access to the video buffer anymore.",False
6f5ad21f5757482b71a5d197f920ea39fb2f1167,2021-04-25 18:08:42,Romain Vimont,"Make decoder push frames to sinks

Now that screen implements the packet sink trait, make decoder push
packets to the sinks without depending on the concrete sink types.",False
08b3086ffc95f846bc3a420f5d4296092020eb8c,2021-04-25 18:08:42,Romain Vimont,"Expose screen as frame sink

Make screen implement the frame sink trait.

This will allow the decoder to push frames without depending on the
concrete sink type.",False
deab7da761d856de22e5880e5376d53cd2e8fb77,2021-04-25 18:08:42,Romain Vimont,"Add frame sink trait

This trait will allow to abstract the concrete sink types from the frame
producer (decoder.c).",False
f7a1b67d66e8b6bd569a5ac608d85a595df3ec27,2021-04-25 18:08:42,Romain Vimont,"Make stream push packets to sinks

Now that decoder and recorder implement the packet sink trait, make
stream push packets to the sinks without depending on the concrete sink
types.",False
cbed38799e2e39bdf368bfd90ab028a896e307e3,2021-04-25 18:08:42,Romain Vimont,"Expose decoder as packet sink

Make decoder implement the packet sink trait.

This will allow the stream to push packets without depending on the
concrete sink type.",False
5beb7d6c0242bbb9995041fdd559982280a3499b,2021-04-25 18:08:42,Romain Vimont,"Reorder decoder functions

This will make further commits more readable.",False
5980183a33bd75235c3dcffdf6e0027462493749,2021-04-25 18:08:42,Romain Vimont,"Expose recorder as packet sink

Make recorder implement the packet sink trait.

This will allow the stream to push packets without depending on the
concrete sink type.",False
fe8de893ca58f3cce53819bc8409fc33d416387c,2021-04-25 18:08:42,Romain Vimont,"Privatize recorder threading

The fact that the recorder uses a separate thread is an internal detail,
so the functions _start(), _stop() and _join() should not be exposed.

Instead, start the thread on _open() and _stop()+_join() on close().

This paves the way to expose the recorder as a packet sink trait.",False
a974483c1560042085a25412f8cf19329505447c,2021-04-25 18:08:42,Romain Vimont,"Reorder recorder functions

This will make further commits more readable.",False
1b072a24c4e58361d353a0bfb5b5d63174e47524,2021-04-25 18:08:42,Romain Vimont,"Add packet sink trait

This trait will allow to abstract the concrete sink types from the
packet producer (stream.c).",False
08f1fd46c8f2ff70b1cc4464ec9dea5c6fd898c9,2021-04-25 18:08:42,Romain Vimont,"Add container_of() macro

This will allow to get the parent of an embedded struct.",False
2ddf760c091ecaed6d6dcb4131dd2c468453a0da,2021-04-25 18:08:42,Romain Vimont,"Make video_buffer more generic

The video buffer took ownership of the producer frame (so that it could
swap frames quickly).

In order to support multiple sinks plugged to the decoder, the decoded
frame must not be consumed by the display video buffer.

Therefore, move the producer and consumer frames out of the video
buffer, and use FFmpeg AVFrame refcounting to share ownership while
avoiding copies.",False
5d9e96dc4eaa41b185c41e8a6df6191762764b1c,2021-04-25 18:08:42,Romain Vimont,"Remove compat with old FFmpeg codec params API

The new API has been introduced in 2016 in libavformat 57.xx, it's very
old.

This will avoid to maintain two code paths for codec parameters.",False
de9b79ec2dd73e5442c6bf0161669bcd8ca7d5be,2021-04-25 18:08:42,Romain Vimont,"Remove compat with old FFmpeg decoding API

The new API has been introduced in 2016 in libavcodec 57.xx, it's very
old.

This will avoid to maintain two code paths for decoding.",False
55806e7d312f2acabd99d1a3c707f7e42fbf90e2,2021-04-25 18:08:42,Romain Vimont,"Remove option --render-expired-frames

This flag forced the decoder to wait for the previous frame to be
consumed by the display.

It was initially implemented as a compilation flag for testing, not
intended to be exposed at runtime. But to remove ifdefs and to allow
users to test this flag easily, it had finally been exposed by commit
ebccb9f6cc111e8acfbe10d656cac5c1f1b744a0.

In practice, it turned out to be useless: it had no practical impact,
and it did not solve or mitigate any performance issues causing frame
skipping.

But that added some complexity to the codebase: it required an
additional condition variable, and made video buffer calls possibly
blocking, which in turn required code to interrupt it on exit.

To prepare support for multiple sinks plugged to the decoder (display
and v4l2 for example), the blocking call used for pacing the decoder
output becomes unacceptable, so just remove this useless ""feature"".",False
21b590b766e1efa4ab75ed685449d1dc09ab9b20,2021-04-25 18:08:42,Romain Vimont,"Write trailer from recorder thread

The recorder thread wrote the whole content except the trailer, which
was odd.",False
d7e658967780bca3631ac630bdb57fc071c2cae3,2021-04-25 18:06:48,brunoais,"Document 4th+5th + 2xn shortcuts

PR #2260 <https://github.com/Genymobile/scrcpy/pull/2260>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b4ee9f27ce522710a52c1b688d1524bb1c904dff,2021-04-25 18:06:48,brunoais,"Add mouse shortcut to expand settings panel

Double-click on extra mouse button to open the settings panel (a
single-click opens the notification panel).

This is consistent with the keyboard shortcut MOD+n+n.

PR #2264 <https://github.com/Genymobile/scrcpy/pull/2264>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
6fa63cf6f86ff1f566587b0f0819d5dbf397a06e,2021-04-25 18:06:48,brunoais,"Add keyboard shortcut to expand settings panel

PR #2260 <https://github.com/Genymobile/scrcpy/pull/2260>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
50eecdab285692ca1cb58b47552af6e1dde9c615,2021-04-25 18:06:48,brunoais,"Add control message to expand settings panel

PR #2260 <https://github.com/Genymobile/scrcpy/pull/2260>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9576283907fed9cf7baad1bb15613a811894f719,2021-04-25 18:06:48,brunoais,"Count repeated identical key events

This will allow shortcuts such as MOD+n+n to open the settings panel.

PR #2260 <https://github.com/Genymobile/scrcpy/pull/2260>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
66c581851fe968a12bf66c225dd76ff4690841f1,2021-04-25 18:06:48,brunoais,"Rename control message type to COLLAPSE_PANELS

The collapsing action collapses any panels.

By the way, the Android method is named collapsePanels().

PR #2260 <https://github.com/Genymobile/scrcpy/pull/2260>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
bb4614d55899bd1df00b14d3c7f3bdac3a5c818a,2021-04-25 18:06:48,Romain Vimont,"Reverse boolean logic for readability

Refs #2260 <https://github.com/Genymobile/scrcpy/pull/2260#issuecomment-823508759>",False
aaf7875d923e492047e66ca88585079704abf5ad,2021-04-23 01:42:23,Frank Leon Rose,"Ensure get_server_path() retval is freeable

PR #2276 <https://github.com/Genymobile/scrcpy/pull/2276>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b9c3f65fd84f27ebbe18f96c9eb207b6bf04eb78,2021-04-19 23:46:45,brunoais,"Provide actions for the extra mouse buttons

Bind APP_SWITCH to button 4 and expand notification panel on button 5.

PR #2258 <https://github.com/Genymobile/scrcpy/pull/2258>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d0739911a3e413b70275ded3eef839f9dc57ba7a,2021-04-19 23:46:45,Romain Vimont,"Forward DOWN and UP separately for right-click

The shortcut ""back on screen on"" is a bit special: the control is
requested by the client, but the actual event injection (POWER or BACK)
is determined on the device.

To properly inject DOWN and UP events for BACK, transmit the action as
a control parameter.

If the screen is off:
 - on DOWN, inject POWER (DOWN and UP) (wake up the device immediately)
 - on UP, do nothing
If the screen is on:
 - on DOWN, inject BACK DOWN
 - on UP, inject BACK UP

A corner case is when the screen turns off between the DOWN and UP
event. In that case, a BACK UP event will be injected, so it's harmless.

As a consequence of this change, the BACK button is now handled by
Android on mouse released. This is consistent with the keyboard shortcut
(Mod+b) behavior.

PR #2259 <https://github.com/Genymobile/scrcpy/pull/2259>
Refs #2258 <https://github.com/Genymobile/scrcpy/pull/2258>",False
498ad23e9804cd7d7bb56bb1cd0d26b88e1830b9,2021-04-18 18:06:31,Andrea Gelmini,"Fix typos

PR #2263 <https://github.com/Genymobile/scrcpy/pull/2263>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
964b6d2243fa1921543e48810f3064b9bd2d50d1,2021-04-17 21:34:24,Romain Vimont,"Forward DOWN and UP separately for middle-click

As a consequence of this change, the HOME button is now handled by
Android on mouse released. This is consistent with the keyboard shortcut
(MOD+h) behavior.

PR #2259 <https://github.com/Genymobile/scrcpy/pull/2259>
Refs #2258 <https://github.com/Genymobile/scrcpy/pull/2258>",False
8cc057c8f14d051b2480bad5116083bbeb2a2270,2021-04-17 21:34:13,Romain Vimont,"Prevent forwarding only ""mouse released"" events

Some mouse clicks DOWN are captured for shortcuts, but the matching UP
events were still forwarded to the device.

Instead, capture both DOWN and UP for shortcuts, and do nothing on UP.

PR #2259 <https://github.com/Genymobile/scrcpy/pull/2259>
Refs #2258 <https://github.com/Genymobile/scrcpy/pull/2258>",False
edee69d6374639d165d12fecc5614f38c6b117c8,2021-04-16 21:10:39,Romain Vimont,"Fix options alphabetical order

""verbosity"" < ""version""",False
8ef4c044fa476dc40e20ac8d3045c0de41371a7c,2021-04-14 02:07:08,Romain Vimont,"Do not forward SDL_DROPFILE event

The event is handled by scrcpy.c, it is not necessary to send it to
screen or input_manager.",False
c23c38f99dbed2776d9c0ec92b37da5788866df7,2021-04-14 02:06:59,Romain Vimont,Move resizing workaround to screen.c,False
65c4f487b306cb288ec9ee1155356de7939eac16,2021-04-14 01:45:05,Romain Vimont,Set initial fullscreen from screen.c,False
c6d7f5ee96b8e23267fbc6f7810b139ead39f3e7,2021-04-14 01:34:38,Romain Vimont,"Make screen_show_window() static

It is only used from screen.c now.",False
28f6cbaea6a309d86d3267a9189cb0035df99860,2021-04-11 18:12:09,Romain Vimont,"Destroy screen once stream is finished

The screen receives callbacks from the decoder, fed by the stream.

The decoder is run from the stream thread, so waiting for the end of
stream is sufficient to avoid possible use-after-destroy.",False
08fc6694e1adf98014d3fdfa3d4cfd886618aba0,2021-04-11 16:37:44,Romain Vimont,"Do not destroy uninitialized screen

When --no-display was passed, screen_destroy() was called while
screen_init() was never called.

In practice, it did not crash because it just freed NULL pointers, but
it was still incorrect.",False
d0983db5924cc1bee69fb5fa868e7b74541a4b8c,2021-04-10 22:18:52,Romain Vimont,Make internal recorder function static,False
fb7870500a8e69bd79b6ca9f0e9ec95e8fb1315e,2021-04-10 22:18:52,Romain Vimont,Remove unused field from input_manager,False
33006561c74c1655aaeb29c9a13ba704892beb37,2021-04-10 22:18:52,Romain Vimont,Remove useless forward declaration from stream.h,False
a09733d175dc610bf81edf5273d028cf03e766bc,2021-04-10 22:18:44,Romain Vimont,Remove useless includes from decoder.c,False
07a85b7c94fc519c4950a12d7c992f51117b7e81,2021-04-07 18:42:33,Romain Vimont,"Fix typo in command-line help

Refs #2237 <https://github.com/Genymobile/scrcpy/issues/2237>",False
6231f683af03d967eeb1266272beae208abb919f,2021-04-06 02:05:14,Romain Vimont,"Fix compilation error for old decoding API

Commits cb9c42bdcb198b0e3ebed893e00257b95f4dcedb and
441d3fb119ce05287e94b0ae0befbb2e75173688 updated the code only for the
new decoding API.",False
9826c5c4a4d19f59a732c3322338b0df37fa2f5e,2021-04-04 18:30:13,Romain Vimont,"Remove HiDPI compilation flag

Always enable HiDPI support, there is no reason to expose a compilation
flag.",False
2812de8a9a0f20fa17126924407ecb6f613ac7e4,2021-04-04 18:09:16,Romain Vimont,"Update brew java version to JDK 11

Refs f8524a2be738e6471ed2e48265f2663d8c21c0be
Refs 7b51a0313ed9423f9252108fa573af68c11e6a2c",False
d50c678a5f9174b6ba99b27bed8faa789ed5e070,2021-04-04 18:08:54,quyleanh,"Update brew cask documentation

The command `brew cask` has been deprecated:
<https://github.com/Homebrew/discussions/discussions/340#discussioncomment-232364>

Should be `brew install` directly now.

PR #2231 <https://github.com/Genymobile/scrcpy/pull/2231>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b77932a5b70bc3f60dbe589cfa5ae92472e139dd,2021-04-01 13:17:15,Romain Vimont,Add instructions to uninstall,False
47d16a57aca02907e9e9a39c86d359ccf200181c,2021-03-29 13:03:39,Romain Vimont,"Add simplified installation script

Add a script to download the server and build scrcpy using the
prebuilt server.",False
fc5de88eaacfd3ef0af2939f19706d72f9bc427d,2021-03-29 12:58:08,Ray Foss,"Clarify the order of operations in BUILD.md

PR #2223 <https://github.com/Genymobile/scrcpy/pull/2223>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fda293f9bbdfeb21c010550051dfb3aa87aea8dc,2021-03-29 12:41:40,Romain Vimont,Fix BUILD.md line wrapping,False
38f392f08ff9d473a052205e3217c38a3fbff492,2021-03-29 12:09:02,Romain Vimont,Fix typo in BUILD.md,False
8414b688f00182e6e5a9f94c880f70dd76fa6ddf,2021-03-29 01:06:00,Romain Vimont,"Link release to main README in translations

This avoids to link an older version.",False
6a217b70f4f4f751a869597670df1a87656a4597,2021-03-29 00:58:20,aruko-210,"Add Japanese translation for README.md

PR #2195 <https://github.com/Genymobile/scrcpy/pull/2195>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3a4b10a38dec2514d4f588abe04dee508fdd772b,2021-03-28 15:55:08,Romain Vimont,"Improve --push-target example in README

A common use case for the --push-target option is to pass the device
Download directory.",False
1fb79575250460e159161bbe5ca55335409ffec5,2021-03-17 13:22:16,Romain Vimont,"Fix typo in README

Refs <https://github.com/Genymobile/scrcpy/pull/2195#discussion_r595664697>",False
19ad107f1f277b1a7dcdf3678ed5e14f3a706be7,2021-03-17 02:13:52,Romain Vimont,"Add ""Get the app"" summary section

Give quick instructions to download/install scrcpy.",False
1d615a0d51d5f912a415c03009e3da058992fcf6,2021-03-17 01:42:35,Yu-Chen Lin,"Support power off on close

PR #824 <https://github.com/Genymobile/scrcpy/pull/824>

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fb0bcaebc2d081f0b6992b49bfe2ce9b12298b51,2021-03-17 01:42:29,Yu-Chen Lin,"Export static method to power off screen in Device

PR #824 <https://github.com/Genymobile/scrcpy/pull/824>

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
dd453ad041b0dcf0486610a2215c2d86499d66a7,2021-03-17 01:34:04,slingmint,"Pass scrcpy-noconsole arguments through to scrcpy

PR #2052 <https://github.com/Genymobile/scrcpy/pull/2052>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0308ef43f22b5e3e937869b30326bd7209242e9a,2021-03-15 23:16:56,Romain Vimont,"Do not set buttons on touch events

BUTTON_PRIMARY must not be set for touch events:

> This button constant is not set in response to simple touches with a
> finger or stylus tip. The user must actually push a button.

<https://developer.android.com/reference/android/view/MotionEvent#BUTTON_PRIMARY>

Fixes #2169 <https://github.com/Genymobile/scrcpy/issues/2169>",False
40febf4a91f0d9c9d9e1a6390930639b3bf5a70e,2021-03-14 23:00:56,Romain Vimont,"Use device id 0 for touch/mouse events

Virtual device is only for keyboard sources, not mouse or touchscreen
sources. Here is the value of InputDevice.getDevice(-1).toString():

    Input Device -1: Virtual
      Descriptor: ...
      Generation: 2
      Location: built-in
      Keyboard Type: alphabetic
      Has Vibrator: false
      Has mic: false
      Sources: 0x301 ( keyboard dpad )

InputDevice.getDeviceId() documentation says:

> An id of zero indicates that the event didn't come from a physical
> device and maps to the default keymap.

<https://developer.android.com/reference/android/view/InputEvent#getDeviceId()>

However, injecting events with a device id of 0 causes event.getDevice()
to be null on the client-side.

Commit 26529d377fe8aae2fd1ffa91405aa801a0ce8a57 used -1 as a workaround
to avoid a NPE on a specific Android TV device. But this is a bug in the
device system, which wrongly assumes that input device may not be null.

A similar issue was present in Flutter, but it is now fixed:
 - <https://github.com/flutter/flutter/issues/30665>
 - <https://github.com/flutter/engine/pull/7986>

On the other hand, using an id of -1 for touchscreen events (which is
invalid) causes issues for some apps:
<https://github.com/Genymobile/scrcpy/issues/2125#issuecomment-790535792>

Therefore, use a device id of 0.

An alternative could be to find an existing device matching the source,
like ""adb shell input"" does. See getInputDeviceId():
<https://android.googlesource.com/platform/frameworks/base.git/+/master/cmds/input/src/com/android/commands/input/Input.java>

But it seems better to indicate that the event didn't come from a
physical device, and it would not solve #962 anyway, because an Android
TV has no touchscreen.

Refs #962 <https://github.com/Genymobile/scrcpy/issues/962>
Fixes #2125 <https://github.com/Genymobile/scrcpy/issues/2125>",False
429fdef04fbc40da9050f4b008a438feb56d3450,2021-03-11 15:25:12,Romain Vimont,"Fix encoder parameter suggestion

The option is --encoder, not --encoder-name.",False
d1789f082a6bbb883e964f2b6136f0c89ead3cde,2021-03-09 14:29:57,Biswapriyo Nath,"meson: Do not use full path with mingw tools name

This helps to use mingw toolchains which are not in /usr/bin path.

PR #2185 <https://github.com/Genymobile/scrcpy/pull/2185>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
eb7e1070cf4d0e2940a27664ae17ae7f974eb839,2021-03-07 03:28:03,Romain Vimont,"Release frame data as soon as possible

During a frame swap, one of the two frames involved can be released.",False
386f017ba9ae52b55e32d3e3c1f068e29e893e1f,2021-03-07 03:28:03,Romain Vimont,Factorize frame swap,False
cc48b243240c36e2a2043098ec80fb037d0b0e9b,2021-03-07 03:28:03,Romain Vimont,"Simplify screen initialization

Use a single function to initialize the screen instance.",False
597c54f0491eb279fed52a1386120ba06ababceb,2021-03-07 03:28:03,Romain Vimont,"Group screen parameters into a struct

The function screen_init_rendering had too many parameters.",False
955da3b57801b6ea14abdb6cbc7e530670b66ae7,2021-03-07 03:28:03,Romain Vimont,"Remove screen static initializer

Most of the fields are initialized dynamically.",False
cb9c42bdcb198b0e3ebed893e00257b95f4dcedb,2021-03-07 03:28:03,Romain Vimont,"Use a callback to notify frame skip

A skipped frame is detected when the producer offers a frame while the
current pending frame has not been consumed.

However, the producer (in practice the decoder) is not interested in the
fact that a frame has been skipped, only the consumer (the renderer) is.

Therefore, notify frame skip via a consumer callback. This allows to
manage the skipped and rendered frames count at the same place, and
remove fps_counter from decoder.",False
fb9f9848bd2c5196a91bbe04fc1d22eacd7abe12,2021-03-07 03:28:03,Romain Vimont,"Use a callback to notify a new frame

Make the decoder independant of the SDL even mechanism, by making the
consumer register a callback on the video_buffer.",False
c50b958ee415843aebc23cd7cc45d7b1e7642c71,2021-03-07 03:28:03,Romain Vimont,"Initialize screen before starting the stream

As soon as the stream is started, the video buffer could notify a new
frame available.

In order to pass this event to the screen without race condition, the
screen must be initialized before the screen is started.",False
441d3fb119ce05287e94b0ae0befbb2e75173688,2021-03-07 03:28:03,Romain Vimont,"Make video buffer more generic

Video buffer is a tool between a frame producer and a frame consumer.

For now, it is used between a decoder and a renderer, but in the future
another instance might be used to swscale decoded frames.",False
cb197ee3a2215784f088768f5e39102fd5f55ddd,2021-03-07 03:28:03,Romain Vimont,"Move fps counter out of video buffer

In order to make video buffer more generic, move out its specific
responsibility to count the fps between the decoder and the renderer.",False
dca11f6c513e3b63e5494fce5bfffdc5c29be002,2021-03-06 18:58:06,Romain Vimont,"Remove obsolete FAQ entry

Issue #15 had been fixed in v1.14 by
e40532a3761da8b3aef484f1d435ef5f50d94574.",False
08baaf4b575aef7ee56d14683be3f4e3a86d39aa,2021-03-04 19:49:00,Romain Vimont,Mention adb debugging in FAQ,False
218636dc1045d17c8c58e08cda5961a5a83a7281,2021-03-03 22:52:54,Romain Vimont,"Inject touch events with smallest detectable size

A value of 1 means the ""largest detectable size"", a value of 0 means the
""smallest detectable size"".

https://developer.android.com/reference/android/view/MotionEvent.PointerCoords#size
https://developer.android.com/reference/android/view/MotionEvent#AXIS_SIZE

Fixes #2125 <https://github.com/Genymobile/scrcpy/issues/2125>",False
1863ca7ad1b87f9b32aa1c5aa9554741f5845fba,2021-02-27 22:23:40,yangfl,"Remove unnecessary escape characters in manpage

PR #2123 <https://github.com/Genymobile/scrcpy/pull/2123>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7b51a0313ed9423f9252108fa573af68c11e6a2c,2021-02-27 04:57:58,Romain Vimont,"Update another java version in BUILD.md

Commit f8524a2be738e6471ed2e48265f2663d8c21c0be updated one reference to
the openjdk package, but there was another one.",False
a2919b3ef2d3b08f426ac53ff1999c0f7f925e9f,2021-02-27 04:50:18,Romain Vimont,"Fix release instructions in BUILD.md

Makefile.CrossWindows have been renamed to release.mk, which is called
from release.sh.",False
b16b65a715485b3bf2babe51e7c17e3c3a355adf,2021-02-26 02:49:05,Romain Vimont,"Simplify default values

It makes sense to extract default values for bitrate and port range
(which are arbitrary and might be changed in the future).

However, the default values for ""max size"" and ""lock video orientation""
are naturally unlimited/unlocked, and will never be changed. Extracting
these options just added complexity for no benefit, so hardcode them.",False
a3aa5ac95e4cd5179e79881f15e8152933cbdd4d,2021-02-26 02:49:05,Romain Vimont,Insert numerical values statically in usage string,False
0207e3df334435d481fec23465f4165c46e6ba22,2021-02-26 02:49:05,Romain Vimont,Remove unused no_window field,False
9cd1a7380db1760807f5ea8077d315e678dabaf2,2021-02-26 02:49:05,Romain Vimont,Enable NDEBUG via Meson built-in option,False
24b637b9728818755f2db84f18025261047d213a,2021-02-26 02:49:05,Romain Vimont,Handle im-related events from input_manager.c,False
76a3d9805bf44f1d73fc47605b26f031c23773fa,2021-02-26 02:49:05,Romain Vimont,"Inline window events handling

Now that all screen-related events are handled from screen.c, there is
no need for a separate method for window events.",False
50b4a730e31e220a465e3b72bd8a5a10f0c6ef08,2021-02-26 02:49:05,Romain Vimont,Handle screen-related events from screen.c,False
ea2369f568ccb2dd8fceb83487171eb0ffba26c9,2021-02-26 02:49:05,Romain Vimont,"Reference video buffer from screen

This paves the way to handle EVENT_NEW_FRAME from screen.c, by allowing
to call screen_update_frame() without an explicit video_buffer instance.",False
0538e9645b3aebddbe9d579cbc5c4ca8f64c3659,2021-02-26 02:48:51,Romain Vimont,"Improve error handling in screen initialization

After the struct screen is initialized, the window, the renderer and the
texture are necessarily valid, so there is no need to check in
screen_destroy().",False
626094ad130225df0bcd319656c97fe44c7024e7,2021-02-17 14:24:03,Romain Vimont,"Handle window events only once visible

This will avoid corner cases where we need to resize while no frame has
been received yet.",False
a566635c43ea7b8d6c60a9cad9b63dca8ac3d078,2021-02-17 14:24:03,Romain Vimont,Log mipmaps error only if mipmaps are enabled,False
862948b13267fa1516840a464c59a8566d9ac28a,2021-02-17 14:24:03,Romain Vimont,"Make use_opengl local

The flag is used only locally, there is no need to store it in the
screen structure.",False
c0c4ba700904d54f087f6cc5a2e5821124ff42db,2021-02-17 14:24:03,Romain Vimont,"Add intermediate frame in video buffer

There were only two frames simultaneously:
 - one used by the decoder;
 - one used by the renderer.

When the decoder finished decoding a frame, it swapped it with the
rendering frame.

Adding a third frame provides several benefits:
 - the decoder do not have to wait for the renderer to release the
   mutex;
 - it simplifies the video_buffer API;
 - it makes the rendering frame valid until the next call to
   video_buffer_take_rendering_frame(), which will be useful for
   swscaling on window resize.",False
c53bd4d8b68d63ed7e6c4cb20e81fd0d7bb9c0ec,2021-02-17 14:24:03,Romain Vimont,Assert non-recursive usage of mutexes,False
54f5c42d7b0e8b9778f9a6423a8cfe174ae06d08,2021-02-17 14:24:03,Romain Vimont,Add mutex assertions,False
21d206f360535047e16cc4ea7de889a55bd9444d,2021-02-17 14:24:03,Romain Vimont,"Expose mutex assertions

Add a function to assert that the mutex is held (or not).",False
d2689fc1683a18bfc9e0af9b5dcbe623a28b6e02,2021-02-17 14:24:03,Romain Vimont,Expose thread id,False
f6320c7e317ba9c5e5fda1fd7d4358646060412b,2021-02-17 14:24:03,Romain Vimont,"Wrap SDL thread functions into scrcpy-specific API

The goal is to expose a consistent API for system tools, and paves the
way to make the ""core"" independant of SDL in the future.",False
30e619d37f867621ada9d549dc735ceaff72a635,2021-02-17 14:24:03,Romain Vimont,"Replace SDL_strdup() by strdup()

The functions SDL_malloc(), SDL_free() and SDL_strdup() were used only
because strdup() was not available everywhere.

Now that it is available, use the native version of these functions.",False
c0dde0fade6d2b582015816a6f08f9114c919094,2021-02-17 14:23:25,Romain Vimont,"Provide strdup() compat

Make strdup() available on all platforms.",False
ace438e52abef2d0ccb8380a2c46501fcdc1c630,2021-02-14 19:17:49,Romain Vimont,"Remove unused port_range field

The port_range is used from ""struct server_params"", the copy in
""struct server"" was unused.",False
8e83f3e8af595ee0a8fe0538abff7501146fcf12,2021-02-14 19:14:05,Romain Vimont,Remove unused custom event,False
f8524a2be738e6471ed2e48265f2663d8c21c0be,2021-01-28 02:20:17,Michael Richardson,"Update java version in BUILD.md

PR #2064 <https://github.com/Genymobile/scrcpy/pull/2064>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
97b001e7c0108ebe474494acba5a331aac4dedb3,2021-01-24 20:01:21,Romain Vimont,"Fix undefined left shift

Small unsigned integers promote to signed int. As a consequence, if v is
a uint8_t, then (v << 24) yields an int, so the left shift is undefined
if the MSB is 1.

Cast to uint32_t to yield an unsigned value.

Reported by USAN (meson x -Db_sanitize=undefined):

    runtime error: left shift of 255 by 24 places cannot be represented
    in type 'int'",False
d8e9ad20b004549b8c001ae5624376fce2070cd4,2021-01-24 18:54:24,Romain Vimont,"Improve file handler error message

Terminating the file handler current process may be either a ""push"" or
""install"" command.",False
b566700bfdedd4115ff9f701aa53eb6be2f8924a,2021-01-24 18:54:24,Romain Vimont,"Kill process with SIGKILL signal

An ""adb push"" command is not terminated by SIGTERM.",False
7afd149f4bccc6b8e0d5d27e48cb5fa05e9f2fec,2021-01-24 18:54:24,Romain Vimont,"Fix file_handler process race condition

The current process could be waited both by run_file_handler() and
file_handler_stop().

To avoid the race condition, wait the process without closing, then
close with mutex locked.",False
6a50231698f0ef635d4ab35ea01d531eb2e0ba2a,2021-01-24 18:54:18,Romain Vimont,"Expose a single process_wait()

There were two versions: process_wait() and process_wait_noclose().

Expose a single version with a flag (it was already implemented that way
internally).",False
b8edcf52b0fb5e1502397c88929868bc79dac1ec,2021-01-22 22:59:21,Romain Vimont,"Simplify process_wait()

The function process_wait() returned a bool (true if the process
terminated successfully) and provided the exit code via an output
parameter exit_code.

But the returned value was always equivalent to exit_code == 0, so just
return the exit code instead.",False
94eff0a4bb0853bc30cbb131e38878f34e28c0f6,2021-01-18 00:14:23,Romain Vimont,"Fix size_t incorrectly assigned to int

The function control_msg_serialize() returns a size_t.",False
8dbb1676b72f4f88dc7967c7d9f6f4802576bcfa,2021-01-18 00:14:23,Romain Vimont,Factorize meson compiler variable initialization,False
ab912c23e756a8a97c48a0735b8027b570f65298,2021-01-17 18:38:48,Romain Vimont,"Define feature test macros in common.h

This enables necessary functions once for all.

As a consequence, define common.h before any other header.",False
ce43fad645d4eb30f322dbeb50d5197601564931,2021-01-15 20:50:34,Simon Chan,"Update README.zh-Hans to v1.17

PR #2029 <https://github.com/Genymobile/scrcpy/pull/2029>

Reviewed-by: Win7GM
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
af516e33ee2561dfe57b30cfe557bd134a6b50cc,2021-01-15 14:47:11,Natan Junges,"Update README.pt-br to v1.17

PR #2034 <https://github.com/Genymobile/scrcpy/pull/2034>

Reviewed-by: latreta <yves_henry13@hotmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
59feb2a15c2e48091675d49561a6258b9d083710,2021-01-08 23:52:10,Romain Vimont,"Group common includes into common.h

Include config.h and compat.h in common.h, and include common.h from all
source files.",False
6385b8c162e58ed167f317a333ceeb13f3979f8c,2021-01-08 23:52:10,Romain Vimont,"Move common structs to coords.h

The size, point and position structs were defined in common.h. Move them
to coords.h so that common.h could be used for generic code to be
included in all source files.",False
037be4af218c2bb5521dce65d01fb8ebd150f113,2021-01-08 23:51:54,Romain Vimont,"Fix compat missing include

The header libavformat/version.h was included, but not
libavcodec/version.h.

As a consequence, the LIBAVCODEC_VERSION_INT definition depended on the
caller includes.",False
1e215199dc682c93b37ebaca9df6f1c0eec68e97,2021-01-08 23:43:53,Romain Vimont,"Remove unused struct port_range

It had been replaced by struct sc_port_range in scrcpy.h.",False
d580ee30f1b388667568b0a30710e365939ca994,2021-01-08 21:14:21,Romain Vimont,"Separate process wait and close

On Linux, waitpid() both waits for the process to terminate and reaps it
(closes its handle). On Windows, these actions are separated into
WaitForSingleObject() and CloseHandle().

Expose these actions separately, so that it is possible to send a signal
to a process while waiting for its termination without race condition.

This allows to wait for server termination normally, but kill the
process without race condition if it is not terminated after some delay.",False
821c175730df6d4d47241ae72346c3be35d1fe99,2021-01-08 21:14:21,Romain Vimont,"Rename process_simple_wait to process_wait

Adding ""simple"" in the function name brings no benefit.",False
cc6f5020d8988c137f04eb22f45e70baa4c9465d,2021-01-08 21:14:21,Romain Vimont,"Move conditional src files in meson.build

Declare all the source files (including the platform-specific ones) at
the beginning.",False
4bd9da4c93d3727c6cd7597452cb255086b47818,2021-01-08 21:14:21,Romain Vimont,"Split command into process and adb

The process API provides the system-specific implementation, the adb API
uses it to expose adb commands.",False
aa8b5713896935e2dfe22ab01e21b84d660c22a1,2021-01-04 12:46:32,Romain Vimont,"Increase display id range

Some devices use big display id values.

Refs #2009 <https://github.com/Genymobile/scrcpy/issues/2009>",False
ed130e05d55615d6014d93f15cfcb92ad62b01d8,2021-01-04 03:11:51,Romain Vimont,"Fix possibly uninitialized value

Due to gotos, ""ret"" may be returned uninitialized.",False
192fbd8450058deb5e70aa1b9bfec3637b5c5e72,2021-01-02 22:57:38,clesiemo3,"Use --cask for latest versions of brew

PR #2004 <https://github.com/Genymobile/scrcpy/pull/2004>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c5c5fc18aec537a5c4134a5bcd45e9f8bbadb66d,2021-01-02 05:56:23,Romain Vimont,Update links to v1.17 in README and BUILD,False
f682b87ba5ed6a5126cc23dff905218b177a2436,2021-01-02 05:23:32,Romain Vimont,Bump version to 1.17,False
10b749e27d34f91d04ff165134fda23e6ec2cc3b,2021-01-02 04:27:01,Romain Vimont,"Kill the server only after a small delay

Let the server terminate properly once all the sockets are closed.

If it does not terminate (this can happen if the device is asleep), then
kill it.

Note: since the server process termination is detected by a flag set
after waitpid() returns, there is a small chance that the process
terminates (and the PID assigned to a new process) before the flag is
set but before the kill() call. This race condition already existed
before this commit.

Fixes #1992 <https://github.com/Genymobile/scrcpy/issues/1992>",False
05e8c1a3c5e955d2941d882e5fe784e6695e3ec4,2021-01-02 04:27:01,Romain Vimont,"Call CloseHandle() after wait on Windows

TerminateProcess() is ""equivalent"" to kill(), while
WaitForSingleObject() is ""equivalent"" to waitpid(), so the handle must
be closed after WaitForSingleObject().",False
83910d3b9c961aa30eec4cf01aee7d38fb050fae,2021-01-01 22:10:52,Romain Vimont,"Initialize server struct dynamically

This will allow to add mutex/cond fields.",False
90f835663004d9dc4969a76a1ef2641af9b02633,2021-01-01 22:02:34,Romain Vimont,"Interrupt device threads on stop

The (non-daemon) threads were not interrupted on video stream stopped,
leaving the server process alive.

Interrupt them to wake up their blocking call so that they terminate
properly.

Refs #1992 <https://github.com/Genymobile/scrcpy/issues/1992>",False
3ba51211d6bb21fa02c5d05079f15aad089de7ca,2021-01-01 22:01:07,Romain Vimont,"Mention how to add default arguments on Windows

Mention that it is possible to add default arguments by editing the
wrapper scripts.",False
ea3582d2c39267d43eda854ce052b3fa35ac7e29,2021-01-01 21:48:13,Romain Vimont,Merge branch 'master' into dev,True
112adbba87f93d85808561301588219b833f9686,2021-01-01 21:46:44,Romain Vimont,Happy new year 2021!,False
d039a7a39a80940c3eca226ce3d7d0555157fa8c,2021-01-01 20:38:58,Romain Vimont,"Upgrade SDL (2.0.14) for Windows

Include the latest version of SDL in Windows releases.",False
6ab80e4ce8311ae65c09d2add5f620bdbef369a2,2021-01-01 20:21:10,Romain Vimont,"Rename release.make to release.mk

It's more standard, and benefits from syntax coloration in vi.",False
230afd8966d3bb4d792a41e4d87dbdd1cf4e9347,2020-12-22 23:22:05,Romain Vimont,"Unify release makefile

Before this change, release.sh built some native stuff, and
Makefile.CrossWindows built the Windows releases.

Instead, use a single release.make to build the whole release. It also
avoids to build the server one more time.",False
a46733906acf3b59d9d1e26abef99ff4b003f5af,2020-12-22 23:21:59,Romain Vimont,"Replace noconsole binary by a wrapper script

This simplifies the build system.

Refs <https://github.com/Genymobile/scrcpy/issues/1975#issuecomment-745314161>",False
431c9ee33b49f5ce7317b4c687e00bc436adbc02,2020-12-22 06:18:01,Romain Vimont,Improve rotation documentation,False
43d3dcbd970640c70272fac9d5e54ff90f8e5eea,2020-12-22 06:14:55,Romain Vimont,"Document Windows command line usage

PR #1973 <https://github.com/Genymobile/scrcpy/pull/1973>

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>",False
a5f4f582956264aa05563df5de847d4a36f8d2aa,2020-12-22 05:44:30,Romain Vimont,Remove duplicate include,False
ea12783bbc935e4bc74329a924cda784b5cfc25a,2020-12-17 15:23:35,Romain Vimont,Upgrade JUnit to 4.13,False
904d47057987fcd2bc2bb9494758a611fa6ab2bc,2020-12-14 14:14:17,Romain Vimont,"Pause on error from a wrapper script

On Windows, scrcpy paused on error before exiting to give the user a
chance to see the user message.

This was a hack and causes issues when using scrcpy from batch scripts.

Disable this pause from the scrcpy binary, and provide a batch wrapper
(scrcpy-console.bat) to pause on error.

Fixes #1875 <https://github.com/Genymobile/scrcpy/issues/1875>",False
6d151eaef914dd836e206e2877263e47882bba18,2020-12-14 13:34:14,Romain Vimont,Reference encoder section from FAQ,False
5dc3285dbf807553f86346ab16d0891cfeb32ab7,2020-12-12 20:56:08,Romain Vimont,"Reference FFmpeg Windows builds from GitHub

Refs #1753 <https://github.com/Genymobile/scrcpy/issues/1753>",False
c9a4bdb8905042cc9bf14e55b09f4430214c9b31,2020-12-12 20:26:32,Romain Vimont,"Upgrade platform-tools (30.0.5) for Windows

Include the latest version of adb in Windows releases.",False
d60ac65b320ab473a8afd1951ac5c3a9da2fa186,2020-12-12 20:25:29,Romain Vimont,Merge branch 'master' into dev,True
d6078cf20244e6651aea5832e6b78b3aa3459766,2020-12-12 20:20:33,jianzhang4,"Fix build errors for macOS

PR #1960 <https://github.com/Genymobile/scrcpy/pull/1960>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
47c897126758ed016881bdf51b2eb643c4a5fe07,2020-12-11 02:07:23,SamBe.ng,"Document shell command to get the device IP

PR #1944 <https://github.com/Genymobile/scrcpy/pull/1944>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
30434afc0ad89198e8f7f5567d9d50bbbf8c055c,2020-11-24 14:15:18,Romain Vimont,Upgrade gradle build tools to 4.0.1,False
868e762d71695f0a45f593c83215aeb428e475b3,2020-11-15 02:40:11,Romain Vimont,"Fix size_t format specifier for Windows

Use ""%Iu"" on Windows. This fixes the following warning:

    ../app/src/sys/win/command.c:17:14: warning: unknown conversion type character ‘l’ in format [-Wformat=]
       17 |         LOGE(""Command too long (%"" PRIsizet "" chars)"", len - 1);",False
576814bcec5718d325de3a85528e5133cc46be68,2020-11-09 01:41:12,Romain Vimont,"Document --encoder option

Add documentation for the new option --encoder in the manpage and in
README.md.",False
42ab8fd61156a7894fb8c6802f7a1b408598e14f,2020-11-09 01:37:20,Romain Vimont,"List available encoders on invalid name specified

If an invalid encoder name is given via the --encoder option, list all
the H.264 encoders available on the device.",False
363eeea19eb0d347643a4dd9592dac0063396dff,2020-11-09 01:37:20,Romain Vimont,"Log encoder name

When the encoder is selected automatically, log the name of the selected
encoder.",False
76c2c6e69dc074031a81c4e050347e374cbfb776,2020-11-09 01:37:17,Tzah Mazuz,"Adding new option --encoder

Some devices have more than one encoder, and some encoders may cause
issues or crash. With this option we can specify which encoder we want
the device to use.

PR #1827 <https://github.com/Genymobile/scrcpy/pull/1827>
Fixes #1810 <https://github.com/Genymobile/scrcpy/issues/1810>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
d5f059c7cbef7d13889086670716d9f33f805dc4,2020-11-07 19:46:51,Romain Vimont,"Add option to force legacy method for pasting

Some devices do not behave as expected when setting the device clipboard
programmatically.

Add an option --legacy-paste to change the behavior of Ctrl+v and MOD+v
so that they inject the computer clipboard text as a sequence of key
events (the same way as MOD+Shift+v).

Fixes #1750 <https://github.com/Genymobile/scrcpy/issues/1750>
Fixes #1771 <https://github.com/Genymobile/scrcpy/issues/1771>",False
adc547fa6e8e6167cd9633a97d98de6665b8c23a,2020-11-03 21:42:26,Romain Vimont,"Add an option to forward all clicks

Add --forward-all-clicks to disable mouse shortcuts and forward middle
and right clicks to the device instead.

Fixes #1302 <https://github.com/Genymobile/scrcpy/issues/1302>
Fixes #1613 <https://github.com/Genymobile/scrcpy/issues/1613>",False
5dcfc0ebab563e7bfdcf4d28025fa1996a79c214,2020-11-03 21:39:03,Romain Vimont,Add local.properties to gitignore,False
ad5f567f07627baea09c7bcf596f921923dca4b2,2020-11-03 21:38:21,Romain Vimont,Remove spurious space,False
25aff0093500c95c90192bc7e78f40ec3f617519,2020-10-06 00:54:59,Romain Vimont,Mention version of Indonesian translation,False
aade92fd1058a88cfdcacf168f2b2b8857b5d562,2020-10-06 00:47:43,yanuarakhid,"Add Indonesian translation for README.md

PR #1802 <https://github.com/Genymobile/scrcpy/pull/1802>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
83082406d36d177976c54d93e8eda5a5ea4811e5,2020-10-06 00:41:50,Romain Vimont,"Enable Java deprecation warnings details

Without the option, gradle reports a lint issue, but without any
details.",False
2edf192e3ae80252d136e6d1a614ab07f93fc561,2020-10-06 00:39:47,Romain Vimont,"Remove deprecation warning

As a workaround for some devices, we need to prepare the main looper.
The method is now deprecated, but we still want to call it.",False
d50ecf40b603f8a0e5a73699babce7301c0bd870,2020-10-01 18:38:18,Romain Vimont,Fix options order,False
15b81367c973a4da7285c697ca2a04d87f44d656,2020-10-01 18:27:09,redev,"Fix FAQ.ko.md

PR #1767 <https://github.com/Genymobile/scrcpy/pull/1767>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
56d237f152fc4d454a65fe594412b4bd9409fd64,2020-10-01 18:22:24,Brinan Sjostrom,"Fix ""press Enter key"" message

The message said ""Press any key to continue..."", whereas only
Enter/Return is accepted.

PR #1783 <https://github.com/Genymobile/scrcpy/pull/1783>
Fixes #1757 <https://github.com/Genymobile/scrcpy/issues/1757>

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
acc65f8c9dc477e978d438a2f2a3501e49230211,2020-09-20 04:41:22,Romain Vimont,"Remove unused field

Fixes #1775 <https://github.com/Genymobile/scrcpy/issues/1775>

Reported-by: lordnn",False
a65ebceac1e1f214328b3be776e7dbc724656db6,2020-09-20 04:41:13,Romain Vimont,"Add missing mutex unlock on error

Fixes #1770 <https://github.com/Genymobile/scrcpy/issues/1770>

Reported-by: lordnn",False
c136edf09d54b4f61e27577622e7ba93f72acb0f,2020-09-17 16:39:43,Win7GM,"Add simplified Chinese translation for README.md

PR #1723 <https://github.com/Genymobile/scrcpy/pull/1723>

Co-authored-by: Shaw Yu <shawyu.nz@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
52560faa344f19d6ec89a586ba85ab8958482e82,2020-09-17 16:33:40,Romain Vimont,Fix README indentation,False
d662f73bdceda1ceb95ea61fe5fd3b556c1ba932,2020-09-15 18:24:22,Romain Vimont,Upgrade Android SDK to 30,False
1c44dc2259f7111f8432fcf1ab8509c68f48d9a0,2020-09-15 17:24:00,Romain Vimont,"Use portable shebang for all bash scripts

Refs #426 <https://github.com/Genymobile/scrcpy/pull/426>
Refs #1716 <https://github.com/Genymobile/scrcpy/pull/1716>",False
02a882a0a2fbe40504889bf753aa055bfc3c4fdf,2020-09-15 17:22:50,Luís Ferreira,"Use a more portable shebang for bash

This should increase the portability of bash scripts across various *nix
systems such as BSD-like distributions.

PR #1716 <https://github.com/Genymobile/scrcpy/pull/1716>

Signed-off-by: Luís Ferreira <contact@lsferreira.net>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
cf7bf3148caca8d4428cbd70578696a8230689e0,2020-09-15 17:14:02,CapsLock,"Use ""/usr/bin/env bash"" for build-wrapper.sh

PR #426 <https://github.com/Genymobile/scrcpy/pull/426>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ae758f99d6af81123bb6b74d307d798c2c17acf3,2020-09-15 17:01:10,Romain Vimont,"Adapt call() on ContentProvider for Android 11

This commit in AOSP framework_base added a parameter ""attributionTag"" to
the call() method:
https://android.googlesource.com/platform/frameworks/base.git/+/12ac3f406fed87cb9cd3a28b9947e7202a2d14bd%5E%21/#F17

As a consequence, the method did not exist, so scrcpy used the legacy
call() method (using the authority ""unknown"") as a fallback, which fails
for security reasons.

Fixes #1468 <https://github.com/Genymobile/scrcpy/issues/1468>",False
bd9f656933e79f7b21b42993f8a70a761ab47226,2020-08-31 17:32:51,Romain Vimont,"Fix feature test macro

The expected feature test macro is _POSIX_C_SOURCE having a value
greater or equal to 200809L.

Fixes #1726 <https://github.com/Genymobile/scrcpy/issues/1726>",False
c243fd4c3fe91e83bacf89d2d6bbf642e5019f39,2020-08-31 17:10:32,Romain Vimont,"Fix more log format warning

The expression port + 1 is promoted to int, but printed as uint16_t.

This is the same mistake fixed for a different log by
7eb16ce36458011d87972715f08bd9f03ff39807.

Refs #1726 <https://github.com/Genymobile/scrcpy/issues/1726>",False
0bf110dd5cc6a9793177c7764fe7fbfb452628f6,2020-08-21 16:04:59,brunoais,"Reset power mode only if screen is on

PR #1670 <https://github.com/Genymobile/scrcpy/pull/1670>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0c5e0a4f6d30834e7aa1623636675df5d9bda1f2,2020-08-21 16:04:50,Romain Vimont,"Make Device methods static when possible

The behavior of some methods do not depend on the user-provided options.
These methods can be static. This will allow to call them directly from
the cleanup process.",False
0be766e71a30eec1709da7b24999b6df2b40dc65,2020-08-20 22:44:45,Romain Vimont,Add undetected device error message in FAQ,False
d02789ce21a183682f968cc95dcd88c98efba0f0,2020-08-16 17:22:01,Romain Vimont,"List available shortcut keys on error

Fixes #1681 <https://github.com/Genymobile/scrcpy/issues/1681>

Suggested-by: Moritz Schulz <moritzleni@gmail.com>",False
6cc22e1c5b370baecee9072f52c44fdd13ba9634,2020-08-16 17:14:42,Romain Vimont,"Reference --shortcut-mod from shortcuts list

Fixes #1681 <https://github.com/Genymobile/scrcpy/issues/1681>

Suggested-by: Moritz Schulz <moritzleni@gmail.com>",False
479d10dc22b70272187e0963c6ad24d754a669a2,2020-08-11 00:04:51,Romain Vimont,Update links to v1.16 in README and BUILD,False
d7779d08e8f9004ec44197cd8eb7fdec0e1d4dd1,2020-08-10 23:39:28,Romain Vimont,Bump version to 1.16,False
df4ba1b8b0e6dc92b41c589cf801da4072c3ef41,2020-08-10 23:38:33,Romain Vimont,Merge branch 'master' into dev,True
198346d1482829119cf07c565086840254e519b9,2020-08-10 23:38:24,Romain Vimont,"Add pinch-to-zoom simulation

If Ctrl is hold when the left-click button is pressed, enable
pinch-to-zoom to scale and rotate relative to the center of the screen.

Fixes #24 <https://github.com/Genymobile/scrcpy/issues/24>",False
8081e9cc11ac96b4dbe452991865d762f3dec468,2020-08-10 23:28:11,RaenonX JELLYCAT,"Add reference of the translations in README

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b87a0df99aa276673307f648853651158c2657b7,2020-08-10 23:28:00,RaenonX JELLYCAT,"Add Traditional Chinese translation for README

Reviewed-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
95f1ea0d80e6bb61579ae6c9a50554d235d91383,2020-08-10 18:07:32,Romain Vimont,"Fix clipboard paste condition

To avoid possible copy-paste loops between the computer and the device,
the device clipboard is not set if it already contains the expected
content.

But the condition was wrong: it was not set also if it was empty.

Refs 1223a72eb83ebafb878a25356250896c45b5cefa
Fixes #1658 <https://github.com/Genymobile/scrcpy/issues/1658>",False
38940ffe892cab44a05d727be26b7a71e725bdba,2020-08-09 20:40:27,Romain Vimont,"Revert ""Inject WAKEUP instead of POWER""

WAKEUP does not work on some devices.

Fixes #1655 <https://github.com/Genymobile/scrcpy/issues/1655>

This reverts commit 322f1512ea806611eb37f508cd952bbbc050f853.",False
a59a15777de9c3af3da27d60181ae046a71c09f4,2020-08-09 14:44:38,Yu-Chen Lin,"Fix missing change of Ctrl key in README

PR #1652 <https://github.com/Genymobile/scrcpy/pull/1652>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
a2cb63e344077f7c34a71333217bc1bdf53ba633,2020-08-08 16:48:23,Jozef Hollý,"Add packaging status

PR #1650 <https://github.com/Genymobile/scrcpy/pull/1650>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f03a3edde618402ecff442383845ec7ba7f0b829,2020-08-07 15:43:27,Romain Vimont,Update links to v1.15.1 in README and BUILD,False
633a51e9c4c64ed549a9a44f8348ded528268451,2020-08-07 15:31:34,Romain Vimont,Bump version to 1.15.1,False
976761956f5ff8a806a8547e7a1af9e4e7e3d77c,2020-08-07 15:02:11,Romain Vimont,"Fix uninitialized repeat count in key events

A new ""repeat"" field has been added by
3c1ed5d86c38bcbd5353b0a7e6ef5653d6c44d0d, but it was not initialized in
every code path.

As a consequence, keycodes generated by shortcuts were sent with an
undetermined value, breaking some shortcuts (especially HOME) randomly.

Fixes #1643 <https://github.com/Genymobile/scrcpy/issues/1643>",False
521f2fe994019065e938aa1a54b56b4f10a4ac4a,2020-08-07 01:26:06,Romain Vimont,Update links to v1.15 in README and BUILD,False
edc4f7675f65d6c94a4c8935d13f84b6f601a79a,2020-08-07 00:30:48,Romain Vimont,Bump version to 1.15,False
712f1fa6b2fa82f4916daad631bcae6c3de94e45,2020-08-07 00:30:48,Romain Vimont,"Upgrade FFmpeg (4.3.1) for Windows

Include the latest version of FFmpeg in Windows releases.",False
1ba06037f88aedf01bae1933b404eac1cb3aa129,2020-08-07 00:30:48,Romain Vimont,"Upgrade platform-tools (30.0.4) for Windows

Include the latest version of adb in Windows releases.",False
da63e3774b94067620ad8a323a65ddccee3bf75f,2020-08-07 00:30:15,Romain Vimont,Merge branch 'master' into dev,True
cf9d44979cf4eca514a66cd9ec4d4bb8b5be1e19,2020-08-03 23:21:58,brunoais,"Keep the screen off on powering on

PR #1577 <https://github.com/Genymobile/scrcpy/pull/1577>
Fixes #1573 <https://github.com/Genymobile/scrcpy/issues/1573>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
84f1d9e37502fbffc1e6b6754b930a37a5403703,2020-08-03 23:21:55,xeropresence,"Add --no-key-repeat cli option

Add an option to avoid forwarding repeated key events.

PR #1623 <https://github.com/Genymobile/scrcpy/pull/1623>
Refs #1013 <https://github.com/Genymobile/scrcpy/issues/1013>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
65d06a36634287426206b459d2f290142ea1bf46,2020-08-02 21:50:14,xeropresence,"Pass full options struct to static functions

This avoids to pass specific options values individually. Since these
function are static (internal to the file), this is not a problem to
make them depend on scrcpy_options.

Refs #1623 <https://github.com/Genymobile/scrcpy/pull/1623>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
74079ea5e4ce0282a5d078cfa80fc68d2d9da16e,2020-08-02 21:49:41,Romain Vimont,"Copy the options used in input manager init

This avoids to pass additional options to some input manager functions.

Refs #1623 <https://github.com/Genymobile/scrcpy/pull/1623>",False
0870d8620f327768249214a5ba6a7bee7a8a75ec,2020-08-01 20:40:09,Romain Vimont,"Mention that MENU unlocks screen

Pressing MENU while in lock screen unlocks (it still asks for the schema
or code if enabled).",False
d49cffb93890982ba837e7b7bc4d9ee9405443d6,2020-08-01 20:34:16,Romain Vimont,"Use <kbd> HTML tag for keys

It's prettyier in a browser.",False
dfb7324d7b06e649c8355164a7d97bd592ef5af8,2020-08-01 20:21:38,Romain Vimont,Mention in README that Ctrl is forwarded,False
d8b3ba170cb005e67be7dc866aa91134c4101edd,2020-08-01 20:21:37,Romain Vimont,"Update copy-paste section in README

Update documentation regarding the recent copy-paste changes.",False
7ad47dfaab57a7e6c7462d7e6a2798a5f122ebaf,2020-08-01 20:17:44,Romain Vimont,"Swap paste shortcuts

For consistency with MOD+c and MOD+x, use MOD+v to inject PASTE.

Use Mod+Shift+v to inject clipboard content as a sequence of text
events.",False
56a115b5c5971b7035609d5e0e3eabf97e91f874,2020-08-01 20:17:43,Romain Vimont,"Add shortcuts for COPY and CUT

Send COPY and CUT on MOD+c and MOD+x (only supported for Android >= 7).

The shortcuts Ctrl+c and Ctrl+x should generally also work (even before
Android 7), but the active Android app may use them for other actions
instead.",False
8f64a5984b35af115aeb106ac7cb3731f83472ad,2020-08-01 20:01:31,Romain Vimont,"Change ""resize to fit"" shortcut to MOD+w

For convenience, MOD+x will be used for injecting the CUT keycode.",False
bccd12bf5c268bdf096ef81971f13703c97bf474,2020-08-01 20:01:31,Romain Vimont,"Remove ""get clipboard"" call

Now that every device clipboard change is automatically synchronized to
the computer, the ""get clipboard"" request (bound to MOD+c) is useless.",False
20d39250997635ef882df4e2c11144e5f9f82448,2020-08-01 20:01:31,Romain Vimont,"Set computer clipboard only if necessary

Do not explicitly set the clipboard text if it already contains the
expected content.

Even if copy-paste loops are avoided by the previous commit, this avoids
to trigger a clipboard change on the computer-side.

Refs #1580 <https://github.com/Genymobile/scrcpy/issues/1580>",False
1223a72eb83ebafb878a25356250896c45b5cefa,2020-08-01 20:01:31,Romain Vimont,"Set device clipboard only if necessary

Do not explicitly set the clipboard text if it already contains the
expected content. This avoids possible copy-paste loops between the
computer and the device.",False
7683be8159c7372c7def0b868ba76a426fa7426e,2020-08-01 20:01:31,Romain Vimont,"Synchronize clipboard on Ctrl+v

Pressing Ctrl+v on the device will typically paste the clipboard
content.

Before sending the key event, synchronize the computer clipboard to the
device clipboard to allow seamless copy-paste.",False
d4ca85d6a83ee7bdb3dce648b9739374ae770662,2020-08-01 20:01:31,Romain Vimont,"Forward Shift to the device

This allows to select text using Shift+(arrow keys).

Fixes #942 <https://github.com/Genymobile/scrcpy/issues/942>",False
e6e528f228f762336ad6b37679c592cf46f6c4cf,2020-08-01 20:01:31,Romain Vimont,"Forward Ctrl to the device

Now that the scrcpy shortcut modifier is Alt by default (and can be
configured), forward Ctrl to the device.

This allows to trigger Android shortcuts.

Fixes #555 <https://github.com/Genymobile/scrcpy/issues/555>",False
a5f8b577c50e9498c43f7d4d9a25287673244c0f,2020-08-01 20:01:31,Romain Vimont,"Ignore text events for shortcuts

Pressing Alt+c generates a text event containing ""c"", so ""c"" was sent to
the device when --prefer-text was enabled.

Ignore text events when the mod state matches a shortcut modifier.",False
e4bb7c1d1feb51e3277db086207833611fc20603,2020-08-01 20:01:31,Romain Vimont,"Accept Super as shortcut modifier

In addition to (left) Alt, also accept (left) Super. This is especially
convenient for macOS users (Super is the Cmd key).",False
1b76d9fd78c3a88a8503a72d4cd2f65bdb836aa4,2020-08-01 20:01:27,Romain Vimont,"Customize shortcut modifier

Add --shortcut-mod, and use Alt as default modifier.

This paves the way to forward the Ctrl key to the device.",False
63cb93d7d7d90354b834e71200eb43ee9228f2a3,2020-08-01 20:01:08,Romain Vimont,"Use Ctrl for all shortcuts

Remove the Cmd modifier on macOS, which was possible only for some
shortcuts but not all.

This paves the way to make the shortcut modifier customizable.",False
9d9dd1f143e6dae770263432a11946f1601be82e,2020-07-17 03:30:42,Romain Vimont,"Make expression order consistent

The condition ""cmd"" was always before ""shift"" in all expressions except
4.",False
eabaf6f7bd391d0147eaebda51c79bbf9a75807a,2020-07-17 03:30:42,Romain Vimont,"Simplify PASTE option for ""set clipboard""

When the client requests to set the clipboard, it may request to press
the PASTE key in addition. To be a bit generic, it was stored as a flag
in ControlMessage.java.

But flags suggest that it represents a bitwise union. Use a simple
boolean instead.",False
199c74f62f5f78748769e6489122242a3217dc54,2020-07-15 15:47:04,Romain Vimont,"Declare main() with argc/argv params in tests

Declaring the main method as ""int main(void)"" causes issues with SDL.

Fixes #1209 <https://github.com/Genymobile/scrcpy/issues/1209>",False
322f1512ea806611eb37f508cd952bbbc050f853,2020-07-15 15:33:44,Romain Vimont,"Inject WAKEUP instead of POWER

To power the device on, inject KEYCODE_WAKEUP to avoid a possible
race condition (the device might become off between the test
isScreenOn() and the POWER keycode injection).",False
30714aba34e8b447159beaebeaf4eeab7bd33907,2020-07-10 02:03:11,brunoais,"Restore power mode to normal on cleanup

This avoids to let the device screen turned off (as enabled by Ctrl+o or
--turn-screen-off).

PR #1576 <https://github.com/Genymobile/scrcpy/pull/1576>
Fixes #1572 <https://github.com/Genymobile/scrcpy/issues/1572>",False
a973757fd141fc07ef81314d350bd4f4de64f59c,2020-07-10 02:02:14,Romain Vimont,"Warn on ignored touch event

In theory, this was expected to only happen when a touch event is sent
just before the device is rotated, but some devices do not respect the
encoding size, causing an unexpected mismatch.

Refs #1518 <https://github.com/Genymobile/scrcpy/issues/1518>",False
deea29f52ac742a5090b53bc880e113bfbbcb265,2020-07-10 02:01:47,Romain Vimont,"Send touch event without pressure on button up

Refs #1518 <https://github.com/Genymobile/scrcpy/issues/1518>",False
5086e7b744e9edfa9d1d56cf5ae2ad3b0ae32ddf,2020-07-08 00:20:09,NGAU Zeonfung,"Update BUILD.md

Update the macOS section.

PR #1559 <https://github.com/Genymobile/scrcpy/pull/1559>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5fa46ad0c71169f9369f9f3bde9cce3d29ed4b88,2020-07-07 19:17:25,Romain Vimont,Fix constants name in comment,False
334964c380ebc647b9f1e876182372efa51f26dc,2020-07-07 19:04:34,Romain Vimont,"Make setScreenPowerMode() method static

Its implementation does not use the instance at all.",False
f7d4b6d0db0f417ab0c45088710dc174e97a0894,2020-07-03 12:23:51,Romain Vimont,"Do not crash on missing clipboard manager

Some devices have no clipboard manager.

In that case, do not try to enable clipboard synchronization to avoid
a crash.

Fixes #1440 <https://github.com/Genymobile/scrcpy/issues/1440>
Fixes #1556 <https://github.com/Genymobile/scrcpy/issues/1556>",False
e99b896ae2b6a59d5f7f2b76a3dd9c29f4838013,2020-06-27 19:21:44,axxx007xxxz,"README: Add Fedora install instructions

PR #1549 <https://github.com/Genymobile/scrcpy/pull/1549>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e8a565f9ea91a30cd354de696b3b35ea74cda83b,2020-06-27 19:15:28,Romain Vimont,"Fix touch events HiDPI-scaling

Touch events were HiDPI-scaled twice:
 - once because the position (provided as floats between 0 and 1) were
   converted in pixels using the drawable size (not the window size)
 - once due to screen_convert_to_frame_coords()

One possible fix could be to compute the position in pixels from the
window size instead, but this would unnecessarily round the event
position to the nearest window coordinates (instead of drawable
coordinates).

Instead, expose two separate functions to convert to frame coordinates
from either window or drawable coordinates.

Fixes #1536 <https://github.com/Genymobile/scrcpy/issues/1536>
Refs #15 <https://github.com/Genymobile/scrcpy/issues/15>
Refs e40532a3761da8b3aef484f1d435ef5f50d94574",False
8c27f59aa571504e2e038dc5386e2be6897cec32,2020-06-26 01:38:02,Hossam Elbadissi,"Improve linguistic

PR #1543 <https://github.com/Genymobile/scrcpy/pull/1543>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3c1ed5d86c38bcbd5353b0a7e6ef5653d6c44d0d,2020-06-20 02:00:17,xeropresence,"Handle repeating keycodes

Initialize ""repeat"" count on key events.

PR #1519 <https://github.com/Genymobile/scrcpy/pull/1519>
Refs #1013 <https://github.com/Genymobile/scrcpy/pull/1013>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
0ba74fbd9a1c599b7a93d44631e6973eb4940049,2020-06-20 02:00:02,Romain Vimont,"Make scrcpy.h independant of other headers

The header scrcpy.h is intended to be the ""public"" API. It should not
depend on other internal headers.

Therefore, declare all required structs in this header and adapt
internal code.",False
29e5af76d4f0a7d5b079c760cc48aa8b26c554e8,2020-06-20 01:24:46,Romain Vimont,"Remove fprintf() call in tests

It should never have been committed.",False
dc7b60e6199b90a45ea26751988f6f30f8b2efdf,2020-06-19 01:05:28,Ivan Keliukh,"Add option for disabling screensaver

PR #1502 <https://github.com/Genymobile/scrcpy/pull/1502>
Fixes #1370 <https://github.com/Genymobile/scrcpy/issues/1370>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
42641d273772b2dcc55a34f8ae7cd5f6bdea51d5,2020-06-19 00:43:35,AreYouLoco?,"Fix typo in README.md

PR #1523 <https://github.com/Genymobile/scrcpy/pull/1523>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1e4ee547b560ad3c52ce33fd32cf1b10b3d24d1a,2020-06-12 02:41:20,Romain Vimont,"Make message buffer static

Now that the message max size is 256k, do not put the buffer on the
stack.",False
488d22d4e23afe902bbcef0e3c535591f66b6f2c,2020-06-12 02:41:20,Romain Vimont,"Increase clipboard size from 4k to 256k

Beyond 256k, SDL_GetClipboardText() returns an empty string on my
computer.

Fixes #1117 <https://github.com/Genymobile/scrcpy/issues/1117>",False
00d292b2f5833740517cec829cc08531f85155e6,2020-06-12 02:41:20,Romain Vimont,"Fix receiver on partial device messages

If a single device message was read in several chunks from the control
socket, the communication was broken.",False
245999aec4a4a1454212b38a988aa96fa701bb04,2020-06-12 02:41:17,Romain Vimont,"Serialize text size on 4 bytes

This will allow to send text having a size greater than 65535 bytes.",False
d91c5dcfd54fa98a06be938da83fdad8e85e3724,2020-06-12 02:38:04,Romain Vimont,"Rename MSG_SERIALIZED_MAX_SIZE to MSG_MAX_SIZE

For simplicity and consistency with the server part.",False
d202d7b2059eb440c044477993a6e0d6aa4d5086,2020-06-12 02:36:02,Romain Vimont,"Add unit test for big clipboard device message

Test clipboard synchronization from the device to the computer.",False
08c0c64af64cf124c46f0922447f81fc804a74b8,2020-06-12 02:36:02,Romain Vimont,"Rename test names from ""event"" to ""msg""

The meson test names had not been changed when ""event"" had been renamed
to ""message"".

Ref: 28980bbc90ab93cf61bdc4b36d2448b8cebbb7df",False
a00a8763d6ebc240ab06380c04a762d10dfc7939,2020-06-12 02:36:02,Romain Vimont,"Avoid additional copy on Java text parsing

Directly pass the buffer range to the String constructor.",False
8f314c74b073a7f844de16539657a264f05662d6,2020-06-12 02:28:54,Romain Vimont,"Reorganize message size constants

Make the max clipboard text length depend on the max message size.",False
3c0fc8f54f42bf6e7eca35b352a7d343749b65c4,2020-06-10 01:39:23,Romain Vimont,Mention sndcpy,False
1b73eff3c95a3e1875f0db51a60179f3d282ea57,2020-06-08 01:30:35,Louis Leseur,"Add missing file in build_without_gradle.sh

Fixes #1481 <https://github.com/Genymobile/scrcpy/issues/1481>
PR #1482 <https://github.com/Genymobile/scrcpy/pull/1482>

Signed-off-by: Louis Leseur <louis.leseur@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
6e1069a8228217d39b87f6a490a4c2c75258c16a,2020-06-02 21:57:23,Romain Vimont,"Configure log level for application only

Do not expose internal SDL logs to users.

Fixes #1441 <https://github.com/Genymobile/scrcpy/issues/1441>",False
c4323df97607d345f35d832cd373b4882b73a9ac,2020-06-02 21:57:14,Romain Vimont,"Fix incorrect log return value

The function must return a SDL_LogPriority, but returned an enum
sc_log_level.

(It was harmless because this specific return should never happen, as
asserted.)",False
8ff07e0c88c7d267cbf00fd9e63f8c9f9dc3c952,2020-06-02 21:55:22,Romain Vimont,Git-ignore release directories,False
e4efd757666c0a29876783dd916043ebebbec493,2020-05-30 01:32:41,Romain Vimont,"Avoid repetition for some shortcuts

Keeping the key pressed generate ""repeat"" events. It does not make sense
to repeat the event for rotation or turn screen off.",False
0e4a6f462bcc628af00896eea38aa883d68acc88,2020-05-29 02:37:28,Romain Vimont,"Mention stay awake limitation

The ""stay awake"" feature only works when the device is plugged in.

Refs #1445 <https://github.com/Genymobile/scrcpy/issues/1445>",False
8b73c90427e5f31d031357c2b319512b57ef78f5,2020-05-27 23:02:02,Romain Vimont,"Mention how to turn the screen on in README

Now that Ctrl+Shift+o has been reactivated, mention it in the ""turn
screen off"" section.",False
ef91ab2841db16d8ac192813cc8cdca7552f8a12,2020-05-27 23:01:12,Romain Vimont,Update links to v1.14 in README and BUILD,False
44fa4a090eb7c64678a2034535da3ee09884b657,2020-05-27 21:56:46,Romain Vimont,Bump version to 1.14,False
dcde578a50ffb9d2594c4764a067e9dd328bf55c,2020-05-27 21:56:46,Romain Vimont,"Reactivate ""turn device screen on"" feature

This reverts commit 8c8649cfcd710859ce18eab557ed2af8cedb9a42.

I cannot reproduce the issue with Ctrl+Shift+o on any device, so in
practice it works, it's too bad to remove the feature for a random bug
on some Android versions on some devices.",False
93a5c5149d6b4d04376f147e6da2f5ca3ced8aea,2020-05-27 21:56:39,Romain Vimont,"Push clipboard text only if not null

In practice, it does not change anything (it just avoids a spurious
wake-up), but semantically, it makes no sense to call
pushClipboardText() with a null value.",False
2ca8318b9df10f24de138ab59ab41d589db26fb3,2020-05-27 16:09:42,Romain Vimont,"Improve manpage formatting

Add a new line to avoid unwanted text justification",False
d499ee53c9fa63fb02db00dc09fdd4425f506ef6,2020-05-27 15:35:29,Romain Vimont,"Initialize a default log level

Clean up has been broken by 3df63c579da7a35048458c6884f5f386154d2353.

The verbosity was correctly initialized for the Server process, but not
for the CleanUp process.

To avoid the problem, initialize a default log level.",False
8f619f337baec26791514632c64c0385585c2f06,2020-05-26 22:51:05,Romain Vimont,"Upgrade platform-tools (30.0.0) for Windows

Include the latest version of adb in Windows releases.",False
fc1dec027093ee8a2746a212db0c72a9d96d39a4,2020-05-26 00:29:21,Romain Vimont,"Paste on ""set clipboard"" if possible

Ctrl+Shift+v synchronizes the computer clipboard to the Android device
clipboard. This feature had been added to provide a way to copy UTF-8
text from the computer to the device.

To make such a paste more straightforward, if the device runs at least
Android 7, also send a PASTE keycode to paste immediately.

<https://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_PASTE>

Fixes #786 <https://github.com/Genymobile/scrcpy/issues/786>",False
274b591d1867eacd9cffd6a1b38c906253023f8e,2020-05-25 22:11:05,Romain Vimont,"Fix union typo

The ""set clipboard"" event used the wrong union type to store its text.

In practice, it worked because both are at the same offset.",False
4bbabfb4ef5f1105215dc2bb8a282ffce221bbcc,2020-05-25 06:58:33,Romain Vimont,"Move injection methods to Device

Only the main injection method was exposed on Device, the convenience
methods were implemented in Controller.

For consistency, move them all to the Device class.",False
ffc57512b3241d28424cd883985d66ac92698cf3,2020-05-25 06:58:33,Romain Vimont,"Avoid clipboard synchronization loop

The Android device listens for clipboard changes to synchronize with the
computer clipboard.

However, if the change comes from scrcpy (for example via Ctrl+Shift+v),
do not notify the change.",False
c7a33fac36576817f092188f54b140e71edd8412,2020-05-25 06:58:33,Romain Vimont,"Log actions on the caller side

Some actions are exposed by the Device class, but logging success should
be done by the caller.",False
81573d81a078021bf17a7e5b76ecd9633c7d0fad,2020-05-25 06:58:15,Romain Vimont,"Pass a Locale to toUpperCase()

Make lint happy.",False
5c2cf88a1dd80cbf9752bb500c3d1bd426316926,2020-05-25 06:52:07,Romain Vimont,"Rename THRESHOLD to threshold

Since the field is not final anymore, lint expects the name not to be
capitalized.",False
8f46e184262aebb3a420571de73520d60ccdfbd0,2020-05-25 02:58:31,Romain Vimont,"Add --force-adb-forward

Add a command-line option to force ""adb forward"", without attempting
""adb reverse"" first.

This is especially useful for using SSH tunnels without enabling remote
port forwarding.",False
ee3882f8be22fe092bea0685be1e57e5add3935e,2020-05-25 02:44:30,Romain Vimont,Fix typo in manpage,False
a3ef461d73c4b010eacfc1f6703d38d0f2e44fad,2020-05-25 01:31:51,Romain Vimont,"Add cli option to set the verbosity level

The verbosity was set either to info (in release mode) or debug (in
debug mode).

Add a command-line argument to change it, so that users can enable debug
logs using the release:

    scrcpy -Vdebug",False
3df63c579da7a35048458c6884f5f386154d2353,2020-05-25 00:44:25,Romain Vimont,"Configure server verbosity from the client

Send the requested log level from the client.

This paves the way to configure it via a command-line argument.",False
56bff2f7181f1b51132f1f06682010900720cff9,2020-05-25 00:41:21,Romain Vimont,"Avoid compiler warning

The field lock_video_orientation may only take values between -1 and 3
(included). But the compiler may trigger a warning on the sprintf()
call, because its type could represent values which could overflow the
string (like ""-128""):

> warning: ‘%i’ directive writing between 1 and 4 bytes into a region of
> size 3 [-Wformat-overflow=]

Increase the buffer size to remove the warning.",False
080a4ee3654a9b7e96c8ffe37474b5c21c02852a,2020-05-24 18:24:34,Tzah Mazuz,"Add --codec-options

Add a command-line parameter to pass custom options to the device
encoder (as a comma-separated list of ""key[:type]=value"").

The list of possible codec options is available in the Android
documentation:
<https://d.android.com/reference/android/media/MediaFormat>

PR #1325 <https://github.com/Genymobile/scrcpy/pull/1325>
Refs #1226 <https://github.com/Genymobile/scrcpy/pull/1226>

Co-authored-by: Romain Vimont <rom@rom1v.com>",False
c7155a1954bd26e09195d8f2c2d582598d5b67dd,2020-05-24 18:03:43,Romain Vimont,"Add unit test for big ""set clipboard"" event

Add a unit test to avoid regressions.

Refs #1425 <https://github.com/Genymobile/scrcpy/issues/1425>",False
517dbd9c85842797ec8bf21ced2ddc4040a87230,2020-05-24 18:03:23,Romain Vimont,"Increase buffer size to fix ""set clipboard"" event

The buffer size must be greater than any event message.

Clipboard events may take up to 4096 bytes, so increase the buffer size.

Fixes #1425 <https://github.com/Genymobile/scrcpy/issues/1425>",False
acc4ef31df8dbdfa9c1ed6170088741a45b1aead,2020-05-24 18:01:49,Romain Vimont,"Synchronize device clipboard to computer

Automatically synchronize the device clipboard to the computer any time
it changes.

This allows seamless copy-paste from Android to the computer.

Fixes #1056 <https://github.com/Genymobile/scrcpy/issues/1056#issuecomment-631363684>
PR #1423 <https://github.com/Genymobile/scrcpy/pull/1423>",False
73e722784d610266d84e1bf75d1db16e9ad3c2d6,2020-05-23 21:51:54,Romain Vimont,"Remove useless exception declaration

The interface declares it can throw a RemoteException, but the
implementation never throws such exception.",False
e1cd75792c3b6a014043b82a4089c6d34fcf78fb,2020-05-23 18:09:09,Romain Vimont,"Simplify rotation watcher call

Remove unnecessary private method (which was wrongly public).",False
ac4c8b4a3f5c342ff2059fb5ca0720dab8b933f2,2020-05-23 18:02:16,Romain Vimont,"Increase LOD bias for mipmapping

Mipmapping caused too much blurring.

Using a LOD bias of -1 instead of -0.5 seems a better compromise to
avoid low-quality downscaling while keeping sharp edges in any case.

Refs <https://github.com/Genymobile/scrcpy/issues/1394>
Refs <https://github.com/Genymobile/scrcpy/issues/40#issuecomment-591917787>",False
fae3f9eeabbb6586eadde8f720a849befd45b6a0,2020-05-23 17:53:30,Romain Vimont,"Remove warning when renderer is not OpenGL

Trilinear filtering can currently only be enabled for OpenGL renderers.

Do not print a warning if the renderer is not OpenGL, as it can confuses
users, while nothing is wrong.",False
f5aeecbc621289fdd92f935858ed2abc4347f2b3,2020-05-23 17:49:09,Romain Vimont,"Reset window size on initialization

On macOS with renderer ""metal"", HiDPI scaling may be incorrect on
initialization when several displays are connected.

Resetting the window size fixes the problem.

Refs #15 <https://github.com/Genymobile/scrcpy/issues/15>",False
e40532a3761da8b3aef484f1d435ef5f50d94574,2020-05-23 17:49:09,Romain Vimont,"Manually position and scale the content

Position and scale the content ""manually"" instead of relying on the
renderer ""logical size"".

This avoids possible rounding differences between the computed window
size and the content size, causing one row or column of black pixels on
the bottom or on the right.

This also avoids HiDPI scale issues, by computing the scaling manually.

This will also enable to draw items at their expected size on the screen
(unscaled).

Fixes #15 <https://github.com/Genymobile/scrcpy/issues/15>",False
d860ad48e6be41ec7c7ccbfca8b305fe126fc340,2020-05-23 17:49:09,Romain Vimont,"Extract optimal window size detection

Extract the computation to detect whether the current size of the window
is already optimal.

This will allow to reuse it for rendering.",False
ec047b501e830dea136d91dc5e7289077488fe34,2020-05-23 17:49:09,Romain Vimont,"Disable ""resize to fit"" in maximized state

In maximized state (but not fullscreen), it was possible to resize to
fit the device screen (with Ctrl+x or double-clicking on black borders).

This caused problems on macOS with the ""expand to fullscreen"" feature,
which behaves like a fullscreen mode but is seen as maximized by SDL.
In that state, resizing to fit causes unexpected results.

To keep the behavior consistent on all platforms, just disable ""resize
to fit"" when the window is maximized.",False
4c2e10fd743a3e83eacc8828d5fbb89c87e929a8,2020-05-23 17:49:09,Romain Vimont,"Workaround maximized+fullscreen on Windows

On Windows, in maximized+fullscreen state, disabling fullscreen mode
unexpectedly triggers the ""restored"" then ""maximized"" events, leaving
the window in a weird state (maximized according to the events, but not
maximized visually).

Moreover, apply_pending_resize() asserts that fullscreen is disabled.

To avoid the issue, if fullscreen is set, just ignore the ""restored""
event.",False
6b1da2fcffdc31f83519a81400af548c8d1dd787,2020-05-23 17:49:09,Romain Vimont,"Simplify size changes in fullscreen or maximized

If the content size changes (due to rotation for example) while the
window is maximized or fullscreen, the resize must be applied once
fullscreen and maximized are disabled.

The previous strategy consisted in storing the windowed size, computing
the target size on rotation, and applying it on window restoration. But
tracking the windowed size (while ignoring the non-windowed size) was
tricky, due to unspecified order of SDL events (e.g. size changes can be
notified before ""maximized"" events), race conditions when reading window
flags, different behaviors on different platforms...

To simplify the whole resize management, store the old content size (the
frame size, possibly rotated) when it changes while the window is
maximized or fullscreen, so that the new optimal size can be computed on
window restoration.",False
2608b1dc62d4cce830880bc504d995db96db0406,2020-05-23 17:49:09,Romain Vimont,"Factorize window resize

When the content size changes, either on frame size or client rotation
changes, the window must be resized. Factorize for both cases.",False
31fa11565566d047c657b99384c9362eb8023e74,2020-05-23 17:48:47,Romain Vimont,Merge branch 'master' into dev,True
a85848a5415b05b712f4320d7a73afd229f5d43a,2020-05-11 05:02:54,Romain Vimont,"Fix Windows Ctrl Handler declaration

The handler function signature must include the calling convention
declaration.

Ref: <https://stackoverflow.com/questions/61717439/why-calling-setconsolectrlhandler-triggers-a-warning>",False
82446b6b0db284e9f9a125cd3e4785586f6845f3,2020-05-10 15:17:56,Romain Vimont,"Reference README.md from localized versions

Mention that the README.md is the only one being up-to-date.",False
24c803924449b1f72801e982ba35dfb80d54116d,2020-05-10 15:16:24,latreta,"Add Brazilian Portuguese translation

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
28abd98f7fef5161ede934a41287b2c0ec1d7668,2020-05-08 18:24:33,Romain Vimont,"Properly handle Ctrl+C on Windows

By default, Ctrl+C just kills the process on Windows. This caused
corrupted video files on recording.

Handle Ctrl+C properly to clean up properly.

Fixes #818 <https://github.com/Genymobile/scrcpy/issues/818>",False
e2d5f0e7fc98af97f3785ce492b7e8f87b109df1,2020-05-07 18:38:11,Romain Vimont,"Send scroll events as a touchscreen

Scroll events were sent with a mouse input device. When scrolling on a
list, this could cause the whole list to be focused, and drawn with the
focus color as background.

Send scroll events with a touchscreen input device instead (like motion
events).

Fixes #1362 <https://github.com/Genymobile/scrcpy/issues/1362>",False
1a9429f3c73e319f108211a66ad57b8c2c9a60aa,2020-05-07 01:56:43,Romain Vimont,"Improve bug report template

Insert a code block to (hopefully) increase the chances that users
format their terminal output.",False
0b4e484da014833f90d58b2b336bf9e5204b1f71,2020-05-07 01:51:33,Romain Vimont,"Add a note about multi-display limitation

Secondary display mirroring is read-only before Android 10.",False
ead7ee4a03c9533ea7bb992a9c2df6ec757fd1f0,2020-05-06 04:40:25,Romain Vimont,"Revert ""Improve resizing workaround""

This reverts commit 92cb3a666109b67598cd36b9c0088fb697abbd23, which
broke the fullscreen/maximized restoration size on Windows.

Fixes #1346 <https://github.com/Genymobile/scrcpy/issues/1346>",False
74ece9b45b6ee477d786c7a9b6e2f21f90f8b5a2,2020-05-05 22:31:44,Romain Vimont,"Simplify ScreenEncoder more

Commit 927d655ff66fa439ccd27e054ae6d54a651640cc removed the
iFrameInternal field and constructor argument.

Also remove it from createFormat() arguments.",False
c77024314ddc9fa7cde51828eaef455a1ee10344,2020-05-02 05:44:25,Romain Vimont,"Add an option to keep the device awake

Add an option to prevent the device to sleep:

    scrcpy --stay-awake
    scrcpy -w

The initial state is restored on exit.

Fixes #631 <https://github.com/Genymobile/scrcpy/issues/631>",False
828327365a51ef918c5b59db3b656feb57c8c9fa,2020-05-02 05:25:32,Romain Vimont,Reorder options in alphabetical order,False
4668638ee10764e8341c0770d548c0b74de69a8d,2020-05-02 05:25:30,Romain Vimont,"Handle ""show touches"" on the device-side

Now that the server can access the Android settings and clean up
properly, handle the ""show touches"" option from the server.

The initial state is now correctly restored, even on device
disconnection.",False
dbb0df607c988c2a94877ebe61590d021d09bc4e,2020-05-02 04:52:18,Romain Vimont,"Move constants to ServiceManager

PACKAGE_NAME and USER_ID could be use by several ""managers"", so move
them to the service manager.",False
2f74ec2518377103e144684a9fb0c2d358168bbb,2020-05-02 04:52:18,Romain Vimont,"Add a clean up process on the device

In order to clean up on close, use a separate process which is not
killed when the device is disconnected (even if the main process itself
is killed).",False
8c6799297b6c84a21509d5847106494b389d0b97,2020-05-02 04:52:10,Romain Vimont,"Implement access to settings without Context

Expose methods to access the Android settings using private APIs.

This allows to read and write settings values immediately without
starting a new process to call ""settings"".",False
62c0c1321feec0a673329cb6771efeefb6dc9657,2020-05-01 23:12:31,Romain Vimont,"Apply workarounds only on error

To avoid NullPointerException on some devices, workarounds have been
implemented. But these workaround produce (harmless) internal errors
causing exceptions to be printed in the console.

To avoid this problem, apply the workarounds only if it fails without
them.

Fixes #994 <https://github.com/Genymobile/scrcpy/issues/994>
Refs #365 <https://github.com/Genymobile/scrcpy/issues/365>
Refs #940 <https://github.com/Genymobile/scrcpy/issues/940>",False
d4eeb1c84d67ed590189aa9d083ebd65f75fec92,2020-05-01 23:04:08,antoninsmetana,"Fix AutoAdb url

PR #1344 <https://github.com/Genymobile/scrcpy/pull/1344>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4e9e712312c9726824d28bed4fc85721e3a2b203,2020-04-30 02:26:26,Romain Vimont,Update links to v1.13 in README and BUILD,False
9babe268050cd8a791364e5edb346c3c15a6e575,2020-04-30 01:54:08,Romain Vimont,Bump version to 1.13,False
76567e684a9ef1ec2b1577f84f15735335646f9f,2020-04-28 01:15:15,Romain Vimont,"Upgrade SDL (2.0.12) for Windows

Include the latest version of SDL in Windows releases.",False
b55ca127f8903f6b27f770b3ff82be4e8337ca93,2020-04-28 01:15:15,Romain Vimont,"Upgrade FFmpeg (4.2.2) for Windows

Include the latest version of FFmpeg in Windows releases.",False
a12b938234e28b3b9fb010e3cb78080cd3e5db0e,2020-04-28 01:14:59,Romain Vimont,Merge branch 'master' into dev,True
a14840a5159aa81fb005e41964a2d62ea0d2ae10,2020-04-25 02:31:58,Romain Vimont,Fix typo in comments,False
8581d6850bb4cf9229e99de188b339da50eee777,2020-04-25 02:22:02,Romain Vimont,"Stabilize auto-resize

The window dimensions are integers, so resizing to fit the content may
not be exact.

When computing the optimal size, it could cause to reduce alternatively
the width and height by few pixels, making the ""optimal size"" unstable.

To avoid this problem, check if the optimal size is already correct
either by keeping the width or the height.",False
92cb3a666109b67598cd36b9c0088fb697abbd23,2020-04-25 01:06:25,Romain Vimont,"Improve resizing workaround

Call the same method as when the event is received on the event loop, so
that the behavior is the same in both cases.",False
561ede444e7ed2aa4a18a16988d2c8adc9d36151,2020-04-23 20:06:48,Romain Vimont,"Mention Ubuntu 20.04 package

Ubuntu 20.04 has been released today, and scrcpy is available in their
repositories: <https://packages.ubuntu.com/focal/scrcpy>",False
3c9ae99ddad51a5d7acf5867973fc30cef9593c1,2020-04-18 05:45:22,Romain Vimont,"Move rotation coordinates to screen

Move the window-to-frame coordinates conversion from the input manager
to the screen.

This will allow to apply more screen-related transformations without
impacting the input manager.",False
44f720e4a4768a11fe2bd9cec8c952341bbbde62,2020-04-18 05:45:22,Romain Vimont,"Log new size on auto-resize request

On ""resize to fit"" and ""resize to pixel-perfect"", log the new size.",False
125c5561e8f4e169fe52884e47fae1f3b9ffb9f7,2020-04-18 05:44:42,Tzah Mazuz,"Use MediaFormat constant for MIME type

Replace ""video/avc"" by MIMETYPE_VIDEO_AVC.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
14ead499fd848504895fee7649b5c7430be148b5,2020-04-17 21:47:12,Romain Vimont,"Fix touch coordinates on rotated display

The touch coordinates were not rotated.",False
94a7f1a0f84cb4bc998e7eb117517209e3ca5584,2020-04-17 00:24:00,Romain Vimont,"Disable input events when necessary

Disable input events on secondary displays before Android 10, even if
FLAG_PRESENTATION is not set.

Refs #1288 <https://github.com/Genymobile/scrcpy/issues/1288>",False
cc22f4622ae9cfe81eb5dba41da266438de232d8,2020-04-15 21:09:51,Romain Vimont,Mention mipmapping in FAQ,False
11a61b2cb374087884ef1270d2f0b5844d797ffd,2020-04-15 21:09:51,Romain Vimont,"Add option --no-mipmaps

Add an option to disable trilinear filtering even if mipmapping is
available.",False
bea7658807d276aeab7d18d856a366c83ee05827,2020-04-15 21:09:51,Romain Vimont,"Enable trilinear filtering for OpenGL

Improve downscaling quality if mipmapping is available.

Suggested-by: Giumo Clanjor (哆啦比猫/兰威举) <cjxgm2@gmail.com>

Fixes #40 <https://github.com/Genymobile/scrcpy/issues/40>
Ref: <https://github.com/Genymobile/scrcpy/issues/40#issuecomment-591917787>",False
8a9b20b27e69dc0f77e305e2a0b829d89d264ca7,2020-04-15 21:09:51,Romain Vimont,"Add --render-driver command-line option

Add an option to set a render driver hint (SDL_HINT_RENDER_DRIVER).",False
d62eb2b11c4554f3c32a470231355ae0430a956a,2020-04-15 13:27:59,Romain Vimont,Fix typo in README,False
eb8f7a1f288b43e333db12e0f329e7706da5a164,2020-04-14 02:17:03,Romain Vimont,"Require Meson 0.48 to get rid of warnings

Debian buster (stable) provides Meson 0.49, which is also available in
stretch (oldstable) backports. It's time to abandon Meson 0.37.

Ref: 20b3f101a40cd7455cc5b41e381291504deec5ba",False
270d0bf639fbcc8e3a88ff29dc097eb6597a0a88,2020-04-13 23:08:43,Romain Vimont,"Rename max length constant for text injection

To avoid confusion with the max text size for clipboard, rename the
constant limiting the text injection length.",False
95fa1a69e4985e479486d7e730a59d538a6d70a3,2020-04-13 20:03:21,Romain Vimont,"Workaround compiler warning

Some compilers warns on uninitialized value in impossible case:

    warning: variable 'result' is used uninitialized whenever switch
    default is taken [-Wsometimes-uninitialized]",False
ea46d3ab689b92a9ee1c9ef53dc3247feee1adc4,2020-04-13 20:03:21,Romain Vimont,"Add missing include string.h

Include <string.h> for strdup() and strtok_r().",False
7eb16ce36458011d87972715f08bd9f03ff39807,2020-04-13 20:03:19,Romain Vimont,"Fix log format warning

The expression port + 1 is promoted to int, but printed as uint16_t.",False
927d655ff66fa439ccd27e054ae6d54a651640cc,2020-04-12 05:39:28,Romain Vimont,"Simplify ScreenEncoder

Do not handle iFrameInterval field and parameter, it is never used
dynamically.",False
ee2894779aa85a7a78a3e57aa154bfeb1025e55c,2020-04-12 05:38:16,Romain Vimont,"Remove unused lockedVideoOrientation field

During PR #1151, this field has been moved to ScreenInfo, but has not
been removed from ScreenEncoder.",False
1c6207f8ce88e89a9d80157881d8012fe14d4463,2020-04-12 04:01:57,Romain Vimont,Merge branch 'master' into dev,True
ab52b368958e60d30e68d6c65baa40484eaa9cce,2020-04-11 18:01:14,Romain Vimont,Reorder options in alphabetical order,False
9f4735ede3c541163a530c5c474b39ba4696773b,2020-04-08 20:07:33,Romain Vimont,"Fix double click on rotated display

A double-click outside the device content (in the black borders) resizes
so that black borders are removed. But the display rotation was not
taken into account to detect the content.

Use the content size instead of the frame size to fix the issue.

Ref: <https://github.com/Genymobile/scrcpy/issues/898#issuecomment-610993695>",False
6295c1a1102e22478db58c9119d9590a2cc4c989,2020-04-08 17:57:25,Romain Vimont,"Remap event positions on rotated display

If the display is rotated, the position of clicks must be adapted.",False
f3fba3c4b968f4242fc0f5d092daa63ffa9b8f5e,2020-04-08 17:42:54,Romain Vimont,"Store rotated content size

This avoids to compute it every time from the frame size.",False
c1ebea26e6489be65603c1eae1dae6a455351ecf,2020-04-08 15:39:24,Kostiantyn Luzan,"Register rotation watcher on selected display

PR #1275 <https://github.com/Genymobile/scrcpy/pull/1275>

Signed-off-by: Kostiantyn Luzan <vblack2006@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f07d21f050f1151d69f64edd9494cced5b3a1649,2020-04-08 15:39:24,Romain Vimont,Suppress DiscouragedPrivateApi lint warning,False
a8fd4aec9aea94f86203e3123aa22939d38bb927,2020-04-08 15:39:24,Romain Vimont,"Remove --fullscreen validation

Many options are meaningless if --no-display is set.

We don't want to validate all possible combinations, so don't make an
exception for --fullscreen.",False
cbde7b964a7573accf96bb76d2355468d1002fab,2020-04-08 15:39:24,Romain Vimont,"Improve documentation for consistency

Make --lock-video-orientation documentation consistent with that of
--rotation.",False
28c71c528f08f961bb0ceacff6d22684635dc3d7,2020-04-08 15:39:22,Romain Vimont,"Add --rotation command-line option

In addition to Ctrl+Left and Ctrl+Right shortcuts, add a command-line
parameter to set the initial rotation.",False
d48b375a1dbc8bed92e3424b5967e59c2d8f6ca1,2020-04-08 15:32:26,Romain Vimont,"Add shortcuts to rotate display

Add Ctrl+Left and Ctrl+Right shortcuts to rotate the display (the
content of the scrcpy window).

Contrary to --lock-video-orientation, the rotation has no impact on
recording, and can be changed dynamically (and immediately).

Fixes #218 <https://github.com/Genymobile/scrcpy/issues/218>",False
fd63e7eb5a60af8e5e52ecfddb9d0f3b7f3740af,2020-04-08 15:32:15,Romain Vimont,"Format shortcut documentation

For consistency, start the descriptions with a capital letter.",False
cdd8edbbb68d6cecdced5036d8e3a3c8583ac512,2020-04-08 02:36:33,Romain Vimont,"Add a note about prebuilt server in BUILD.md

Mention that it works with a matching client version.",False
9b9e717c41beeba765cdcef7f833f22989c2f614,2020-04-07 14:13:20,Romain Vimont,"Explain master and dev branches in BUILD

People may not guess that `master` is not the development branch.",False
15e4da08a362d19eb98ff065c29091d25f043805,2020-04-07 14:07:19,Romain Vimont,"Improve ""low quality"" section in FAQ",False
2afbfc2c751ab2c9c5fdbd68289df54cb61e75da,2020-04-04 00:59:09,Romain Vimont,Add Android device and version in issue template,False
2cf022491f39d5d1d8d09330e9c5a5fba73567f4,2020-04-03 22:21:18,Romain Vimont,"Add issue templates

Closes #1157 <https://github.com/Genymobile/scrcpy/issues/1157>",False
d30593e1d53c55cddaf0c597e8827b96c7cd8419,2020-04-03 21:50:33,Harsh Shandilya,"gitignore: Add x/ directory

People following default build instructions can be caught off guard by
seeing the build artifacts in the git tree.

Signed-off-by: Harsh Shandilya <me@msfjarvis.dev>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9e78b765da01843b4986f93179b0c92701269062,2020-04-03 21:41:35,Harsh Shandilya,"Update to Gradle 6.3

Signed-off-by: Harsh Shandilya <me@msfjarvis.dev>
Signed-off-by: Romain Vimont <rom@rom1v.com>

-- Note from committer:

The binary gradle/wrapper/gradle-wrapper.jar has the expected SHA-256
checksum:

    $ curl -L https://services.gradle.org/distributions/gradle-6.3-wrapper.jar.sha256
    1cef53de8dc192036e7b0cc47584449b0cf570a00d560bfaa6c9eabe06e1fc06

All the changed files match an upgrade executed independently:
<https://docs.gradle.org/current/userguide/gradle_wrapper.html#sec:upgrading_wrapper>",False
271de0954a15ec23dca945009eb3f576af6abed8,2020-04-03 21:40:51,Harsh Shandilya,"Update to AGP 3.6.2

Signed-off-by: Harsh Shandilya <me@msfjarvis.dev>",False
54ccccd8839f16cc289f98160882b909ea7aa3c0,2020-04-03 00:35:26,Romain Vimont,"Replace SDL_Atomic by stdatomic from C11

There is no reason to use SDL atomics.",False
bea1c11f8ed74854f15b26428f69c7ed78f0de4e,2020-04-03 00:35:26,Romain Vimont,"Do not log success on failure

If calling the private API does not work, an exception is printed. In
that case, do not log that the action succeeded.",False
94e16968693bcb326fcbbd85818589c7f4b8d02f,2020-04-03 00:35:26,Romain Vimont,"Do not warn on terminating the server

If the server is already dead, terminating it fails. This is expected.",False
a346bb80f4ae85abafa2fc5d261d77c433928bea,2020-04-03 00:35:26,Romain Vimont,"Do not block on accept() if server died

The server may die before connecting to the client. In that case, the
client was blocked indefinitely (until Ctrl+C) on accept().

To avoid the problem, close the server socket once the server process is
dead.",False
d421741a83a1d7114a85d286f4bb92c52b20f31b,2020-04-03 00:35:26,Romain Vimont,"Wait server from a separate thread

Create a thread just to wait for the server process exit.

This paves the way to simply wake up a blocking accept() in a portable
way.",False
64d5edce92dc27cfef11594a27876cd378225e53,2020-04-03 00:35:26,Romain Vimont,"Refactor server_start() error handling

This avoids cleanup duplication.",False
4150eedcdf1652fd131480383850882f95a0ea7d,2020-04-03 00:32:52,e_vigurskiy,"Add display id parameter

Add --display command line parameter to specify a display id.

PR #1238 <https://github.com/Genymobile/scrcpy/pull/1238>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5031b2c8ff4285a43ca445f53adaaa7fe635d06f,2020-03-29 02:38:16,Romain Vimont,"Remove MagicNumber checkstyle

There are a lot of ""magic numbers"" that we really don't want to extract
as a constant.

Until now, many @SuppressWarnings annotations were added, but it makes
no sense to check for magic number if we silent the warnings everywhere.",False
4adf5fde6dfb91d7af21103a2620f28707bc8334,2020-03-28 20:22:02,Romain Vimont,Log device details on server start,False
e050cfdcd6ab5c0133d8b98baaa38c45a5b604aa,2020-03-27 18:31:56,Romain Vimont,"Fix static_assert() parameters

In C11, static_assert() expects a message.",False
dc7c677728cdeb7471745a2aff9f63ebe8d14f53,2020-03-27 03:22:41,Romain Vimont,"Accept negative window position

It seems to work on some window managers.

Fixes #1242 <https://github.com/Genymobile/scrcpy/issues/1242>",False
3504c0016b835dab4e74e1a05bfadedcd325c873,2020-03-27 03:18:01,Romain Vimont,"Add tests for control message length

This will avoid regressions for #1245.

<https://github.com/Genymobile/scrcpy/issues/1245>",False
89d1602185066ff540b6525bf99eb894004aad04,2020-03-27 03:15:43,Romain Vimont,"Fix expected message length for touch events

The expected length for a touch event control message was incorrect. As
a consequence, a BufferUnderflowException could occur.

Fixes #1245 <https://github.com/Genymobile/scrcpy/issues/1245>",False
566ba766af6f84e04d0c64533c88bbbc5c4ec35a,2020-03-27 03:13:53,Romain Vimont,"Remove unused constant

It has not been removed when mouse and touch events have been merged.",False
a0af402d96849f1573b1361523ac96772952e480,2020-03-19 23:58:57,Tzah Mazuz,"Fix the printed versions (were opposite)

PR #1224 <https://github.com/Genymobile/scrcpy/pull/1224>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7bb91638ad80ba20700529cf336ea533d8f058e7,2020-03-19 23:52:58,Romain Vimont,Improve FAQ,False
600df37753856122f004b79edff980a375ec6447,2020-03-19 23:46:08,Romain Vimont,Mention AutoAdb in README,False
902b99174df8ffc1fe7548399c19e446aa5488b6,2020-03-19 23:45:43,Romain Vimont,"Fix server debugger for Android >= 9

Add a compilation flag to select the debugger method to use:
 - old: Android < 9
 - new: Android >= 9

See <https://github.com/Genymobile/scrcpy/issues/1187#issuecomment-599075661>",False
cd69eb4a4fecf8167208399def4ef536b59c9d22,2020-03-14 22:07:14,Jaafar Biyadi,"Handle NumPad events when NumLock is disabled

PR #1188 <https://github.com/Genymobile/scrcpy/pull/1188>
Fixes #1048 <https://github.com/Genymobile/scrcpy/issues/1048>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
bc7508427b3a6a19a5603caa63d05a860dbacd8a,2020-03-14 21:41:49,Yogev Boaron Ben-Har,"Add scoop instructions for Windows

PR #1202 <https://github.com/Genymobile/scrcpy/pull/1202>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
24ade6ad7740a5428a531c5b22a8b72ed0987bd5,2020-03-14 21:37:20,Romain Vimont,Simplify Chocolatey documentation,False
ae2d094362fbdc4d402b0315d981015ffe5c4967,2020-03-08 15:08:31,Romain Vimont,"Handle locked video orientation from ScreenInfo

Centralize video size management in ScreenInfo.

This allows to always send the correct initial video size to the client
if the video orientation is locked.",False
c5f5d1e45669d676f74eaebb532f55aae99c65f4,2020-03-05 02:45:10,Romain Vimont,"Rename ""rotation"" to ""device rotation""

This paves the way to reduce confusion in ScreenInfo when it will handle
locked video orientation.",False
63286424bb5a21cbdc2e94a4bf493abe07ea1e98,2020-03-05 02:45:10,Romain Vimont,"Compute all screen info from ScreenInfo

Screen information was partially initialized from Device. Move this
initialization to ScreenInfo.",False
da18c9cdab1c40c605bb63105e92b40284704867,2020-03-05 02:45:10,Romain Vimont,Remove useles import,False
c396758b4ed29cb4d4ad51e8bcdd1deecf5761d2,2020-03-04 02:09:27,Romain Vimont,"Remove link to Windows 32 bits release

Binaries created with MinGW (even a simple Hello World) are detected as
malware by some anti-virus. For some reason, only the 32 bits version of
scrcpy is impacted.

Since users should use the 64 bits version by default anyway, remove the
link to the 32 bits version from the main page.

The 32 bits release is still available in the ""releases"" tab.

See <https://github.com/Genymobile/scrcpy/issues/1102>",False
d3281f4b67c36164955593ec6b7fcf16e2f95436,2020-02-28 01:58:42,yangfl,"Show a friendly hint for adb installation

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1982bc439b67829ec815b5e1bd13f1bf4e660f4b,2020-02-28 01:54:37,George Stamoulis,"Add option to lock video orientation

PR #1151 <https://github.com/Genymobile/scrcpy/pull/1151>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
ef56cc6ff74862e85c0af4746fa26ef391f6f3a9,2020-02-28 01:54:37,Romain Vimont,"Retrieve screen info once

The method getScreenInfo() is synchronized, and the result may change
between calls.

Call it once and store the result in a local variable.",False
c0f428eb059e9b4697814e6cab27dab302ecfb99,2020-02-28 01:54:32,Romain Vimont,Merge branch 'master' into dev,True
4794ca8ae7515c7376b8e19aa8ec9c07546c965c,2020-02-25 16:50:18,Romain Vimont,"Use linear filtering

Anisotropic filtering makes no sense for scrcpy use case.

This (semantically) reverts 9e328ef98b0fc730036aa389f33649a31737d0e3.",False
f903cd376d1f32fa6d03cffe8ba9c598e2df5fee,2020-02-16 20:34:17,George Stamoulis,"Documentation rectifications

PR #1151 <https://github.com/Genymobile/scrcpy/pull/1151>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e8127375aeba200b5c1a24a0c37c61516aae3ba1,2020-02-16 02:56:30,Camilo Martinez,"Add Chocolatey for Windows install

PR #1144 <https://github.com/Genymobile/scrcpy/pull/1144>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
1144f642144103a3b0bbd017998d75edd9d2a8b8,2020-02-06 23:12:08,Romain Vimont,Indicate that -s can also be used for TCP/IP,False
39356602ed472cc3f533e36ae04a110b247c29e0,2020-01-19 20:49:51,Romain Vimont,Mention scrcpy Debian package in README,False
0fb22c3e98caed6d7b07f8e53caa9da2ed6334d7,2020-01-19 20:34:20,Romain Vimont,Happy new year 2020!,False
96bd2c974d0fb9765dc4d2978688bb0bbd65cc9f,2020-01-19 20:22:24,Romain Vimont,"Do not report workarounds errors

Some workarounds are needed on some devices. But applying them may cause
exceptions on other devices, where they are not necessary anyway.

Do not report these errors in release builds.

Closes #994 <https://github.com/Genymobile/scrcpy/issues/994>",False
dc7fcf3c7a7a0e26c2447990206b798742e062c7,2020-01-18 21:51:00,Romain Vimont,"Accept port range

Accept a range of ports to listen to, so that it does not fail if
another instance of scrcpy is currently starting.

The range can be passed via the command line:

    scrcpy -p 27183:27186
    scrcpy -p 27183  # implicitly 27183:27183, as before

The default is 27183:27199.

Closes #951 <https://github.com/Genymobile/scrcpy/issues/951>",False
2a3a9d4ea91f9b79b87387a4883af484e702c53a,2020-01-18 21:51:00,Romain Vimont,"Add util function to parse a list of integers

This will help parsing arguments like '1234:5678' into a list of
integers.",False
ca0031cbde8cc4aaed07ddb7523841754c0423d5,2020-01-18 21:51:00,Romain Vimont,"Refactor server tunnel initialization

Start the server socket in enable_tunnel() directly.

For the caller point of view, enabling the tunnel opens a port (either
the server socket locally or the ""adb forward"" process).",False
d1a9a76cc6d738c455942d37138a3c365a423e88,2020-01-18 21:51:00,Romain Vimont,"Reorder functions

Move functions so that they can be called from enable_tunnel() (in the
following commit).",False
a8ceaf52846cddf61ea7da939db4d35dff969eb4,2020-01-18 01:30:14,Romain Vimont,Fix include order,False
83d48267a734e999fac0eccd93173b93019bf006,2019-12-19 16:22:09,Romain Vimont,"Accept --max-fps before Android 10

KEY_MAX_FPS_TO_ENCODER existed privately before Android 10:
<https://github.com/Genymobile/scrcpy/issues/488#issuecomment-567321437>",False
db6252e52b95af16976f6afa38028aca8c221036,2019-12-16 02:34:09,Romain Vimont,"Simplify net.c

The platform-specific code for net.c was implemented in sys/*/net.c.

But the differences are quite limited, so use ifdef-blocks in the single
net.c instead.",False
229eeb24a2e640e6b56aab29a23acadd2e1baef5,2019-12-15 17:54:17,Romain Vimont,"Merge pull request #1002 into dev

Fix utf-8 char path in windows

<https://github.com/Genymobile/scrcpy/pull/1002>",True
f9786e50346246139b67ab70d040443e3a80c16b,2019-12-14 23:17:54,Yu-Chen Lin,"Get env in windows correctly

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
78a320a763d747b04dcb0c6fed41a1edcc90101c,2019-12-14 23:17:30,Yu-Chen Lin,"Fix utf-8 char path in windows

The file 'E:\安安\scrcpy-win64-v1.12.1-1-g31bd950\scrcpy-server'
exists, however, it will show msg as follow:

    INFO: scrcpy 1.12.1 <https://github.com/Genymobile/scrcpy>
    stat: No such file or directory
    ERROR: 'E:\安安\scrcpy-win64-v1.12.1-1-g31bd950\scrcpy-server' does
    not exist or is not a regular file
    Press any key to continue...

This patch fixes it.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
7d5845196e6a7e919d0ec3b5fc53fc7dab8d3222,2019-12-14 22:53:25,Romain Vimont,"Fix memory leak on portable builds

The function get_server_path() sometimes returned an owned string,
sometimes a non-owned string.

Always return an allocated (owned) string, and free it after usage.",False
31bd95022bc525be42ca273d59a3211d964d278b,2019-12-10 22:29:44,Romain Vimont,Update links to v1.12.1 in README and BUILD,False
4687a0ebac74f2d34e5ef330e1f9d587e7136222,2019-12-10 14:37:48,Romain Vimont,Bump version to 1.12.1,False
6965d051ae4c34116367ae5f2319c843d788661c,2019-12-10 13:58:27,Romain Vimont,"Limit bitrate range to 31 bits integer

A proper solution could be to use ""long long"" instead (guaranteed to be
at least 64 bits), but it adds its own problems (e.g. ""%lld"" is not
supported as a printf format on all platforms).

In practice, we don't need such high values, so keep it simple.

Fixes #995 <https://github.com/Genymobile/scrcpy/issues/995>",False
71df3175bd1f21987b41f79938c9f2b04cc444e7,2019-12-10 04:22:26,Romain Vimont,Update links to v1.12 in README and BUILD,False
a0f8e7fd9f2d866808e24c3f4a10e6758c6bc403,2019-12-10 03:54:43,Romain Vimont,Bump version to 1.12,False
e4cebc8d4cfdcb474727c0109d4a00ef1d0cc7fe,2019-12-10 03:54:39,Romain Vimont,"Do not build tests in release mode

Assertions would not be executed.

And as a side effect, it causes ""unused variable"" warnings.",False
ba1b36758e8a6cbebe8215d9bb0936d4598d6045,2019-12-10 03:54:39,Romain Vimont,"Define SDL_MAIN_HANDLED in all tests

Each test defines its own main() function. If this flag is not set, then
SDL redefines it to SDL_main(), causing compilation failures.",False
ad92a192b5d1baef501acdef6290cb8a92cde5c3,2019-12-10 03:30:55,Romain Vimont,Fix meson.build codestyle,False
81a8e503e501a6492441bbfa679efdff260aec67,2019-12-10 03:21:27,Romain Vimont,Describe screen rotation shortcut in README,False
242e57d69bbd35232734ee8611ccbc0e341f0330,2019-12-10 03:07:20,Romain Vimont,Merge branch 'master' into dev,True
024c2f7e6b11c6e0d9e6a80a6ba355d2f340bbf4,2019-12-10 03:01:14,Romain Vimont,"Configure log priority early

The log priority must be configured before parsing command-line
arguments, in order to get logs as expected.",False
1eae139b6ee8ee04e7b531132d482ced368af1aa,2019-12-10 03:00:48,Romain Vimont,"Add missing consts

String parsing functions should not be able to modify their input.",False
419c869c9c276022bd6ec9ac9dd8523a20c6db8a,2019-12-10 01:29:11,Romain Vimont,Use ARRAY_LEN() macro in tests,False
929bf48c7e1c6e4f7bbcca9b02e10785e49a72c4,2019-12-09 03:49:01,Romain Vimont,Add tests for command-line parsing,False
d950383b729f93d4da84e65013b4c78caddf6d68,2019-12-09 03:48:57,Romain Vimont,Move command-line parsing to a separate file,False
61274a7cdbab8b921171c4d2fa5b8c3c75bde311,2019-12-09 01:49:53,Romain Vimont,"Factorize integer argument parsing

Add util functions for integer parsing (with tests), and factorize
integer argument parsing to avoid code duplication.",False
64bcac91575ba01dda2c9a2178d65f17daa3a3ab,2019-12-06 01:37:11,Romain Vimont,"Refuse to push a non-regular file server

If SCRCPY_SERVER_PATH points to a directory, then a directory will be
pushed to /data/local/tmp/scrcpy-server.jar.

When executing it, app_process will just abort and leave the directory
on the device, causing scrcpy to always fail.

To avoid the problem, check that the server is a regular file before
pushing it.

Closes #956 <https://github.com/Genymobile/scrcpy/issues/956>",False
3259c60b22598379e86fb4e20352f95f3282d0af,2019-12-06 01:36:49,Romain Vimont,"Fix test compilation on mingw

Including SDL2/SDL.h redefines main to SDL_main by default.",False
e0b117de137685b9073e72f8c373f5157df6265f,2019-12-06 01:35:45,Romain Vimont,Fix checkstyle warning,False
eb0f339271862af38693913e5ce1d4078d2c9e56,2019-12-05 02:33:25,Romain Vimont,"Add shortcut to rotate screen

On Ctrl+r, disable auto-rotation (if enabled), set the screen rotation
and re-enable auto-rotation (if it was enabled).

Closes #11 <https://github.com/Genymobile/scrcpy/issues/11>",False
bdd05b4a16a2b0fc15d2ecf8f832afb9670854ee,2019-12-05 00:04:20,Romain Vimont,"Refactor wrappers for Android SDK classes

Internally, a failure to invoke a method via reflection was partially
managed using exceptions, partially using a null return value.

Handle all errors at the same place, by not catching
NoSuchMethodException too early.",False
525d6d4a758a9df0baac2c9a0d4dcf6514e6c8e3,2019-12-05 00:02:38,Romain Vimont,"Try new methods before legacy ones

Use the legacy methods when the new ones do not exist.",False
4041043d1cd3ef34993c8d59970ee40b05c702c9,2019-12-04 23:55:58,Romain Vimont,"Merge pull request #967 into dev

Add some tests

<https://github.com/Genymobile/scrcpy/pull/967>",True
fbc86a616c38ea91beee586c417ea405ea6be56a,2019-12-04 23:54:59,Yu-Chen Lin,"Correct coding style

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
b2bf25c52ca08d8de812186ab7651128e9989cb3,2019-12-04 23:54:59,Yu-Chen Lin,"Add test_buffer_util

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
5eeaed09aed64b088cbc7cf946923aeea92e4f67,2019-12-04 23:54:59,Yu-Chen Lin,"Add test_strquote

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
3100533e56b2efdfc6f07b96681a7eef25ff63e0,2019-12-04 01:40:43,Romain Vimont,"Fix ""natural scrolling""

> Movements down (scroll backward) generate negative y values and up
> (scroll forward) generate positive y values.

> If direction is SDL_MOUSEWHEEL_FLIPPED the values in x and y will be
> opposite. Multiply by -1 to change them back.

<https://wiki.libsdl.org/SDL_MouseWheelEvent#Remarks>

The x and y values already take the scrolling configuration into
account. Reversing the values when the direction is flipped cancels the
scrolling configuration.

Therefore, just ignore the direction field.

Fixes <https://github.com/Genymobile/scrcpy/issues/966>",False
684e0abb74cf2f5291d2c52bbf758e85f917a4d6,2019-12-03 20:35:23,Seb Leo,"Update BUILD.md to install adb package

PR <https://github.com/Genymobile/scrcpy/pull/965>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
86fcd89d8046318e6a40a5c7938999db6fe7acd0,2019-12-03 16:37:36,Romain Vimont,"Fix max size default value

Suggested-by: jurkov

Closes <https://github.com/Genymobile/scrcpy/issues/978>",False
8a694a97855333849976bea5e558eaa45add0168,2019-11-30 15:16:22,Romain Vimont,"Suggest workaround for error 0xfffffc0e

When the hardware encoder is not able to encode at the given definition,
it fails with an error 0xfffffc0e.

It is documented in the FAQ:
<https://github.com/Genymobile/scrcpy/blob/master/FAQ.md#i-get-an-error-could-not-open-video-stream>

But it is better to directly suggest the workaround in the console.",False
26529d377fe8aae2fd1ffa91405aa801a0ce8a57,2019-11-29 19:01:19,Romain Vimont,"Use virtual device id to avoid NPE

Inject mouse events using id -1 (virtual device) instead of 0 which
does not exist (and causes the InputDevice to be null).

Fixes <https://github.com/Genymobile/scrcpy/issues/962>",False
15a206b7fcc9ecab2a1d0ffa782bb3d4c845a25a,2019-11-28 02:10:58,Romain Vimont,"Assert return value of mutex functions

Mutex functions may only fail due to a programming error.

Use assertions in debug builds, and ignore the value in release builds.",False
d0f5a7fd9f49e3780c40f34eeeaa1a6574558a47,2019-11-28 02:10:54,Romain Vimont,"Remove unused includes

No mutex is used in decoder.c and stream.c.",False
510caff0cd1f6b369e9b00e97d806099d08146ea,2019-11-28 01:49:46,Romain Vimont,"Replace SDL_assert() by assert()

SDL_assert() open a dialog on assertion failure.

There is no reason not to use assert() directly.",False
b5ebb234ddbb3683441ec1a6f2492ea0190d2615,2019-11-28 01:41:52,Romain Vimont,"Replace BUILD_DEBUG by NDEBUG

Use the ""standard"" NDEBUG definition, which is used by assert().",False
73e8ec1b356eacfc4a77e84fcd4c143727e8eeb0,2019-11-28 01:41:52,Romain Vimont,"Remove path argument from cmd_execute()

It is always equal to argv[0] (or not used on Windows).",False
8dc11a0286fba384ae88254e6bcec785b2b73473,2019-11-28 01:41:52,Romain Vimont,"Fix warnings on Windows

fix warnings reported with -Dwarning_level=2 on Windows.",False
06104a701b6e2d149d536938a967f9707e22ed9f,2019-11-27 17:55:56,Romain Vimont,"Fix windows build

Utilities have been moved to util/, but includes had not been updated
in Windows-specific files.

Ref: dfd0707a2925e9569aaa2ae6b88b161a12376a49",False
8bc056b9c68eea7bccfa5d9123a70443fb1d75b2,2019-11-27 15:28:17,yangfl,Fix manpage format,False
7637a113e3cb9ce1fb9e19ac1f790d551d2af1f9,2019-11-26 13:52:20,Romain Vimont,Compile with warning_level=2 by default,False
31d9d5611730e4753bd72e0cb7807777d979780c,2019-11-26 13:40:41,Romain Vimont,"Fix warnings

Fix warnings reported with -Dwarning_level=2.",False
6abb8fd0cd8a4df05128034f662d678be425fee8,2019-11-25 22:03:42,Romain Vimont,"Reformat Java code

Reformated by Android studio to match the 150 characters column defined
in checkstyle.",False
2b845680b0d8d6778600d3c46a570d73dc83e2b5,2019-11-24 16:28:40,Romain Vimont,"Initialize Application object to avoid NPE

When an ApplicationInfo is set (commit
90293240cc622bb58cb1de741f86cbc0889c03e8), some devices (Nvidia Shield
TV) attempt to access the Application object, causing a
NullPointerException.

As a workaround, initialize an Application object.

Fixes <https://github.com/Genymobile/scrcpy/issues/940>",False
ebdc2ee8b5afe900a0f228e0d78577db0cc156af,2019-11-24 16:25:42,Romain Vimont,"Rename variable for consistency

Use suffix ""Field"" for fields variables.",False
dfd0707a2925e9569aaa2ae6b88b161a12376a49,2019-11-24 16:23:23,Romain Vimont,Move utilities to util/,False
8ec077ce1b5ae3c8a5993e062668220e7c684c30,2019-11-24 15:39:30,seoyeonK,"Add Korean translation for README and FAQ

PR <https://github.com/Genymobile/scrcpy/pull/934>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
83ace842809034f8076296a338c017e49519f068,2019-11-22 19:53:57,Romain Vimont,"Restore the .jar extension on the device side

Commit 3da95b52bd21ae0f4d81ee933caea63b78191deb renamed
'scrcpy-server.jar' to 'scrcpy-server' to avoid issues on the client
side.

However, removing the extension may cause issues with app_process, so
restore the extension only on the device side.

Fixes <https://github.com/Genymobile/scrcpy/issues/944>",False
c9d886f38bb6e3eaa1194a8bcfeda3bc90be4f85,2019-11-22 19:46:00,Romain Vimont,Use the existing constants for device server path,False
7d7f3daff2244e7f22ab80dd2985917d795e9c1f,2019-11-20 21:46:46,yangfl,"Fix aidl option in build_without_gradle.sh

Debian's aidl complains about the missing path for -o option.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
40c3c5761397a4e6f89c69729bf524455e07e7f4,2019-11-20 04:09:30,Romain Vimont,Update links to v1.11 in README and BUILD,False
2aa65015bcf09fe3d541f00310ccc69680f89d74,2019-11-20 03:35:39,Romain Vimont,Bump version to 1.11,False
4906aff4542bb83d2605d580a817ea76df32bd33,2019-11-20 03:35:39,Romain Vimont,"Upgrade platform-tools (29.0.5) for Windows

Include the latest version of adb in Windows releases.",False
cb6b300483db9af6c717b5f9e96551ea9da3853f,2019-11-20 03:35:39,Romain Vimont,"Upgrade FFmpeg (4.2.1) for Windows

Include the latest version of FFmpeg in Windows releases.",False
c2116082ab293772bb2d154707542b4bf0ccedf0,2019-11-20 03:35:39,Romain Vimont,"Remove deprecated options from help and manpage

Ref: ff061b4f30c54dedc5073a588c6c697477b805db",False
3599fcaae545c4945d6cc480e5728a8ab815f106,2019-11-20 03:28:18,Romain Vimont,"Fix help for --window-width and --window-height

The default value is 0 (automatic), not -1.",False
c610a6b3c7983c89c92e04bb9e7805db14221e74,2019-11-20 02:53:08,Romain Vimont,Document scrcpy via SSH tunnel in README,False
704c0ff4dd6f260ad25fd1c1d7e61c4b6089ac49,2019-11-20 02:53:08,Romain Vimont,Document copy-paste and --prefer-text in README,False
b145b8d5f4455ed4ebef852a4f63654dbe57b483,2019-11-20 02:53:08,Romain Vimont,Reorganize features in README,False
90293240cc622bb58cb1de741f86cbc0889c03e8,2019-11-20 02:53:08,act262,"Fix meizu 16th NPE

Fill AppInfo to avoid NullPointerException on some devices.

Fixes <https://github.com/Genymobile/scrcpy/issues/365>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
213c468c2032d1c1490c6a7951c999c36f452b8f,2019-11-20 02:53:08,Romain Vimont,"Move workarounds to a separate class

Extract workarounds (currently only one) to a separate class to avoid
polluting the main code.",False
18f2e33a8bf967a813142dbe9556813032ec9f0b,2019-11-19 16:52:11,Romain Vimont,"Fix noconsole.exe

The linker flag ""-mwindows"" has no effect on my current MinGW.

Instead, passing ""-Wl,--subsystem,windows"" works.

Fixes <https://github.com/Genymobile/scrcpy/issues/691>",False
7aed5d5b60c7ae82f5ca2353c294076a2e0ffc2c,2019-11-18 22:15:52,senta2006,"Fix typos

PR <https://github.com/Genymobile/scrcpy/pull/927>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
601b0fecdd4fff284cb8ac38e545fcec9b3cf0fd,2019-11-18 19:03:14,Romain Vimont,Extract DEBUG flag in build_without_gradle.sh,False
7fd800d58324a3f7520e9b225a9860ac5c712708,2019-11-18 19:02:07,Romain Vimont,"Generate VERSION_NAME in build_without_gradle.sh

Since commit b963a3b9d56f744cceba2e19cba3f9fef858c058, the server uses
BuildConfig.VERSION_NAME.

Generate this field manually for building without gradle.",False
1d97d7213d004ba4ac781baa13e9a0884b305cc3,2019-11-18 02:40:39,Romain Vimont,"Add option --max-fps

Add an option to limit the capture frame rate. It only works for devices
with Android >= 10.

Fixes <https://github.com/Genymobile/scrcpy/issues/488>",False
fb976816f98d0c9792cf63c414b5fbfaf9e2c4a5,2019-11-18 02:40:33,Romain Vimont,"Do not expose frame rate in ScreenEncoder

The KEY_FRAME_RATE parameter value is necessary for the configuration of
the encoder, but its actual value does not impact the frame rate (only
resources used by the encoder).

Therefore, it's an internal detail and should not be exposed by the
ScreenEncoder class.",False
1b78a77962bd19cd89c488a55972ec9a50eb1031,2019-11-18 02:38:34,Romain Vimont,Fix error message,False
59073223aad2aae42d5033b0a01e7838a8f6cd46,2019-11-15 23:29:47,Romain Vimont,Update manpage for --window-borderless option,False
59bc5bc1f55a2671062fb5b6000067f55fdb751f,2019-11-15 23:29:40,Diego Fernando Díaz A,"Add option to disable window decoration

Add --window-borderless parameter.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9fd7a80a897103c6675e651b7f1e78b1575ab148,2019-11-15 23:22:58,Romain Vimont,"Add option to specify the initial window size

Add --window-width and --window-height parameters.

If only one is provided, the other is computed so that the aspect ratio
is preserved.",False
b6e2f8ae00737098af5139b56cd3ca15bd5c9335,2019-11-15 23:20:49,Romain Vimont,"Update manpage for --window-{x,y} options",False
ce5635f28cec04f20dc3ef1c205e1740ac115c74,2019-11-15 23:20:49,Diego Fernando Díaz A,"Add option to specify the initial window position

Add --window-x and --window-y parameters.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
771bd8404d289d433586fdf25c02ebb4e812623e,2019-11-13 20:44:46,Romain Vimont,"Do not write invalid packet duration

Configuration packets have no PTS. Do not compute a packet duration from
their PTS.

Fixes recording to mp4 on device rotation.",False
af3027a85b99c6bc3597017836077b99518707c7,2019-11-13 16:31:02,Romain Vimont,"Merge pull request #920 into dev

Compare server and client version at the start of scrcpy",True
b963a3b9d56f744cceba2e19cba3f9fef858c058,2019-11-13 16:30:50,Yu-Chen Lin,"Check client and server mismatch

Send client version as first parameter and check it at server start.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
aa0f77c8983ef8049c2eba17bace430cf39ba171,2019-11-12 02:19:23,Romain Vimont,"Accept resize shortcuts on maximized window

Allow ""resize to fit"" and ""resize to pixel-perfect"" on maximized window:
restore the window to normal size then resize.",False
35c05bb3cec7e5270229574d0f9d17d4989c107e,2019-11-12 02:19:23,Romain Vimont,"Fix rotation while the window is maximized

Keep the windowed window size to handle maximized window the same way as
fullscreen window.

Fixes <https://github.com/Genymobile/scrcpy/issues/750>",False
f6f2868868497b2804e3308b774f52bcc5418a5c,2019-11-11 19:32:26,Romain Vimont,"Handle window events from screen.c

Only the screen knows what to do on window events.

This paves the way to handle more window events.",False
6996cbf5d38b2f5bfdc061b421ea204e3aafce67,2019-11-10 01:47:03,Romain Vimont,"Log device disconnection

If scrcpy closes due to socket disconnection, log a warning.",False
e282100d0b796b579b2a9b9656cf962cca88aca0,2019-11-10 01:01:57,olbb,"Call Looper.prepareMainLooper() to avoid exception

Some devices internally create a Handler when creating an input Surface,
causing an exception:

> Surface: java.lang.RuntimeException: Can't create handler inside
> thread that has not called Looper.prepare()

As a workaround, call Looper.prepareMainLooper() beforehand.

Fixes:
 - <https://github.com/Genymobile/scrcpy/issues/240>
 - <https://github.com/Genymobile/scrcpy/issues/921>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
b08a98324d35298903098ec8ea9023ecf9515a2f,2019-11-08 02:28:57,Romain Vimont,"Fix segfault on empty file recorded

Write the file trailer only if the file header have been written, to
avoid a segfault in libav.

Fixes <https://github.com/Genymobile/scrcpy/issues/918>.",False
c916af0984f72a60301d13fa8ef9a85112f54202,2019-11-07 23:31:35,Romain Vimont,"Add --prefer-text option

Expose an option to configure how key/text events are forwarded to the
Android device.

Enabling the option avoids issues when combining multiple keys to enter
special characters, but breaks the expected behavior of alpha keys in
games (typically WASD).

Fixes <https://github.com/Genymobile/scrcpy/issues/650>",False
ff061b4f30c54dedc5073a588c6c697477b805db,2019-11-07 14:31:59,Romain Vimont,"Deprecate short options for advanced features

The short options will be removed in the future (and may be reused for
other features).",False
157c60feb4de2010de2b4d357076f1645b816cba,2019-11-07 14:18:48,Romain Vimont,Fix indentation,False
2d90e1befdd8e751a1d710ab4824cc8fa28cce90,2019-11-07 02:52:46,Romain Vimont,Fix include recorder.h,False
0e301ddf19c45de50ed728419adff9e6792332bf,2019-11-07 02:36:54,Romain Vimont,"Factorize scrcpy options and command-line args

Do not duplicate all scrcpy options fields in the structure storing the
parsed command-line arguments.",False
c42ff75b74a617d20a24e86d15da26a13a9bb828,2019-11-07 01:54:36,Romain Vimont,"Pass screen to mouse event converters

Mouse events coordinates depend on the screen size and location, so the
converter need to access the screen.

The fact that it needs the position or the size is an internal detail,
so pass a pointer to the whole screen structure.",False
b0db1178d1f61e9cef42189e60c4ce68cc1c0aee,2019-11-07 01:54:36,Romain Vimont,"Move event conversion to input_manager

Only keep helper functions separated.

This will help to convert coordinates internally when necessary.",False
8d601d3210c0714c947a3029a1299182a849e348,2019-11-07 01:54:36,Romain Vimont,"Rename ""input_manager"" variables to ""im""

It is used a lot, a short name improves readability.",False
683f7ca848ad4785557d116dcea466f1b5654ef9,2019-11-04 00:12:37,Romain Vimont,Document how to attach a debugger to the server,False
120f08ee96d29464bed9f4b1390244d8e2ccb81c,2019-11-03 21:21:47,Romain Vimont,"Fix manpage option parameter format

The parameter for --window-title was not underlined the same way as
others.",False
0415672a75c3ec98e4e7d231a9c380cd74d97067,2019-11-03 20:26:10,Romain Vimont,Merge branch 'master' into dev,True
3ea47423217775d2519fb5ac61edd55072639a64,2019-11-01 01:35:04,Romain Vimont,"Call ninja without changing directory

In build instructions, use:

    ninja -Cx ...

instead of:

    cd x
    ninja ...",False
95fd64b5dea57c4b94f2ab0a08f6421a134a48bf,2019-11-01 01:27:57,Romain Vimont,"Add scrcpy version in recorded video metadata

It might help to understand problems in recorded videos.",False
ab205084dcb42d9b76392dc114b5d3c87a4a37f4,2019-10-31 18:14:01,Romain Vimont,"Merge pull request #896 from yangfl/upstream

Add manpage for scrcpy",True
4696878a979bcf49bd5ecd8dc38765a61e85bada,2019-10-31 15:48:19,yangfl,Add manpage for scrcpy,False
3da95b52bd21ae0f4d81ee933caea63b78191deb,2019-10-31 15:24:29,Romain Vimont,"Rename scrcpy-server.jar to scrcpy-server

The server name ending with .jar has several drawbacks:
 - meson requires the jar executable to attempt to modify it:
     <https://github.com/Genymobile/scrcpy/issues/404#issuecomment-456065923>
     <https://github.com/mesonbuild/meson/issues/4844>
 - meson warns during ""ninja install""
     <https://github.com/Genymobile/scrcpy/issues/458>
 - some users try to execute it on the computer as a java executable

Removing the extension solves all these problems.",False
c72f6774355e7de53cb31bb40baab93852052ddf,2019-10-31 03:59:44,Romain Vimont,Merge branch 'master' into dev,True
1380f6e00f9e091f099d4d5184215dfa29b076ec,2019-10-31 03:21:40,Romain Vimont,"Fix help for --record-format

Record format requires a parameter.",False
d841718956d2dbd9f2bface70d971c4e0bec545c,2019-10-31 02:17:20,Romain Vimont,"Add a script to build the server without gradle

Gradle versions may sometimes cause problems. This script offers an
alternative.",False
17d53be3ef9d376e48a7f9e90cf6c87cf8fbf8f5,2019-10-25 14:39:06,Romain Vimont,"Fix mouse events conversion

The conversion from SDL mouse state to Android mouse state used wrong
constants as mask.

Fixes <https://github.com/Genymobile/scrcpy/issues/635>",False
f9938dbf88fbe35415db65824a3345a0117790f9,2019-10-25 14:34:04,Romain Vimont,"Inject button state for touch/mouse events

The buttons state was forwarded, but ignored by the server.",False
f6c8460ebb2e96aa4f1630296893807adfb84a3c,2019-10-20 19:38:16,Romain Vimont,"Rename window size functions for clarity

Now, get_window_size() returns the current window size (fullscreen or
not), while get_windowed_window_size() always returned the windowed size
(the size when fullscreen is disabled).",False
c33a147fd0e9fbd3a5add6f0190eea909d74c26d,2019-10-18 02:55:00,Romain Vimont,"Fix ""turn screen off"" on Android Q

Call getInternalDisplayToken(), which retrieve the id of the first
physical display (which is not necessarily 0 anymore).

Fixes <https://github.com/Genymobile/scrcpy/issues/835>",False
8b33c6c1087a183c7e8a7d45445eb0673b50e458,2019-10-18 01:51:47,Romain Vimont,"Adapt copy-paste methods for Android 10

The methods getPrimaryClip() and setPrimaryClip() expect an additional
parameter since Android 10.

Fixes <https://github.com/Genymobile/scrcpy/issues/796>.",False
5b7a0cd8e958946a51409767630cb43504807b0f,2019-10-18 01:41:39,Romain Vimont,Extract String literal to static constant,False
bab936194858bdf21f8505e30c38c25c26d72434,2019-10-18 01:39:54,Romain Vimont,"Do not crash on control error

Some devices do not have some methods that we invoke via reflection, or
their call do not return the expected value. In that case, do not crash
the whole controller.",False
6220456def65e00696a268ac654756a8b22a96a7,2019-10-04 00:07:49,Romain Vimont,"Merge mouse and touch events

Both are handled the very same way on the device.",False
7e1d52c1194ae262bd34489419a26e148d899138,2019-10-03 23:57:28,Romain Vimont,"Rename ""touch pointer"" to ""pointer""

There are only touch pointers now, mouse pointers have been removed.",False
280d5b718cb0416adb164d363ffe077060ea87b1,2019-10-03 23:35:29,Romain Vimont,"Use common pointers for mouse and touch

The mouse is a pointer like any other.",False
30168f042890f01071d15a7d7c88050b1825aa73,2019-10-03 23:35:29,Romain Vimont,"Ignore duplicate mouse events

In SDL, a touch event may simulate an identical mouse event. Since we
already handle touch event, ignore these duplicates.",False
b5a2d99bc24b6ae1cd040bef7086e4847cae4d07,2019-10-03 23:35:29,Romain Vimont,"Send touch events from the client

On SDL touch events, send control messages to the server.",False
f765aae352ecc0404ab483ec3255e7e1608ee128,2019-10-03 23:35:29,Romain Vimont,"Inject touch events on the server

On receiving an ""inject touch"" control message, update the local
pointers state and inject touches.",False
77f876e29cdd6f78dd9de4be6511b6228d58a1e7,2019-10-03 23:35:27,Romain Vimont,"Add ""inject touch"" control message

Add a control message type in the protocol to forward touch events to
the device.",False
d90549d1e67e018285fedb8f1d820c04b7d5b3c7,2019-10-03 01:10:26,Romain Vimont,"Rename ""pointer"" to ""mouse pointer""

This will help to distinguish them from ""touch pointers"".",False
810ff80ba7c425f021bcfda972345595a85b803c,2019-10-03 01:10:26,Romain Vimont,"Add buffer_write64be()

Add a function to write 64 bits in big-endian from a uint64_t.",False
1f8ba1ca79f4915f3a7b3c5199258904e3192445,2019-09-30 02:09:53,Romain Vimont,"Include config.h everywhere

Ref: <https://github.com/Genymobile/scrcpy/issues/829>

Suggested-by: Louis Kruger <louisk@gmail.com>",False
129dabcfa466d0d76d2f2b2715e48d649d80a4ba,2019-09-30 02:09:47,Louis Kruger,"Include config.h to fix HIDPI support

Ref: <https://github.com/Genymobile/scrcpy/issues/829>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
f510f1de1c28dba662a60c7b2b642163cfbf4242,2019-09-28 18:16:44,Romain Vimont,"Remove ""make"" from build dependencies

The project is built with meson+ninja.",False
7d1932b9076b6ff3a3fd77d3b6d94a886a91ceaa,2019-09-28 15:53:54,Romain Vimont,Fix gradle warnings in tests,False
795d1030327701373bd81bafc01d26422eda28e5,2019-09-28 08:07:25,Yu-Chen Lin,"input_manager.c: Correct log

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
513d1ac96d24d6cf07fb1850232b5c0e8f555615,2019-09-27 07:34:41,Ta-da,"Fix option ""record-format"" related short opt",False
ffdbf5990ba82fa206248b4a411442a6885dbcca,2019-09-15 20:59:03,Romain Vimont,"Rename event converter functions

Rename ""XXX_from_sdl_to_android"" to ""convert_XXX"", to avoid huge
function names.",False
9463850c2471dac67b571f5343cd5307cc0d6d54,2019-09-15 20:59:03,Romain Vimont,"Rename ""convert.h"" to ""event_converter.h""

The filename gave no hint about what was converted.",False
6e38e0cbfee9cb5258f9d1bf33c8608f58b97844,2019-09-15 20:59:03,Romain Vimont,"Rename variable names ""event"" to ""msg""

Some variable names had not been renamed when ""event"" was renamed to
""message"" (28980bbc90ab93cf61bdc4b36d2448b8cebbb7df).",False
7040e8abc45ae95d901341c81f7d4cfe52da171c,2019-09-15 20:59:03,Romain Vimont,"Fix control message reader test

The mouse event test actually tested a key event control message.",False
da5b0ec0d59a9da591507cbb7b5d19f55b76c35c,2019-08-15 02:02:46,Romain Vimont,Improve FAQ,False
a9c8fa305d2313bed70b2d1d756083f40e065352,2019-08-13 22:28:36,Romain Vimont,"Fix segfault on recording with old FFmpeg

The AVPacket fields side_data and side_data_elems were not initialized
by av_packet_ref() in old FFmpeg versions (prior to [1]).

As a consequence, on av_packet_unref(), side_data was freed, causing a
segfault.

Fixes <https://github.com/Genymobile/scrcpy/issues/707>

[1]: <http://git.videolan.org/gitweb.cgi/ffmpeg.git/?p=ffmpeg.git;a=commitdiff;h=3b4026e15110547892d5d770b6b43c9e34df458f>",False
20b3f101a40cd7455cc5b41e381291504deec5ba,2019-08-09 18:45:28,Romain Vimont,"Print gradle output on compiling

Enable the attribute ""console"" of custom_target() introduced in meson
0.48. This allows to get a feedback of what gradle does (which can takes
a very long time).

This produces warnings because we declare to support meson >= 0.37, but
we don't want to stop supporting older versions for that. Older versions
just ignore the option:

> WARNING: Unknown keyword arguments in target scrcpy-server: console

Newer meson versions use it, but warn because we declare supporting
older versions:

> WARNING: Project targetting '>= 0.37' but tried to use feature
> introduced in '0.48.0': console arg in custom_target

Meson does not support conditional branches to suppress such warnings,
so just keep the warnings.",False
686733023bd4c8bc2b655ff64209512a5620deb1,2019-08-09 02:54:47,Romain Vimont,"Merge pull request #708 from toddsierens/patch-1

Update WindowManager.java",True
27eacc3c11d0d40d4a125629a2ade9f459fc6d77,2019-08-09 02:47:48,toddsierens,Update WindowManager.java,False
8507fea2718141075de519a3f1f53c99951cd368,2019-08-08 22:27:52,Romain Vimont,"Record a packet with its duration

Record a packet only once the following has been received, so that we
can set its duration before muxing it.

Fixes <https://github.com/Genymobile/scrcpy/issues/702>",False
8a08ca0f3dfa90fe273d8e6b5a5744d8602c0597,2019-08-08 03:12:06,Romain Vimont,"Merge pull request #692 from msfjarvis/msf/uprev-dependencies

Upgrade build dependencies",True
44fb692a64adffa16fbbb84068949d3121f1a7ae,2019-08-08 03:11:36,Harsh Shandilya,"Uprev Gradle wrapper to latest stable

Signed-off-by: Harsh Shandilya <msfjarvis@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
3f77c29c956ef3f4cb7779fcdf90f61b22e0093e,2019-08-08 02:50:16,Harsh Shandilya,"Uprev AGP to latest stable

Signed-off-by: Harsh Shandilya <msfjarvis@gmail.com>",False
9a50b65b338699ab6f0916712cda806353127434,2019-08-05 18:56:06,Romain Vimont,"Merge pull request #695 from schwabe/schwabe/fix_null_queue

Fix building on OS X (missing NULL in queue.h)",True
c05056343b56be65ae887f8b7ead61a8072622b9,2019-08-05 18:32:05,Arne Schwabe,"Fix building on OS X (missing NULL in queue.h)

Headers seem to be a bit different in Apple land and you need to include
stddef.h explicitly to the NULL declaration.

This also makes the code a bit more correct, as stddef.h is the header
in the C standard that defines NULL
(https://en.cppreference.com/w/cpp/header/cstddef).",False
9bcee4ea428472c884fc869a42e0d667c5958b4b,2019-08-05 01:33:45,Romain Vimont,Update links to v1.10 in README and BUILD,False
c28619e4e8de8c195132d12ec44e92dc27e04da0,2019-08-04 20:11:04,Romain Vimont,Bump version to 1.10,False
8969444ff2b37132a72ce92512590028b0dbc0bf,2019-08-04 19:53:42,Romain Vimont,"List scrcpy characteristics in README

They were listed in the blog post introducing scrcpy:
<https://blog.rom1v.com/2018/03/introducing-scrcpy/>",False
b54f0bfe487274f2fb02456c6f3e0458f9245786,2019-08-04 19:53:42,Romain Vimont,"Upgrade SDL (2.0.10) for Windows

Include the latest version of SDL in Windows releases.",False
0aec1e502ef3d909595f6c7008b0960149c5039b,2019-08-04 19:53:42,Romain Vimont,"Update platform-tools (29.0.2) for Windows

Include the latest version of adb in Windows releases.",False
c3a58ad10fdcc3be7d38263037f6d148573cc3c1,2019-08-04 19:53:42,Romain Vimont,"Upgrade FFmpeg (4.1.4) for Windows

Include the latest version of FFmpeg in Windows releases.",False
b0184f2869d259ae83eebe981010e39485fe459f,2019-08-04 19:52:39,Romain Vimont,"Initialize queue ""last"" field

The compiler is not always able to see that ""last"" is always initialized
before being used, so always initialize it.",False
e2ac996183c661a1887ae225c81b624551cc0299,2019-08-04 02:43:44,Romain Vimont,"Use Cmd instead of Ctrl on macOS when possible

Fixes <https://github.com/Genymobile/scrcpy/issues/642>",False
5e4ccfd83298d3fb2e1c638b6235b811d034afdd,2019-08-02 02:45:47,Romain Vimont,"Use generic FIFO queue for recording

Replace the specific recording queue by the new generic FIFO queue
implementation.",False
53b6ee2cf493fc8574d41290df7462ffb6e7eb7c,2019-08-02 02:44:50,Romain Vimont,"Add generic intrusive FIFO queue

We need several FIFO queues (a queue of packets, a queue of messages,
etc.).

Some of them are implemented using cbuf, a generic circular buffer. But
for recording, we need to store the packets in an unbounded queue until
they are written, so the queue was implemented manually.

Create a generic implementation (using macros) to avoid reimplementing
it every time.",False
26213f1031e364bd8496e5317fba8140adaba357,2019-08-02 02:20:03,Romain Vimont,Fix cbuf documentation,False
96b5067cbfe9621ea8cfa977b79b73264f29aa3b,2019-08-02 01:38:34,Romain Vimont,Remove unnecessary backslash in cbuf,False
421e4be399ce57c6376d0bbd00f238c1723c1c56,2019-07-31 20:05:14,Romain Vimont,"Remove root directory from Windows zip releases

Put the scrcpy files at the root of the zip archive. This avoids an
unnecessary level of directories when extracting.",False
6abb4902c60169132bfa0c9bd6cc56fa8580e7c0,2019-07-31 14:34:38,Romain Vimont,"Log recording failure

If recording fails, log ""recording failed"" instead of ""recording
complete"".",False
d4ed8b6f26fcf0f7bd8c211daf905ee47f4d7ea8,2019-07-31 05:25:43,Romain Vimont,"Log scrcpy version and URL on start

Keep --version which also print the version of dependencies.",False
35d9185f6c3dc1c34ea7d46859ee89827e2fe74a,2019-07-31 05:25:40,Romain Vimont,"Record asynchronously

The record file was written from the stream thread. As a consequence,
any blocking I/O to write the file delayed the decoder.

For maximum performance even when recording is enabled, send
(refcounted) packets to a separate recording thread.",False
63af7fbafe3740b17b5495a8230298eff9d45581,2019-07-31 05:25:32,Romain Vimont,"Reduce latency by 1 frame

To packetize the H.264 raw stream, av_parser_parse2() (called by
av_read_frame()) knows that it has received a full frame only after it
has received some data for the next frame. As a consequence, the client
always waited until the next frame before sending the current frame to
the decoder!

On the device side, we know packets boundaries. To reduce latency,
make the device always transmit the ""frame meta"" to packetize the stream
manually (it was already implemented to send PTS, but only enabled on
recording).

On the client side, replace av_read_frame() by manual packetizing and
parsing.

<https://stackoverflow.com/questions/50682518/replacing-av-read-frame-to-reduce-delay>
<https://trac.ffmpeg.org/ticket/3354>",False
a90ccbdf3b37694aac8c34cd6d0837d511c81843,2019-07-31 05:23:16,Romain Vimont,"Add option to change the push target

A drag & drop always pushed the file to /sdcard/.

Add an option to customize the target directory.

Fixes <https://github.com/Genymobile/scrcpy/issues/659>",False
ca970e8aa6fe505d85998325ce1c65f0d4ff981b,2019-07-31 03:44:17,Romain Vimont,Merge branch 'master' into dev,True
6b3d9e3eab1d9ba4250300eccd04528dbee9023a,2019-07-30 15:47:33,Romain Vimont,"Add unit test for device message serialization

There was a test for the deserialization, but not for the serialization.",False
02692ffa42c66c1c3dc93752c2fe2bec74e0240b,2019-07-29 18:49:07,Romain Vimont,"Rename ""build_"" to ""compile_""

Recent versions of meson complain about an option having name starting
with ""build_"":

> DEPRECATION: Option uses prefix ""build_"", which is reserved for Meson.
> This will become an error in the future.

Use ""compile_"" instead.",False
3b69463e61becd3e36e27abb3bb43eb77389164c,2019-07-29 18:29:44,Jonathan,"Update README.md

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
9dea6d23848fe68450b003067cc231f914332c6b,2019-07-29 18:29:44,Romain Vimont,Add me as copyright owner,False
3c55d0c69b089a1a282b8803dcd076404226901e,2019-07-13 00:37:06,Romain Vimont,"Fix double-free on error

If writing the recording header fails, do not clean the resources
immediately to avoid double-free.",False
49612561233b3cde41339ee08c71892e42649706,2019-06-27 03:20:39,Romain Vimont,"Close decoder on stream ended

Add missing call to decoder_close().",False
e4ac943d86e6328f53eb63f86164da534b293524,2019-06-25 01:07:38,Romain Vimont,Document --window-title in README,False
4b997239f39c9db9b400bae57902e312b706cac4,2019-06-25 01:02:45,Romain Vimont,"Merge pull request #614 from beango1:window-title-simple

add option window-title to set the title",True
8e65c10720b5713d642241508c38d831012d9f06,2019-06-24 23:28:00,beango1,"Add option --window-title

Add an option to set a custom window title.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
056e47e752be3f4555d4af9057f1ad25809524c9,2019-06-24 00:22:03,Romain Vimont,"Replace ""cannot"" by ""could not""",False
439b009a794983a738f3d48e1d07cd721dca112d,2019-06-24 00:17:21,Romain Vimont,Fix expected parameters count in error message,False
91ecb4f218f9a0f348ed8aee47919d6c2f4779a9,2019-06-20 15:45:45,Romain Vimont,"Close socket on error

Suggested-by: barry-ran

<https://github.com/Genymobile/scrcpy/issues/607>",False
bfb3f0842f523b315ec92668bb15818fb3883bab,2019-06-20 14:29:19,Romain Vimont,"Prevent to turn screen off if no control

If --no-control is set, then the controller is not initialized (both in
the client and the server), so it is not possible to control the device
to turn its screen off.

See <https://github.com/Genymobile/scrcpy/issues/608>.",False
87d7a157a9da80a010bc4f7654d123f9ea3caba7,2019-06-20 14:17:02,Romain Vimont,Reference USBaudio from README,False
b91ecf52256da73f5c8dca04fb82c13ec826cbd7,2019-06-18 20:43:53,Romain Vimont,"Fix --serial help

Make explicit that --serial excepts a parameter.",False
1807de4955e7d80d513f96a21026cd542886dc4f,2019-06-15 18:44:22,Romain Vimont,"Merge pull request #595 from taaem/fix_build_fedora

The Java JDK is needed to build the server",True
0a233fd27fc9c44dc942d921f3daa70206712129,2019-06-15 18:40:51,taaem,"Fix required java package for Fedora

The Java JDK is needed to build the server. The relevant Fedora package
is java-devel, not java.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
4940746bcba1ef50dec9add25cf231e8596407af,2019-06-14 13:45:53,Romain Vimont,"Remove useless else

The if-block ends with a return.",False
fe758e6e1545db7a4a95af44fd081c75e9a12aba,2019-06-14 13:41:15,Romain Vimont,"Improve comment

Rephrase to simplify and add a link to the issue.",False
b29a568f08506889d3a5c912c6417e59baeb13e4,2019-06-14 13:34:12,Romain Vimont,"Merge pull request #587 from schwabe/fix_586_screen_off_qbeta

Use getPhysicalDisplayToken if getBuiltInDisplay is not found",True
b769083a5bcebebefa5ec50cbacba584421add21,2019-06-13 17:00:54,Arne Schwabe,"Use getPhysicalDisplayToken on Anroid Q+ instead of getBuiltInDisplay

This makes the -S (screen off) parameter work on Android Q beta 4

Closes #586",False
8ca36406b9893ba7a9af270eec2f81136062d4fb,2019-06-12 15:13:18,Romain Vimont,"Remove compilation flag ""skip_frames""

It is unused since ebccb9f6cc111e8acfbe10d656cac5c1f1b744a0.",False
53310a925a495f61d42dd90faa0a0748074d63c5,2019-06-12 14:56:23,Romain Vimont,"Disable portable build by default

The default value of a boolean meson option is true. We want
non-portable build by default.",False
0cb902d58b7ede70ee97cc46d74ccb535833d693,2019-06-12 14:53:15,Romain Vimont,Merge pull request #587 from zzndb/patch-1,True
bcd0a876f7bf52642330410812a6b7100cdeda91,2019-06-12 14:52:50,zzndb,"Fix a spell mistake

After commented default portable option in `app/meson.build` get some
error and then find this. :)

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
de2016a48e3016e6f24858afa9c52a9a54e8ab47,2019-06-12 03:11:56,Romain Vimont,"Add link to Snap package in README

<https://github.com/Genymobile/scrcpy/issues/523>",False
19ca6a0d66b5bf0bb997e64c6e5e1c278d79d6fd,2019-06-12 02:31:23,Romain Vimont,Fix typo in README,False
e2996e85c0e2e75b012b259ba4346b0b6d7b1e9a,2019-06-12 02:30:09,Romain Vimont,Update links to v1.9 in README and BUILD,False
c2df0228a39187e42e6c915bef16bb3ca64a1b0e,2019-06-12 02:24:58,Romain Vimont,Merge branch 'dev',True
259d3aee934e60ab7bd28ed97c830052a442c2c8,2019-06-12 01:20:29,Romain Vimont,Bump version to 1.9,False
90859f1dcfd9cac1b6ad8c24c3c021242d034ae0,2019-06-12 01:19:14,Romain Vimont,"Upgrade tarketSdkVersion to 29

This fixes a lint warning.",False
1afe9ce2ee806772e837de124a72e83429b83a8d,2019-06-12 01:18:58,Romain Vimont,Fix deprecation warning in Java unit test,False
273cec8a92ecc47ec7f336c07a2fa124726901e9,2019-06-12 01:17:31,Romain Vimont,Fix typo in test name,False
02f189b1de51359150d0c7da0ecc5e815c7a3e15,2019-06-12 01:07:09,Romain Vimont,"Remove obsolete detail in README

Now that scrcpy-server.jar is found in the same directory as the
scrcpy executable, using SCRCPY_SERVER_PATH is not particularly useful
on Windows anymore",False
4abe163233f9bfc636ec8387b8a2d286812482ab,2019-06-12 00:50:06,Romain Vimont,"Remove obsolete explanation in FAQ

Issue 9 was about stdout/stderr not printed in Windows console. This is
solved since the Windows version is cross-compiled from Linux.",False
5ffdcbb7beea8721350280170365aa8417c38ab8,2019-06-12 00:48:43,Romain Vimont,Update DEVELOP.md,False
ffe0417228fb78ab45b7ee4e202fc06fc8875bf3,2019-06-11 22:49:47,Romain Vimont,"Update platform-tools (29.0.1) for Windows

Include the latest version of adb in Windows releases.",False
e3afb67e7f7ab01d81a46b5be95bcfcf74277de4,2019-06-11 22:48:45,Romain Vimont,"Downgrade SDL to 2.0.8 for Windows

Revert ""Update SDL (2.0.9) for Windows""

Several users experienced freezes with SDL 2.0.9.

This reverts commit a5787dccd62fe4ff9dc05d597d3aab06da717edd.

See:
 - <https://github.com/Genymobile/scrcpy/issues/425>
 - <https://discourse.libsdl.org/t/unstable-frame-rate-unexpectedly/25783>",False
4ee1391361e7590cd6f88d87b0efc762a30c82c7,2019-06-11 22:48:45,Romain Vimont,"Upgrade FFmpeg (4.1.3) for Windows

Include the latest version of FFmpeg in Windows releases.",False
2755bfc255f28db0727e29749d456eebe82ba776,2019-06-11 21:14:07,Romain Vimont,"Improve portable builds

In portable builds, scrcpy-server.jar was supposed to be present in the
current directory, so in practice it worked only if scrcpy was launched
from its own directory.

Instead, find the absolute path of the executable and build a suitable
path to use scrcpy-server.jar from the same directory.",False
3b17ff7c866cf6b27ce82dbe6a8f87df1310069c,2019-06-11 21:14:07,Romain Vimont,"Add functions to convert wide char to UTF-8

There was already utf8_to_wide_char(), used to correctly execute
commands on Windows.

Add the reverse converter: utf8_from_wide_char(). We will need it to
build the scrcpy-server path based on the executable directory.",False
4eb6b26c93e6af6f44f125244a04c0a343b3b996,2019-06-11 21:14:07,Romain Vimont,"Extract ""scrcpy-server.jar"" string

The filename is used at several places.",False
eb34098add981aebd0c9aaed89ea9fa04d9ce798,2019-06-11 21:14:07,Romain Vimont,"Simplify portable build configuration

To create a portable build (with scrcpy-server.jar accessible from the
scrcpy directory), replace OVERRIDE_SERVER_PATH by a simple compilation
flag: PORTABLE.

This paves the way to use more complex rules to determine the path of
scrcpy-server.jar in portable builds.",False
b777760bcac71f59797e69600448b814b215b618,2019-06-11 21:14:07,Romain Vimont,"Simplify scrcpy-server path configuration

The full path of scrcpy-server.jar was partially configured from
meson.build then concatenated by C code.

Instead, directly write the path in C.",False
72bdfbc7a6f0a60358eb3976925ebb6a4d8ad08e,2019-06-11 21:14:07,Romain Vimont,"Never return 0 for stream protocol

On socket disconnection, on Linux, recv() returns -1 and errno is set.
But on Windows, errno is 0.

In that case, AVERROR(errno) == 0, leading to the warning:

> Invalid return value 0 for stream protocol

To avoid the problem, if errno is 0, return AVERROR_EOF.

Ref: commit 2876463d394c3bc4dc239a605e65ebab75598353",False
8604f16b30892e7dc2482d221f611757aefb0d87,2019-06-07 21:15:03,Romain Vimont,"Truncate device name at UTF-8 code point boundary

Just in case.",False
5d1133925994077d93d37e95565c359e026abfff,2019-06-07 20:49:00,Romain Vimont,"Inline lock_util functions

They are just tiny wrappers.",False
e2a272bf99ecf48fcb050177113f903b3fb323c4,2019-06-07 20:46:26,Romain Vimont,"Improve framerate counting

The FPS counter was called only on new frames, so it could not print
values regularly, especially when there are very few FPS (when the
device surface does not change).

To the extreme, it was never able to display 0 fps.

Add a separate thread to print framerate every second.",False
d104d3bda91b018c25bf0fdcf1733bc90cc894cd,2019-06-07 20:24:31,Romain Vimont,"Add cond_wait_timeout()

Add a ""timed out"" version of cond_wait().",False
eda44b6068dc44104bb7e1700bc4abfb55d873be,2019-06-07 03:33:21,Romain Vimont,"Fix controller cleanup

After commit bfb86ca2c23c29cf768c9216dbfff3a89d5d0b5f, the controller
was not stopped and destroyed on quit.",False
ebccb9f6cc111e8acfbe10d656cac5c1f1b744a0,2019-06-06 01:09:42,Romain Vimont,"Add runtime option to render expired frames

Replace the compilation flag SKIP_FRAMES by a runtime flag to force
rendering of expired frames. By default, the expired frames are skipped.",False
a143b8b07af14c579300ff536fc195e9351c9226,2019-06-05 22:32:42,Romain Vimont,"Indent command-line options

Prepare indentation for --render-expired-frames.",False
92539968739ea8ba58af3f19541b2b9c4e89c7e2,2019-06-05 22:32:42,Romain Vimont,Add README section explaining --turn-screen-off,False
a13524e7f9d696635983776c548adaa1b9c8508f,2019-06-05 13:22:25,Romain Vimont,"Replace android-tools-adb by adb

Here is the description of the adb package in Debian:

> Description: Android Debug Bridge
>
> A versatile command line tool that lets you communicate with an
> emulator instance or connected Android-powered device.
>
> This package recommends ""android-sdk-platform-tools-common"" which
> contains the udev rules for Android devices. Without this package, adb
> and fastboot need to be running with root permission.

And android-tools-adb:

> Description: transitional package
>
> This is a transitional package. It can safely be removed.",False
f3f3433163db795b8310f045c6e3ddf721650bb5,2019-06-05 13:21:47,Romain Vimont,"Merge pull request #574 from crow1170/patch-1

Fix dependencies",True
232aaa386e3de06218a3070bfd39829b29a83954,2019-06-05 10:45:59,Chris Knowles,"Fix dependencies

Some missing or misspelled dependencies. Checked on Ubuntu 19.04.",False
8e66b33000994f3b95de5128e0f78fdf62f51a5a,2019-06-05 04:25:46,Romain Vimont,"Add option to turn device screen off

In addition to the shortcut (Ctrl+o) to turn the device screen off, add
a command-line argument to turn it off on start.",False
7f07b134468d891f5869bb11a6a60e7c836fd4bb,2019-06-05 04:25:39,Romain Vimont,"Indent command-line options

Preparse indentation for --turn-screen-off.",False
acc4dcd520f960a3e5d8fb431ceb0cbc3e7825e4,2019-06-05 03:55:57,Romain Vimont,"Disable server controller if --no-control

If --no-control is disabled, there is no need for a controller.

It also avoids to power on the device on start if control is disabled.",False
ca767ba36410bc90532a8b441c3c4712f973c352,2019-06-05 03:55:57,Romain Vimont,"Group server params in a struct

Starting the server requires more and more parameters. For clarity,
group them in a struct.",False
c8a6783494b133244da69f7e551de1e25fa66c5a,2019-06-05 03:55:15,Romain Vimont,"Use positive options names internally

For clarity, store the flag resulting of the command-line options
--no-control and --no-display into ""control"" and ""display"".",False
5b56900e2b2e08631f62f073107499985730ceba,2019-06-05 00:59:14,Romain Vimont,"Rename unused field

The flag is used only in the server_start() implementation, there is no
need to store it in the structure.",False
8c8649cfcd710859ce18eab557ed2af8cedb9a42,2019-06-03 15:14:39,Romain Vimont,"Remove ""turn device screen on"" feature

Only keep ""turn device screen off"" and POWER button.

After we turn the device screen off (with Ctrl+o), turning it back on
does not always work, and leaves the device in a weird state, where even
the power button may not be sufficient:
<https://github.com/Genymobile/scrcpy/issues/175#issuecomment-497946596>

This is not an acceptable behavior, so disable the shortcut to turn the
physical device screen on. We can use the POWER button (or Ctrl+p)
instead.",False
e572d81fa25b930e8aa68da1160dd034a532c279,2019-06-03 00:04:52,Romain Vimont,"Rename function to ""power on""

This will reduce confusion between ""power on"" when the device is off and
""turn device screen off"" while mirroring.",False
41225c3e41324e8feb0a88d217f47d29a8dc9520,2019-06-01 10:48:05,Romain Vimont,"Improve key processing readability

The condition ""event->type == SDL_KEYDOWN"" and the variable
input_manager->controller are used many times. Replace them by local
variables to reduce verbosity.",False
296047d82a4d6e8d87a955b9643f7538e79200ee,2019-06-01 03:03:44,Romain Vimont,"Use net_close() to close sockets

So that it also works on Windows.",False
0792998cc24de067bb2d4a055838fb5047ad6197,2019-06-01 03:01:53,Romain Vimont,"Remove unused import

Introduced by the previous commit.",False
12a3bb25d39037931f577dc0165b3e517aad92df,2019-06-01 02:37:23,Romain Vimont,"Implement device screen off while mirroring

Add two shortcuts:
 - Ctrl+o to turn the device screen off while mirroring
 - Ctrl+Shift+o to turn it back on

On power on (either via the POWER key or BACK while screen is off), both
the device screen and the mirror are turned on.

<https://github.com/Genymobile/scrcpy/issues/175>",False
3ee9560ece4b4d17031e23b3ac8a0901f86c5694,2019-06-01 02:27:12,Romain Vimont,"Fix comment style

For consistency.",False
a56045dd8047f9b147e63be67c41a4423023437f,2019-06-01 01:54:31,Yu-Chen Lin,"Prevent socket leak on error

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
fcf225049dc783677244f08700ed4c53e8dc5382,2019-06-01 01:54:17,Yu-Chen Lin,"Use consistent variable names

Use the same variable name in functions declaration and definition.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
6537c2ef011cf730c4f26b047131041e065094ec,2019-05-31 19:48:00,Romain Vimont,"Add clipboard logs

Synchronizing local and device clipboards in invisible. Add INFO logs
on success.",False
9712cb8123502152ec6932a709c7d8de7ea02eb5,2019-05-31 19:48:00,Romain Vimont,"Do not minimize on focus loss

The default behavior seems annoying.

Fixes <https://github.com/Genymobile/scrcpy/issues/554>",False
ad55a9addc4bd045b8af6bb541e58abc2b32460d,2019-05-31 19:48:00,Romain Vimont,"Prefix server logs

Sometimes, it is not obvious whether a log is generated by the server or
by the client. Prefix server logs for clarity.",False
28980bbc90ab93cf61bdc4b36d2448b8cebbb7df,2019-05-31 19:48:00,Romain Vimont,"Rename ""event"" to ""message""

After the recent refactorings, a ""control event"" is not necessarily an
""event"" (it may be a ""command""). Similarly, the unique ""device event""
used to send the device clipboard content is more a ""reponse"" to the
request from the client than an ""event"".

Rename both to ""message"", and rename the message types to better
describe their intent.",False
f710d76c9ef9f93cad0b0cb0e47cfeee18b4e94a,2019-05-31 18:57:35,Romain Vimont,"Merge pull request #568 from npes87184/dev

Correct return value type in handle_event",True
2a8a3e6ed5f019bdb296dd2fdfa3a2d486b0bc15,2019-05-31 18:27:06,Yu-Chen Lin,"Correct return value type in handle_event

handle_event return the type enum event_result not bool

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
c2cef8d501226688c90f3d7038c799e669158b24,2019-05-31 02:36:52,Yu-Chen Lin,"server/meson.build: Prevent using input field for directory

This will fix build warning in newer meson.
Fix #540.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
0125af1e46ae88c3ef05210686ab55e553ab3e96,2019-05-31 02:16:52,Romain Vimont,Update DEVELOP after recent refactorings,False
c13a24389cae489e01ba5a31f4ef6b384d1f8547,2019-05-31 02:16:52,Romain Vimont,"Implement computer-to-device clipboard copy

It was already possible to _paste_ (with Ctrl+v) the content of the
computer clipboard on the device. Technically, it injects a sequence of
events to generate the text.

Add a new feature (Ctrl+Shift+v) to copy to the device clipboard
instead, without injecting the content. Contrary to events injection,
this preserves the UTF-8 content exactly, so the text is not broken by
special characters.

<https://github.com/Genymobile/scrcpy/issues/413>",False
232206965671f921a1d5a881e2b28f63aff1eb72,2019-05-31 02:16:52,Romain Vimont,"Extract control event String parsing

Parsing a String from a serialized control event, encoded as length (2
bytes) + data, will be necessary in several events.

Extract it to a separate method.",False
61f5f96b4229a97152bfc05bc97682dd8316d071,2019-05-31 02:16:52,Romain Vimont,"Fix control event String parsing

At least 2 bytes must be available to read the length of the String.",False
63c078ee6ca19c4a2b3d84b04068220ef425aaf4,2019-05-31 02:16:52,Romain Vimont,"Implement device-to-computer clipboard copy

On Ctrl+C:
 - the client sends a GET_CLIPBOARD command to the device;
 - the device retrieve its current clipboard text and sends it in a
   GET_CLIPBOARD device event;
 - the client sets this text as the system clipboard text, so that it
   can be pasted in another application.

Fixes <https://github.com/Genymobile/scrcpy/issues/145>",False
3149e2cf4a9d7b0db34c30d41077a73f048cb919,2019-05-31 02:16:52,Romain Vimont,"Add device event sender

Create a separate component to send device events, managed by the
controller.",False
6112095e756cc93a2ba16e81c228a876ae66d07d,2019-05-31 02:16:52,Romain Vimont,"Add device event receiver

Create a separate component to handle device events, managed by the
controller.",False
f9d2d99166f2259f05cd348fcde019b9a314d780,2019-05-31 02:06:22,Romain Vimont,"Add GET_CLIPBOARD device event

Add the first device event, used to forward the device clipboard to the
computer.",False
ec71a3f66ab48c2fdd1728753acc09edbd4db570,2019-05-31 02:05:41,Romain Vimont,"Use two sockets for video and control

The socket used the device-to-computer direction to stream the video and
the computer-to-device direction to send control events.

Some features, like copy-paste from device to computer, require to send
non-video data from the device to the computer.

To make them possible, use two sockets:
 - one for streaming the video from the device to the client;
 - one for control/events in both directions.",False
69360c7407c6e063a4d11aa259fd490c2324a0d5,2019-05-31 02:05:04,Romain Vimont,"Extract control event string serialization

A string is serialized as a length (2 bytes) followed by the string data
(non nul-terminated).

For now, it is used only once, but we will need to serialize strings in
other events.",False
6ec2ddd2d1498db754a10c4c95ea046a5488fe14,2019-05-31 02:04:59,Romain Vimont,"Truncate UTF-8 properly

This will avoid to produce invalid UTF-8 results (although unlikely).",False
0a7fe7ad57ac815f0f45b69f8f734e402abb6f41,2019-05-31 02:00:18,Romain Vimont,"Add helpers to truncate UTF-8 at code points

This will help to avoid truncating a UTF-8 string in the middle of a
code point, producing an invalid UTF-8 result.",False
3aa5426cad132792321c2cd370b9f9c156f7e901,2019-05-31 02:00:18,Romain Vimont,"Add unit tests for control events serialization

Add missing tests for serialization and deserialization of control
events.",False
63207d9cd589352da3898a33ee0fd88018735838,2019-05-31 02:00:18,Romain Vimont,Fix wrong comment in unit test,False
ad4c061cd29041b3cc94a93ff0e861fc0a52439c,2019-05-31 02:00:18,Romain Vimont,"Use custom class Point

The framework class android.graphics.Point cannot be used in unit tests.
Implement our own Point.",False
63909fd10d8bf76ac1d7f72bc0be79eb5b6461b0,2019-05-31 02:00:18,Romain Vimont,"Merge commands with other control events

Several commands were grouped under the same event type ""command"", with
a separate field to indicate the actual command.

Move these commands at the same level as other control events. It will
allow to implement commands with arguments.",False
3b4366e5bfa062d80df9ad455b68c98f7f7482c9,2019-05-31 02:00:18,Romain Vimont,"Stop stream immediately on quit

If the stream is stopped, av_read_frame() will be woken up and yield a
corrupted packet. Do not try to decode or record it.",False
47f1003200705a237d04af13525d2890a3f74583,2019-05-31 02:00:18,Romain Vimont,"Close server socket before killing process

The sockets may be closed and shutdown on server_stop(). This will
interrupt the stream and controller threads more quickly and gracefully.",False
bfb86ca2c23c29cf768c9216dbfff3a89d5d0b5f,2019-05-31 02:00:18,Romain Vimont,"Simplify cleanup

The cleanup is not linear: for example, the server must be stopped and
its sockets must be shutdown after the stream and controller are stopped
(so that they don't continue processing garbage), but before they are
joined, to avoid a deadlock if they are blocked on a socket read.

Simplify the spaghetti-cleanup by keeping trace of initialization at
runtime.",False
0dee9b04b2866e6e71f2844b58c416bc59741ca0,2019-05-31 02:00:18,Romain Vimont,"Use net_recv() to read only one byte

Partial read is impossible for 1 byte, so net_recv_all() is useless.",False
8fc58bde75f775b25aa699e4dbf3b1a6049300f9,2019-05-31 02:00:18,Romain Vimont,"Simplify server_connect_to()

Only use 2 branches, using either forward or remote tunnel.",False
5a431cdf9bf3e51e3be7dc2685ce67fc065a495b,2019-05-31 02:00:18,Romain Vimont,"Make server_connect_to() return a bool

The resulting socket is accessible from the server instance, there is no
need to return it.

This paves the way to use several sockets in parallel.",False
6edb1294f015ee5bf64d6a732c7897bdea79d038,2019-05-31 02:00:18,Romain Vimont,Add missing return 0 in unit test,False
073181b294c27e2abd7581a9dcef0de9b1762156,2019-05-31 02:00:18,Romain Vimont,"Use cbuf for file handler request queue

Replace the file_handler_request_queue implementation by cbuf.",False
241a3dcba524337b2b59c1931ed3403c00a6d05e,2019-05-31 02:00:18,Romain Vimont,"Use cbuf for control event queue

Replace the control_event_queue implementation by cbuf.",False
b38292cd695ebc51a6925f21afeb89eeff1b0208,2019-05-31 02:00:18,Romain Vimont,"Add generic circular buffer

Add a circular buffer implementation, to factorize multiple specific
queues implementation.",False
7475550ae8e4f128ac829a0d178298c72f840ce3,2019-05-31 02:00:18,Romain Vimont,"Add buffer_read16be()

Add a function to read 16 bits in big-endian to a uint16_t.",False
7fc8793d5b98a8a7c2cf208227c5cb966513171d,2019-05-31 02:00:18,Romain Vimont,"Make buffer util functions accept const buffers

So that they can be used both on const and non-const input buffers.",False
bf5e54b2e9c55186d0cf34098506a270a3f416a0,2019-05-31 02:00:18,Romain Vimont,"Make control_event_serialize() return size_t

control_event_serialize() returns the number of bytes written, so the
type should be size_t.",False
507b0bcccf708ef0a4b732d9165e882df4330bd9,2019-05-31 02:00:18,Romain Vimont,"Fix memory leak on error

The variable condition was not destroyed on strdup() failure.",False
e1afd9f8b019607fcb7f28f42682959697456f68,2019-05-31 02:00:18,Romain Vimont,Fix event ownership comment,False
b08dada6c1f0d93392886b0e874e0e486e5fb447,2019-05-31 02:00:18,Romain Vimont,"Prefix control event constants by namespace

This will avoid conflicts with future device events.",False
999c9646895fea64ece612be86aed162472b5d3b,2019-05-31 02:00:18,Romain Vimont,"Make macro expansion-safe

Use parentheses to avoid unexpected results.

For example, make:

    2 * SERIALIZED_EVENT_MAX_SIZE

expand to:

    2 * (3 + TEXT_MAX_LENGTH)

instead of:

    2 * 3 + TEXT_MAX_LENGTH",False
befe455e44620bd5a0f05c3e0040691fffd77fd2,2019-05-31 02:00:18,Romain Vimont,"Remove unused includes

The struct control_event does not use mutexes, and net.h does not need
SDL_platform.h.",False
d2504f974c05a7f15efda631decd1e6b31a0981e,2019-05-31 02:00:18,Romain Vimont,"Fix indentation

Previous refactorings broke indentation.",False
0fbab42f8cf9d392b769605226588fc21c6f2a09,2019-05-31 02:00:18,Romain Vimont,Format meson.build for readability,False
08f506b24f8c1a5fe3a2c12ab42710633150b4ec,2019-05-31 02:00:18,Romain Vimont,"Replace SDL_bool by bool in tests

Commit dfed1b250e5aada1c0b4c75fbaf54aebc19a92d5 replaced SDL types by
standard types in sources, but tests were not updated.",False
3bc1c51b91dbad1e67bb93371599049217508890,2019-05-31 02:00:08,Romain Vimont,"Always use SDL_malloc() and SDL_free()

To avoid mixing SDL_malloc()/SDL_strdup() with free(), or malloc() with
SDL_free(), always use the SDL version.",False
7ed976967f9bb14670b0030db2c28e4b36bd3f95,2019-05-30 03:52:05,Romain Vimont,"Fix checkstyle warning

Checkstyle wants a specific order of imports.",False
b75f0e94274f0fc152716a2ef0123ef477972171,2019-05-28 17:01:37,Romain Vimont,Merge branch 'master' into dev,True
5d473efeb5c4f42a75aad6ab5892e2813358c0c9,2019-05-27 13:54:47,Romain Vimont,"Bind Home key to MOVE_HOME

On pressing Home key on the computer, move the cursor to the beginning
of the line instead of going back to the home screen.

<https://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_HOME>
<https://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_MOVE_HOME>

Fixes (part of) <https://github.com/Genymobile/scrcpy/issues/555>.",False
a41dd6c79f542925c5db7f1ee51d27b65ba832ec,2019-05-24 20:55:31,Romain Vimont,"Make owned filename a pointer-to-non-const

The file handler owns the filename string, so it needs to free it.
Therefore, it should not be a pointer-to-const.",False
c3779d8513dbb1d80d29132aaf1550080c07dda7,2019-05-24 20:54:17,Romain Vimont,"Make owned serial a pointer-to-non-const

The file handler owns the serial, so it needs to free it. Therefore, it
should not be a pointer-to-const.",False
b3bd5f1b80ee0da8bd7eae7318cb1e7b164f46d2,2019-05-24 20:53:21,Romain Vimont,Remove useless casts to (void *),False
a920ba647140d29fedd2dc7bf167464ebc336d9e,2019-05-24 16:55:12,Romain Vimont,Explain how to customize path in README,False
3133d5d1c7a652a0227a979ddd6b021c4e7aa8c1,2019-05-24 00:28:08,Romain Vimont,"Continue on icon loading failure

If loading the icon from xpm fails, launch scrcpy without window icon.

<https://github.com/Genymobile/scrcpy/issues/539>",False
2dc1a594714ddc688b7403b4ef96eb41301055ae,2019-05-20 13:14:45,Romain Vimont,"Check surface returned for icon

SDL_CreateRGBSurfaceFrom() may return NULL, causing a segfault.

<https://github.com/Genymobile/scrcpy/issues/539>",False
3068457b901964cacd57405decd5852a1d1ce8fe,2019-05-20 12:10:10,Romain Vimont,"Log characters failed to be injected

Some characters may not be injected (e.g. '\r`). Log them instead of
ignoring them silently.",False
56f8e78f580a972f4fe967f82240b878f8de08bc,2019-05-20 12:09:02,Romain Vimont,"Merge pull request #542 from npes87184/dev

Return success count in injectText",True
1630f923ef9847142839907a9c2f3c3bde3a3369,2019-05-20 12:06:32,Yu-Chen Lin,"Return success count in injectText

It will insert as many text as possible now.
Fix #509, tested on Windows 10 and Arch Linux.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
e443518ed902b678ad33886a2e626bfb70f8cd45,2019-05-12 18:46:13,Romain Vimont,"Print adb command on error

When the execution of an adb command fails, print the command. This will
help to understand what went wrong.

See <https://github.com/Genymobile/scrcpy/issues/530>.",False
eeb8e8420fcca9aecaef3b15cee027cb7c03f325,2019-05-12 18:01:18,Romain Vimont,"Use size_t for command length

The size of an array should have type size_t.",False
39b5893c427ebe13d7cdf2e59930919bb7841bb5,2019-05-05 21:05:10,Romain Vimont,"Merge pull request #522 from dos1/compositor

Disable X11 compositor bypass",True
b941854c7375a0c9a9f3ef957ccbf659e645490c,2019-05-05 21:05:00,Sebastian Krzyszkowiak,"Disable X11 compositor bypass

Compositor bypass is meant for fullscreen games consuming lots of GPU
resources. For a light app that will usually be windowed, this only
causes unnecessary compositor suspends, especially visible (and
annoying) with complying window manager like KWin.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
068253a3a299a60d78c7c1b0e760f4bbe3b75bc1,2019-05-05 20:58:25,Sebastian Krzyszkowiak,"Fix mouse focus clickthrough

Mouse focus clickthrough didn't work due to compat.h header not being
included in scrcpy.c.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
c8338b2918d81d0238a7254ec2a6556211beb957,2019-05-04 18:19:48,Romain Vimont,"Recover if expand/collapse panels is not available

Some devices don't have the required method. Recover gracefully without
crashing the server.

Fixes <https://github.com/Genymobile/scrcpy/issues/506>.",False
2837c6eaab51eac7bc18c5a0848754a203970f44,2019-05-04 18:19:04,Romain Vimont,"Add method to log error without throwable

Add Ln.e(message) in addition to Ln.e(message, error).",False
668e54fd4b5ecf6fa03b60c2c59446538b99c976,2019-05-04 18:19:04,Romain Vimont,Upgrade gradle,False
01664777c8e6a280350eac9220208e1bc47502dd,2019-05-04 18:18:54,Romain Vimont,Merge branch 'master' into dev,True
ffa8c66979d4262a95cad584894b9a5fbeea0e84,2019-03-31 23:37:07,Gerdal,"Fix link error on Windows Subsystem for Linux

Build failed on WSL because of lack of reference to WinMain@16 during
linking.

Fixes <https://github.com/Genymobile/scrcpy/issues/316>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
5254e585c60c20f2f2ccfc360eba80d607db273e,2019-03-28 02:21:42,Romain Vimont,Run server tests on release,False
66baf0f95b3c0fc0b4e56e53cf8f69ff23645be8,2019-03-28 02:20:25,Romain Vimont,"Run tests with ASAN enabled

This may capture more errors (like
e2ef39fae5ffb576cdc4d924cf0b67393138168d).",False
f11b0ec2043ba912e91efce8bb30ecc547dc0aef,2019-03-28 02:17:54,Romain Vimont,"Fix server checkstyle errors

Fix errors reported by:

    gradle -p server check",False
e2ef39fae5ffb576cdc4d924cf0b67393138168d,2019-03-25 16:03:32,Romain Vimont,"Fix overflow in test

The serialized text is not nul-terminated (its size is explicitely
provided), but the input text in the event is a nul-terminated string.

The test was failing with ASAN enabled.",False
3eda38e5fc63f08eed408c39155b88e1bcefc341,2019-03-21 23:16:22,Romain Vimont,"Do not call codec.stop() on exception

On exception, the codec is not in a state were .stop() can be called.",False
a16cf95b8e7666509e039a44b2eca83f90a524e8,2019-03-11 03:49:09,Andrew Rabert,"Remove deprecated Arch Linux package

The `scrcpy-prebuiltserver` has been deprecated in favor of the `scrcpy`
package.

<https://aur.archlinux.org/cgit/aur.git/commit/?h=scrcpy-prebuiltserver&id=2ef4359b2e45fc278a191fae014d381b486ffcfe>

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
71fd238b0a8a888b51b89361bf0ad28b58d8e097,2019-03-08 01:18:43,Romain Vimont,Update developer documentation for v1.8,False
d795144a36dcc2bfe983e5cca4037bee3f4d8458,2019-03-08 01:12:08,Romain Vimont,"Add note about Ctrl+C on Windows while recording

Ctrl+C kills the app on Windows, so the recorded file is broken.",False
c287826f8e43224241c2cd5bad8084e1d6086ff9,2019-03-08 01:12:02,Romain Vimont,Update links to v1.8 in README and BUILD,False
1323e3c43e928ad0197cf45e7233485beca1316e,2019-03-08 00:51:07,Romain Vimont,Bump version to 1.8,False
50dac2eaee7dc33f35918c6276b89380e8df1dbc,2019-03-08 00:48:03,Romain Vimont,"Log ""new texture"" at INFO level

The ""initial texture"" is logged at INFO level. For consistency, log ""new
texture"" at the same level.",False
b8ff35efe6da66fa2eab084841478e988df3be27,2019-03-07 23:33:13,Romain Vimont,Remove empty line,False
7fad611dfb0290964f425f9debdc1120ab28f5c0,2019-03-07 23:32:40,Romain Vimont,Merge branch 'dev',True
a7b3901c3174975e818e3ef345fadfa10d4b6f25,2019-03-03 16:32:41,Romain Vimont,"Add more consts

Some decoder and recorder functions must not write to AVCodec and
AVPacket.",False
fc81d0d77106236c50803b0f1afacf8617fd2fc7,2019-03-03 15:46:13,Romain Vimont,"Merge pull request #442 from npes87184/master

server/meson.build: support relative path for prebuilt_server",True
f7efafd846e0d5597c6b198f523f1517bf8af782,2019-03-03 15:35:26,Romain Vimont,"Explicitly pass control flag to input manager

Replace the ""global"" control flag in the input_manager by a function
parameter to make explicit that the behavior depends whether
--no-control has been set.",False
c456e3826470753bdaefcffc93e9ae1bf25b12f7,2019-03-03 09:57:56,Yu-Chen Lin,"server/meson.build: support relative path for prebuilt_server

If we don't do this trick, the prebuilt_server will be
../server/[the_user_defined_path]. In general, we will not give an relative path
based on build directory, which leads to wrong prebuilt_server path.

The building error:

ninja: error: '../scrcpy-server-v1.7.jar', needed by
'server/scrcpy-server.jar', missing and no known rule to make it

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
6baed8a06fc05a9bc2e6d7aeef2b17c3cc5da98f,2019-03-03 06:11:35,Romain Vimont,"Do not init SDL video subsystem if no display

The SDL video subsystem is not necessary if we don't display the video.

Move the sdl_init_and_configure() function from screen.c to scrcpy.c,
because it is not only related to the screen display.",False
8595862005ebfb8a02081bea593884b308c19b49,2019-03-03 05:05:20,Romain Vimont,"Use explicit output parameter for skipped frame

The function video_buffer_offer_decoded_frame() returned a bool to
indicate whether the previous frame had been consumed.

This was confusing, because we could expect the returned bool report
whether the action succeeded.

Make the semantic explicit by using an output parameter.

Also revert the flag (report if the frame has been skipped instead of
consumed) to avoid confusion for the first frame (the previous is
neither skipped nor consumed because there is no previous frame).",False
9ef345fdd0eff7b779cea8bb6e8c3acd65e084a9,2019-03-03 04:31:16,Romain Vimont,"Make owned serial a pointer-to-non-const

The server owns the serial, so it needs to free it. Therefore, it should
not be a pointer-to-const.",False
dfed1b250e5aada1c0b4c75fbaf54aebc19a92d5,2019-03-03 04:25:23,Romain Vimont,"Replace SDL types by C99 standard types

Scrcpy is a C11 project. Use the C99 standard types instead of the
SDL-specific types:

    SDL_bool -> bool
    SintXX   -> intXX_t
    UintXX   -> uintXX_t",False
8655ba7197d7559695ad189a66e455261876c6f7,2019-03-03 03:40:21,Romain Vimont,"Add option to mirror in read-only

Add an option to disable device control: -n/--no-control.",False
163cd36ccc1257aac8201ff864b7d75ba939f70f,2019-03-03 03:16:46,Romain Vimont,"Rename -n/--no-window to -N/--no-display

The description of scrcpy is ""Display and control your Android device"".
We want an option to disable display, another one to disable control.

For naming consistency, name it --no-display.

Also change the shortname to -N, so that we can use -n for --no-control
later.",False
db6644f1f918604ce520da412de728d598cc0024,2019-03-03 03:12:28,Romain Vimont,"Add missing no_window initialization

Initialize the field no_window in ""struct args""",False
36191b7eec817b8ab6d87decd379b7cab2ce5834,2019-03-03 02:21:07,Romain Vimont,"Avoid unnecessary call if display is disabled

If --no-window is passed, there is no need to register an event watcher.",False
33ccb1368f013d803854e8980d6148503d4cb683,2019-03-03 02:21:07,Romain Vimont,"Extract event processing out of event_loop()

To avoid too many levels of nested blocks, move the event handling logic
in a separate function.",False
aeda583a2c75ebc09862f698892acfd2ccff95d5,2019-03-03 00:58:46,Romain Vimont,"Update code style

Limit source code to 80 chars, and declare functions return type and
modifiers on a separate line.

This allows to avoid very long lines, and all function names are
aligned.

(We do this on VLC, and I like it.)",False
b2fe00549882a17d8c5c68b33c9756968f7a681d,2019-03-03 00:40:34,Romain Vimont,"Replace uint64_t by Uint64 for consistency

The field pts is declared Uint64 in struct frame_meta.",False
ef118cc633943ac8941bed0ec7c3bafe6c59bbbf,2019-03-02 23:15:56,Romain Vimont,Describe the --no-window feature in README,False
89812e4eee47a49a92cf79d9e48c1f763505d0a6,2019-03-02 23:15:56,Romain Vimont,"Implement the --no-window flag

Disable decoder, screen (display), file_handler and controller when
--no-window is requested.

<https://github.com/Genymobile/scrcpy/pull/418>",False
421a1141e29cfa28e2ca90ac51e2d7387082f2fa,2019-03-02 23:15:56,CapsLock,"Add a new option: -n/--no-window

This option will allow scrcpy to record the stream without display.

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e6e011baafa9641a1d2b4419f36ef1dc975d479a,2019-03-02 23:15:45,Romain Vimont,"Add stream layer

The decoder initially read from the socket, decoded the video and sent
the decoded frames to the screen:

              +---------+      +----------+
  socket ---> | decoder | ---> |  screen  |
              +---------+      +----------+

The design was simple, but the decoder had several responsabilities.

Then we added the recording feature, so we added a recorder, which
reused the packets received from the socket managed by the decoder:

                                    +----------+
                               ---> |  screen  |
              +---------+     /     +----------+
  socket ---> | decoder | ----
              +---------+     \     +----------+
                               ---> | recorder |
                                    +----------+

This lack of separation of concerns now have concrete implications: we
could not (properly) disable the decoder/display to only record the
video.

Therefore, split the decoder to extract the stream:

                                    +----------+      +----------+
                               ---> | decoder  | ---> |  screen  |
              +---------+     /     +----------+      +----------+
  socket ---> | stream  | ----
              +---------+     \     +----------+
                               ---> | recorder |
                                    +----------+

This will allow to record the stream without decoding the video.",False
e7b7b083aad8c2e016cd5207988f5775cdaa19e9,2019-03-02 22:51:20,Romain Vimont,"Store the recording request in a local bool

This avoids to test explicitly whether options->record_filename is NULL.",False
8aeb5c0e3ccb43864d3ce0bd4d8af8f83d11e5d6,2019-03-02 22:43:11,Romain Vimont,"Fix cleanup order

The order of cleanup was not the reverse as the initialization order. As
a consequence, recorder_destroy() could theoretically be called even if
recorder_init() failed.",False
bcd4090d5152ee87e5c1b000f178ea36f79c7aff,2019-03-02 21:33:15,Romain Vimont,"Fix recording with old decoding/encoding API

The deprecated avcodec_decode_video2() should always the whole packet,
so there is no need to loop (cf doc/examples/demuxing_decoding.c in
FFmpeg).

This hack changed the packet size and data pointer. This broke recording
which used the same packet.",False
84270e2d1811924f1abc3917739d8d55c69611d4,2019-03-02 21:33:15,Romain Vimont,"Rename ""stop"" to ""interrupt""

The purpose of video_buffer_stop() is to interrupt any blocking call, so
rename it to video_buffer_interrupt().",False
fff87095d95c257f9d6cab34f605da65d0bf478d,2019-03-02 19:54:33,Romain Vimont,"Rename ""frames"" to ""video_buffer""

It better describes the purpose of the structure.",False
aacb09a3d66d018a6e1ff2988729d8c6b274755c,2019-03-02 19:18:34,Romain Vimont,Remove unused mutex field in decoder,False
7d10ec2b5aab648dd06b5ea9770f7cedacfbd74d,2019-02-27 01:05:37,Romain Vimont,"Add shortcut to expand/collapse notification panel

Use Ctrl+n to expand, Ctrl+Shift+n to collapse.

Fixes <https://github.com/Genymobile/scrcpy/issues/392>",False
1c1fe5ec53173fcccb6767a3c45b816610a8c72a,2019-02-16 19:58:56,Romain Vimont,"Use ""always on top"" only for SDL >= 2.0.5

The flag SDL_WINDOW_ALWAYS_ON_TOP is available since SDL 2.0.5.

Do not use it if SDL is older, to fix compilation failure.

Fixes <https://github.com/Genymobile/scrcpy/issues/432>",False
751600a7f99fb9910e96f0f29be427622c932441,2019-02-16 19:58:56,Romain Vimont,"Move all compat ifdefs definitions to compat.h

This allows to give a proper name to features requirements.",False
3fc11ee4650421c6b79c29362d35bc9e76565e5e,2019-02-16 05:37:15,Romain Vimont,Update links to v1.7 in README and BUILD,False
b7472a545e82d178d677400b348dd92514b61d78,2019-02-16 05:23:19,Romain Vimont,Bump version to 1.7,False
f5f4e6b1c5f8a07fa53c27bf81f02b8bf0380e92,2019-02-16 05:23:12,Romain Vimont,"Allocate extradata with av_malloc()

The extradata buffer is owned by libav, so it must be allocated with
av_malloc(), not SDL_malloc().

This fixes a crash on Windows during avformat_free_context().",False
6c40dbd27dbc5c3e9b6904eda4c9283f54374007,2019-02-10 19:03:59,Romain Vimont,Regroup Windows-ifdefs in command.h,False
477c0a2cabbe59f9c9617a14c5d841be95dfe9c6,2019-02-10 17:38:28,Romain Vimont,"Create process with wide chars on Windows

Windows does not support UTF-8, so pushing a file with non-ASCII
characters failed.

Convert the UTF-8 command line to a wide characters string and call
CreateProcessW().

Fixes <https://github.com/Genymobile/scrcpy/issues/422>",False
c0b65b14df0e55063b0c79f0462579905a2123ab,2019-02-10 16:53:47,Romain Vimont,Merge branch 'master' into dev,True
b23cacfc1abd65f01022fda5b590059b3c4b29b7,2019-02-10 15:59:34,Romain Vimont,"Add recording logs

Log when recording is started and stopped.",False
0ed23739529b3651c640a75a065d081ac9f4d588,2019-02-09 20:26:24,Romain Vimont,"Support recording to MKV

Implement recording to Matroska files.

The format to use is determined by the option -F/--record-format if set,
or by the file extension ("".mp4"" or "".mkv"").",False
1aaad6ba35701f85d2500b0a23c573b2ee9ae62e,2019-02-09 20:21:18,Romain Vimont,"Rescale packet timestamp to container time base

Some containers force their own time base. For example, matroska
overwrite time_base to (AVRational) {1, 1000}.

Therefore, rescale our packet timestamps to the output stream time base.

Suggested-by: Steve Lhomme <robux4@ycbcr.xyz>",False
c8f0805b899bbe90f25101697ac05088d70c49fb,2019-02-09 20:20:24,Romain Vimont,"Write header file with correct extradata

When recording, the header must be written with extradata set to the
content of the very first packet.

Suggested-by: Steve Lhomme <robux4@ycbcr.xyz>

Fixes <https://github.com/Genymobile/scrcpy/issues/351>
Fixes <https://github.com/Genymobile/scrcpy/issues/416>",False
ee3cba57a82ab04767b3d0e2637e2397584bff62,2019-02-09 16:57:13,Romain Vimont,"Forward FFmpeg logs

FFmpeg logs can be useful to understand the cause of issues.",False
c11905b8606f257b9c1e421ef755c7240fcb036f,2019-02-09 16:57:13,Romain Vimont,"Add log verbose macro

This was the only log priority missing.",False
1a5ba5950413136bd5b96052c7eb8313994dbc07,2019-02-09 16:57:13,Romain Vimont,"Fix memory leak on close

The buffer associated to the AVIOContext must be freed.",False
aa07dfd2ca8d6d7f69657ab836742971bf28678d,2019-01-27 18:39:19,Romain Vimont,"Merge pull request #412 from npes87184/dev

app: add always_on_top",True
eca82e09c3d3127cab247bfd94795da887a547cc,2019-01-27 18:24:24,Yu-Chen Lin,"app: add always_on_top

It is very convenient when I play mobile game and watch video at the
same time.

Tested on Linux mint Cinnamon as well as Windows 10.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
eea478b9dc357561ae10f2937985402d374d6dc1,2019-01-26 20:01:14,Romain Vimont,"Add release script

Add a script to generate the whole release properly.

It first builds locally in release mode, then execute tests. Then it
builds archives for Windows. Finally, it puts all release files (Windows
archives, prebuilt server and checksums) in a separate release
directory.",False
43ad402356f411a56a3dbba486fa6a0ab070ae2e,2019-01-26 17:52:42,Romain Vimont,"Merge pull request #411 from npes87184/master

tests: fix test_control_event_serialize",True
4d30fa93ba80591d5d23cbd1627cc774ddf72351,2019-01-26 17:39:32,Yu-Chen Lin,"tests: fix test_control_event_serialize

commit fefb9816a changed the protocol, fix the related testing case.

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
b35733edb6df2a00b6af9b1c98627d344c377963,2019-01-22 14:17:26,Romain Vimont,"Fix expected mouse event sizes

Commit fefb9816a99e6f8fa59befcfb70ba87112f90a8d modified mouse events
serialization. The server-side parsing was updated to correctly read the
position, but the expected size of these events was not updated.

As a result, the server might try to parse incomplete events, leading
to BufferUnderflowException.

Fixes
<https://github.com/Genymobile/scrcpy/issues/350#issuecomment-456298816>.",False
7764a836f1ee02a4540cfc4118c20729018daaac,2019-01-22 14:08:51,Romain Vimont,"Fix incorrect comment

Comment had not been updated along with the code.",False
0bfaf7b7ff2532bc2bbde1ac1f5d836a6285e9f4,2019-01-21 02:35:32,Romain Vimont,Update links to v1.6 in README and BUILD,False
446c68237440e9832e4f72eff589362ad7529ad6,2019-01-21 02:05:42,Romain Vimont,Bump version to 1.6,False
3aacb7967dd618b14c91c3fee56b8769228d11d8,2019-01-20 02:10:55,Romain Vimont,Merge branch 'dev' into master,True
06a0bbbc71ccc51fe112af434797f03f50cd8abc,2019-01-19 22:44:05,Romain Vimont,"Update FFmpeg (4.1) for Windows

Include the last version of FFmpeg in Windows releases.",False
d71e036f3a16877f20299b87ae15fed7bbc3b382,2019-01-19 03:47:31,Romain Vimont,"Do not disable screensaver

Keep screensaver enabled while scrcpy is running.

Fixes <https://github.com/Genymobile/scrcpy/issues/380>.",False
b343a5dc59fae5653a7e57675d7e68d5f2fda1c9,2019-01-18 18:04:41,Romain Vimont,"Merge pull request #401 from npes87184/dev

input_manager: don't ignore double click event when clicking inside device",True
c5ec1a194ca7b637bc4349236d2e3ed3d1ca1ed6,2019-01-18 17:51:25,Yu-Chen Lin,"input_manager: don't ignore double click event when clicking inside device

Signed-off-by: Yu-Chen Lin <npes87184@gmail.com>",False
4f254d8232c237d66b14fc2ef1d9d7cf53c59e2a,2019-01-17 01:46:04,Romain Vimont,"Merge pull request #396 from npes87184/master

prepare-dep: use variable for better readability",True
1fdde490fd2a0b89680a2b5da5e5274192398023,2019-01-16 18:51:18,Romain Vimont,"Mirror ""secure"" content

Some applications, like Silence, prevent the content of a window from
being viewed on non-secure displays:
<https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#FLAG_SECURE>

We can mirror it by just creating a ""secure"" display:
<https://developer.android.com/reference/android/view/Display#FLAG_SECURE>",False
fb73aa101a4e7e0568776c258cb91fb9343fecf3,2019-01-15 19:02:46,yuchenlin,"prepare-dep: use variable for better readability

The arguments are saved to variable when script started. Instead of
using $1, $2 and $3, we can use these variables.

Signed-off-by: yuchenlin <npes87184@gmail.com>",False
39c5e7160567af769d1b333c4b52d2da783d5c90,2019-01-15 01:42:23,Romain Vimont,"Make the server unlink itself

To clean up the device, the client executed ""adb shell rm"" once the
server was guaranteed to be started (after the connection succeeded).

This implied to track whether the installation state, and failed if an
additional tunnel was used in ""forward"" mode:
<https://github.com/Genymobile/scrcpy/issues/386#issuecomment-453936034>

Instead, make the server unlink itself on start.",False
fefb9816a99e6f8fa59befcfb70ba87112f90a8d,2018-11-27 13:29:22,Romain Vimont,"Handle mouse events outside device screen

Mouse events position were unsigned (so negative values could not be
handled properly).

To avoid issues with negative values, mouse events outside the device
screen were ignored (commit a7fe9ad779057f7a2698fc1769dce3c3786993ee).

But as a consequence, drag&drop were ""broken"" if the ""drop"" occurred
outside the device screen.

Instead, use signed 32-bits to store the position, and forward events
outside the device screen.

Fixes <https://github.com/Genymobile/scrcpy/issues/357>.",False
7830859c21d5033035f1054085f5d1d587a35cb6,2018-11-27 13:08:57,Romain Vimont,Merge branch 'master' into dev,True
0e019f8ab8f9176e99e162136fbc4b63e7a46f32,2018-11-25 15:59:27,Romain Vimont,Add a note to allow simulating input in README,False
f7d02cad4b3c7a48fe5770182b9e9a2d42bd9f56,2018-11-19 14:13:05,Romain Vimont,"Add ninja-build to the packages list to install

The package ninja-build should be installed automatically as a meson
dependency, but some users need to install a newer meson from pip3, so
ninja must be installed explicitly.",False
a7fe9ad779057f7a2698fc1769dce3c3786993ee,2018-11-19 02:01:57,Romain Vimont,"Ignore mouse events outside device screen

Never create a ""struct point"" with a position possibly outside the
device screen (i.e. in the black borders area), and do not transmit such
events.

This fixes an assertion failure on mouse wheel events outside the device
screen area.",False
1e22ebcac2719fe6a1fda73d8c3bc78fb202ed84,2018-11-16 23:09:41,Romain Vimont,"Always use non-empty arguments

The client passes parameters to the server via ""adb shell"" arguments.

Use ""-"" instead of """" when no crop is specified to avoid empty
arguments, which are not handled the same way on all devices.

Fixed <https://github.com/Genymobile/scrcpy/issues/337>.",False
d81729ba390228330df34680bdd668bf4d733f4b,2018-11-16 23:06:01,Romain Vimont,"Always expect 5 parameters for the server

The client always sends all the arguments, so there is no need to check.",False
b2c3df7550245721253323e7038a14e0822138fe,2018-11-16 01:41:58,Romain Vimont,"Point out that ninja must not be run as root

See https://github.com/Genymobile/scrcpy/issues/335.",False
46fec41b7b8b2954c7c476a43c0f083add9226f4,2018-11-14 01:09:18,Romain Vimont,"Move drag&drop features in README

Present how to install an APK and how to push a file in the ""features""
section (instead of ""shortcuts"").",False
2876463d394c3bc4dc239a605e65ebab75598353,2018-11-12 19:15:43,Romain Vimont,"Fix read_packet() return value on error or EOF

Fix warning on error or EOF:

> Invalid return value 0 for stream protocol

See <http://git.videolan.org/?p=ffmpeg.git;a=commitdiff;h=a606f27f4c610708fa96e35eed7b7537d3d8f712>.

Fixes <https://github.com/Genymobile/scrcpy/issues/333>.",False
6dc6ec05d54aa07299629a13db6f0f65cb219a3f,2018-11-12 18:40:21,Romain Vimont,"Configure version at meson project level

Make meson aware of the project version, so that it does not print:

    Project version: undefined",False
b5e630eea3a8ba63c5f37bee7f51e9754cbce68f,2018-11-12 13:22:45,Romain Vimont,"Update links to v1.5-fixversion

I forgot to bump version _before_ the release, so I had to make a new
one which fixes the version string (for scrcpy --help).",False
a17f1116ced777302563dd591d1405636102fb83,2018-11-12 12:54:18,Pierre Gordon,"Bump version to 1.5

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
e4cf152b264868d38a07b5396a613af9e7c43787,2018-11-12 04:05:47,Romain Vimont,Update links to v1.5 in README and BUILD,False
bd320166326898382fec93ceb0425f44590aa623,2018-11-12 02:10:05,Romain Vimont,Improve features presentation in README,False
77b620e1d005e7756ae4bd35b9ef201f8e444842,2018-11-12 02:09:38,Romain Vimont,"Merge branch 'record' into dev (#292)

Record screen to file",True
22ff03f2f793dafe6ff86f4c101f8f1d1555a551,2018-11-12 02:07:31,Romain Vimont,"Do not queue invalid PTS

Configuration packets produced by MediaCodec have no valid PTS, and do
not produce frame. Do not queue their (invalid) PTS not to break the
matching between frames and their PTS.",False
60afb46c8d4c3db6bb4d82bf00bc8741fa390713,2018-11-12 02:07:31,Romain Vimont,"Store queue of PTS for pending frames

Several frames may be read by read_packet() before they are consumed
(returned by av_read_frame()), so we need to store the PTS of frames in
order, so that the right PTS is assigned to the right frame.",False
345f8858d386d53a0af75b5d9a942717d53adfcf,2018-11-12 02:07:31,Romain Vimont,"Send frame meta only if recording is enabled

The client needs the PTS for each frame only if recording is enabled.
Otherwise, the PTS are not necessary, and the protocol is more
straighforward.",False
22bf0c19d6caecb972290e71a922e0653339abaf,2018-11-12 02:07:31,Romain Vimont,"Rename --output-file to --record

To record the screen to a local file:

    scrcpy --record file.mp4",False
70579dc7095582390e0a3297b04c61ff321eedd0,2018-11-12 02:07:31,Romain Vimont,"Wrap receiver state into separate struct

For readability, wrap the state of the receiver in a separate struct
receiver_state.",False
e562837c0b5ed77ea7f556ea9365cdeda789cd68,2018-11-12 02:07:31,Romain Vimont,"Avoid partial header reads

Use net_recv_all() to avoid partial reads for the ""meta"" header (this
would break the whole stream).",False
ebe998cf784a98402716f782551edb7099b333fd,2018-11-12 02:07:31,Romain Vimont,Move buffer reader functions to buffer_util.h,False
b98eb7d0fafd347704a6826d5996c59dd12ee301,2018-11-12 02:07:31,Romain Vimont,"Support AVStream.codec for old FFmpeg versions

AVStream.codec has been deprecated in favor of AVStream.codecpar.

Due to the FFmpeg/Libav split, this happened in two separate versions:
 - 57.33.100 for FFmpeg
 - 57.5.0 for Libav",False
e361b49b4acb9c66a60776d8d7bce6b5a399e157,2018-11-12 02:07:31,yuchenlin,"recorder: use av_oformat_next to support older FFmpeg

Signed-off-by: yuchenlin <npes87184@gmail.com>",False
d0e090e1f92f943c082c03fcb156db9052c0cc01,2018-11-12 02:07:31,Romain Vimont,"Reenable custom SDL signal handlers

This partially reverts commit f00c6c5b1321860eb6d590928448778ec8f43278.

On Ctrl+C, we need to execute cleanup code. For instance, if recording
is enabled, we need to write MP4 file trailer on exit.

Custom SDL signal handlers were disabled because it leaded to process
hanging on Ctrl+C during network calls on initialization, but now it
seems to work correctly, the network calls return immediately on signal.",False
475912a39c9caedda545972d405f88494ce12aa8,2018-11-12 02:07:31,Romain Vimont,"Do not transmit MediaCodec flags

Since PTS handling has been fixed, the recorder do not associate a PTS
to a wrong frame anymore, so PTS of ""configuration packets"" (which never
produce a frame), are never read by the recorder. Therefore, there is no
need to ignore them explicitly, so we can remove the MediaCodec flags
completely.",False
27e8a9a79d7ba06181daa497456f5a11261655e3,2018-11-12 02:07:31,Romain Vimont,"Assign PTS to the right frame

The PTS was read from the socket and set as the current one even before
the frame was consumed, so it could be assigned to the previous frame
""in advance"".

Store the PTS for the current frame and the last PTS read from the
packet header of the next frame in separate fields.

As a side-effect, this fixes the warning on quit:

> Application provided invalid, non monotonically increasing dts to
> muxer in stream 0: 17164020 >= 17164020",False
61db5758613f26dd5295b023fb1e3fad67a48b60,2018-11-12 02:07:31,Romain Vimont,"Decode and push frame before recording

Handle display before recording, to reduce latency.",False
2cd99e72051fd91c6616743add7126c1c799f0e6,2018-11-12 02:07:26,Romain Vimont,"Only set valid PTS/DTS

When the PTS is valid, set both PTS and DTS to avoid FFmpeg warnings.

Since configuration packets have no PTS, do not record these packets.",False
27686e93615e31bd77f4fab3912d9a98a146aa9d,2018-11-11 21:00:23,Romain Vimont,"Add recorder

Implement recording in a separate ""class"".",False
d706c5df3991a35b5f98058bfd2f640bcef05ea7,2018-11-11 21:00:23,Ivan Gorinov,"Enable video output file, with pts set by server",False
b5c64c0f5a7060fa4639642cb703d349ef08aaec,2018-11-11 20:59:03,Romain Vimont,"Fix SDL 2.0.9 for Windows

Add missing version upgrade in cross_winXX.txt files.",False
a5787dccd62fe4ff9dc05d597d3aab06da717edd,2018-11-11 20:34:17,Romain Vimont,"Update SDL (2.0.9) for Windows

Include the last version of SDL in Windows releases.",False
cb3cf801c839141eb80070c40974c31503602eaf,2018-11-11 05:31:56,Romain Vimont,"Extract bit operations to buffer_util.h

Move util functions to a reusable separate header.",False
b1d2c2c6409f238b8774557d001bfeb5a1de9097,2018-11-11 04:38:41,Romain Vimont,"Explain how to install up-to-date meson

On Ubuntu 16.04, meson is 0.29, while scrcpy requires >= 0.37.

Explain how to install a newer version from pip3.",False
9160d465ece61dc088d542a94a0edaf4011cdfbf,2018-11-10 20:46:08,Romain Vimont,"Add feature test macro to declare kill()

Avoid the following warning on some systems:

> warning: implicit declaration of function 'kill'
> [-Wimplicit-function-declaration]",False
5c739874a413c2304a0389d84c1e4f69fb19211f,2018-11-09 20:40:44,Romain Vimont,"Fix memory leak on error

On decode error, unref the packet.",False
d061c309656b477dc9adbaf5813e99861d77520e,2018-11-01 20:49:07,Romain Vimont,"Replace Ctrl by Meta for volume shortcuts on MacOS

Ctrl+UP and Ctrl+DOWN are already used by the window manager on MacOS.

Use Cmd key instead (like on VLC).",False
5bf1261364707e9b27d271d0075cf9601ea2ee29,2018-11-01 20:49:07,Romain Vimont,"Refactor to support Meta in shortcuts

Move the Ctrl and Meta key down checks to each shortcut individually, so
that we can add a shortcut involving Meta.",False
facbbced9ed9a812689253f994c1d7172f9816ad,2018-10-27 18:19:00,Romain Vimont,"Merge pull request #310 from npes87184/master

fix text memory leak",True
96056e3213b9f142cc39672186290b7495c1e0dd,2018-10-27 17:37:22,yuchenlin,"input_manager: fix potential memory leak on text

Fix potential memory leak when controller_push_event failed.

Signed-off-by: yuchenlin <npes87184@gmail.com>",False
0b92b9335821cf4536565289efc1c943b5a6dd64,2018-10-24 22:38:36,Romain Vimont,"Capture Alt and Meta keys

Alt and Meta keys should not be forwarded to the device. For now, they
are not used for shortcuts, but they could be.",False
c20245630ed946340be76b1e6c6e937beaa77bd5,2018-10-21 22:27:06,Romain Vimont,"Factorize Windows command building

Extract command line building to a separate method.",False
b882322f7371b16acd53677c4a3adbaaed0aef77,2018-10-09 12:13:17,Romain Vimont,"Work around Os.write() not updating position

ByteBuffer position is not updated as expected by Os.write() on old
Android versions. Count the remaining bytes manually.

Fixes <https://github.com/Genymobile/scrcpy/issues/291>.",False
887595592167c09a7c44ce8754f97f4475ae26c6,2018-10-05 00:31:23,Romain Vimont,"Support paths containing spaces on Windows

Quote the arguments of ""adb push"" to support paths which contain spaces
on Windows.

Fixes <https://github.com/Genymobile/scrcpy/issues/288>.",False
ff4430b2a397ecb5064f2a1aec0af725af27ce9b,2018-10-04 20:34:20,Romain Vimont,"Declare fun(void) functions with no parameters

This is not C++.",False
cea176c210661f856bf2ac764f3d0794c8f2c47e,2018-10-04 03:43:28,Romain Vimont,Update links to v1.4 in README and BUILD,False
f613752606d56241a1eb4e771157b78e5ce7fdb6,2018-10-04 02:48:37,Romain Vimont,"Update platform-tools (28.0.1) for Windows

Include the latest version of adb in Windows releases.",False
24d107d017cd297965f1e86d49c8e58b6d38a762,2018-10-04 02:33:27,Romain Vimont,Bump version to 1.4,False
66d1f81f56d62f6ca625c6d4af6a1fa2e985bb38,2018-10-04 02:32:09,Romain Vimont,Merge branch 'master' into dev,True
411aa4fcfd6ed245252be29660777f9c286448ec,2018-10-04 01:37:09,Romain Vimont,"Handle alpha and space chars as raw events

To handle special chars, text is handled as text input instead of key
events. However, this breaks the separation of DOWN and UP key events.

As a compromise, send letters and space as key events, to preserve
original DOWN/UP events, but send other text input events as text, to be
able to send ""special"" characters.

Fixes <https://github.com/Genymobile/scrcpy/issues/87>.

Suggested-by: pete1414
Suggested-by: King-Slide <kingslide@gmail.com>",False
78d5a4d8a139e9ff49e77b5ceb9458d4a08a2cd2,2018-09-20 01:39:52,Romain Vimont,Add link to Gentoo Ebuild in README,False
52e2c60190b5f18d08c1cf066caecd533b409f6c,2018-09-18 12:26:40,Romain Vimont,"Merge pull request #261 from npes87184/dev

prevent closing console right after process error in windows",True
140b1ef6a5f2de489f99c6f7f63dc2a49bc404f6,2018-09-14 18:04:59,yuchenlin,"prevent closing console right after process error in windows

Signed-off-by: yuchenlin <npes87184@gmail.com>",False
eca99d5af7d27115bb232f01826d3c5fc4fedd47,2018-09-13 19:57:19,Romain Vimont,Fix header guard name,False
6a1fb070f78a4c89bd11a290fedd4bf2585ae221,2018-09-09 18:58:56,Romain Vimont,"Merge branch 'npes87184:dev' into dev (#254)

Return specific error for missing adb binary on Windows",True
27bed948d4ddfffbb6ea5ad80a2a58394fa96b75,2018-09-09 18:58:25,yuchenlin,"Use specific error for missing binary on Windows

Signed-off-by: yuchenlin <npes87184@gmail.com>
Signed-off-by: Romain Vimont <rom@rom1v.com>",False
66def38b734829170654647086bd76f99efdec70,2018-09-09 18:35:06,Romain Vimont,"Avoid additional buffer copy in userspace

Directly send the data from MediaCodec buffers to the LocalSocket,
without an intermediate copy in userspace.",False
a60aef5aaf714fbb4d1e41057c512c29428f3a39,2018-09-04 22:21:56,Romain Vimont,"Merge branch 'philippsandhaus:master' into dev (#252)

Added new command line parameter to start in fullscreen",True
28015c3ee460eec477dccba80c9063ef6fddcffe,2018-09-04 22:21:35,Romain Vimont,Present fullscreen option in README,False
af9808cf02c63c93ad82f1de111b7c85dc2e8d75,2018-09-04 22:21:32,Philipp Sandhaus,"Add option to start in fullscreen

Signed-off-by: Romain Vimont <rom@rom1v.com>",False
34550311be8d8d466d5282fdea99ef0816e46de4,2018-09-04 22:13:17,Romain Vimont,"Merge branch 'npes87184:dev' into dev (#236)

check adb runnable before starting scrcpy",True
55d33ddd5fb0b559eed33d8f47d9b07a2456979a,2018-09-04 12:27:07,Romain Vimont,"Do not handle system-specific values in command.c

The common command.c handled process errors from system-specific int
values (errno).

Rather, expose a new enum process_result to handle error cause in a
generic way.",False
6d2d803003c231df9df3343eb73edf97d9ac3c76,2018-09-04 12:16:17,yuchenlin,"Notify adb missing

There are many user who encounters missing adb.
To stop things happens again, we check it and show
sexy response to user.

Signed-off-by: yuchenlin <npes87184@gmail.com>",False
fdbb725436a016f2df903819a095b77d78d6e470,2018-08-20 18:30:01,Romain Vimont,Add link to FLAG_SECURE in FAQ,False
ce6e5d1969185ff367eca8ac5e352aa16f20d13b,2018-08-17 23:21:25,Romain Vimont,"Explain how to install adb on Mac OS

The package scrcpy from Homebrew does not install adb.",False
963890e9c2fe6eac4b8608f9a2e817ae6bfbc36c,2018-08-17 21:27:08,Romain Vimont,"Separate build instructions from README

README included build instructions, which made it complicated to follow.
Move the build instructions to a separate file (BUILD.md).",False
3b5e54278ece2edbff2d8823395274f9d3fc7c16,2018-08-15 23:00:02,Romain Vimont,"Update FFmpeg (4.0.2) for Windows

Include the last version of FFmpeg in Windows releases.",False
dd3ba685e4a21ff8db8cdcee65acfa1793a485e8,2018-08-15 23:00:02,Romain Vimont,"Update platform-tools (28.0.0) for Windows

Include the last version of adb in Windows releases.

Fixes <https://github.com/Genymobile/scrcpy/issues/224>.",False
89e02036821a83635a71cf90162d713411530671,2018-08-15 23:00:02,Romain Vimont,"Add missing include for lock_util.h

lock_util.c did not include lock_util.h. This was catched by the gcc
option -Wmissing-prototypes.",False
536b31829ab400277c30088c3b61827ebb99ca03,2018-08-15 23:00:01,Romain Vimont,"Separate multi-words filenames by '_'

Rename foobar.ext to foo_bar.ext.

<https://github.com/Genymobile/scrcpy/pull/226#discussion_r209454865>",False
f3f704d1ed574477c744e01ae14673cca111d24e,2018-08-15 20:49:32,Romain Vimont,"Document ""push file"" feature

Document how to push a file to /sdcard/ in the shortcuts list.",False
6581f9feb9e0b4cc0c33bca15492166b0c8e0702,2018-08-15 20:49:32,Romain Vimont,"Make request_queue functions static

These functions are local to file_handler.c.",False
359685b1db8f355a6d7ade3a99989b03558ff907,2018-08-15 20:49:32,Romain Vimont,"Simplify SDL_assert() calls

SDL_assert() already prevents ""unused variable"" warnings.",False
4527be4cde9fddfd8debcb2bcc15d81e52512ca6,2018-08-15 20:49:32,Romain Vimont,"Add missing include config.h

When config.h is not included, BUILD_DEBUG is not set.",False
92d1aff85fd18a96918bcc8fd1ecae03444aaa71,2018-08-15 20:48:15,Romain Vimont,"Merge branch 'npes87184:push_file_to_sdcard' into dev (#226)

support drag & drop file to device /sdcard",True
66f45f9dae6a9c1a6845c4c87377c9bc235edd7f,2018-08-15 20:42:10,npes87184,"Support drag&drop a file to transfer it to device

Signed-off-by: npes87184 <npes87184@gmail.com>",False
aa97eed24b7571c1c30026528eceba15f382a862,2018-08-15 20:41:41,npes87184,"installer -> file_handler

Signed-off-by: npes87184 <npes87184@gmail.com>",False
2daeb1fd5fd98cacd2ae394e92fe900f7325afde,2018-08-15 20:40:07,Romain Vimont,"Reset current installer process

The current_process field was never reset after an installation is
complete. As a consequence, installer_stop() attempted to terminate it,
leading to a warning, at best.",False
cde0b3d248012f72a32a7a837124d77acd415dbc,2018-08-15 17:50:45,Grief,"Return non-zero value on connection loss

Make scrscpy to return 0 exit code only in case when the user closes its
app, otherwise, i.e. in case of connection loss, return 1.",False
6fa209fa821275cf14671b083854670897f36837,2018-08-12 19:05:29,Romain Vimont,"Remove AINPUT_SOURCE_ANY value

In the Android input header file, an enum has a value taking more than
31 bits, leading to the following warning:

    ISO C restricts enumerator values to range of ‘int’

Since we don't use it, remove it.",False
b37c0f6cd628a46cb41c879255fc33611be52b10,2018-08-12 19:05:25,Romain Vimont,Replace Uint32 by int to fix warnings in tinyxpm,False
c4a1fc746b8cd88a1565f2e768f25e174620a37f,2018-08-12 18:51:30,Romain Vimont,"Explicitly use ISO C11

ISO C99 doesn't support unnamed structs/unions.",False
a3ab92226d96669e10b659bf559e50e64fe4a205,2018-08-12 18:27:36,npes87184,"Destroy mutex if strdup failed

Signed-off-by: npes87184 <npes87184@gmail.com>",False
ec66b3be82f0a42a0474045db4c2aece6443c61c,2018-08-12 18:26:13,Romain Vimont,"Merge pull request #225 from npes87184/master

remove redundant semicolon",True
f8ef4f1cf77584541a001c9e22f5add32f71ded4,2018-08-11 18:46:36,npes87184,"remove redundant semicolon

Signed-off-by: npes87184 <npes87184@gmail.com>",False
9e683b7daccd3c92996693c5204040728e7a4c5c,2018-08-09 22:56:31,Romain Vimont,Update links to v1.3 in README,False
7e42358a7b4319265d1f9b931ab965a3f8d27c55,2018-08-09 22:44:17,Romain Vimont,Bump version to 1.3,False
caa9e30004bcbbb5e063352e9106c5c430b02c08,2018-08-09 22:42:27,Romain Vimont,"Add crop feature

Add an option to crop the screen on the server. This allows to mirror
only part of the device screen.",False
e85010fbc2754168d7e999f046feeae9e1a701ad,2018-08-09 21:53:38,Romain Vimont,"Move annotation comment

This confused the Android Studio code formatter.",False
820cd2bb541431ebb5a463c948dc952dddc3ed5a,2018-08-09 21:52:52,Romain Vimont,"Extract video size computation

One method, one thing.",False
8793c104ee35647233cc308f43ed56dda9e16f92,2018-08-09 21:52:42,Romain Vimont,"Increase ""adb forward"" connection attempts

5 seconds might not be sufficient:
<https://github.com/Genymobile/scrcpy/issues/213>

Increase to 10 seconds (it does not harm).",False
fca806e0954b43cfb2a6b21e66cc9286b713b6a2,2018-08-09 21:48:22,Romain Vimont,"Do not call deprecated av_register_all()

av_register_all() is deprecated in FFmpeg since this commit:
<http://git.videolan.org/?p=ffmpeg.git;a=commitdiff;h=0694d8702421e7aff1340038559c438b61bb30dd>

It is now useless to call it:
<https://ffmpeg.org/pipermail/ffmpeg-devel/2018-February/225051.html>

Fixes <https://github.com/Genymobile/scrcpy/issues/203>.",False
280891837e8855499df0499c8078cdf694b71ccd,2018-07-16 20:43:36,Romain Vimont,"Simplify README for Windows users

So that users stop downloading platform-tools unnecessarily.",False
49b2e63d13ad408925924f118d921825a5f33437,2018-06-25 01:21:54,Romain Vimont,"Forward repeated volume events

Send repeated events when holding volume up/down shortcuts.",False
c12c64ed412cb1f4eded19c2c5f5c8258c7f54d2,2018-06-25 01:20:53,Romain Vimont,"Send separate DOWN/UP key events

Shortcuts generated instant DOWN/UP key events. Instead, generate DOWN
event on Ctrl+key down and UP event on Ctrl+key up.

Fixes <https://github.com/Genymobile/scrcpy/issues/166>.",False
2f66acd75dc490adea096407b8889c7f1f2705ef,2018-06-25 00:16:14,Romain Vimont,"Improve English comment

Replace ""implying"" by ""involving"" (both ""impliquant"" in French).",False
1846d2f078a61650c3ed97bcb50507393ef87103,2018-06-22 23:26:58,Romain Vimont,"Prevent killing unexpected process

A missing initialization (fixed by the previous commit) leaded to kill
unexpected process.

In order to prevent consequences of similar errors in the future, never
call kill() with a non-positive PID.

See <https://github.com/Genymobile/scrcpy/issues/182>.",False
1a0139321b86cb42df66b134868643a0b572cecc,2018-06-22 22:05:58,Romain Vimont,"Fix missing installer initialization

The current_process field of struct installer was not initialized.
Since the installer instance is static, its default value was 0.

The call to installer_stop() then called kill(0, SIGTERM) (on Linux),
which sent SIGTERM to every process in the process group. In particular,
the scrcpy process was killed.

As a consequence, the last cleanup steps, like disabling ""show touches"",
were not executed.

Fixes <https://github.com/Genymobile/scrcpy/issues/183>.",False
8890750681577816f3072b051f6330cdec2c52ad,2018-06-08 11:38:00,Romain Vimont,"Merge pull request #169 from zopelee/master

Fix meson error: ‘for’ loop initial declarations are only allowed in …",True
aac9d5057fd2783faf8abb5a855873127ab3d466,2018-06-08 09:51:04,zack,Fix meson error: ‘for’ loop initial declarations are only allowed in C99 mode.,False
f705a73149e37cd075b1d9fd41d8eac2451aa26d,2018-06-06 00:15:41,Romain Vimont,"Use a meson option to crossbuild for Windows

Meson decided to crossbuild for Windows as soon as
meson.is_cross_build() returned true. This made non-Windows crossbuilds
fail.

Instead, add an explicit option ""crossbuild_windows"".

Fixes <https://github.com/Genymobile/scrcpy/issues/165>.",False
27a9bd342403cfeaeb1174da49c00d7ff46cb42f,2018-06-06 00:12:35,Romain Vimont,"Fix clean recipe in cross Makefile

Make the ""clean"" recipe also remove the noconsole build directories.",False
cf121a0f65e53a6daefb07ae4fb70d9a4b3ed347,2018-06-06 00:03:37,Romain Vimont,Upgrade gradle,False
c8a5f9dc63e9a3aa394a2a9eeb9d2690e3e068a1,2018-05-29 02:22:52,Romain Vimont,Update links to v1.2 in README,False
8106bb8215bb8cf1debb007c0c1fe67f3843a3c7,2018-05-29 02:02:14,Romain Vimont,Bump version to 1.2,False
f1b3a403752c2a86e789c31fd358613640e746d9,2018-05-29 02:02:14,Romain Vimont,"Rename SHA256SUM to SHA256SUMS

It contains the checksums for several files.",False
a63dd47f2d8e93fd7bdc048593f75333f1538448,2018-05-29 01:58:20,Romain Vimont,"Make CreateProcess() flags depend on ""noconsole""

On Windows, display the output of external commands (adb) when a console
is available.",False
6b4bbb1fb33393ea985c89ef4ebceea8fc791cbc,2018-05-29 00:15:54,Romain Vimont,"Update README and FAQ for the new Windows releases

Document how to generate a Windows release from Linux.

It solves the ""no output"" issue on Windows, so update the FAQ.",False
aedc2c2da956a0fbbee1f434bb7daa6fd2e284f5,2018-05-29 00:15:54,Romain Vimont,"Also build ""noconsole"" binary for Windows

On Windows, an application is either console or gui, it cannot be both.

Scrcpy should be both: it outputs important information to console, but
we still want to be able to ignore the console and launch it without a
visible cmd.exe window.

Therefore, build two binaries:
 - scrcpy.exe
 - scrcpy-noconsole.exe",False
106b87a4d2459ae881ab89b987cc9347a843a4ea,2018-05-29 00:15:54,Romain Vimont,"Add cross-compilation scripts for Windows

Build the Windows binary from mingw on Linux, using the official
prebuilt binaries for ffmpeg, SDL2 and adb.

MSYS2 and all its packaged dll are not necessary anymore.",False
7d68316f458d98e0f91800291dda48b5c4b1164f,2018-05-29 00:15:54,Romain Vimont,Indicate that libs are included for Windows,False
e729b76176cd8ed669532662756f73db0d59bee2,2018-05-29 00:15:54,Romain Vimont,Indicate that scrcpy also works over TCP/IP,False
6274cc3767046aacc8082f9911a4a5081f293e19,2018-05-29 00:15:54,Romain Vimont,"Document APK drag & drop

Add the drag & drop shortcut for installing an APK file to the README
and the help.",False
9c6f9b24f98a19a17eaaa29f0dc47510446d6c01,2018-05-29 00:15:54,Romain Vimont,"Quote apk path on Windows

Windows will parse the string, so the local name must be quoted.",False
e2a2973990ecd31b8e4c1638eed3368a96a1e9c0,2018-05-29 00:15:54,Adonis Najimi,"Drag and drop to install apk files from computer

<https://github.com/Genymobile/scrcpy/pull/133>",False
41419a2e77558dc52f975c9923eab0560f4d91e1,2018-05-28 23:51:56,Romain Vimont,"Fix net_send_all() warning

If len is not positive, w could be returned uninitialized.",False
e3d0a59c80b85298dba2dbd4c5cc0695b80a1dd6,2018-05-28 23:51:50,Romain Vimont,"Fix proc_show_touches warning

In practice, proc_show_touches may not be used uninitialized, since it
checks the flag options->show_touches, but the compiler can't know that,
so initialize it to avoid the warning.",False
bb3a7f05ac4fe20ee0c5b1b1d1e6efa5fc7d8586,2018-05-26 18:44:46,Romain Vimont,"Release controller lock while processing events

Once the controller took a control event, release the mutex before
processing it, so that the main thread is not blocked to push a new
event.",False
ec0282304511456a88117a97b4bdba4075486080,2018-05-26 17:50:05,Romain Vimont,"Fix leak on server start error

Fail on SDL_strdup() failure, and free the duplicated serial on further
error.",False
435a7fe314aa315ea7ed74d39952d71ea0d708f7,2018-05-13 19:03:13,Romain Vimont,"Add missing includes

Include string.h and stdio.h explicitly.",False
78da66f126e80ba7bb272e4105c9fc73e11b0ab6,2018-04-08 16:11:51,Romain Vimont,Merge branch 'master' into dev,True
9aa88b6fc3724851c5728093b11eb8f1464a6e95,2018-04-08 16:10:05,Romain Vimont,"Map numpad ENTER key

Forward numpad ENTER key to the device.

Fixes <https://github.com/Genymobile/scrcpy/issues/117>.",False
f8ad7df3be5acea5ba0df740b4d3110412bddcfe,2018-04-05 05:33:26,Romain Vimont,"Add FAQ section about KWin crash

Link to the workaround to keep the compositor enabled while _scrcpy_ is
running.",False
0871bca9c72bf3e26dd7e75f72aa49644d1485b9,2018-04-04 14:20:12,Romain Vimont,"Avoid pointer arithmetic on ""void *""

Fix the following warning (with -Wpedantic enabled):

    pointer of type ‘void *’ used in arithmetic [-Wpointer-arith]",False
b2b5404883a139b980707c9fc166a33b88689ffb,2018-04-04 14:20:07,Romain Vimont,"Use const pointers when possible

Sending data only require to read the input buffer, so declare it const.",False
1bddb80b5f168611c4e2cbeab716c967184f6da3,2018-04-03 17:55:11,Romain Vimont,"Change volume shortcuts

I could not make Ctrl+'+' and Ctrl+'-' work for every keyboard on every
platform.

Instead, use Ctrl+UP and Ctrl+DOWN (like in VLC) to change the volume.

Fixes <https://github.com/Genymobile/scrcpy/issues/103>.",False
6323f3974ffb434940b48ba7f916f5398f1fcaba,2018-03-31 14:37:25,Romain Vimont,"Document 32 bits packages Windows in README

To build for Windows 32 bits, use the i686 packages instead.",False
16a3de17967d5673d98b5aeb702fc4d1911c1307,2018-03-29 01:35:34,Romain Vimont,"Make checkstyle happy

Reorder the imports to remove checkstyle warnings.",False
6161f7688cc8467efa24ee4bdb170c2fcab6f534,2018-03-28 17:44:56,Romain Vimont,"Install on macOS via Homebrew in README

The application is now packaged for Homebrew:
<https://github.com/Homebrew/homebrew-core/pull/25173>

Give instructions to install it from Homebrew for macOS (it's much
easier).

Thanks to @stek29 for the formula ;-)",False
2a02fb361117df105b7cbff60b907725b7aa3228,2018-03-28 14:38:01,Romain Vimont,"Document how to make a portable build on Windows

On MSYS2, ./gradlew does not work as expected, so use its absolute path.",False
71f50fb69774e3d871db6a2d04961a95bb3ffe7d,2018-03-28 14:15:23,Romain Vimont,Merge branch 'master' into dev,True
82efff34e8bcb9d5c4089dbee7f58af965a61778,2018-03-27 14:31:40,Romain Vimont,"Factorize texture creation

SDL_CreateTexture() is called both during initialization and on frame
size change.

To avoid inconsistent changes to arguments value, factorize them to a
single function create_texture().",False
860006e082545a766dde222d6c8cb2754ff987f1,2018-03-26 18:19:10,Romain Vimont,"Forward double-click events

Double-clicks were not sent to the device anymore since the
""double-click on black borders"" feature.

When a double click occurs inside the device screen, send the event to
the device normally.

Fixes <https://github.com/Genymobile/scrcpy/issues/97>.",False
57eaf05289b6f3bed79a799db7ab18292e649878,2018-03-25 20:09:36,Romain Vimont,"Improve startup time when show_touches is enabled

Enabling ""show touches"" involves the execution of an adb command, which
takes some time.

In order to parallelize, execute the command as soon as possible, but
reap the process only once everything is initialized.",False
dd2a5c1ecf3fdcf26ef7123d30c934fa38c2d79f,2018-03-25 19:33:02,Romain Vimont,"Disable ""show touches"" once window is closed

If --show-touches is set, then the option must be disabled on quit.

Since it executes an adb command, it takes some time, so close the
window beforehand so that the close window button does not seem
unresponsive.",False
66ec2528930ef85d238152d95d9b220b70c94f11,2018-03-25 19:13:27,Romain Vimont,"Add an option to enable ""show touches""

Add -t/--show-touches option to show physical touches while scrcpy is
running.

See <https://github.com/Genymobile/scrcpy/issues/96>.",False
b13d25b9f4e4d09c5bb8f1b32be24af8ed511f77,2018-03-25 18:46:29,Romain Vimont,"Group scrcpy options into a struct

The scrcpy() function accepts as many parameters as there are options.

To simplify, group all options in a separate struct.",False
b449c09442bd89ef633910b8c43eb9fbc730c9c3,2018-03-25 18:46:19,Romain Vimont,Merge branch 'master' into dev,True
8b84492830ef5cf0f80778eca37523c2f4a8d5d5,2018-03-25 18:01:02,Romain Vimont,"Merge branch 'stek29/macos' (#56)

macOS specific README changes",True
4d50832f8ea71e2039092a83e2523b41c77a00e8,2018-03-25 17:59:22,Viktor Oreshkin,"Add instructions to install Java 8 on macOS

And remove gcc from the packages list, clang is available by default.",False
e0e8dfeb3b3e404fd2e554a08393ada0444f6d11,2018-03-25 17:42:29,Romain Vimont,"Merge pull request #94 from pierlon/pierlon-patch-1

Add instructions to run via Docker",True
f4d6449af792768f3d6ec07537f47f44e5c8fc90,2018-03-25 17:30:20,Romain Vimont,"Merge pull request #95 from Sea-n/patch-1

Update README.md",True
64963fff624ecd3ceaafb40679aa5f7aa29deadb,2018-03-25 15:21:29,Sean,"Update README.md

Fix Typo",False
b7d9b8739cff408b9964931ba11429c800f7be7d,2018-03-25 09:45:14,Pierre Gordon,Add instructions to run via Docker,False
88f6b43c8f031e203b006db4f07089ff9838d7c2,2018-03-24 13:56:12,Romain Vimont,"Merge pull request #93 from CampbellOwen/patch-1

Add links to FFmpeg and LibSDL2 dependencies",True
324a2642330e12249530fa77652f091445356298,2018-03-24 13:39:41,Owen Campbell,Change links to wikipedia,False
3bb2cda955590ed3c9e5227220efa1348d01b60e,2018-03-24 13:25:05,Owen Campbell,Add links to FFmpeg and LibSDL2 dependencies,False
35298bb0c60cdc6c55952de95ff7b92ff35130c7,2018-03-23 18:31:58,Romain Vimont,"Process the last video frame

On H.264 stream EOF, the eof_reached flag is set, but av_read_frame()
still provides a frame, so check the flag only afterwards.

As a side-effect, it also fixes a memory leak (the very last packet was
not unref).",False
73c332e3e4c3a4bcc6a23528f2ad050a67391e20,2018-03-23 18:27:32,Romain Vimont,Unref last packet on exit,False
15014f268931bd5bca39a50f80573bbe4b1a3a5e,2018-03-23 15:25:52,Romain Vimont,"Clarify adb requirements

Since _scrcpy_ also supports `adb forward`, remove the part about `adb
reverse`.

Make explicit that _adb_ is included in the prebuilt application for
Windows (many users manually download the platform-tools for no reason).",False
29b5c5b8f412ce70ba535e9e2506df67df0abd36,2018-03-23 14:43:19,Romain Vimont,"Merge branch 'arich/addShake' into dev (#85)

Add support for CTRL+S to send hardware ""shake"" to device",True
88ee6bc928e82a407a976665b1401cf23c3879df,2018-03-23 14:40:24,Romain Vimont,"Swap MENU and APP_SWITCH shortcuts

Ctrl+s was mapped to MENU, while Ctrl+m was mapped to APP_SWITCH.

To avoid confusion, swap the shortcuts:
 - Ctrl+m like _M_enu
 - Ctrl+s like _S_witch",False
35e9a64c34ff26fe302f814d1987a66dc348cda3,2018-03-23 14:37:48,Romain Vimont,"Rename ""shake"" to ""menu""

The action sends AKEYCODE_MENU, so just name it ""menu"".

See <https://github.com/Genymobile/scrcpy/pull/85>.",False
9cac38fe589070085b411859141e4af196154124,2018-03-23 14:27:45,Romain Vimont,"Describe workaround to get output on Windows

Since nothing is printed to the console, we need a way to get the output
in case of errors.

Describe how in the README.",False
301c52b6031f97370af76b009c434696111d567d,2018-03-23 04:45:24,Andy Rich,"Add support for CTRL+S to send hardware ""shake"" to device w/readme",False
f00c6c5b1321860eb6d590928448778ec8f43278,2018-03-22 02:13:12,Romain Vimont,"Disable custom SDL signal handlers

Request SDL not to replace the SIGINT and SIGTERM handlers, so that the
process is immediately terminated on Ctrl+C.

This avoids process hanging on Ctrl+C during network calls on
initialization.

Some of them accepted a timeout, but it was not used since
commit 9b056f5091ad0bc35cd0188cfcb887eb30269fef anymore.",False
3b3803da0d47592041fd2a29fa777f5a15275ef2,2018-03-21 15:44:15,Romain Vimont,"Remove useless blocks in switch/case

Remove unnecessary additional blocks.",False
f5cf6c1b2c49bc60e036e5700a6c3b0ebfa73f87,2018-03-21 02:02:41,Romain Vimont,"Include source root directory

All headers and sources are in src/. To avoid using relative includes
from subdirectories (""../../""), include the source root directory.",False
2573df9727767f423ef0be33993e27490ac25315,2018-03-18 16:40:06,Romain Vimont,"Document the step to clone the project

This is not obvious to everyone, especially non-developers.",False
c65cb36d3b32d9c4f42d7886a58c9c76a78732f5,2018-03-16 19:29:08,Romain Vimont,"Increase the number of connection attempts

In ""adb forward"" mode, it may take a while before the server socket is
listening, so increase the number of connection attempts.

See <https://github.com/Genymobile/scrcpy/issues/5#issuecomment-373718551>.",False
821ec9843c32410b5088ee86ada70e61db23e119,2018-03-16 13:28:59,Romain Vimont,"Fix win32 build

The types size_t and ssize_t are defined on Windows (in MSYS2), so there
is no need to typedef SIZE_T and SSIZE_T.

Exit code is ""unsigned long"" both on Windows 32 and 64 bits.

See <https://github.com/Genymobile/scrcpy/issues/46#issuecomment-373603596>.",False
f16bd8880249237a91b401ba9e1bcf0ee206209d,2018-03-15 21:00:51,Romain Vimont,"Remove useless cast

For consistency with mouse button events handling, directly assign from
Sint32 to Uint16.",False
f3e8834a3c7674d4b2fa9194bb8eec6807e50848,2018-03-15 20:44:40,Romain Vimont,"Fix warning message

Mouse ""wheel button"" is meaningless :)",False
080df5eb5d2734f414bb2d97d405ef548dbb6d08,2018-03-15 20:30:40,Romain Vimont,"Fix switch/case code style

For readability and consistency, indent case statatements, and remove
unnecessary additional blocks.",False
047179f232dcf7143e983f6c297111213b35589a,2018-03-15 13:59:14,Romain Vimont,"Add FAQ section about mouse clicks

On some devices, mouse clicks do not work by default. Enabling an option
is required.",False
2992dda4977ec568e2c8cfad0afc617fbe8e6415,2018-03-14 22:33:34,Romain Vimont,Add link to the article for v1.1 in README,False
6406f64edcc6138be4234f28355626a79ce09135,2018-03-14 14:26:36,Romain Vimont,"Update FAQ after v1.1 release

Two issues described in the FAQ have been fixed by V1.1. Remove them
from the FAQ.",False
f3f19d4e1d15309c5a49ae68b88cf9b1b5b40387,2018-03-14 14:23:55,Romain Vimont,Update links to v1.1 in README,False
d744837f1349f84e6f0dbfa0689f8025dd672e48,2018-03-14 14:04:00,Romain Vimont,Bump version to 1.1,False
f7bc0bd5b5a9cc6ef86b715656a55446e46667d8,2018-03-14 14:03:53,Romain Vimont,Merge branch 'dev' into release,True
8a3c6a3ae718e53aafc98f97014980a06307328d,2018-03-14 14:02:05,Romain Vimont,"Remove useless argument

Do not pass any data to the event watcher, it is unused.",False
c530d95881988d6d48d431e335c50286a53181d9,2018-03-14 13:58:25,Romain Vimont,"Immediately close the server socket on the device

In ""adb forward"" mode, close the server socket as soon as the client is
connected.

Even if unlikely to be useful, it allows to run several instances of
scrcpy also in ""adb forward"" mode.",False
0b1e59186f1fb75d74f2929f636128958b067ab4,2018-03-14 03:18:04,Romain Vimont,"Workaround continuous resizing on Windows/MacOS

On Windows and MacOS, resizing blocks the event loop, so resizing events
are not triggered:
 - <https://bugzilla.libsdl.org/show_bug.cgi?id=2077>
 - <https://stackoverflow.com/a/40693139/1987178>

As a workaround, register an event watcher to render the screen from
another thread.

Since the whole event loop is blocked during resizing, the screen
content is not refreshed (on Windows and MacOS) until resizing ends.",False
e69f6f710d14e6e42aacf6d27777fa5c34f43dae,2018-03-13 14:50:09,Romain Vimont,"Disable stdout/stderr buffering on Windows

In MSYS2 on Windows, the output is buffered by default. Disable
buffering to print output immediately.

Note that in cmd.exe, it still prints nothing.",False
b858204786bbcf9700e0bed2dc5b4ce7f07b2e6b,2018-03-13 13:07:46,Romain Vimont,"Remove black borders on double-click

Resize the window to fit the device screen on click on black borders
(same as Ctrl+x).

Suggested-by: Guillaume Roche <groche@genymobile.com>",False
e8510a8cc3f66d0ed9ee02631b5c789289c1f99a,2018-03-12 20:30:12,Romain Vimont,Add links to AUR packages in README,False
1038bad3850f18717a048a4d5c0f8110e54ee172,2018-03-12 18:40:32,Romain Vimont,"Make it work over tcpip

""adb reverse"" currently does not work over tcpip (i.e. on a device
connected by ""adb connect""):
<https://issuetracker.google.com/issues/37066218>

To work around the problem, if the call to ""adb reverse"" fails, then
fallback to ""adb forward"", and reverse the client/server roles.

Keep the ""adb reverse"" mode as the default because it does not involve
connection retries: when using ""adb forward"", the client must try to
connect successively until the server listens.

Due to the tunnel, every connect() will succeed, so the client must
attempt to read() to detect a connection failure. For this purpose, when
using the ""adb forward"" mode, the server initially writes a dummy byte,
read by the client.

Fixes <https://github.com/Genymobile/scrcpy/issues/5>.",False
2b3ed5bcdba63d30da427f324a7ab77c9a4b7937,2018-03-12 18:40:32,Romain Vimont,"Store serial in server instance

The serial is needed for many server actions, but this is an
implementation detail, so the caller should not have to provide it on
every call.

Instead, store the serial in the server instance on server_start().

This paves the way to implement the ""adb forward"" fallback properly.",False
9e328ef98b0fc730036aa389f33649a31737d0e3,2018-03-12 18:40:12,Romain Vimont,"Always use the best render scale quality available

Because why not.

See <https://wiki.libsdl.org/SDL_HINT_RENDER_SCALE_QUALITY>.",False
f9a63ec272a6051bd2f1a92a580640018124a34c,2018-03-12 14:07:46,Romain Vimont,"Reverse horizontal scrolling behavior

The SDL mouse wheel event seems inconsistent between horizontal and
vertical scrolling.

> Movements to the left generate negative x values and to the right
> generate positive x values. Movements down (scroll backward) generate
> negative y values and up (scroll forward) generate positive y values.

<https://wiki.libsdl.org/SDL_MouseWheelEvent#Remarks>

Reverse the horizontal.

Fixes <https://github.com/Genymobile/scrcpy/issues/49>.",False
f6d0893316c2c5f921c1d155668759096d84229f,2018-03-12 02:37:12,Romain Vimont,"Merge branch 'fedora_install' (pull request #29)

Document how to install on Fedora",True
ed65cd72fd2c0f895022118007dd694217f8056a,2018-03-12 02:36:15,Romain Vimont,"Use one subsection by distribution in README

Now that instructions are given for both Debian/Ubuntu and Fedora, use
subsections.",False
70599998ebd72f1765eed9120693fac4e48471b9,2018-03-12 02:36:15,Michael Gangolf,Document how to install on Fedora,False
e87cd175cc47a40a82698f9ff8221159e5ff95f2,2018-03-12 02:35:41,Romain Vimont,"Improve dependencies in README

Document server and client dependencies separately, to avoid unneeded
packages installation when building using the prebuilt server.

Also remove ""zip"", since it's only used for building a portable version
(which is not documented in README).",False
c075ad0a1e9e496bd2b0adf353d539933aa8c7ee,2018-03-11 18:41:43,Romain Vimont,"Fix mouse clicks on LG devices

Use default values (0) for some fields of PointerCoords so that mouse
clicks work correctly on LG devices.

Fixes <https://github.com/Genymobile/scrcpy/issues/18>.",False
dac7196bd61e6a4714e68b10f53f4ed5082b5b95,2018-03-11 18:39:25,Romain Vimont,"Support screens with dimensions not divisible by 8

The codec only supports dimensions which are multiple of 8.

Thus, when --max-size is specified, the value is always rounded down to
the nearest multiple of 8.

However, it was wrongly assumed that the physical size is always a
multiple of 8. To support such devices, also round down the physical
screen dimensions.

Fixes <https://github.com/Genymobile/scrcpy/issues/39>.",False
14b15ceb0637d1c48a7387b0fb14e98632746e9c,2018-03-11 15:10:46,Romain Vimont,Add a FAQ for common issues,False
b9bb4ff740b44dfef948df598c0c11b50268bb71,2018-03-10 21:01:17,Romain Vimont,"Merge branch 'sdushantha' (pull request #28)

Improve README syntax highlighting.",True
cc4a0152567d0c7e007de140089fa0e5e139d417,2018-03-10 20:54:03,Romain Vimont,"Add empty lines around code blocks

And fix spaces (do not randomly use non-breaking spaces for
indentation).",False
8476b4aab81c0591d1ed52404090a7f4f245eee7,2018-03-10 20:04:59,Siddharth Dushantha,"removed ""$"" and changed Mac OS ---> MacOS",False
a1491862e40430837d9496133028c69c047db188,2018-03-10 13:42:47,Siddharth Dushantha,"added ""$"" in front of terminal commands",False
c87d94ee2779838cf4576f6505a918bc485620d5,2018-03-10 05:14:19,Romain Vimont,"Map middle-click to HOME

Middle-click is useless in practice. Use it for HOME.",False
675704c71c0d105af2242d9bbeee83127097fa0d,2018-03-10 04:46:29,Romain Vimont,"Map right-click to BACK if screen is on

Right-click was used to turn the screen on. It did nothing when the
screen was already on.

Instead, in that case, press BACK (like Vysor).

Suggested by: <https://www.reddit.com/r/Android/comments/834zmr/introducing_scrcpy_an_app_to_display_and_control/dvfueft/>",False
9396ea6d422d6d8f35f2c898bcf621c4895cd9b9,2018-03-10 03:00:10,Romain Vimont,"Fix text input event segfault

The text input control_event was initially designed for mapping
SDL_TextInputEvent, limited to 32 characters.

For simplicity, the copy/paste feature was implemented using the same
control_event: it just sends the text to paste.

However, the pasted text might have a length breaking some assumptions:
 - on the client, the event max-size was smaller than the text
   max-length,
 - on the server, the raw buffer storing the events was smaller than the
   max event size.

Fix these inconsistencies, and encode the length on 2 bytes, to accept
more than 256 characters.

Fixes <https://github.com/Genymobile/scrcpy/issues/10>.",False
f9562f537ae9a1fa4949256d44f0ce9a06837edf,2018-03-09 02:06:04,Romain Vimont,"Unref the packet on error

Do not leak the packet data on error.",False
a34fbd23e99bc149f195888c6656c61e7274c7c9,2018-03-09 01:16:02,Romain Vimont,"Do not leak the packet data

Oops! The content of the packets were never freed.",False
e8b8a570e7b996ef3afe7abac9278e90291cd5dc,2018-03-08 19:23:18,Romain Vimont,"Document ./run script usage

Indicate how to run the app from the build directory in README. It's
convenient during development.",False
0e9a76c0c480fcb3b042f6133a4f27e39e38c784,2018-03-08 17:01:26,Romain Vimont,Add link to blog article in README,False
f9f305d19d1f36f02343868147fc7aa8046563cc,2018-03-08 16:04:54,Romain Vimont,Update release checksums in README,False
727d1ef1e2e89322d935eacc3a8ac09b0c39b1cd,2018-03-08 14:57:40,Romain Vimont,"Add developer documentation

And update README.",False
c2ac6fe7bdd65815e08c1f6830b925595e3888e9,2018-03-08 13:51:06,Romain Vimont,Upgrade version to 1.0,False
e2a7abcd5349fc986696edbd991575e0cd492231,2018-03-07 22:37:02,Romain Vimont,"Implement clipboard paste

Paste computer clipboard to the device on Ctrl+v.

The other direction (pasting the device clipboard to the computer) is
not implemented. It would require a communication channel from the
device to the computer, other than the socket used by the video stream.",False
e4d64e8752cf3fdf57a5bf1e34c02a7eccb5c6e6,2018-03-07 22:37:02,Romain Vimont,"Initialize struct field by field

Initializing with braces initializes the other fields to 0, which is not
necessary.",False
fffeedffdab2ed6ada1aceb3d2ab7b7f4a396917,2018-03-07 22:37:02,Romain Vimont,"Expose High DPI support configuration flag

The High DPI support is enabled by default, so that the renderer use the
full definition of High DPI screens.

However, there are still mouse coordinates problems on some MacOS having
High DPI support (but not all), so expose a way to disable it.",False
82b4acee73f16b7279470c651b166f193d420e80,2018-03-07 22:37:02,Romain Vimont,"Do not fail on EAGAIN

A call to avcodec_receive_frame() may return AVERROR(EAGAIN) if more
input is required. This is not an error, do not fail.",False
633b18d78645c08dc26a224582eef48ae86874cf,2018-03-07 22:37:02,Romain Vimont,"Provide a better URL to document key decomposition

Directly link to the relevant subsection.",False
ab780ce26db85235baf9e182f3d8aa0a9569d16a,2018-03-07 22:37:02,Romain Vimont,"Avoid useless variables initialization

Initialize variables only when necessary.",False
84ad6633a68d5ce340e53433c83bc696693e14a6,2018-03-07 22:37:01,Romain Vimont,"Move the new avcodec implementation before the old

The API to decode the video frames is different depending on the
libavcodec version.

Move the new API usage to the #if-block.",False
1b0cea61a5e19f8a0ccac2b0d0da6d374fd0ef67,2018-03-07 22:37:01,Romain Vimont,"Do not use return code for thread run function

The decoder sometimes returned a non-zero value on error, but not on
every path.

Since we never use the value, always return 0 at the end (like in the
controller).",False
42f6341a146b0870f18cefcfa3961bc03347e593,2018-03-07 22:36:43,Romain Vimont,"Revert ""Enable high dpi support""

Just enabling this flag breaks mouse location values.

This reverts commit 38b56f552e0667db60c7022d4a2713da8fb4e338.",False
acd2dc3183320d46dc15e5766200f2de437d3348,2018-03-07 22:34:39,Romain Vimont,"Shutdown sockets before closing

The server socket does not release the port it was listening for if we
just close it: we must also shutdown it.",False
db396f2138e9d3779f3d91c6f3d69d55fe46d8e9,2018-03-07 22:34:39,Romain Vimont,"Fix scroll wheel mouse position

SDL_MouseWheelEvent does not provide the mouse location, so we used
SDL_GetMouseState() to retrieve it.

Unfortunately, SDL_GetMouseState() returns a position expressed in the
window coordinate system while the position filled in SDL events are
expressed in the renderer coordinate system. As a consequence, the
scroll was not applied at the right position on the device.

Therefore, convert the coordinate system.

See <https://stackoverflow.com/questions/49111054/how-to-get-mouse-position-on-mouse-wheel-event>.",False
e6feb991dbd5d987e350f78906ea45ec7b3c67de,2018-03-07 22:34:38,Romain Vimont,"Fix comment typo

Replace ""at network level"" by ""at the network level"".",False
e3f5d3b49bb3c1a2cceea0a4eeeec466df7fd8c5,2018-03-07 22:34:38,Romain Vimont,"Double the default bitrate

Set the default video bitrate to 8Mbps. This greatly increase quality on
fast motion, without negative side effects.",False
a7979e4e74a7fdc1bb63b07bc0ecbcb262a0df4a,2018-03-07 22:34:38,Romain Vimont,"Rename rotation detection method name

The old name checkRotationChanged() did not suggest that the flag was
reset.",False
38b56f552e0667db60c7022d4a2713da8fb4e338,2018-03-07 22:34:38,Romain Vimont,"Enable high dpi support

Use high DPI if available.

Note that on Mac OS X, setting this flag is not sufficient:

> On Apple's OS X you must set the NSHighResolutionCapable Info.plist
> property to YES, otherwise you will not receive a High DPI OpenGL
> display.

<https://wiki.libsdl.org/SDL_CreateWindow#flags>",False
8ace3d17817196afdc5e440aa7ac296d996cb349,2018-03-07 22:34:38,Romain Vimont,"Update README

Explain how to build, install and run the application.",False
bae8263cdd08f7078722fcb5996a0e155c02614f,2018-02-28 21:32:15,Romain Vimont,Add Apache 2 LICENSE file,False
c78ad6377c71c1b7dc1a008a0af2e080d0c53a1a,2018-02-28 21:26:20,Romain Vimont,"Terminate the server on stop

On user request to quit, two kinds of blocking calls must be interrupted
on the server:
 1. the reads from and writes to the socket;
 2. the call to MediaCodec.dequeueOutputBuffer().

The former case was handled by calling shutdown() on the socket from the
client, but the latter was not managed.

There is no easy way to wake this call properly, so just terminate the
process from the client (i.e. send SIGTERM on Linux) instead.",False
b61310a25749dca717b0eed90620e6853e9f09c7,2018-02-28 20:10:52,Romain Vimont,"Initialize eof flag from BufferInfo

Stop encoding if the codec signaled the end of stream.

The eof flag was read, but never written.",False
221a7d08266c4a7ce4948ea209b9671be3085e73,2018-02-28 19:57:45,Romain Vimont,"Clean up the server from temporary folder

The server is copied to /data/local/tmp/scrcpy-server.jar and executed
on the device.

As soon as we are connected, we can unlink (rm) it from /data/local/tmp,
to keep the device clean.",False
08d32e3bae72d355a77fb72025a6e8ba481ac240,2018-02-28 19:35:49,Romain Vimont,"Clean up useless const-casts

The function adb_execute() now expects a ""const char *const *"" parameter
for the adb command, so there is no need to cast.",False
487cb10cf0d79e11c745578181513faa6e2069b1,2018-02-28 19:27:18,Romain Vimont,"Rename ScrCpyServer to Server

The Server class is in package scrcpy, there is no need to repeat the
name in the classname.",False
0d050d83b44af776d16d1848928c5752fee66805,2018-02-16 20:06:25,Romain Vimont,"Add missing .PHONY in portable Makefile

The recipe ""build-portable"" is also the name of the generated directory.
Add this name to the .PHONY list.",False
089378926b09252c111be15e336177c7f9fc652c,2018-02-16 20:06:25,Romain Vimont,"Rename SCRCPY_SERVER_JAR to SCRCPY_SERVER_PATH

The server is currently a JAR, but it may ba an APK or a DEX, so the
variable name should not contain the type.

Rename the environment variable, the Meson options and the C
definitions.",False
60f31851851f0d2297c4bd46140c60554b38b497,2018-02-16 20:06:25,Romain Vimont,"Reuse server address

Set SO_REUSEADDR flag to server socket, so that bind() does not fail if
we restart scrcpy immediately after we closed the previous one.",False
6db22ef339b511cf20e35b40f240a8412e20c2fb,2018-02-16 19:33:50,Romain Vimont,"Log socket errors

Do not silently ignore close() and shutdown() errors, and use perror()
to get the errno.",False
37af0c80765b01ed349f843032b2131690e0cd66,2018-02-16 18:43:13,Romain Vimont,"Terminate event controller thread on EOF

No exception was thrown on EOF, so the event controller did not
terminate. This leaded to a further InvocationTargetException.

Instead, terminate the event controller on EOF, so that the process
terminates properly.",False
ad6209f6ffb34e271f9b7cab3f6474871a173627,2018-02-16 16:17:42,Romain Vimont,"Terminate the device process gracefully

Call shutdown() on the device socket to make the device process finish
its execution quickly and gracefully, without killing it.",False
a791c272bc203796c390e76718195541f9ddc4d7,2018-02-16 05:27:48,Romain Vimont,"Send and recv all data when necessary

Expose net_recv_all() and net_send_all(), equivalent of net_recv() and
net_send(), but that waits/retries until the requested length has been
transferred.

Use these new functions where it was (wrongly) assumed that the
requested length had been transferred.",False
d646f95a314a164444d8aaf724a29ba9fcebcf64,2018-02-16 05:27:48,Romain Vimont,"Avoid division by 0

If the frame_size width or height is 0, just return the current size to
avoid calculations involving divison by 0.",False
27b9159b070f0da676f5a2c09b3ade6a074d9b72,2018-02-16 05:27:48,Romain Vimont,Cleanup old code comment,False
cf59d49d2566efac30b57d8bc1f6f62373d86ab5,2018-02-16 05:27:47,Romain Vimont,"Detect failure of device information read

If the received data is smaller than the device information size, then
something is wrong.",False
9b056f5091ad0bc35cd0188cfcb887eb30269fef,2018-02-16 05:26:58,Romain Vimont,"Replace SDL_net by custom implementation

SDL_net is not very suitable for scrcpy.

For example, SDLNet_TCP_Accept() is non-blocking, so we have to wrap it
by calling many SDL_Net-specific functions to make it blocking.

But above all, SDLNet_TCP_Open() is a server socket only when no IP is
provided; otherwise, it's a client socket. Therefore, it is not possible
to create a server socket bound to localhost, so it accepts connections
from anywhere.

This is a problem for scrcpy, because on start, the application listens
for nearly 1 second until it accepts the first connection, supposedly
from the device. If someone on the local network manages to connect to
the server socket first, then they can stream arbitrary H.264 video.
This may be troublesome, for example during a public presentation ;-)

Provide our own simplified API (net.h) instead, implemented for the
different platforms.",False
bf41e5479b12252b0903a1e777d21019c49d7419,2018-02-16 03:29:04,Romain Vimont,"Improve decoder stopped event

The syntax was correct, but less readable, and it unnecessarily zeroed
the fields other than ""type"".

Create the event properly, from a separate method.",False
518d6d5dcd7e0775c38613c0e4b4e185cdf93719,2018-02-16 03:12:37,Romain Vimont,"Prevent new window opening with CreateProcess()

Executing commands (like ""adb push"") created a new terminal window on
Windows. Avoid it.",False
e8cad790a44a1177f097cad2964e5ceeb71a807a,2018-02-15 18:34:48,Romain Vimont,"Reword Ctrl+x description

Pressing Ctrl+x resizes the window to remove black borders, ""optimal"" is
not well-defined.",False
5ebf31d4833a6863e1652d83b6c314d5f07542b8,2018-02-15 18:12:31,Romain Vimont,"Remove useless screen render on initialization

screen_render() should not be called on initialization:
 1. it is useless, since the window is hidden until the first frame;
 2. it writes an empty texture (probably green) to the renderer.",False
d97720222420eadbf8dd566b4c1fe1a718aba5da,2018-02-15 16:54:16,Romain Vimont,"Add Ctrl+i shortcut to enable/disable FPS counter

Disable FPS counter on start, and use Ctrl+i to enable/disable it.",False
000ced9ba8ec544667ff0e526d7bc8ea0d84c1ec,2018-02-15 16:37:47,Romain Vimont,"Refactor screencontrol to inputmanager

The ""screen control"" handled user input, which happened to be only
used to control the screen.

The controller and screen were passed to every function. Instead, group
them in a struct input_manager.

The purpose is to add a new shortcut to enable/disable FPS counter. This
feature is not related to ""screen control"", and will require access to
the ""frames"" instance.",False
fb0e46758564e9973b66536f9e4fed9be0a56a77,2018-02-15 15:58:19,Romain Vimont,"Add description for meson options

The descriptions are displayed in the result of:

    mesonconf builddir",False
42882702d7107a44a8ce67a4c0aa91dce8fd4382,2018-02-15 15:54:18,Romain Vimont,"Expose skip_frames as a build option

It can be initially configured by:

    meson builddir -Dskip_frames=false

Or on an existing builddir by:

    mesonconf builddir -Dskip_frames=false",False
38e6682875fd708089658c5c9a3086ddf2156acb,2018-02-15 15:52:48,Romain Vimont,"Add FPS counter

Remove frame counter from scrcpy.c and add a new FPS counter, logging as
INFO the measured frame rate every second (on new frame).",False
c6c17af84098372697d166ba232b090692b3e4c5,2018-02-14 23:31:26,Romain Vimont,"Do not print usage on command error

On error, a message is printed. If we print usage afterwards, it's easy
to miss it.",False
8697659890090a4e7b2788a9db898519f3098ebb,2018-02-14 23:27:29,Romain Vimont,"Expose device serial as an optional argument

The device serial was provided as a positional argument:

    scrcpy 0123456789abcdef

Instead, expose it as an optional argument, -s or --serial:

    scrcpy -s 0123456789abcdef

This avoids inconsistency between platforms when the positional
argument is passed before the options (which is undefined).",False
23d92a95b63493e8bf22b4b9aba269d00e0563f5,2018-02-14 23:23:16,Romain Vimont,"Extract argument parsing to specific functions

To avoid a big switch/case, implement the argument parsing logic in
separate static functions.",False
111068d733fa179277ac17f6b041c6bbeb3eacd5,2018-02-14 23:14:28,Romain Vimont,"Use SDL_bool return to indicate success

For clarity and consistency across the application, return SDL_TRUE
(instead of 0) on success and SDL_FALSE on failure (instead of
non-zero).",False
d3c76c004e926aa36b3417b2297c97b55fd6ff28,2018-02-14 23:09:46,Romain Vimont,"Sort parameters by letter

For readability, sort the command-line arguments parsing by letter.",False
9a07b694f104601a03966d565a20287d7806206d,2018-02-14 23:01:42,Romain Vimont,"Add run script

Add a script to simplify the execution of scrcpy generated in a specific
build directory.

To run scrcpy generated in builddir, with a video size of 1024:

    ./run builddir -m 1024",False
07983d914fe4fc4c3dbf3f84eb42c31ef3d47f86,2018-02-14 20:58:21,Romain Vimont,"Accept prebuilt server

Expose a 'prebuilt_server' option to pass the path of the prebuilt
binary, so that the build does not require Android SDK.

Usage:

    meson builddir -Dprebuilt_server=/tmp/my_prebuilt_server.jar",False
0efa9305ebb2d33b59b494928302459206872b3a,2018-02-14 18:33:56,Romain Vimont,"Require Meson 0.37

Older versions of Meson are too limited, and it's simple to install a
newer version (""pip3 install meson"").",False
4c49b27e9f6be02b8e63b508b60535426bd0291a,2018-02-14 18:33:56,Romain Vimont,"Always invoke gradle except as root

The custom target used to invoke Gradle from Meson should always
be built, otherwise, the server would not be rebuilt on source changes.

However, when enabling ""build_always"", gradle is invoked as root on
""sudo ninja install"" after ""ninja"", so it downloads the whole Gradle
world into /root/.gradle.

To avoid the problem, just do not call gradle if the effective user id
is 0.",False
c2127d08190bc9297bd1eb83968e1095d5392cb0,2018-02-14 18:33:56,Romain Vimont,"Replace meson subprojects by subdir

Since Meson 0.44, subproject_dir may not be '.' anymore. This implies we
must move app/ and server/ to a subprojects/ directory, which requires
to also change some gradle files.

Instead, just use subdir(), with options to disable building of the app
or the server.",False
ff94462d8ac6ef10e38f48f8131c29b56f4baf07,2018-02-14 13:53:14,Romain Vimont,"Refactor build system

The client was built with Meson, the server with Gradle, and were run by
a Makefile.

Add a Meson script for the server (which delegates to Gradle), and a
parent script to build and install both the client and the server to the
system, typically with:

    meson --buildtype release build
    cd build
    ninja
    sudo ninja install

In addition, use a separate Makefile to build a ""portable"" version of
the application (where the client expects the server to be in the
current directory). Typically:

    make release-portable
    cd dist/scrcpy
    ./scrcpy

This is especially useful for Windows builds, which are not ""installed"".",False
396df8a9d8425d272c2370ef72fd973ad8eb37d7,2018-02-13 14:54:02,Romain Vimont,"Provide config.h.in for old meson versions

The current meson version is able to generate a config.h from a
configuration data object without any template.

However, older versions of meson require a template, so provide it for
compatibility.",False
3ed80a1fac069ad584d3841c83eb9fd0f38926b2,2018-02-13 14:40:18,Romain Vimont,"Define macros wrappers for logs

Use macros to wrap SDL_Log* functions with the ""application"" category.",False
d45ef1a29518620723aa6a14fffe476c8d5a445c,2018-02-12 21:57:25,Romain Vimont,"Do not use too recent set_quoted()

Old versions of meson do not support set_quoted(). Replace the call by
the old-fashioned manual quotation.",False
a5b6c6cc2de9db8bb9b26e8eea82d44a60a2c774,2018-02-12 21:49:52,Romain Vimont,"Enable debug logs only for debug builds on server

Print the logs only if their level is not under the threshold, which is
defined to INFO in release mode and DEBUG in debug mode.",False
ad41bacb4827ab98508013d7008b7c5764b4efce,2018-02-12 21:05:23,Romain Vimont,"Fix ""terminate process"" on Windows

CloseHandle() does not terminate the process. TerminateProcess() does.",False
6fe65d9f5c9a3f099b57e780d11273a7acabf858,2018-02-12 20:39:34,Romain Vimont,"Log with category APPLICATION

All our logs should use APPLICATION category. The logs for other
categories are not printed by default under the ""critical"" level.",False
598ddcbfbcedeccddbff62448c3f268a91e32aad,2018-02-12 20:29:27,Romain Vimont,"Disable sanitizer on debug builds

On our Windows machine, the mingw ld.exe does not support sanitizers.

Exclude them from the default debug build.",False
4dbc450d011af2ad0ffbc6231dd5f2c9de63be26,2018-02-12 18:47:29,Romain Vimont,"Enable debug logs only for debug builds

In release mode, use the default log priorities.",False
2f3e00ed98a3dc3dfc055974697db507e9ee288c,2018-02-12 18:47:29,Romain Vimont,"Enable link-time optimization for release

Because why not.",False
000c70a64404807c3ad39fac0b359776571254ff,2018-02-12 18:47:10,Romain Vimont,"Decompose accented characters

Characters like 'é' or 'î' are not resolved by getEvents(). For example,
getEvents(""é"") returns null.

However, it is possible to decompose them. For example,
getEvents(""\u0301e"") returns the events generating ""é"".

Thank you Philippe! ;)",False
0fce4f95b94328c0ca56c9b7a17d033c2c7a3ee2,2018-02-09 20:51:10,Romain Vimont,"Properly clean up on exit

The SDL clean up does not crash anymore on exit, probably since the
memory corruption caused by calling SDLNet_TCP_Close() too early has
been resolved.",False
eb09fefd43178e43b93952ef5befb9a62693a89f,2018-02-09 20:51:10,Romain Vimont,"Timeout the server socket connection

Wait no more than 2 seconds for accepting the connection from the
device, since it blocks the event loop, preventing to react to SIGTERM
(Ctrl+C).",False
90a46b4c45637d083e877020d85ade52a9a5fa8e,2018-02-09 20:49:50,Romain Vimont,"Improve startup time

On startup, the client has to:
 1. listen on a port
 2. push and start the server to the device
 3. wait for the server to connect (accept)
 4. read device name and size
 5. initialize SDL
 6. initialize the window and renderer
 7. show the window

From the execution of the app_process command to start the server on the
device, to the execution of the java main method, it takes ~800ms. As a
consequence, step 3 also takes ~800ms on the client.

Once complete, the client initializes SDL, which takes ~500ms.

These two expensive actions are executed sequentially:

                     HOST              DEVICE
listen on port        |                  |
push/start the server |----------------->|| app_process loads the jar
accept the connection .   ^              ||
                      .   |              ||
                      .   | WASTE        ||
                      .   |  OF          ||
                      .   | TIME         ||
                      .   |              ||
                      .   |              ||
                      .   v              X execution of our java main
connection accepted   |<-----------------| connect to the host
init SDL             ||                  |
                     || ,----------------| send frames
                     || |,---------------|
                     || ||,--------------|
                     || |||,-------------|
                     || ||||,------------|
init window/renderer  | |||||,-----------|
display frames        |<++++++-----------|
(many frames skipped)

The rationale for step 3 occuring before step 5 is that initializing
SDL replaces the SIGTERM handler to receive the event in the event loop,
so pressing Ctrl+C during step 5 would not work (since it blocks the
event loop).

But this is not so important; let's parallelize the SDL initialization
with the app_process execution (we'll just add a timeout to the
connection):

                     HOST              DEVICE
listen on port        |                  |
push/start the server |----------------->||app_process loads the jar
init SDL             ||                  ||
                     ||                  ||
                     ||                  ||
                     ||                  ||
                     ||                  ||
                     ||                  ||
accept the connection .                  ||
                      .                  X execution of our java main
connection accepted   |<-----------------| connect to the host
init window/renderer  |                  |
display frames        |<-----------------| send frames
                      |<-----------------|

In addition, show the window only once the first frame is available to
avoid flickering (opening a black window for 100~200ms).

Note: the window and renderer are initialized after the connection is
accepted because they use the device information received from the
device.",False
063cfd13269dc30fb6f20745b6b2ab5364fb2e1b,2018-02-09 18:33:25,Romain Vimont,"Turn screen on in control()

Turning the screen on is semantically associated to control(): only
creating the EventController object should not turn the screen on.",False
523097eadf6fb276909df518ed1086ab427cee6b,2018-02-09 18:00:49,Romain Vimont,"Provide decoder_init()

Expose an initializer so that the caller does not have to guess what
fields must be initialized.",False
4662198261b133c52b93d449560c72d159d2bc2f,2018-02-09 17:29:36,Romain Vimont,"Do not release TCP sockets while still in use

SDLNet_TCP_Close() not only closes, but also release the resources.

Therefore, we must not close the socket if another thread attempts to
read it.

For that purpose, move socket closing from server_stop() to
server_destroy().",False
d658586d0d28c10f2b2f64e3b372a4c3199b692a,2018-02-09 16:42:07,Romain Vimont,"Enable sanitizer in debug builds

""make build-debug"" will build with ASAN and USAN enabled.",False
fe21d9dfb587cd7b831459755e58a9c3ac6c4e63,2018-02-09 15:44:47,Romain Vimont,"Move frame updating to screen.c

Replace screen_update() by a higher-level screen_update_frame() handling
the whole frame updating, so that scrcpy.c just call it without managing
implementation details.",False
7458d8271e89408c12b691f7440969771db11e31,2018-02-09 15:31:50,Romain Vimont,"Kill the server immediately on close

Do not wait 100ms anymore to let the server print any exception: we
justly want to ignore them.

Moreover, there is no nanosleep() on Windows, so this solve another
problem.",False
c683872bbcceb4063cfaf592ad02d149ad5d46bd,2018-02-09 15:29:15,Romain Vimont,"Avoid server stacktraces on close

On close, the socket is closed by the client, and the server process is
killed.

This leads to (expected) exceptions, that should not be printed.",False
2fdc368c419a2cd462eb0562cebb3f1bc05fa022,2018-02-09 14:27:23,Romain Vimont,"Do not try to decode video when EOF is reached

When the video stream socket is closed and read_packey() returns -1,
av_read_frame() still returns 0.

To detect EOF, check the flag eof_reached in the AVIOContext.

This avoids garbage errors on closing.",False
a8aa3d39b704451ee7077c54eae20c99a1f9dc6c,2018-02-09 14:13:58,Romain Vimont,"Send ""screen on"" command only on mouse down

Avoid to send the command twice, once on mouse down, once on mouse up.",False
127e56780a82fdc529428d4b13ffb5748b28716e,2018-02-09 14:11:05,Romain Vimont,"Fix deadlock on exit if SKIP_FRAMES disabled

On exit, the renderer will not consume frames anymore, so signal the
condition variable to wake up the decoder.",False
629c296207ea09cdf9820eefdb8d620fe1c7f0dd,2018-02-09 01:27:29,Romain Vimont,"Move frame swapping logic to frame.c

Expose frames_offer_decoded_frame() and frames_consume_rendered_frame()
so that callers are not exposed to frame swapping (between the decoding
and rendering frames) details.",False
0d7f0503896e952ed81ca488cde070ca4a2f8277,2018-02-08 23:09:38,Romain Vimont,"Unlock mutex on screen update failure

The mutex was not unlocked on all code paths.",False
e8dfb723af712af9049a37280851893333ff3034,2018-02-08 22:44:50,Romain Vimont,"Move control-related code to screencontrol.c

Move the code handling user input from scrcpy.c to a separate file,
screencontrol.c.",False
e1749a0c09b586794b131fcc7040c79433a486d9,2018-02-08 22:10:09,Romain Vimont,"Remove the ""adb reverse"" tunnel immediately

As soon as we accepted a connection, we can remove the ""adb reverse""
tunnel.",False
3b06e7d50063f1c47cf089e36903a6349a1d5afc,2018-02-08 22:10:09,Romain Vimont,"Move device-related code to device.c

Move the code to read the initial device info from scrcpy.c to a
separate file, device.c.",False
28c5cc030b440eb12d17aa333d10c5915868e49e,2018-02-08 22:10:09,Romain Vimont,"Move server-related code to server.c

The file server.c already existed, but exposed a low-level API. Make it
higher-level, so that scrcpy.c does not handle server details directly.",False
6c578b5caab66d2e3c055e5adb3fc3156baec52a,2018-02-08 20:13:28,Romain Vimont,"Move screen-related code to screen.c

The file scrcpy.c contains too many different things in addition to the
main logic, so move the screen code to a separate file, screen.c.",False
14c58546a7f8e6beb5a0848eb8d27af05a8d73d3,2018-02-08 19:56:08,Romain Vimont,"Add missing include guards

In practice, these headers are included only once, but it's a good
practice to always use include guards.",False
ffae15e36ae769288141f7fb5e0285b7753224b4,2018-02-08 17:56:01,Romain Vimont,"Rename control to controller

The struct decoder is defined in decoder.h.

For naming consistency, define the struct controller in controller.h.",False
7b7fd77134739110c99091d1254dd62ca72c8376,2018-02-08 13:38:55,Romain Vimont,"Add missing static

Some functions in scrcpy.c are not used outside the file, so declare
them static.",False
e55e42a44234fe6a97ca0ddd5239f1669ca115f7,2018-02-08 01:28:18,Romain Vimont,"Apply Genymobile rules for Android projects

Apply Genymobile checkstyle and gradle build files organization.",False
285fc97d02024b3f8df4e8818d54426d5a356996,2018-02-08 01:20:58,Romain Vimont,"Fix horizontal scrolling constant

Use AXIS_HSCROLL (available since API 12) instead of AXIS_SCROLL (since
API 26).",False
c6d01331ed20dadfbf161b834d18bc0879fd9b8d,2018-02-07 22:18:21,Romain Vimont,"Simplify EventController

In handleEvent(), connection.receiveControlEvent() may never return
null: either it returns a valid ControlEvent, either it throws an
Exception.

Therefore, there is no need to propagate a flag to indicate whether it
returned a valid ControlEvent.",False
03c5f97e3fc5e32e4177770fcf5070192b24a7cb,2018-02-07 22:15:28,Romain Vimont,"Extract control event parsing to separate methods

Use one parse method per control event type.",False
1eaa27ed9e9105b94df93e51b7292efe815a0033,2018-02-07 21:17:31,Romain Vimont,"Remove instrumented test dependencies

The server is not a real Android application, it's just a jar with a
main method. Instrumented tests are meaningless in this context.",False
5f51d605c037f75bc266b8d62c5048a803f639cf,2018-02-07 21:02:16,Romain Vimont,"Recreate codec and display on rotation changed

On some devices, we can reuse the same codec and display, but on some
others (e.g. Nexus 5X with Android 7.1.2), it crashes on codec.stop()
with an IllegalStateException.

Therefore, always recreate the codec and display, so that it works on
all devices.",False
d5acc8adc5dee4e5dafffd7ade717216fb8f0549,2018-02-07 20:20:38,Romain Vimont,"Always release output buffer

If rotation changed, the dequeued output buffer was never released. Move
it to a finally block to avoid the leak.",False
f39de46a3936f14d51f27e4510af7a2d348c466a,2018-02-07 20:11:59,Romain Vimont,"Add delay before stopping server

Let some time to print any exception trace before killing it.",False
cb1428223f60de96e282b5d814329888ca9a0f1f,2018-02-07 20:11:59,Romain Vimont,"Log user request to quit

Log at debug level user requests to quit.",False
7fe11033cb8f055b2838ee411d76b5621c5a1339,2018-02-07 20:11:59,Romain Vimont,"Include dependencies version

On --version, also print the dependencies version scrcpy has been
compiled against.",False
9f6464acffd8d3548454a8a81c56d5e5c31b1f32,2018-02-07 20:11:59,Romain Vimont,"Expose application version

Expose scrcpy version via -v or --version.",False
8d30d40b7958fdfad68e7a628f4e62b31451fa5e,2018-02-07 20:10:24,Romain Vimont,"Make SKIP_FRAMES a compilation flag

The skip_frames flag was a non-configurable runtime flag. Since it is
not exposed to the user, there is no need for a (possible) runtime cost.

For testing purpose, we still want it to be configurable, so make it a
compilation flag.",False
53ff1aa410f7fb38ff9d0640cd4a10063522cbf4,2018-02-07 16:39:10,Romain Vimont,"Use meson to configure default values

Make meson generate config.h with configured values.",False
cb7e29180fc258e43d9efa8118cf9171e9bcf84f,2018-02-07 16:18:25,Romain Vimont,"Change the window icon color in debug mode

To highlight the debug/release mode of the running application, use a
different window icon color in debug mode.",False
33062ffb8c19f745d5f7215478b48123ddd05bce,2018-02-07 16:17:10,Romain Vimont,"Add Makefile recipe for debug build

Expose commands to build the application in debug mode.",False
71c2bfdd22f153d2660dc405aeb96b94021f4375,2018-02-05 23:54:33,Romain Vimont,"Parse XPM without SDL_image

We encounter some problems with SDL2_image on MSYS2 (Windows), so
implement our own XPM parsing which does not depend on SDL_image.

The input XPM is considered safe (it's in our source repo), so do not
check XPM format errors. This implies that read_xpm() is not safe to
call on any unsafe input.

Although less straightforward, use SDL_CreateRGBSurfaceFrom() instead of
SDL_CreateRGBSurfaceWithFormatFrom() because it is available with SDL
versions older than 2.0.5.",False
920bafce731ac36cf5b30a5bd008e8f3218f0bb5,2018-02-05 23:54:00,Romain Vimont,"Revert ""Fix Makefile for Windows""

In MSYS2 on Windows, the behavior is the same as on Linux.

On systems where the behavior is not the same, just customize the GRADLE
variable:

    GRADLE=gradlew make release

This reverts commit de192cab1b5f0829fedd34d4feb569445c02346c.",False
f22d4decca96b5b6183eb109b4f458f9414a5d2b,2018-02-05 20:45:52,Romain Vimont,"Enable mouse focus clickthrough only if available

The hint SDL_HINT_MOUSE_FOCUS_CLICKTHROUGH appeared in SDL 2.0.5. Ignore
it if the SDL version is older.",False
de192cab1b5f0829fedd34d4feb569445c02346c,2018-02-05 19:22:19,Romain Vimont,"Fix Makefile for Windows

The default value of GRADLE is ""./gradlew"", which is the correct value
on Linux.

On Windows, it should use gradlew.bat (by calling ""gradlew"") instead.",False
52c89c7afb69f9279bf73173df756b5159eb5bfc,2018-02-05 19:16:00,Romain Vimont,"Add window icon

Add a bugdroid icon loaded from an XPM.",False
5eb91a4ca78434838e2f47e47ed3cb5d276a9a5b,2018-02-04 17:09:17,Romain Vimont,"Fix scrcpy() return value

The scrcpy() function returns a SDL_bool to indicate its success, but
was initialized to 0 (SDL_FALSE) instead of SDL_TRUE.",False
82ee55845cb22eb54a5173579e4abe0513a92efb,2018-02-04 16:47:34,Romain Vimont,"Add ""make run""

To run the app during development, add a recipe ""run"" to the Makefile.",False
1ac37c4291925195d0b76b1ade9f1ed13d2bf7df,2018-02-02 21:36:57,Romain Vimont,"Hide services in Device

Expose useful methods directly in Device, without exposing the service
managers.",False
06333e1e08c5be837bb3af538aa54770d6f74daa,2018-02-02 20:55:37,Romain Vimont,"Cache managers in ServiceManager

To guarantee that we instantiate services only one, cache the value the
first time.",False
69a359c7f45de54b21a9279e5e07fe4eb4e957a8,2018-02-02 19:53:04,Romain Vimont,"Refactor actions calls

The purpose of handle_shortcut() was to group all actions together,
whether they are initiated from a text input event or a keycode event.

However, it did not handle the case where it was initiated from a mouse
event (a right-click must turn the screen on), since the action was
identified by the shortcut char.

Instead, expose one function per action, to be called directly from
where the event is handled.",False
d73dee9833085d08bb4496d3c5d1831b75cb65cf,2018-02-02 19:47:03,Romain Vimont,fixup! Handle all shortcuts in the same function,False
0a70e24e80db283596ef73700b82e46c4c341446,2018-02-02 19:40:44,Romain Vimont,"Add new shortcuts description in help

Document the new shortcuts in the help (scrcpy --help).",False
3365460658303a40adca6a13d18dbccd6158d60f,2018-02-02 19:27:33,Romain Vimont,"Turn screen on on start

When starting scrcpy, immediately turn the screen on.",False
a139509f118f239ffa132caa042f3bbd1818de9d,2018-02-02 19:26:03,Romain Vimont,"Turn screen on on right-click

The right-click is almost useless on Android, so use it to turn the
screen on.

Add a new control event type (command) to request the server to turn the
screen on.",False
228545cefd96d06d66e75c90fb30b8cd534237d3,2018-02-02 19:22:00,Romain Vimont,"Reformat EventController

Reformated by Android Studio.",False
deba69d022bfc4bc31d17b93e0001e3e7a9421ea,2018-02-02 16:31:38,Romain Vimont,"Handle all shortcuts in the same function

Shortcuts are sometimes initiated from a keycode event, and sometimes
from a text input event.

Move the handling to a unique function.",False
7f6a565401efcdf4e1ececed7b1beaf72d73e97a,2018-02-02 16:22:19,Romain Vimont,"Extract shortcut actions to separate functions

To simplify event handling code, move all actions to separate functions.",False
f8ad007a2805f2f9f103ff5e7e2a02b9339b3641,2018-02-02 16:18:05,Romain Vimont,"Move switch fullscreen logs

Logs were printed by the caller of switch_fullscreen(). Move them inside
the function to simplify event handling code.",False
6fe7b84629d2fc562192e32f278fe2ddf3634d66,2018-02-02 16:09:25,Romain Vimont,"Add shortcuts for physical keys

Add shortcuts for HOME, BACK, APPS, POWER, VOLUME_UP and VOLUME_DOWN.",False
1faf6cfd9d7d51f4f15796c06370d14d818b9ce5,2018-02-02 14:07:10,Romain Vimont,"Rename the server scrcpy-server.jar

The server is built as an APK to simplify the build, but in fact this is
a simple jar (it is not even signed).

In order to avoid confusion, rename it to .jar, so that users do not try
to ""adb install"" it.

Also rename it from ""scrcpy"" to ""scrcpy-server"" to distinguish from the
client-side.",False
2172c53b7b067b01ae09bb6209f7d49b7ca7cf71,2018-02-02 14:04:52,Romain Vimont,"Force the server target filename

The server path may be customized using SCRCPY_APK. If its basename is
different from ""scrcpy.apk"", it will be pushed with a different name,
so the execution would fail.

Therefore, force the push target filename.",False
ca44585f9642f300bd457a8dbf7a14c1d7d26aad,2018-02-02 13:56:25,Romain Vimont,"Do not send simple mouse move events

Moving the mouse without any button pressed has no effect on Android.
Therefore, do not even send these very frequent events.",False
79b28eb68ff87110fad9b4b08db56fd56c9ec0a2,2018-02-02 01:22:44,Romain Vimont,"Enable mouse focus clickthrough

Consider a click to gain focus as a click on the device.",False
6b546a87abf803136d23a0661814be926940945e,2018-02-01 21:41:40,Romain Vimont,"Add bit-rate command-line option

Add a command-line option (-b/--bit-rate) to customize the video
bit-rate.",False
7fe7bbf58cbb7f8a6c37520442e1b34bb6909b75,2018-02-01 21:41:40,Romain Vimont,"Check empty string before strtol()

There is no need to call strtol() if the input string is empty.",False
3bc63708b4d56d00746cf0e655f65a391a088fae,2018-02-01 21:41:40,Romain Vimont,"Remove useless newlines in SDL_Log*

Trailing new line is not necessary in SDL_Log* methods.",False
2683fa20ed759d523f252b01e5d45ce5833755ad,2018-02-01 21:41:40,Romain Vimont,"Add debug log for shortcuts

Add a debug log for every succeeded shortcut action.",False
274e1ac9ec04f93c47bd58867d774545cf3ce450,2018-02-01 21:41:40,Romain Vimont,"Fix rotation bug in fullscreen mode on X11

On rotation, scrcpy resize the window to match the new rotation.
However, in fullscreen mode, setting the window size does not change the
windowed size on X11, so the behavior is incorrect.

To avoid the problem, apply the resize only after fullscreen is
disabled.",False
35a111d56e300b9f143044d05d213689a1c6d330,2018-02-01 21:41:40,Romain Vimont,"Add --help

Provide command-line help, with -h/--help option.",False
ee93f3f23a74591d67e772f8e27e1141684c514e,2018-02-01 21:41:40,Romain Vimont,"Rename maximum_size to max_size

The long option is --max-size, so for consistency, adapt the code
accordingly.",False
213b721ff942560a4de5e94ccd0e9945f7bc194f,2018-02-01 20:05:20,Romain Vimont,"Use long command-line options

In addition to the short form (e.g. ""-p""), add the long form (""--port"").",False
60b2f2ca640b0a32fb32b7d8cde92e3b663cf5cf,2018-02-01 16:14:20,Romain Vimont,"Indent switch blocks content

For readability, indent ""case"" in switch blocks.

Replace:

    switch (x) {
    case 1:
        // ...
    case 2:
        // ...
    case 3: { // a local scope block
        int i = 42;
        // ...
    }
    }

By:

    switch (x) {
        case 1:
            // ...
        case 2:
            // ...
        case 3: { // a local scope block
            int i = 42;
            // ...
        }
    }",False
628f88ab897935f168a544a3b22a09d9a1b1a4a4,2018-02-01 00:21:43,Romain Vimont,"Use ADB environment variable

Use the ADB environment variable to provide a custom adb path.",False
865ebb3862398c3ba8c8dcba73189256880372f0,2018-02-01 00:21:43,Romain Vimont,"Encode video using MediaCodec API

Replace screenrecord execution by manual screen encoding using the
MediaCodec API.

The ""screenrecord"" solution had several drawbacks:
 - screenrecord output is buffered, so tiny frames may not be accessible
   immediately;
 - it did not output a frame until the surface changed, leading to a
   black screen on start;
 - it is limited to 3 minutes recording, so it needed to be restarted;
 - screenrecord added black borders in the video when the requested
   dimensions did not preserve aspect-ratio exactly (sometimes
   unavoidable since video dimensions must be multiple of 8);
 - rotation handling was hacky (killing the process and starting a new
   one).

Handling the encoding manually allows to solve all these problems.",False
7ed334915e1ed68b41b13e5823ed031c9264f08a,2018-02-01 00:20:45,Romain Vimont,"Register uncaught exception handler

Never miss an exception by using an uncaught exception handler.",False
8c4a454d683d6e779f3f7c84551f6d1521eaac7c,2018-02-01 00:19:49,Romain Vimont,"Extract argument parsing

Move argument parsing to a separate method.",False
73831a0837e7180237f9b63848110bbc588567dd,2018-02-01 00:12:08,Romain Vimont,"Use the Point class from the framework

Replace our custom Point class by android.graphics.Point.",False
b67907e24e948cd000199ca324289883fa796ad1,2018-01-30 16:31:36,Romain Vimont,"Convert server to an Android project

To simplify the device server-side build, use gradle to create an APK,
even if we use it as a simple jar, by running its main() method.",False
89f6a3cfe7ea74be51b0f91b8da46f27c5214038,2018-01-29 20:10:33,Romain Vimont,"Handle resized video stream

Accept a parameter to limit the video size.

For instance, with ""-m 960"", the great side of the video will be scaled
down to 960 (if necessary), while the other side will be scaled down so
that the aspect ratio is preserved. Both dimensions must be a multiple
of 8, so black bands might be added, and the mouse positions must be
computed accordingly.",False
2c4ea6869eb7975facd5cbceb4b4a2da580bb970,2018-01-29 19:30:15,Romain Vimont,"Do not use device as a singleton

The device instance should be able to store a state (e.g. the maximum
size requested by the user), so it should not be a singleton.",False
879941355dcae24a6c1ed4226b5bc524143af0b9,2018-01-29 19:22:22,Romain Vimont,"Swap position/point names

A point is a 2D vector. A position represent a point relative to the
screen size.",False
f70359f14fb13f277c65b96f43ec83aba4722457,2018-01-25 21:47:21,Romain Vimont,"Inject mouse events as touchscreen

As a mouse, some clicks on close prositions are sometimes not generated
on some devices.",False
1930c8106225b4b6d4b51f3b2557c84ab644e1f0,2018-01-25 21:46:32,Romain Vimont,"Add toString() methods to java point classes

Useful for debugging.",False
dca53ff931912ebe31b2bc58e549f584d3ac24a8,2018-01-25 21:45:40,Romain Vimont,"Add missing source files in server Makefile

All classes were still built, but make was not able to detect changes on
missing files.",False
2aa15db21035fbedf3d278376f6cf4c92c8ebe3d,2018-01-24 14:26:42,Romain Vimont,"Add shortcut to resize to ratio 1:1

Make Ctrl+g resize the window to the size of the video (pixel-perfect).",False
ab2c3de9f57be7f26a75362830c5b704a0c06e27,2018-01-24 14:23:09,Romain Vimont,"Capture all Ctrl events

For consistency, capture all Ctrl events (not only those we react to).",False
2c352206183b58da45148b4284e4149e9f2aa5bb,2018-01-23 21:14:59,Romain Vimont,"Rename screen -> scrcpy -> main

Rename scrcpy.c to main.c (this file handles the command line parsing),
and screen.c to scrcpy.c (it exposes the entry point scrcpy()).",False
8984c1a7c4d2476715ba1dd119a5e22b726b4071,2018-01-23 21:14:59,Romain Vimont,"Scale mouse events

The video screen size on the client may differ from the real device
screen size (e.g. the video stream may be scaled down). As a
consequence, mouse events must be scaled to match the real device
coordinates.

For this purpose, make the client send the video screen size along with
the absolute pointer location, and the server scale the location to
match the real device size before injecting mouse events.",False
11a60e57676b276355b1fa4961347f9c69580651,2018-01-23 21:14:59,Romain Vimont,"Keep screen info in cache

Currently, we only use screen information (width, height, rotation)
once at initialization, to send the device size to the client.

To be able to scale mouse events, make it accessible in memory. For this
purpose, replace the ""static"" DeviceUtil to a singleton Device, and
update it on every screen rotation.",False
d7b00a9babf7cffac2dd415f51cfdfeea09d8b59,2018-01-23 20:50:03,Romain Vimont,"Move server-related functions to server.c

In addition to the functions to start/stop the server, move the
functions to push the jar and enable/disable the ""adb reverse"" tunnel.",False
3078894d1f7577b33097417b382ff2f174e48ffb,2018-01-23 20:50:03,Romain Vimont,"Add debug log on new screenrecord execution

To easily notice problems with screenrecord execution, log every new
instance started.",False
7d67696b7e8928013fa008f17a3794f67fe70b23,2018-01-22 15:59:44,Romain Vimont,"Extract server-related functions

To lighten screen.c, move start_server() and stop_server() to a separate
file.",False
52af91f6b0aed9467aacd243ea7b10f63e28dd6b,2018-01-19 21:25:39,Romain Vimont,"Add unit tests for control event serialization

Test serialization of the 4 types of events (keycode, text, mouse,
scroll).",False
90c69d2c79dff2c9e3f0f66abb3466062d337c61,2018-01-19 19:43:38,Romain Vimont,"Use pointers-to-const where relevant

Explicitly declare const a function parameter intended to be read-only.",False
53cd59605ae5526f024233d1e55baf853b0845bb,2018-01-19 18:39:15,Romain Vimont,"Ignore keycodes generating unwanted events

Ctrl, Alt, Shift and Meta should not be transmitted to the Android
device: they may generate unwanted events. For instance, resizing the
window using Alt+click will generate an Alt event which may open a menu
on the device.

All keycodes that generate a text input must also be excluded, to avoid
the text input to be written twice.",False
66b7a99db64cd8ed38c84f7f555a8e98895a1fec,2018-01-19 15:45:51,Romain Vimont,"Fix includes windows-specific source

The header strutil.h is two levels above sys/win/command.c, and
SDL_log.h was missing.",False
fbf2d340067c3f671ad7a8961524ec15effab6c6,2018-01-18 21:58:05,Romain Vimont,Add unit testing instructions in README,False
f75c404a269d584cd96c351b28ca0c31ecef2536,2018-01-18 21:55:13,Romain Vimont,"Add tests for strutil

Test our custom string handling functions.",False
cabb102a04153f9c237b18257d3269a058558c63,2018-01-18 21:55:13,Romain Vimont,"Implement keyboard/mouse control

To control the device from the computer:
 - retrieve mouse and keyboard SDL events;
 - convert them to Android events;
 - serialize them;
 - send them on the same socket used by the video stream (but in the
 opposite direction);
 - deserialize the events on the Android side;
 - inject them using the InputManager.",False
6605ab8e23fbbfac26d6227d50ea90992bdc28e6,2018-01-18 21:23:20,Romain Vimont,Log to android logger and stdout/stderr,False
95591d293891b2657c0604616dcdc633a3a5eaac,2018-01-04 14:52:09,Romain Vimont,"Move platform specific to sys/

Move unix/ and win/ to sys/, so that we can use android/ for android
headers without confusion.",False
a919944372d887ec6ea094621c4f0d4dc6dbf36a,2018-01-04 14:52:09,Romain Vimont,"Use _exit() instead of exit() in child process

exit() should not be called from within a child process, since it would
call functions registered with atexit(), and flush stdio streams. Use
_exit() instead.",False
07b3918129bba1051198d06d183e3a90b5ab0d8f,2017-12-19 18:42:11,Romain Vimont,"Do not call SDL_Quit()

It may crash in i965_dri.so when calling SDL_Quit (probably a driver
bug). To avoid a segmentation fault, do not call SDL_Quit().",False
a005df7b375c4d4fe11c71ee5a574be05d657034,2017-12-19 18:41:55,Romain Vimont,"Always destroy in reverse order

For consistency and safety, always destroy objects in reverse order they
were initialized.",False
de106747b6f456286429b8c40bff3edd0b9af771,2017-12-18 15:59:34,Romain Vimont,"Improve main() error handling

Parse the command-line arguments first, and do not ignore avformat
network init failure. At the end, deinit the avformat network.",False
bb8afa9324ba0572150bf6cae812b7e904cd778b,2017-12-18 15:57:55,Romain Vimont,"Fix comment about data sent over the socket

We now send the device name in addition to the screen dimensions on the
socket. Update the comment accordingly.",False
d972a88c1a0e3fe4ee3b116c5228542df60a1b4e,2017-12-18 15:37:42,Romain Vimont,"Optimize includes

Only include SDL_stdinc.h for SDL_bool, not the whole SDL.h.",False
d5b349f670a9ee896c7e16bbdf9582534a00e016,2017-12-18 15:37:42,Romain Vimont,"Do not inline lockutil functions

This duplicates chars in the final binary.",False
a9b276aa67dd924eec2066e5c36c2011a6b39f2b,2017-12-15 21:49:43,Romain Vimont,"Remove useless forward declarations

The required headers are included anyway.",False
b9c9466d6598b36c562bdcf2c964502d5f91fcce,2017-12-15 21:45:55,Romain Vimont,"Handle condition variable failure

Add condition variables function wrappers to handle unexpected failure.",False
c4266e487b033ff95b2dfddedd8c9a06cbca7fd1,2017-12-15 21:45:55,Romain Vimont,"Rename (un)lock_mutex to mutex_(un)lock

For consistency, rename lock_mutex and unlock_mutex to mutex_lock and
mutex_unlock.",False
ad667bfa20aabb03c2fd3b7939fdc5bae26f24db,2017-12-15 16:07:29,Romain Vimont,"Fix function signature

Use void for parameters (this project is in C).",False
37d88b8a6a4209fc36a993fc1fbada5c6c97c03c,2017-12-15 15:57:54,Romain Vimont,"Use SDL_bool return type instead of int

Many functions returned an int to indicate their success. For clarity,
use SDL_bool instead.",False
2b44052f800b82baf5ba722c4bd6f305fc0f655a,2017-12-15 15:42:02,Romain Vimont,"Destroy condition variable on frames destruction

A condition variable was init for the ""struct frames"", but was never destroyed.",False
1a71c4ab1d836fd014588c822cf6798285641718,2017-12-14 16:11:08,Romain Vimont,"Implement framework wrappers separately

Move the DeviceUtil internal static classes to public classes, in a
separate package ("".wrappers"").

This paves the way to implement InputManager properly.",False
39fd6ce518c13769ef6e627adab90412c5f556bf,2017-12-13 14:32:07,Romain Vimont,"Send device name on the socket

Make the server send the device name along with the width and height, so
that the client may use it as the window title.",False
9d141a7f50a0e81e1df751694f240b9ceac4f9f1,2017-12-12 20:30:49,Romain Vimont,Add README,False
54d9148a36decdf0dcc412560ae50870a7790fde,2017-12-12 19:55:15,Romain Vimont,"Initial commit

Start a new clean history from here.",False
